(()=>{var Ft=Object.assign;var k=class{constructor(t,e){this.x=t,this.y=e}get copy(){return new k(this.x,this.y)}setCoordinates(t,e){this.x=t,this.y=e}get length(){return Math.sqrt(this.x*this.x+this.y*this.y)}get sqlength(){return this.x*this.x+this.y*this.y}get heading(){if(this.x===0&&this.y===0)return 0;if(this.x===0)return this.y>0?Math.PI/2:1.5*Math.PI;if(this.y===0)return this.x>0?0:Math.PI;let t=k.normalized(this);return this.x>0&&this.y>0?Math.asin(t.y):this.x<0&&this.y>0?Math.asin(-t.x)+Math.PI/2:this.x<0&&this.y<0?Math.asin(-t.y)+Math.PI:this.x>0&&this.y<0?Math.asin(t.x)+1.5*Math.PI:0}add(t){this.x+=t.x,this.y+=t.y}sub(t){this.x-=t.x,this.y-=t.y}mult(t){this.x*=t,this.y*=t}div(t){this.x/=t,this.y/=t}lerp(t,e){this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e}dist(t){return new k(this.x-t.x,this.y-t.y).length}pNorm(t){let e=t;return e<1&&(e=1),(Math.abs(this.x**e)+Math.abs(this.y**e))**(1/e)}setMag(t){this.length!==0&&this.mult(t/this.length)}normalize(){this.length!==0&&this.div(this.length)}rotate(t){let e=Math.cos(t),s=Math.sin(t);this.setCoordinates(this.x*e-this.y*s,this.x*s+this.y*e)}static rotateArr(t,e){let s=Math.cos(e),o=Math.sin(e);t.forEach(a=>{a.setCoordinates(a.x*s-a.y*o,a.x*o+a.y*s)})}rotate90(){let{x:t}=this;this.x=-this.y,this.y=t}rotate270(){let{x:t}=this;this.x=this.y,this.y=-t}static add(t,e){return new k(t.x+e.x,t.y+e.y)}static sub(t,e){return new k(t.x-e.x,t.y-e.y)}static mult(t,e){return new k(t.x*e,t.y*e)}static div(t,e){return new k(t.x/e,t.y/e)}static fromAngle(t){return new k(Math.cos(t),Math.sin(t))}static fromAnglePNorm(t,e){let s=new k(Math.cos(t),Math.sin(t));return s.div(s.pNorm(e)),s}static lerp(t,e,s){return k.add(t,k.mult(k.sub(e,t),s))}static dist(t,e){return k.sub(t,e).length}static dot(t,e){return t.x*e.x+t.y*e.y}static cross(t,e){return t.x*e.y-t.y*e.x}static crossScalarFirst(t,e){return new k(-e.y*t,e.x*t)}static crossScalarSecond(t,e){return new k(t.y*e,-t.x*e)}static angle(t,e){return Math.acos(Math.min(Math.max(k.dot(t,e)/Math.sqrt(t.sqlength*e.sqlength),1),-1))}static angleACW(t,e){let s=t.heading,a=e.heading-s;return a<0?2*Math.PI+a:a}static normalized(t){let e=t.length;return e===0?t:new k(t.x/e,t.y/e)}toJSON(){return{x:this.x,y:this.y}}static fromObject(t){return new k(t.x,t.y)}},n=k;var Lt=class{constructor(t,e){this.a=t,this.b=e}get length(){return n.dist(this.a,this.b)}distFromPoint(t){let e=n.sub(this.a,this.b),s=n.sub(t,this.b),o=n.sub(t,this.a),a=s.length,h=o.length,c=e.length;if(c===0)return a;let u=n.angle(s,o),l=n.angle(s,e),r=Math.PI-u-l,d=Math.sin(r)*h*c/2,m=2*d/c;return r>Math.PI/2?h:l>Math.PI/2?a:m}get nearestPointO(){let t=n.sub(this.b,this.a);if(n.dot(this.a,t)>=0)return this.a.copy;if(n.dot(this.b,t)<=0)return this.b.copy;t.normalize();let e=-n.dot(this.a,t);return n.add(this.a,n.mult(t,e))}static intersect(t,e){let s=n.sub(t.b,t.a),o=s.y/s.x,a=t.b.y-t.b.x*o,h=n.sub(e.b,e.a),c=h.y/h.x,u=e.b.y-e.b.x*c;if(s.x===0&&h.x!==0){if(t.a.x>=e.a.x&&t.a.x<=e.b.x||t.a.x<=e.a.x&&t.a.x>=e.b.x){let g=c*t.a.x+u;if(g>t.a.y&&g<t.b.y||g<t.a.y&&g>t.b.y)return new n(t.a.x,g)}return!1}if(h.x===0&&s.x!==0){if(e.a.x>=t.a.x&&e.a.x<=t.b.x||e.a.x<=t.a.x&&e.a.x>=t.b.x){let g=o*e.a.x+a;if(g>e.a.y&&g<e.b.y||g<e.a.y&&g>e.b.y)return new n(e.a.x,g)}return!1}if(s.x===0&&h.x===0){if(t.a.x===e.a.x){let g;t.a.y<t.b.y?g=[t.a.y,t.b.y]:g=[t.b.y,t.a.y];let f;e.a.y<e.b.y?f=[e.a.y,e.b.y]:f=[e.b.y,e.a.y];let p=[g[0]>f[0]?g[0]:f[0],g[1]<f[1]?g[1]:f[1]];if(p[0]<=p[1])return new n(t.a.x,(p[0]+p[1])/2)}return!1}let l;t.a.x<t.b.x?l=[t.a.x,t.b.x]:l=[t.b.x,t.a.x];let r;e.a.x<e.b.x?r=[e.a.x,e.b.x]:r=[e.b.x,e.a.x];let d=[l[0]>r[0]?l[0]:r[0],l[1]<r[1]?l[1]:r[1]];if(o===c&&a===u&&d[0]<=d[1])return new n((d[0]+d[1])/2,(d[0]+d[1])/2*o+a);let m=(u-a)/(o-c);return m>=d[0]&&m<=d[1]?new n(m,m*o+a):!1}},w=Lt;var Nt=class extends w{get length(){return Number.POSITIVE_INFINITY}distFromPoint(t){let e=n.sub(this.a,this.b);e.setMag(1),e.rotate(Math.PI/2);let s=n.sub(t,this.a);return Math.abs(n.dot(s,e))}static intersect(t,e){let s=n.sub(t.b,t.a),o=s.y/s.x,a=t.b.y-t.b.x*o,h=n.sub(e.b,e.a),c=h.y/h.x,u=e.b.y-e.b.x*c;if(o===c)return t.distFromPoint(e.a)===0?new n((t.a.x+t.b.x+e.a.x+e.b.x)/4,(t.a.y+t.b.y+e.a.y+e.b.y)/4):!1;let l=(u-a)/(o-c);return new n(l,o*l+a)}static intersectWithLineSegment(t,e){let s=n.sub(t.b,t.a),o=s.y/s.x,a=t.b.y-t.b.x*o,h=n.sub(e.b,e.a),c=h.y/h.x,u=e.b.y-e.b.x*c;if(s.x===0){if(h.x===0)return t.a.x===e.a.x?new n((e.a.x+e.b.x)/2,(e.a.y+e.b.y)/2):!1;let d=t.a.x,m=c*d+u;return Math.min(e.a.x,e.b.x)<d&&d<Math.max(e.a.x,e.b.x)&&Math.min(e.a.y,e.b.y)<m&&Math.max(e.a.y,e.b.y)>m?new n(d,m):!1}if(h.x===0){let d=e.a.x,m=o*d+a;return Math.min(e.a.x,e.b.x)<d&&d<Math.max(e.a.x,e.b.x)&&Math.min(e.a.y,e.b.y)<m&&Math.max(e.a.y,e.b.y)>m?new n(d,m):!1}if(o===c)return t.distFromPoint(e.a)===0?new n((e.a.x+e.b.x)/2,(e.a.y+e.b.y)/2):!1;let l=(u-a)/(o-c),r=o*l+a;return Math.min(e.a.x,e.b.x)<l&&l<Math.max(e.a.x,e.b.x)&&Math.min(e.a.y,e.b.y)<r&&Math.max(e.a.y,e.b.y)>r?new n(l,r):!1}},z=Nt;function G(i,t,e,s){let o=s,a=e,h=i,c=t,u=h.vel,l=c.vel,r=h.ang,d=c.ang,m=n.sub(a,h.pos),g=n.sub(a,c.pos),f=h.am,p=c.am,y=h.m,x=c.m,S=(h.k+c.k)/2,I=(h.fc+c.fc)/2,v=h.velInPlace(a),mt=c.velInPlace(a),M=n.sub(mt,v),P=1/y+1/x;P+=n.dot(n.crossScalarFirst(n.cross(m,o)/f,m),o),P+=n.dot(n.crossScalarFirst(n.cross(g,o)/p,g),o),P=-((1+S)*n.dot(M,o))/P;let tt=n.sub(u,n.mult(o,P/y)),et=n.add(l,n.mult(o,P/x)),ft=r-P*n.cross(m,o)/f,gt=d+P*n.cross(g,o)/p,B=M.copy;if(B.sub(n.mult(o,n.dot(M,o))),B.setMag(1),n.dot(o,B)**2>.5){h.vel=tt,c.vel=et,h.ang=ft,c.ang=gt;return}let j=1/y+1/x;j+=n.dot(n.crossScalarFirst(n.cross(m,B)/f,m),B),j+=n.dot(n.crossScalarFirst(n.cross(g,B)/p,g),B),j=-n.dot(M,B)/j;let q=Math.sign(j)*P*I;Math.abs(q)>Math.abs(j)&&(q=j),tt=n.sub(tt,n.mult(B,q/y)),et=n.add(et,n.mult(B,q/x)),ft-=q*n.cross(m,B)/f,gt+=q*n.cross(g,B)/p,h.vel=tt,c.vel=et,h.ang=ft,c.ang=gt}function W(i,t,e){let s=t,o=e,a=i,h=n.sub(s,a.pos),{am:c,m:u}=a,l=n.mult(a.velInPlace(s),-1),r=1/u;r+=n.dot(n.crossScalarFirst(n.cross(h,o)/c,h),o),r=-((1+a.k)*n.dot(l,o))/r;let d=n.sub(a.vel,n.mult(o,r/u)),m=a.ang-r*n.cross(h,o)/c,g=l.copy;if(g.sub(n.mult(o,n.dot(l,o))),g.setMag(1),n.dot(o,g)**2>.5){a.vel=d,a.ang=m;return}let f=1/u;f+=n.dot(n.crossScalarFirst(n.cross(h,g)/c,h),g),f=-n.dot(l,g)/f;let p=Math.sign(f)*r*a.fc;Math.abs(p)>Math.abs(f)&&(p=f),d=n.sub(d,n.mult(g,p/u)),m-=p*n.cross(h,g)/c,a.vel=d,a.ang=m}function L(i,t){this.min=i,this.max=t}L.prototype.size=function(){return this.max-this.min};function T(i){return new L(Math.min(...i),Math.max(...i))}function V(i,t){return new L(Math.max(i.min,t.min),Math.min(i.max,t.max))}function Rt(i,t,e,s){let o=[...e,...s],a=m=>T(i.map(g=>n.dot(g,m))),h=m=>T(t.map(g=>n.dot(g,m))),c=[];if(o.some(m=>{let g=a(m),f=h(m),p=V(g,f);return c.push(p),p.max<p.min}))return!1;let u=c.map(m=>m.size()),l=u[0],r=0;for(let m=1;m<u.length;m+=1)l>u[m]&&(l=u[m],r=m);return{normal:o[r].copy,overlap:l,index:r}}var pt={white:"#faf3dd",green:"#02c39a",pink:"#e58c8a",blue:"#3db2f1",black:"#363732",Beige:"#f2f3d9",Independence:"#38405f",Turquoise:"#5dd9c1","Rich Black FOGRA 29":"#0e131f","Independence 2":"#59546c","Roman Silver":"#8b939c","Imperial Red":"#ff0035","Hot Pink":"#fc6dab","Maximum Yellow Red":"#f5b841","Lavender Web":"#dcd6f7"},X=pt,st=pt.Turquoise,R=pt.Turquoise;var J=class{constructor(t,e,s,o,a,h){this.pos=t.copy,this.lastPos=this.pos.copy,this.r=s,this.fc=.4,this.amc=.5,this.density=1,this.rotation=0,a?this.ang=a:this.ang=0,(h||h===0)&&(this.fc=h),Number.isFinite(o)?this.k=o:this.k=.8,e!==void 0?this.vel=e.copy:this.vel=new n(0,0),this.layer=void 0,this.style=st}get m(){return this.density*this.r*this.r*Math.PI}get am(){return this.amc*this.r*this.r*this.m}getAmInPoint(t){let e=this.am;return e+=n.sub(this.pos,t).sqlength*this.m,e}get copy(){let t=new J(this.pos.copy,this.vel.copy,this.r,this.k,this.ang,this.fc);return t.lastPos=this.lastPos.copy,t.rotation=this.rotation,t}move(t,e){this.pos.x+=t,this.pos.y+=e}rotate(t){this.rotation+=t}collided(t){return this.pos.dist(t.pos)<this.r+t.r}static collide(t,e){if(!t.collided(e))return;let s=n.dist(t.pos,e.pos),o=t.m,a=e.m,h=t.pos.copy,c=e.pos.copy,u=t,l=e,r=t.r+e.r-s,d=n.sub(t.pos,e.pos);if(d.setMag(1),d.mult(r*a/(o+a)),h.add(d),d.setMag(1),d.mult(-r*o/(o+a)),c.add(d),u.pos=h,l.pos=c,n.dot(d,n.sub(t.vel,e.vel))<0)return;d.setMag(1);let m=n.add(t.pos,n.mult(d,t.r));return G(t,e,m,d),{cp:m,n:d}}containsPoint(t){return n.dist(this.pos,t)<=this.r}velInPlace(t){let e=n.sub(t,this.pos);return e.rotate(Math.PI/2),e.mult(this.ang),e.add(this.vel),e}effectiveMass(t,e){let s=n.sub(t,this.pos);if(s.length===0)return this.m;let o=n.angle(e,s),a=Math.sin(o)**2*s.length**2/this.am;return 1/(a+1/this.m)}applyDeltaVelInPoint(t,e){let s=n.sub(e,this.pos);if(s.length===0){this.vel.add(t);return}let o=n.angle(s,t),a=n.mult(s,n.dot(t,s)/s.length**2);this.vel.add(a);let h=s.copy;h.rotate(Math.PI/2),h.setMag(1);let c=Math.sign(n.dot(t,h)),u=t.length*Math.cos(o),l=1/(1/this.m+s.length**2/this.am),r=u*l/this.m;this.vel.add(n.mult(h,r*c));let d=c*u*l*s.length/this.am;this.ang-=d}toJSON(){let t={};return t.pos=this.pos.toJSON(),t.lastPos=this.lastPos.toJSON(),t.r=this.r,t.fc=this.fc,t.amc=this.amc,t.rotation=this.rotation,t.ang=this.ang,t.fc=this.fc,t.k=this.k,t.vel=this.vel.toJSON(),typeof this.layer!="undefined"&&(t.layer=this.layer),t.style=this.style,t}static fromObject(t){let e=new J(n.fromObject(t.pos),n.fromObject(t.vel),t.r,t.k,t.ang,t.fc);return e.lastPos=n.fromObject(t.lastPos),e.amc=t.amc,e.rotation=t.rotation,e.vel=n.fromObject(t.vel),typeof t.layer!="undefined"&&(e.layer=t.layer),e.style=t.style,e}},C=J;var ve=15,nt=class{constructor(t){this.points=t;let e=this.points,s=0,o=0,a=n.angleACW(n.sub(e[1],e[0]),n.sub(e[e.length-1],e[0]));this.points.length>0?[this.center]=[this.points[0]]:this.center=new n(0,0),this.boundRadius=1,this.calculateCenterAndRadius(),this.boundsX=new L(0,0),this.boundsY=new L(0,0),this.calculateBoundingBox(),this.axes=[],this.calculateAxes(),s+=a,o+=Math.PI*2-a;for(let c=1;c<e.length-1;c+=1)a=n.angleACW(n.sub(e[(c+1)%e.length],e[c]),n.sub(e[c-1],e[c])),s+=a,o+=Math.PI*2-a;if(a=n.angleACW(n.sub(e[0],e[e.length-1]),n.sub(e[e.length-2],e[e.length-1])),s+=a,o+=Math.PI*2-a,o>s)return;let h=[];for(let c=e.length-1;c>=0;c-=1)h.push(e[c]);this.points=h}calculateBoundingBox(){this.boundsX=T(this.points.map(t=>t.x)),this.boundsY=T(this.points.map(t=>t.y))}calculateAxes(){let t=Math.cos(Math.PI/ve);this.axes=this.normals.map(e=>new n(e.x,Math.abs(e.y)));for(let e=this.axes.length-2;e>=0;e-=1)for(let s=this.axes.length-1;s>e;s-=1){let o=this.axes[s],a=this.axes[e];Math.abs(n.dot(o,a))>t&&(this.axes.splice(s,1),this.axes[e]=o)}}collideWithBall(t){let e,s,o=t,a=this.points.some((h,c)=>{let u=n.sub(o.pos,h);u.sqlength<=t.r*t.r&&(e=h,s=u);let l=this.points[(c+1)%this.points.length].copy,r=new n(l.x-h.x,l.y-h.y),d=r.sqlength;r.setMag(1);let m=r.copy;m.rotate270();let g=n.dot(u,r),f=n.dot(u,m);return f>=-t.r&&f<t.r&&g>=0&&g*g<=d?(e=n.add(h,n.mult(r,g)),s=m,!0):!1});if(typeof s!="undefined"&&(a||s.setMag(1),typeof e!="undefined"))return s.mult(-1),o.pos=n.add(e,n.mult(s,-t.r)),W(o,e,s),{cp:e,n:s}}get normals(){return this.sides.map(t=>{let e=n.sub(t.b,t.a);return e.setMag(1),e.rotate270(),e})}containsPoint(t){let{sides:e}=this,s=Math.max(...this.points.map(c=>n.dist(c,t)))+1,o=n.fromAngle(0);o.setMag(s);let a=new w(t,n.add(o,t));return e.filter(c=>w.intersect(c,a)!==void 0).length%2==1}calculateCenterAndRadius(){this.center=this.points.reduce((t,e)=>n.add(t,e)),this.center.div(this.points.length),this.boundRadius=Math.max(...this.points.map(t=>n.dist(t,this.center)))}get sides(){return this.points.map((t,e)=>new w(t,this.points[(e+1)%this.points.length]))}toJSON(){let t={};return t.points=this.points.map(e=>({x:e.x,y:e.y})),t}static fromObject(t){return new nt(t.points.map(s=>new n(s.x,s.y)))}},H=nt;var we=15,U=class{constructor(t,e,s,o,a){this.points=t,this.pos=new n(t[0].x,t[0].y);let h=this.points,c=0,u=0,l=n.angleACW(n.sub(h[1],h[0]),n.sub(h[h.length-1],h[0]));c+=l,u+=Math.PI*2-l;for(let r=1;r<h.length-1;r+=1)l=n.angleACW(n.sub(h[(r+1)%h.length],h[r]),n.sub(h[r-1],h[r])),c+=l,u+=Math.PI*2-l;if(l=n.angleACW(n.sub(h[0],h[h.length-1]),n.sub(h[h.length-2],h[h.length-1])),c+=l,u+=Math.PI*2-l,u<c){let r=[];for(let d=h.length-1;d>=0;d-=1)r.push(h[d]);this.points=r}this.m=1,this.am=1,this.boundRadius=1,this.boundsX=new L(0,0),this.boundsY=new L(0,0),this.defaultAxes=[],this.axes=[],this.recalculateBoundingBox(),this.calculatePosAndMass(),this.calculateAxes(),this.lastPos=this.pos.copy,this.fc=.4,this.rotation=0,Number.isFinite(o)?this.ang=o:this.ang=0,(a||a===0)&&(this.fc=a),Number.isFinite(s)?this.k=s:this.k=.8,e!==void 0?this.vel=e.copy:this.vel=new n(0,0),this.style=R}calculateAxes(){let t=Math.cos(Math.PI/we);this.defaultAxes=this.normals.map(e=>new n(e.x,Math.abs(e.y)));for(let e=this.defaultAxes.length-2;e>=0;e-=1)for(let s=this.defaultAxes.length-1;s>e;s-=1){let o=this.defaultAxes[s],a=this.defaultAxes[e];Math.abs(n.dot(o,a))>t&&(this.defaultAxes.splice(s,1),this.defaultAxes[e]=o)}this.axes=this.defaultAxes.map(e=>e.copy)}support(t){let e=Number.NEGATIVE_INFINITY,s=this.pos;return this.points.forEach(o=>{let a=n.dot(t,o);a>e&&(e=a,s=o)}),s.copy}getAmInPoint(t){let e=this.am;return e+=n.sub(this.pos,t).sqlength*this.m,e}get copy(){let t=this.points.map(s=>new n(s.x,s.y)),e=new U(t,this.vel.copy,this.k,this.ang,this.fc);return e.rotation=this.rotation,e.lastPos=this.lastPos.copy,e.pos=this.pos.copy,e}move(t,e){this.pos.x+=t,this.pos.y+=e,this.points.forEach(s=>{let o=s;o.x+=t,o.y+=e}),this.boundsX.min+=t,this.boundsX.max+=t,this.boundsY.min+=e,this.boundsY.max+=e}recalculateBoundingBox(){this.boundsX=T(this.points.map(t=>t.x)),this.boundsY=T(this.points.map(t=>t.y))}collideWithBall(t){let e,s,o;if(!(n.dist(t.pos,this.pos)>t.r+this.boundRadius)&&(this.points.forEach((a,h)=>{let c=new n(a.x,a.y);if(c.x-=t.pos.x,c.y-=t.pos.y,c.length<=t.r){e=c.heading+Math.PI,s=c.length;let g=n.fromAngle(e);g.mult(t.r-s),this.move(g.x*-1*t.m/(this.m+t.m),g.y*-1*t.m/(this.m+t.m)),t.move(g.x*1*this.m/(this.m+t.m),g.y*1*this.m/(this.m+t.m)),o=new n(a.x,a.y)}c=new n(a.x,a.y);let u=new n(this.points[(h+1)%this.points.length].x,this.points[(h+1)%this.points.length].y),l=new n(t.pos.x,t.pos.y),d=new n(u.x-c.x,u.y-c.y).heading;c.rotate(-d+Math.PI),u.rotate(-d+Math.PI),l.rotate(-d+Math.PI);let m=l.y-(c.y+u.y)/2;if(m>=-t.r&&m<=t.r&&l.x>=u.x&&l.x<=c.x){e=d-Math.PI/2,s=m;let g=n.fromAngle(e);g.mult(t.r-s),this.move(g.x*-1*t.m/(this.m+t.m),g.y*-1*t.m/(this.m+t.m)),t.move(g.x*1*this.m/(this.m+t.m),g.y*1*this.m/(this.m+t.m)),o=t.pos.copy,o.add(n.mult(n.fromAngle(e+Math.PI),m))}}),Number.isFinite(e)&&o)){let a=n.sub(o,t.pos);return a.setMag(-1),G(this,t,o,a),{cp:o,n:a}}}calculatePosAndMass(){let t=[];if(t.push([]),this.points.forEach(a=>{t[0].push(new n(a.x,a.y))}),this.isConcave){let a=(l,r)=>{for(let d=0;d<l.length;d+=1)if(l[d]===r)return!0;return!1},h=(l,r,d)=>{for(let m=0;m<r.length;m+=1)if(!a(d,m)){let g=new w(new n(r[m].x,r[m].y),new n(r[(m+1)%r.length].x,r[(m+1)%r.length].y));if(w.intersect(l,g))return!0}return!1},c=!0,u=()=>{c=!1;for(let l=0;l<t.length;l+=1){let r=t[l],d=n.sub(r[1],r[0]),m=n.sub(r[r.length-1],r[0]),g=n.angleACW(d,m);if(g>Math.PI){c=!0;let f=0,p=f+2,y=new w(new n(r[f].x,r[f].y),new n(r[p%r.length].x,r[p%r.length].y)),x=new n(y.b.x-y.a.x,y.b.y-y.a.y).heading;for(;!(d.heading>m.heading?x>d.heading&&x<2*Math.PI||x>0&&x<m.heading:x>d.heading&&x<m.heading)||h(new w(new n(r[f%r.length].x,r[f%r.length].y),new n(r[p%r.length].x,r[p%r.length].y)),r,[(r.length-1)%r.length,f%r.length,(p-1)%r.length,p%r.length]);)p+=1,y=new w(new n(r[f].x,r[f].y),new n(r[p%r.length].x,r[p%r.length].y)),x=new n(y.b.x-y.a.x,y.b.y-y.a.y).heading;let S=[],I=[];for(let v=f;v<=p;v+=1)S.push(r[v%r.length]);for(let v=p;v<=f+r.length;v+=1)I.push(r[v%r.length]);t[l]=S,t.push(I);return}for(let f=1;f<r.length;f+=1)if(d=n.sub(r[(f+1)%r.length],r[f]),m=n.sub(r[f-1],r[f]),g=n.angleACW(d,m),g>Math.PI){c=!0;let p=f+2,y=new w(new n(r[f].x,r[f].y),new n(r[p%r.length].x,r[p%r.length].y)),x=new n(y.b.x-y.a.x,y.b.y-y.a.y).heading;for(;!(d.heading>m.heading?x>d.heading&&x<2*Math.PI||x>0&&x<m.heading:x>d.heading&&x<m.heading)||h(y,r,[(f-1)%r.length,f%r.length,(p-1)%r.length,p%r.length]);)p+=1,y=new w(new n(r[f].x,r[f].y),new n(r[p%r.length].x,r[p%r.length].y)),x=new n(y.b.x-y.a.x,y.b.y-y.a.y).heading;let S=[],I=[];for(let v=f;v<=p;v+=1)S.push(r[v%r.length]);for(let v=p;v<=f+r.length;v+=1)I.push(r[v%r.length]);t[l]=S,t.push(I);return}}};for(;c;)u()}for(let a=t.length-1;a>=0;a-=1){let h=t[a];for(;h.length>3;)t.push([h[0],h[1],h[2]]),h.splice(1,1)}let e=0,s=0,o=new n(0,0);t.forEach(a=>{let h=Math.sqrt((a[0].x-a[1].x)**2+(a[0].y-a[1].y)**2),c=Math.sqrt((a[1].x-a[2].x)**2+(a[1].y-a[2].y)**2),u=Math.sqrt((a[2].x-a[0].x)**2+(a[2].y-a[0].y)**2),l=(h+c+u)/2,r=Math.sqrt(l*(l-h)*(l-c)*(l-u));e+=r,o.x+=r*(a[0].x+a[1].x+a[2].x)/3,o.y+=r*(a[0].y+a[1].y+a[2].y)/3}),o.div(e),this.pos=o,this.m=e,t.forEach(a=>{let h=Math.sqrt((a[0].x-a[1].x)**2+(a[0].y-a[1].y)**2),c=Math.sqrt((a[1].x-a[2].x)**2+(a[1].y-a[2].y)**2),u=Math.sqrt((a[2].x-a[0].x)**2+(a[2].y-a[0].y)**2),l=(h+c+u)/2,r=Math.sqrt(l*(l-h)*(l-c)*(l-u)),m=new z(a[1],a[2]).distFromPoint(a[0]),g=n.sub(a[2],a[1]);g.rotate90(),g.add(a[1]),h=new z(a[1],g).distFromPoint(a[0]);let p=(c*c*c*m-c*c*m*h+c*m*h*h+c*m*m*m)/36;p+=new n((a[0].x+a[1].x+a[2].x)/3,(a[0].y+a[1].y+a[2].y)/3).dist(this.pos)**2*r,s+=p}),this.am=s,this.boundRadius=Math.max(...this.points.map(a=>n.dist(a,this.pos)))}rotate(t){this.points.forEach(e=>{let s=e;s.sub(this.pos),s.rotate(t),s.add(this.pos)}),this.rotation+=t,this.recalculateBoundingBox(),n.rotateArr(this.axes,t)}get isConcave(){let t=this.points,e=n.angleACW(n.sub(t[1],t[0]),n.sub(t[t.length-1],t[0]));if(e>Math.PI)return!0;for(let s=1;s<t.length-1;s+=1)if(e=n.angleACW(n.sub(t[(s+1)%t.length],t[s]),n.sub(t[s-1],t[s])),e>Math.PI)return!0;return e=n.angleACW(n.sub(t[0],t[t.length-1]),n.sub(t[t.length-2],t[t.length-1])),e>Math.PI}static collide(t,e){let s=t,o=e,a=[...s.axes,...o.axes],h=a.map(M=>T(s.points.map(P=>n.dot(P,M)))),c=a.map(M=>T(o.points.map(P=>n.dot(P,M)))),l=a.map((M,P)=>V(h[P],c[P])).map(M=>M.max-M.min);if(l.some(M=>M<0))return;let r=Number.MAX_VALUE,d=0;l.forEach((M,P)=>{M<r&&(r=M,d=P)});let m,g,f=a[d].copy;n.dot(n.sub(s.pos,o.pos),f)>0&&f.mult(-1);let p=n.mult(f,-(r*s.m)/(s.m+o.m)),y=n.mult(f,r*o.m/(s.m+o.m));d<s.axes.length?(m=o,g=s):(m=s,g=o),s.move(p.x,p.y),o.move(y.x,y.y);let x=n.sub(m.pos,g.pos),S;if(n.dot(x,f)>=0)S=m.points.map(M=>n.dot(M,f));else{let M=n.mult(f,-1);S=m.points.map(P=>n.dot(P,M))}let I=m.points[S.indexOf(Math.min(...S))],v=s.velInPlace(I),mt=o.velInPlace(I);if(!(n.dot(v,f)<n.dot(mt,f)))return f.mult(1),G(s,o,I,f),{n:f,cp:I}}get normals(){return this.sides.map(t=>{let e=n.sub(t.b,t.a);return e.setMag(1),e.rotate270(),e})}collideWithFixedBall(t){let e,s,o=t,a=this.points.some((h,c)=>{let u=n.sub(o,h);u.sqlength<=o.r*o.r&&(e=h,s=u);let l=this.points[(c+1)%this.points.length].copy,r=new n(l.x-h.x,l.y-h.y),d=r.sqlength;r.setMag(1);let m=r.copy;m.rotate270();let g=n.dot(u,r),f=n.dot(u,m);return f>=-o.r&&f<o.r&&g>=0&&g*g<=d?(e=n.add(h,n.mult(r,g)),s=m,!0):!1});if(typeof s!="undefined"&&(a||s.setMag(1),typeof e!="undefined")){let h=n.sub(e,o).length-o.r,c=n.mult(s,h);return this.move(c.x,c.y),W(this,e,s),{cp:e,n:s}}}collideWithWall(t){let e=V(this.boundsX,t.boundsX),s=V(this.boundsY,t.boundsY);if(e.size()<=0||s.size()<=0)return;let o=Rt(this.points,t.points,this.axes,t.axes);if(typeof o!="boolean"){let{normal:a,overlap:h,index:c}=o;n.dot(n.sub(this.pos,t.center),a)<0&&a.mult(-1);let u=n.mult(a,h),l,r;c<this.axes.length?(l=t,r=n.sub(l.center,this.pos)):(l=this,r=n.sub(this.pos,t.center)),this.move(u.x,u.y);let d;n.dot(r,a)>=0?d=l.points.map(f=>n.dot(f,a)):d=l.points.map(f=>-n.dot(f,a));let m=l.points[d.indexOf(Math.min(...d))],g=this.velInPlace(m);return n.dot(g,a)>0?void 0:(a.mult(-1),W(this,m,a),{n:a,cp:m})}}containsPoint(t){let{sides:e}=this,s=Math.max(...this.points.map(c=>n.dist(c,t)))+1,o=new n(s,0),a=new w(t,n.add(o,t));return e.filter(c=>w.intersect(c,a)instanceof Object).length%2==1}get sides(){return this.points.map((t,e)=>new w(t,this.points[(e+1)%this.points.length]))}velInPlace(t){let e=n.sub(t,this.pos);return e.rotate(Math.PI/2),e.mult(this.ang),e.add(this.vel),e}effectiveMass(t,e){let s=n.sub(t,this.pos),o=n.angle(e,s),a=Math.sin(o)**2*s.length**2/this.am;return 1/(a+1/this.m)}applyDeltaVelInPoint(t,e){let s=n.sub(e,this.pos);if(s.length===0){this.vel.add(t);return}let o=n.angle(s,t),a=n.mult(s,n.dot(t,s)/s.length**2);this.vel.add(a);let h=s.copy;h.rotate(Math.PI/2),h.setMag(1);let c=Math.sign(n.dot(t,h)),u=t.length*Math.cos(o),l=1/(1/this.m+s.length**2/this.am),r=u*l/this.m;this.vel.add(n.mult(h,r*c));let d=c*u*l*s.length/this.am;this.ang-=d}toJSON(){let t={};return t.points=this.points.map(e=>({x:e.x,y:e.y})),t.vel=this.vel.toJSON(),t.k=this.k,t.ang=this.ang,t.fc=this.fc,t.pos=this.pos.toJSON(),t.lastPos=this.lastPos.toJSON(),t.rotation=this.rotation,t.style=this.style,t}static fromObject(t){let e=new U(t.points.map(s=>new n(s.x,s.y)),n.fromObject(t.vel),t.k,t.ang,t.fc);return e.pos=n.fromObject(t.pos),e.lastPos=n.fromObject(t.lastPos),e.rotation=t.rotation,e.style=t.style,e}},N=U;var jt=class{constructor(t,e){this.length=t,this.springConstant=e,this.pinned=!1,this.objects=[],this.rotationLocked=!1}pinHere(t,e){this.pinned={x:t,y:e}}unpin(){this.pinned=!1}attachObject(t){let e=this.objects;e.push(t),e.length===2&&(this.pinned=!1),e.length>=3&&(e=[e[e.length-2],e[e.length-1]])}lockRotation(){this.rotationLocked=!0}unlockRotation(){this.rotationLocked=!1}update(t){let e,s;if(this.pinned instanceof Object&&this.objects[0]){[s,e]=[this.pinned,this.objects[0]];let o=new n(s.x-e.pos.x,s.y-e.pos.y),a=o.length-this.length;o.setMag(1),o.mult(a*this.springConstant*t/e.m),e.vel.x+=o.x,e.vel.y+=o.y;let h=e.vel;if(h.rotate(-o.heading),this.rotationLocked){let c=new n(s.x,s.y),l=n.sub(e.pos,c).length,r=l*l*e.m+e.am,d=(e.am*e.ang-l*e.m*h.y)/r;h.y=-d*l,e.ang=d}h.rotate(o.heading)}else if(this.objects[0]&&this.objects[1]){[e,s]=[this.objects[0],this.objects[1]];let o=n.sub(e.pos,s.pos),a=o.length-this.length;o.setMag(1),o.mult(a*this.springConstant*t),s.vel.add(n.div(o,s.m)),e.vel.add(n.div(o,-e.m)),o=n.sub(e.pos,s.pos);let h=e.vel,c=s.vel;if(h.rotate(-o.heading),c.rotate(-o.heading),this.rotationLocked){let u=new n(e.pos.x*e.m+s.pos.x*s.m,e.pos.y*e.m+s.pos.y*s.m);u.div(e.m+s.m);let l=n.sub(e.pos,u),r=n.sub(s.pos,u),d=l.length,m=r.length,g=d*d*e.m+e.am+m*m*s.m+s.am,f=(h.y-c.y)*m/(d+m)+c.y,p=(e.am*e.ang+s.am*s.ang+d*e.m*(h.y-f)-m*s.m*(c.y-f))/g;h.y=p*d+f,c.y=-p*m+f,e.ang=p,s.ang=p}h.rotate(o.heading),c.rotate(o.heading)}}},O=jt;var Wt=class extends O{constructor(t){super(t,0);this.springConstant=0}update(){let t,e;if(this.pinned instanceof Object&&"x"in this.pinned&&this.objects[0]){[e,t]=[this.pinned,this.objects[0]];let s=new n(e.x-t.pos.x,e.y-t.pos.y);s.setMag(1),s.mult(-this.length),t.move(-t.pos.x+e.x+s.x,-t.pos.y+e.y+s.y);let o=t.vel;if(o.rotate(-s.heading),o.x=0,this.rotationLocked){let a=new n(e.x,e.y),c=n.sub(t.pos,a).length,u=c*c*t.m+t.am,l=(t.am*t.ang+c*t.m*o.y)/u;o.y=l*c,t.ang=l}o.rotate(s.heading)}else if(this.objects[0]&&this.objects[1]){[t,e]=[this.objects[0],this.objects[1]];let s=n.sub(t.pos,e.pos),o=this.length-s.length;s.setMag(1);let a=n.mult(s,o*e.m/(t.m+e.m)),h=n.mult(s,-o*t.m/(t.m+e.m));t.move(a.x,a.y),e.move(h.x,h.y);let c=t.vel,u=e.vel;if(c.rotate(-s.heading),u.rotate(-s.heading),c.x=(t.m*c.x+e.m*u.x)/(t.m+e.m),u.x=c.x,this.rotationLocked){let l=new n(t.pos.x*t.m+e.pos.x*e.m,t.pos.y*t.m+e.pos.y*e.m);l.div(t.m+e.m);let r=n.sub(t.pos,l),d=n.sub(e.pos,l),m=r.length,g=d.length,f=m*m*t.m+t.am+g*g*e.m+e.am,p=(c.y-u.y)*g/(m+g)+u.y,y=(t.am*t.ang+e.am*e.ang+m*t.m*(c.y-p)-g*e.m*(u.y-p))/f;c.y=y*m+p,u.y=-y*g+p,t.ang=y,e.ang=y}c.rotate(s.heading),u.rotate(s.heading)}}},Y=Wt;var Dt=class{constructor(t,e,s,o,a){this.points=[],o||o===0?this.fc=o:this.fc=.4,this.pressure=s,a?this.resolution=a:this.resolution=30,this.r=Math.abs(e);let h=Math.random()*1e6;for(let c=0;c<this.resolution;c+=1){let u=new n(t.x,t.y);u.add(n.mult(n.fromAngle(c/this.resolution*Math.PI*2),this.r)),this.points.push(new C(u,new n(0,0),this.r*Math.sin(Math.PI/this.resolution),0,0,this.fc)),this.points[this.points.length-1].layer=h}this.sides=[];for(let c=0;c<this.resolution;c+=1){let u=new Y(2*this.r*Math.sin(Math.PI/this.resolution));u.attachObject(this.points[c]),u.attachObject(this.points[(c+1)%this.resolution]),c%2==0&&u.lockRotation(),this.sides.push(u)}}static updatePressureBasedForces(t,e){let s=[];if(s.push([]),t.points.forEach(h=>{s[0].push(new n(h.pos.x,h.pos.y))}),(h=>{let c=n.angleACW(n.sub(h[1],h[0]),n.sub(h[h.length-1],h[0]));if(c>Math.PI)return!0;for(let u=1;u<h.length-1;u+=1)if(c=n.angleACW(n.sub(h[(u+1)%h.length],h[u]),n.sub(h[u-1],h[u])),c>Math.PI)return!0;return c=n.angleACW(n.sub(h[0],h[h.length-1]),n.sub(h[h.length-2],h[h.length-1])),c>Math.PI})(s[0])){let h=(l,r)=>{for(let d=0;d<l.length;d+=1)if(l[d]===r)return!0;return!1},c=(l,r,d)=>{for(let m=0;m<r.length;m+=1)if(!h(d,m)){let g=new w(new n(r[m].x,r[m].y),new n(r[(m+1)%r.length].x,r[(m+1)%r.length].y));if(w.intersect(l,g))return!0}return!1},u=!0;t:for(;u;){u=!1;for(let l=0;l<s.length;l+=1){let r=s[l],d=n.sub(r[1],r[0]),m=n.sub(r[r.length-1],r[0]),g=n.angleACW(d,m);if(g>Math.PI){u=!0;let f=0,p=f+2,y=new w(new n(r[f].x,r[f].y),new n(r[p%r.length].x,r[p%r.length].y)),x=new n(y.b.x-y.a.x,y.b.y-y.a.y).heading;for(;!(d.heading>m.heading?x>d.heading&&x<2*Math.PI||x>0&&x<m.heading:x>d.heading&&x<m.heading)||c(new w(new n(r[f%r.length].x,r[f%r.length].y),new n(r[p%r.length].x,r[p%r.length].y)),r,[(r.length-1)%r.length,f%r.length,(p-1)%r.length,p%r.length]);)p+=1,y=new w(new n(r[f].x,r[f].y),new n(r[p%r.length].x,r[p%r.length].y)),x=new n(y.b.x-y.a.x,y.b.y-y.a.y).heading;let S=[],I=[];for(let v=f;v<=p;v+=1)S.push(r[v%r.length]);for(let v=p;v<=f+r.length;v+=1)I.push(r[v%r.length]);s[l]=S,s.push(I);continue t}for(let f=1;f<r.length;f+=1)if(d=n.sub(r[(f+1)%r.length],r[f]),m=n.sub(r[f-1],r[f]),g=n.angleACW(d,m),g>Math.PI){u=!0;let p=f+2,y=new w(new n(r[f].x,r[f].y),new n(r[p%r.length].x,r[p%r.length].y)),x=new n(y.b.x-y.a.x,y.b.y-y.a.y).heading;for(;!(d.heading>m.heading?x>d.heading&&x<2*Math.PI||x>0&&x<m.heading:x>d.heading&&x<m.heading)||c(y,r,[(f-1)%r.length,f%r.length,(p-1)%r.length,p%r.length]);)p+=1,y=new w(new n(r[f].x,r[f].y),new n(r[p%r.length].x,r[p%r.length].y)),x=new n(y.b.x-y.a.x,y.b.y-y.a.y).heading;let S=[],I=[];for(let v=f;v<=p;v+=1)S.push(r[v%r.length]);for(let v=p;v<=f+r.length;v+=1)I.push(r[v%r.length]);s[l]=S,s.push(I);continue t}}}}for(let h=s.length-1;h>=0;h-=1){let c=s[h];for(;c.length>3;)s.push([c[0],c[1],c[2]]),c.splice(1,1)}let o=0;s.forEach(h=>{let c=Math.sqrt((h[0].x-h[1].x)**2+(h[0].y-h[1].y)**2),u=Math.sqrt((h[1].x-h[2].x)**2+(h[1].y-h[2].y)**2),l=Math.sqrt((h[2].x-h[0].x)**2+(h[2].y-h[0].y)**2),r=(c+u+l)/2;o+=Math.sqrt(r*(r-c)*(r-u)*(r-l))});let a=t.pressure*(t.r*t.r*Math.PI/o)-t.pressure;t.sides.forEach(h=>{let c=n.sub(h.objects[0].pos,h.objects[1].pos);c.mult(a),c.rotate(Math.PI/2),c.mult(e),h.objects[0].vel.add(n.div(c,h.objects[0].m)),h.objects[1].vel.add(n.div(c,h.objects[1].m))})}get sideSegments(){return this.points.map((t,e)=>new w(t.pos,this.points[(e+1)%this.points.length].pos))}containsPoint(t){let e=this.sideSegments,s=Math.max(...this.points.map(c=>n.dist(c.pos,t)))+1,o=n.fromAngle(0);o.setMag(s);let a=new w(t,n.add(o,t));return e.filter(c=>w.intersect(c,a)!==void 0).length%2==1}},D=Dt;var $=class{constructor(){this.balls=[],this.bodies=[],this.fixedBalls=[],this.softBalls=[],this.walls=[],this.bounds=[],this.springs=[],this.airFriction=1,this.gravity=new n(0,0),this.addBodyNotBall=!1,this.collisionData=[]}update(t){this.collisionData=[];for(let e=0;e<this.balls.length;e+=1)this.balls[e].lastPos=this.balls[e].pos.copy,this.balls[e].pos.add(n.mult(this.balls[e].vel,t)),this.balls[e].rotation+=this.balls[e].ang*t,this.balls[e].rotation%=Math.PI*2;for(let e=0;e<this.bodies.length;e+=1)this.bodies[e].lastPos=this.bodies[e].pos.copy,this.bodies[e].move(this.bodies[e].vel.x*t,this.bodies[e].vel.y*t),this.bodies[e].rotate(this.bodies[e].ang*t);for(let e=0;e<3;e+=1)this.springs.forEach(s=>{s.update(t/3/2)});for(let e=0;e<this.balls.length;e+=1){this.gravity&&this.balls[e].vel.add(new n(this.gravity.x*t,this.gravity.y*t));for(let s=e+1;s<this.balls.length;s+=1)if(this.balls[e].layer!==this.balls[s].layer||!this.balls[e].layer&&!this.balls[s].layer){let o=C.collide(this.balls[e],this.balls[s]);o&&this.collisionData.push(o)}this.walls.forEach(s=>{let o=s.collideWithBall(this.balls[e]);o&&this.collisionData.push(o)}),this.fixedBalls.forEach(s=>{let o=this.balls[e],a=n.sub(o.pos,s);if(a.sqlength<=(o.r+s.r)**2){let h=a;h.setMag(1),o.pos=n.add(s,n.mult(h,o.r+s.r)),h.mult(-1),W(o,s,h),this.collisionData.push({cp:n.fromObject(s),n:h})}}),this.bounds.forEach(s=>{let o=s.collideWithBall(this.balls[e]);o&&this.collisionData.push(o)})}for(let e=0;e<this.bodies.length;e+=1){this.balls.forEach(s=>{let o=this.bodies[e].collideWithBall(s);o&&this.collisionData.push(o)});for(let s=e+1;s<this.bodies.length;s+=1){let o=N.collide(this.bodies[e],this.bodies[s]);o&&this.collisionData.push(o)}this.bodies.forEach(s=>{this.fixedBalls.forEach(o=>{let a=s.collideWithFixedBall(o);a&&this.collisionData.push(a)})}),this.bodies.forEach(s=>{this.walls.forEach(o=>{let a=s.collideWithWall(o);a&&this.collisionData.push(a)})}),this.bodies.forEach(s=>{this.bounds.forEach(o=>{let a=s.collideWithWall(o);a&&this.collisionData.push(a)})}),this.gravity&&this.bodies[e].vel.add(new n(this.gravity.x*t,this.gravity.y*t))}this.softBalls.forEach(e=>{D.updatePressureBasedForces(e,t)});for(let e=0;e<3;e+=1)this.springs.forEach(s=>{s.update(t/3/2)});this.balls.forEach(e=>{let s=e;s.vel.mult(this.airFriction**t),s.ang*=this.airFriction**t}),this.bodies.forEach(e=>{let s=e;s.vel.mult(this.airFriction**t),s.ang*=this.airFriction**t})}get copy(){let t=this.toJSON();return $.fromObject(t)}setAirFriction(t){!Number.isFinite(t)||(this.airFriction=t,this.airFriction<0&&(this.airFriction=0),this.airFriction>1&&(this.airFriction=1))}setGravity(t){this.gravity=t.copy}addBall(t){if(this.addBodyNotBall){let e=(s,o,a)=>{let h=[];for(let c=0;c<a;c+=1){let u=n.fromAngle(c/a*2*Math.PI);u.mult(o),u.add(s),h.push(u)}return h};this.bodies.push(new N(e(t.pos,t.r,24),t.vel,t.k,t.ang,t.fc))}else this.balls.push(t)}addBody(t){this.bodies.push(t)}addSoftBall(t){this.balls.push(...t.points),this.springs.push(...t.sides),this.softBalls.push(t)}addSoftSquare(t,e,s,o,a=24,h=1){let c=new D(t,Math.sqrt(e*e/Math.PI),h,s,a);c.sides.forEach(r=>{let d=r;d.length=.96*4*e/c.resolution}),c.points.forEach(r=>{let d=r;d.vel=o.copy}),this.balls.push(...c.points),this.springs.push(...c.sides);let u=e*e*200*h,l=new O(Math.sqrt(c.r*c.r*Math.PI),u/2);l.attachObject(c.points[0]),l.attachObject(c.points[c.resolution/2]),this.springs.push(l),l=new O(Math.sqrt(c.r*c.r*Math.PI),u/2),l.attachObject(c.points[c.resolution/4]),l.attachObject(c.points[3*c.resolution/4]),this.springs.push(l),l=new O(Math.sqrt(2*c.r*c.r*Math.PI),u),l.attachObject(c.points[c.resolution/8]),l.attachObject(c.points[5*c.resolution/8]),this.springs.push(l),l=new O(Math.sqrt(2*c.r*c.r*Math.PI),u),l.attachObject(c.points[3*c.resolution/8]),l.attachObject(c.points[7*c.resolution/8]),this.springs.push(l)}addRectWall(t,e,s,o){let a=[];a.push(new n(t-s/2,e-o/2)),a.push(new n(t+s/2,e-o/2)),a.push(new n(t+s/2,e+o/2)),a.push(new n(t-s/2,e+o/2)),this.walls.push(new H(a))}addRectBody(t,e,s,o,a,h,c=R){let u=[];u.push(new n(t-s/2,e-o/2)),u.push(new n(t+s/2,e-o/2)),u.push(new n(t+s/2,e+o/2)),u.push(new n(t-s/2,e+o/2));let l=new N(u,new n(0,0),h,0,a);l.style=c,this.bodies.push(l)}addWall(t){this.walls.push(t)}addFixedBall(t,e,s){this.fixedBalls.push({x:t,y:e,r:s})}addSpring(t){this.springs.push(t)}setBounds(t,e,s,o,a=!0){this.bounds=[];let h=(c,u,l,r)=>{let d=[];return d.push(new n(c-l/2,u-r/2)),d.push(new n(c+l/2,u-r/2)),d.push(new n(c+l/2,u+r/2)),d.push(new n(c-l/2,u+r/2)),new H(d)};this.bounds.push(h(t-s,e,2*s,4*o)),this.bounds.push(h(t+2*s,e,2*s,4*o)),a&&this.bounds.push(h(t,e-o,4*s,o*2)),this.bounds.push(h(t+s/2,e+2*o,5*s,2*o))}getObjectAtCoordinates(t,e){let s={x:t,y:e,pinPoint:!0},o=new n(t,e);return this.balls.some(a=>a.containsPoint(o)?(s=a,!0):!1)||this.bodies.some(a=>a.containsPoint(o)?(s=a,!0):!1)||this.walls.some(a=>a.containsPoint(o)?(s=a,!0):!1)||(this.fixedBalls.forEach(a=>{n.dist(new n(a.x,a.y),new n(t,e))<=a.r&&(s=a)}),this.softBalls.forEach(a=>{a.containsPoint(o)&&(s=a)})),s}getCopyOfBalls(){return this.balls.map(t=>t.copy)}getCopyOfBodies(){return this.bodies.map(t=>t.copy)}removeObjFromSystem(t){let e=-1;if(t instanceof C&&(e=this.balls.indexOf(t)),e!==-1){let s=!1;if(this.softBalls.forEach(o=>{o.points.includes(this.balls[e])&&(this.removeObjFromSystem(o),s=!0)}),s)return;this.springs.forEach(o=>{o.objects.includes(this.balls[e])&&this.removeObjFromSystem(o)}),this.balls.splice(e,1);return}if(t instanceof N&&(e=this.bodies.indexOf(t)),e!==-1){this.bodies.splice(e,1);return}if(t instanceof H&&(e=this.walls.indexOf(t)),e!==-1){this.walls.splice(e,1);return}if(t instanceof Object&&"r"in t&&"x"in t&&(e=this.fixedBalls.indexOf(t)),e!==-1){this.fixedBalls.splice(e,1);return}if((t instanceof Y||t instanceof O)&&(e=this.springs.indexOf(t)),e!==-1){this.springs.splice(e,1);let s=this.springs[e];this.softBalls.forEach(o=>{s instanceof Y&&o.sides.includes(s)&&this.removeObjFromSystem(o)});return}if(t instanceof D&&(e=this.softBalls.indexOf(t)),e!==-1){let s=this.softBalls[e];this.softBalls.splice(e,1),s.points.forEach(o=>{this.removeObjFromSystem(o)})}}getObjectIdentifier(t){return t instanceof C?{type:"ball",index:this.balls.indexOf(t)}:t instanceof N?{type:"body",index:this.bodies.indexOf(t)}:{type:"nothing",index:-1}}toJSON(){let t={};return t.airFriction=this.airFriction,t.gravity=this.gravity.toJSON(),t.balls=this.balls.map(e=>e.toJSON()),t.bodies=this.bodies.map(e=>e.toJSON()),t.bounds=this.bounds.map(e=>e.toJSON()),t.fixedBalls=this.fixedBalls.map(e=>Ft({},e)),t.walls=this.walls.map(e=>e.toJSON()),t.springs=this.springs.map(e=>{let s={};return s.length=e.length,s.pinned=e.pinned,s.rotationLocked=e.rotationLocked,s.springConstant=e.springConstant,e instanceof O?s.type="spring":e instanceof Y&&(s.type="stick"),s.objects=e.objects.map(o=>this.getObjectIdentifier(o)),s}),t.softBalls=this.softBalls.map(e=>{let s={};return s.fc=e.fc,s.points=e.points.map(o=>this.getObjectIdentifier(o)),s.pressure=e.pressure,s.r=e.r,s.resolution=e.resolution,s.sides=e.sides.map(o=>this.springs.indexOf(o)),s}),t}stickOrSpringFromObject(t){let e={};return t.type==="spring"?e=new O(t.length,t.springConstant):t.type==="stick"&&(e=new Y(t.length)),e.pinned=t.pinned,e.rotationLocked=t.rotationLocked,e.objects=t.objects.map(s=>s.type==="ball"?this.balls[s.index]:this.bodies[s.index]),e}softBallFromObject(t){let e=Object.create(D.prototype);return e.fc=t.fc,e.pressure=t.pressure,e.resolution=t.resolution,e.r=t.r,e.points=t.points.map(s=>this.balls[s.index]),e.sides=t.sides.map(s=>this.springs[s]),e}static fromObject(t){let e=new $;return e.balls=t.balls.map(s=>C.fromObject(s)),e.bounds=t.bounds.map(s=>H.fromObject(s)),e.walls=t.walls.map(s=>H.fromObject(s)),e.bodies=t.bodies.map(s=>N.fromObject(s)),e.fixedBalls=t.fixedBalls,e.airFriction=t.airFriction,e.gravity=n.fromObject(t.gravity),e.springs=t.springs.map(s=>e.stickOrSpringFromObject(s)),e.softBalls=t.softBalls.map(s=>e.softBallFromObject(s)),e}};var K=$;var it,qt,Q;function Z(i){qt=i,i?Q.classList.add("bg-pink-darker"):Q.classList.remove("bg-pink-darker")}function bt(i){it=i.getPhysics().toJSON(),Q=document.getElementById("set start"),Z(!1);let t=document.getElementById("pause");t&&(t.onclick=()=>{i.getTimeMultiplier()!==0?i.setTimeMultiplier(0):(i.setTimeMultiplier(1),qt===!0&&(it=i.getPhysics().toJSON()),Z(!1))});let e=document.getElementById("revert");e&&(e.onclick=()=>{i.setTimeMultiplier(0),i.setPhysics(K.fromObject(it)),Z(!0)});let s=document.getElementById("clear all");s&&(s.onclick=()=>{Z(!0);let a=i.getPhysics();a.balls=[],a.walls=[],a.softBalls=[],a.springs=[],a.bodies=[],a.fixedBalls=[]}),Q&&(Q.onclick=()=>{it=i.getPhysics().toJSON(),Z(!0),i.setTimeMultiplier(0)});let o=!1;document.addEventListener("visibilitychange",()=>{document.hidden?i.getTimeMultiplier()!==0?(i.setTimeMultiplier(0),o=!0):o=!1:o&&i.setTimeMultiplier(1)})}function b(i,t,...e){let s=document.createElement(i);return t&&Object.entries(t).forEach(([o,a])=>{s[o]=a}),e&&e.forEach(o=>{typeof o=="string"?s.appendChild(document.createTextNode(o)):o instanceof HTMLElement&&s.appendChild(o)}),s}var Ht=document.createElement("template");Ht.innerHTML=`
  <style>
    .slider {
      -webkit-appearance: none;
      height: 0.6rem;
      background: var(--pinky-darker);
      outline: none;
      opacity: 0.7;
      -webkit-transition: 0.2s;
      transition: opacity 0.2s;
      border-radius: 100vh;
      width: 90%;
    }
    .slider:hover {
      opacity: 1;
    }
    .slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 0.8rem;
      height: 0.8rem;
      background: var(--blues-hover);
      opacity: 0.7;
      cursor: pointer;
      border-radius: 100vh;
    }
    .slider::-moz-range-thumb {
      width: 0.8rem;
      height: 0.8rem;
      background: var(--blues-hover);
      opacity: 0.7;
      cursor: pointer;
      border-radius: 100vh;
    }
    .slider-label {
      margin-top: 1em;
      margin-bottom: 0.3em;
      padding-left: 0em;
      font-weight: bold;
    }
    /* For tablets */
    @media (max-width: 768px) {
      .slider-label {
        font-weight: bold;
        margin-top: 0.5em;
        margin-bottom: 0rem;
        font-size: small;
      }
      .slider {
        height: 0.4rem;
      }
      .slider::-webkit-slider-thumb {
        width: 0.55rem;
        height: 0.55rem;
      }
      .slider::-moz-range-thumb {
        width: 0.55rem;
        height: 0.55rem;
      }
    }
  </style>
`;var zt=class extends HTMLElement{constructor(){super();this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(Ht.content.cloneNode(!0)),this.shadowRoot.appendChild(b("div",null,b("p",{className:"slider-label"},b("slot",null)),b("input",{id:"slider",type:"range",className:"slider"})))}get slider(){return this.shadowRoot.querySelector("#slider")}set min(t){this.slider.min=t}set max(t){this.slider.max=t}set step(t){this.slider.step=t}set value(t){this.slider.value=t}set onChange(t){this.slider.onchange=e=>t(e.target.valueAsNumber),this.slider.oninput=e=>t(e.target.valueAsNumber)}};window.customElements.define("range-slider",zt);var Gt=document.createElement("template");Gt.innerHTML=`
  <style>
    .picker-label {
        display: flex;
        align-items: center;
        font-weight: bold;
        padding-right: 0.45em;
        margin-top: 1.3em;
    }
    #colorWell {
        margin-left: 0.5rem;
        border-radius: 100vh;
        background-color: var(--turquoise);
        border: none;
        height: 1rem;
        cursor: pointer;
    }
    /* For tablets */
    @media (max-width: 768px) {
      .picker-label {
        margin-top: 0.6em;
        font-size: small;
      }
      #colorWell {
        height: 1em;
      }
    }
  </style>
`;var Vt=class extends HTMLElement{constructor(){super();this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(Gt.content.cloneNode(!0)),this.shadowRoot.appendChild(b("div",null,b("label",{htmlFor:"colorWell",className:"picker-label"},b("div",null,b("slot",null)),b("input",{type:"color",id:"colorWell"}))))}get picker(){return this.shadowRoot.querySelector("#colorWell")}set value(t){this.picker.value=t,this.picker.style["background-color"]=t}set onChange(t){let e=s=>{t(s.target.value),this.picker.style["background-color"]=s.target.value};this.picker.onchange=e,this.picker.oninput=e}};window.customElements.define("color-picker",Vt);var ot=35,yt=.5,xt=1.5,vt=st,Jt=document.createElement("div"),Me={name:"Ball creator",description:"",element:Jt,drawFunc(i,t){let e=i.cnv.getContext("2d");e.strokeStyle="black",e.beginPath(),e.arc(i.mouseX,i.mouseY,ot,0,2*Math.PI),e.stroke(),i.lastX!==0&&i.lastY!==0&&(e.beginPath(),e.moveTo(i.mouseX,i.mouseY),e.lineTo(i.lastX,i.lastY),e.stroke())},startInteractionFunc(i){},endInteractionFunc(i){if(i.lastX!==0&&i.lastY!==0){let t=new C(new n(i.lastX,i.lastY),new n(i.lastX-i.mouseX,i.lastY-i.mouseY),ot,yt,0,xt);t.style=vt,Number.isFinite(t.pos.x)&&Number.isFinite(t.pos.y)&&Number.isFinite(t.vel.x)&&Number.isFinite(t.vel.y)||(t.vel.x=0,t.vel.y=0),i.physics.addBall(t)}},keyGotUpFunc(i){},keyGotDownFunc(i){}};Jt.append(b("range-slider",{min:5,max:120,step:1,value:ot,onChange:i=>{ot=i}},"Size"),b("range-slider",{min:0,max:1,step:.02,value:yt,onChange:i=>{yt=i}},"Bounciness"),b("range-slider",{min:0,max:2,step:.1,value:xt,onChange:i=>{xt=i}},"Coefficient of friction"),b("color-picker",{value:vt,onChange:i=>{vt=i}},"Color:"));var Ut=Me;var ke=document.createElement("div"),Pe={name:"Delete",description:"",element:ke,drawFunc(i,t){},startInteractionFunc(i){i.choosed&&typeof i.choosed!="boolean"&&i.physics.removeObjFromSystem(i.choosed)}},$t=Pe;var _=35,Se=.5,at=1.5,wt=24,Mt=1e6,Kt=document.createElement("div"),Ie={name:"Elastic ball creator",description:"",element:Kt,drawFunc(i,t){let e=i.cnv.getContext("2d");e.strokeStyle="black",e.beginPath(),e.arc(i.mouseX,i.mouseY,_,0,2*Math.PI),e.stroke(),i.lastX!==0&&i.lastY!==0&&(e.beginPath(),e.moveTo(i.mouseX,i.mouseY),e.lineTo(i.lastX,i.lastY),e.stroke())},startInteractionFunc(i){},endInteractionFunc(i){if(i.lastX!==0&&i.lastY!==0){let t=new C(new n(i.lastX,i.lastY),new n(i.lastX-i.mouseX,i.lastY-i.mouseY),_,Se,0,at);if(Number.isFinite(t.pos.x)&&Number.isFinite(t.pos.y)&&Number.isFinite(t.vel.x)&&Number.isFinite(t.vel.y)){let e=new D(t.pos,_,Mt,at,wt);e.points.forEach(s=>{let o=s;o.vel=t.vel.copy}),i.physics.addSoftBall(e)}}}};Kt.append(b("range-slider",{min:5,max:60,step:1,value:_,onChange:i=>{_=i}},"Size"),b("range-slider",{min:5e5,max:3e6,step:4e3,value:Mt,onChange:i=>{Mt=i}},"Pressure"),b("range-slider",{min:0,max:2,step:.1,value:at,onChange:i=>{at=i}},"Coefficient of friction"),b("range-slider",{min:6,max:24,step:1,value:wt,onChange:i=>{wt=i}},"Resolution"));var Qt=Ie;var Zt=0,_t=0,Ce=document.createElement("div"),Oe={name:"Move",description:"",element:Ce,drawFunc(i,t){let{choosed:e}=i;e instanceof Object&&"move"in e&&(e.move(i.mouseX-e.pos.x,i.mouseY-e.pos.y),t===0?(e.vel.x=0,e.vel.y=0):(e.vel.x=(i.mouseX-Zt)/t,e.vel.y=(i.mouseY-_t)/t),e.ang=0),Zt=i.mouseX,_t=i.mouseY},startInteractionFunc(i){let{choosed:t}=i;if(t instanceof Object&&"move"in t){let e=i;e.cnv.style.cursor="grabbing"}},endInteractionFunc(i){let{choosed:t}=i;if(t instanceof Object&&"move"in t){let e=i;e.cnv.style.cursor="grab"}},activated(i){let t=i;t.cnv.style.cursor="grab"},deactivated(i){let t=i;t.cnv.style.cursor="default"}},At=Oe;var Ee=document.createElement("div"),Be={name:"Rectangle wall",description:"",element:Ee,drawFunc(i,t){if(i.lastX!==0&&i.lastY!==0){let e=i.cnv.getContext("2d");e.strokeStyle="black",e.strokeRect(i.mouseX,i.mouseY,i.lastX-i.mouseX,i.lastY-i.mouseY)}},startInteractionFunc(i){},endInteractionFunc(i){if(i.lastX!==0&&i.lastY!==0){if(Math.abs(i.lastX-i.mouseX)<5&&Math.abs(i.lastY-i.mouseY)<5)return;i.physics.addRectWall(i.lastX/2+i.mouseX/2,i.lastY/2+i.mouseY/2,2*Math.abs(i.lastX/2-i.mouseX/2),2*Math.abs(i.lastY/2-i.mouseY/2))}},keyGotUpFunc(i){},keyGotDownFunc(i){}},te=Be;var kt=.2,Pt=.5,St=R,ee=document.createElement("div"),Xe={name:"Rectangle body",description:"",element:ee,drawFunc(i,t){let e=i.cnv.getContext("2d");i.lastX!==0&&i.lastY!==0&&(e.strokeStyle="black",e.strokeRect(i.mouseX,i.mouseY,i.lastX-i.mouseX,i.lastY-i.mouseY))},startInteractionFunc(i){},endInteractionFunc(i){if(i.lastX!==0&&i.lastY!==0){let t=Math.abs(i.mouseX-i.lastX),e=Math.abs(i.mouseY-i.lastY);if(t/e>50||e/t>50||e===0||t===0)return;i.physics.addRectBody(i.lastX/2+i.mouseX/2,i.lastY/2+i.mouseY/2,2*Math.abs(i.lastX/2-i.mouseX/2),2*Math.abs(i.lastY/2-i.mouseY/2),Pt,kt,St)}},keyGotUpFunc(i){},keyGotDownFunc(i){}};ee.append(b("range-slider",{min:0,max:.6,step:.02,value:kt,onChange:i=>{kt=i}},"Bounciness"),b("range-slider",{min:0,max:2,step:.1,value:Pt,onChange:i=>{Pt=i}},"Coefficient of friction"),b("color-picker",{value:St,onChange:i=>{St=i}},"Color:"));var se=Xe;var rt=35,It=.5,Ct=.5,ct=4,ht=24,Ot=R,ne=document.createElement("div");function ie(i=24,t=4){return[...new Array(i).keys()].map(e=>n.fromAnglePNorm(Math.PI*2*e/i,t))}var Ye={name:"Squircle creator",description:"",element:ne,drawFunc(i,t){let e=i.cnv.getContext("2d");e.strokeStyle="black";let s=ie(ht,ct);s.forEach(o=>o.mult(rt)),e.beginPath(),e.moveTo(i.mouseX+s[0].x,i.mouseY+s[0].y);for(let o=1;o<s.length;o+=1)e.lineTo(i.mouseX+s[o].x,i.mouseY+s[o].y);e.closePath(),e.stroke(),i.mouseDown&&(e.beginPath(),e.moveTo(i.mouseX,i.mouseY),e.lineTo(i.lastX,i.lastY),e.stroke())},startInteractionFunc(i){},endInteractionFunc(i){let t=ie(ht,ct),e=new n(i.lastX,i.lastY);if(t.forEach(s=>{s.mult(rt),s.add(e)}),i.lastX!==0&&i.lastY!==0){let s=new N(t,new n(i.lastX-i.mouseX,i.lastY-i.mouseY),It,0,Ct);s.style=Ot,i.physics.addBody(s)}}};ne.append(b("range-slider",{min:5,max:120,step:1,value:rt,onChange:i=>{rt=i}},"Size"),b("range-slider",{min:2,max:7,step:1,value:9-ct,onChange:i=>{ct=9-i}},"Roundness"),b("range-slider",{min:12,max:36,step:1,value:ht,onChange:i=>{ht=i}},"Resolution"),b("range-slider",{min:0,max:.9,step:.02,value:It,onChange:i=>{It=i}},"Bounciness"),b("range-slider",{min:0,max:2,step:.1,value:Ct,onChange:i=>{Ct=i}},"Coefficient of friction"),b("color-picker",{value:Ot,onChange:i=>{Ot=i}},"Color:"));var oe=Ye;var E=35,Te=.5,lt=1.5,Et=24,Bt=1,ae=document.createElement("div"),Fe={name:"Soft square creator",description:"",element:ae,drawFunc(i,t){let e=i.cnv.getContext("2d");e.strokeStyle="black",e.beginPath(),e.moveTo(i.mouseX-E,i.mouseY-E),e.lineTo(i.mouseX+E,i.mouseY-E),e.lineTo(i.mouseX+E,i.mouseY+E),e.lineTo(i.mouseX-E,i.mouseY+E),e.lineTo(i.mouseX-E,i.mouseY-E),e.stroke(),i.lastX!==0&&i.lastY!==0&&(e.beginPath(),e.moveTo(i.mouseX,i.mouseY),e.lineTo(i.lastX,i.lastY),e.stroke())},startInteractionFunc(i){},endInteractionFunc(i){if(i.lastX!==0&&i.lastY!==0){let t=new C(new n(i.lastX,i.lastY),new n(i.lastX-i.mouseX,i.lastY-i.mouseY),E,Te,0,lt);Number.isFinite(t.pos.x)&&Number.isFinite(t.pos.y)&&Number.isFinite(t.vel.x)&&Number.isFinite(t.vel.y)&&i.physics.addSoftSquare(t.pos,E*2,lt,t.vel,Et,Bt)}}};ae.append(b("range-slider",{min:5,max:100,step:1,value:E,onChange:i=>{E=i}},"Size"),b("range-slider",{min:.4,max:3,step:.1,value:Bt,onChange:i=>{Bt=i}},"Pressure"),b("range-slider",{min:0,max:2,step:.1,value:lt,onChange:i=>{lt=i}},"Coefficient of friction"),b("range-slider",{min:16,max:48,step:8,value:Et,onChange:i=>{Et=i}},"Resolution"));var re=Fe;var ce=document.createElement("template");ce.innerHTML=`
  <style>
    .checkbox-label {
        font-weight: bold;
        padding-right: 0.45em;
        margin-top: 1.1em;
        display: flex;
    }
    .ch-box {
        display: none;
    }
    .checkbox-display {
        width: 1.15em;
        height: 1.15em;
        display: block;
        background-color: var(--roman-silver);
        margin-bottom: 0.3em;
        margin-right: 0.3em;
        margin-left: 0em;
        padding: 0;
        position: relative;
        border-radius: 0.2em;
        top: 0.2em;
        -webkit-transition: 0.2s;
        transition: background-color 0.2s;
        text-align: center;
        float: left;
    }
    input[type="checkbox"]:checked ~ .checkbox-display {
        background-color: var(--pinky-darker);
    }
    .checkbox-display:hover,
    .checkbox-label:hover > .checkbox-display {
        background-color: var(--independence);
    }
    input[type="checkbox"]:checked ~ .checkbox-display > .checkmark {
        transform: scale(1.2);
    }
    .checkmark {
        width: 75%;
        height: auto;
        fill: white;
        transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        transform: scale(0);
    }
    .label-text {
        margin-top: 0.2em;
        flex: 1;
    }
    .cursor-pointer > * {
        cursor: pointer;
    }
    /* For tablets */
    @media (max-width: 768px) {
      .checkbox-label {
        margin-top: 0.6em;
        font-size: small;
      }
    }
  </style>
`;var he=class extends HTMLElement{constructor(){super();this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(ce.content.cloneNode(!0)),this.shadowRoot.appendChild(b("div",{className:"cursor-pointer"},b("label",{htmlFor:"cbIdentifier",className:"checkbox-label"},b("input",{type:"checkbox",className:"ch-box",id:"cbIdentifier"}),b("div",{className:"checkbox-display"}),b("div",{className:"label-text"},b("slot",null))))),this.shadowRoot.querySelector(".checkbox-display").innerHTML='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="122.877px" height="101.052px" viewBox="0 0 122.877 101.052" id="checkmark-svg" enable-background="new 0 0 122.877 101.052" xml:space="preserve"><g><path d="M4.43,63.63c-2.869-2.755-4.352-6.42-4.427-10.11c-0.074-3.689,1.261-7.412,4.015-10.281 c2.752-2.867,6.417-4.351,10.106-4.425c3.691-0.076,7.412,1.255,10.283,4.012l24.787,23.851L98.543,3.989l1.768,1.349l-1.77-1.355 c0.141-0.183,0.301-0.339,0.479-0.466c2.936-2.543,6.621-3.691,10.223-3.495V0.018l0.176,0.016c3.623,0.24,7.162,1.85,9.775,4.766 c2.658,2.965,3.863,6.731,3.662,10.412h0.004l-0.016,0.176c-0.236,3.558-1.791,7.035-4.609,9.632l-59.224,72.09l0.004,0.004 c-0.111,0.141-0.236,0.262-0.372,0.368c-2.773,2.435-6.275,3.629-9.757,3.569c-3.511-0.061-7.015-1.396-9.741-4.016L4.43,63.63 L4.43,63.63z"/></g></svg>',this.shadowRoot.querySelector("#checkmark-svg").classList.add("checkmark")}get checkbox(){return this.shadowRoot.querySelector("#cbIdentifier")}set checked(t){this.checkbox.checked=t}set onChange(t){this.checkbox.onchange=e=>t(e.target.checked)}};window.customElements.define("check-box",he);var Xt=!1,A=1e4,le=document.createElement("div"),Le={name:"Spring creator",description:"",element:le,drawFunc(i,t){let e=i.cnv.getContext("2d");i.lastX!==0&&i.lastY!==0&&(e.strokeStyle="black",e.beginPath(),e.moveTo(i.mouseX,i.mouseY),e.lineTo(i.lastX,i.lastY),e.stroke())},startInteractionFunc(i){},endInteractionFunc(i){if(i.lastX!==0&&i.lastY!==0){let t=i.physics.getObjectAtCoordinates(i.mouseX,i.mouseY),e,s=O;if(t||(t={x:i.mouseX,y:i.mouseY,pinPoint:!0}),i.choosed===t||i.choosed===void 0&&t===void 0||i.choosed instanceof Object&&t instanceof Object&&"pinPoint"in i.choosed&&"pinPoint"in t||(i.choosed instanceof Object&&t instanceof Object&&"pinPoint"in i.choosed&&"pos"in t?(e=new s(Math.sqrt((i.choosed.x-t.pos.x)**2+(i.choosed.y-t.pos.y)**2),A),e.attachObject(t),e.pinHere(i.choosed.x,i.choosed.y)):t instanceof Object&&i.choosed instanceof Object&&"pos"in i.choosed&&"pinPoint"in t?(e=new s(Math.sqrt((i.choosed.pos.x-t.x)**2+(i.choosed.pos.y-t.y)**2),A),e.attachObject(i.choosed),e.pinHere(t.x,t.y)):i.choosed instanceof Object&&t instanceof Object&&"pos"in i.choosed&&"pos"in t&&(e=new s(Math.sqrt((i.choosed.pos.x-t.pos.x)**2+(i.choosed.pos.y-t.pos.y)**2),A),e.attachObject(i.choosed),e.attachObject(t)),typeof e=="undefined"))return;i.physics.addSpring(e),Xt&&e.lockRotation()}}};le.append(b("check-box",{checked:Xt,onChange:i=>{Xt=i}},"Lock rotation"),b("range-slider",{min:2e3,max:1e5,value:A,step:200,onChange:i=>{A=i}},"Spring stiffness"));var ue=Le;var Yt=!1,Tt=document.createElement("div"),Ne={name:"Stick creator",description:"",element:Tt,drawFunc(i,t){let e=i.cnv.getContext("2d");i.lastX!==0&&i.lastY!==0&&(e.strokeStyle="black",e.beginPath(),e.moveTo(i.mouseX,i.mouseY),e.lineTo(i.lastX,i.lastY),e.stroke())},startInteractionFunc(i){},endInteractionFunc(i){if(i.lastX!==0&&i.lastY!==0){let t=i.physics.getObjectAtCoordinates(i.mouseX,i.mouseY),e,s=Y;if(t||(t={x:i.mouseX,y:i.mouseY,pinPoint:!0}),typeof i.choosed=="boolean"||i.choosed===t||i.choosed===void 0&&t===void 0||"pinPoint"in i.choosed&&"pinPoint"in t||("pinPoint"in i.choosed&&"pos"in t?(e=new s(Math.sqrt((i.choosed.x-t.pos.x)**2+(i.choosed.y-t.pos.y)**2)),e.attachObject(t),e.pinHere(i.choosed.x,i.choosed.y)):"pinPoint"in t&&"pos"in i.choosed?(e=new s(Math.sqrt((i.choosed.pos.x-t.x)**2+(i.choosed.pos.y-t.y)**2)),e.attachObject(i.choosed),e.pinHere(t.x,t.y)):"pos"in i.choosed&&"pos"in t&&(e=new s(Math.sqrt((i.choosed.pos.x-t.pos.x)**2+(i.choosed.pos.y-t.pos.y)**2)),e.attachObject(i.choosed),e.attachObject(t)),typeof e=="undefined"))return;i.physics.addSpring(e),Yt&&e.lockRotation()}},keyGotUpFunc(i){},keyGotDownFunc(i){}};[b("check-box",{checked:Yt,onChange:i=>{Yt=i}},"Lock rotation")].forEach(Tt.appendChild.bind(Tt));var de=Ne;var ut=20,me=document.createElement("div"),Re={name:"Wall drawer",description:"",element:me,drawFunc(i,t){let e=i.cnv.getContext("2d");e.strokeStyle="black",e.beginPath(),e.arc(i.mouseX,i.mouseY,ut,0,2*Math.PI),e.stroke(),i.lastX!==0&&i.lastY!==0&&i.physics.addFixedBall(i.mouseX,i.mouseY,ut)}};me.append(b("range-slider",{min:5,max:70,step:1,value:ut,onChange:i=>{ut=i}},"Size"));var fe=Re;var je=document.createElement("div"),We={name:"World settings",description:"",element:je,init(i){let t=i;this.element.append(b("range-slider",{min:0,max:5e3,step:200,value:t.physics.gravity.y,onChange:e=>{t.physics.gravity.y=e}},"Gravity"),b("range-slider",{min:-5e3,max:5e3,step:1e3,value:t.physics.gravity.x,onChange:e=>{t.physics.gravity.x=e}},"Gravity in X direction"),b("range-slider",{min:0,max:.99,step:.01,value:1-t.physics.airFriction,onChange:e=>{t.physics.setAirFriction(1-e)}},"Air friction"),b("check-box",{checked:t.hasCeiling(),onChange:e=>{t.setCeiling(e)}},"World ceiling"),b("check-box",{checked:t.drawCollisions,onChange:e=>{t.drawCollisions=e}},"Show collision data"),b("check-box",{checked:t.showAxes,onChange:e=>{t.showAxes=e}},"Show body axes"))}},ge=We;var pe=[Ut,te,fe,de,ue,At,Qt,re,$t,se,ge,oe];var F=pe,dt=F.map(i=>i.name),be=class{constructor(){this.resizeCanvas=()=>{let t=this.canvasHolder.getBoundingClientRect();this.cnv.width=t.width,this.cnv.height=window.innerHeight-t.top;let e=window.devicePixelRatio||1,s=t;this.cnv.width=s.width*e,this.cnv.height=s.height*e,this.cnv.style.width=`${s.width}px`,this.cnv.style.height=`${s.height}px`,this.scaling=this.cnv.height/this.worldSize.height,this.scaling/=e,this.scaling*=.9,this.viewOffsetX=.01*this.cnv.width,this.viewOffsetY=.03*this.cnv.height;let o=this.cnv.getContext("2d");o&&(o.scale(e,e),o.lineWidth=e),this.defaultSize=(this.cnv.width+this.cnv.height)/80};this.drawFunction=()=>{var s,o;Number.isFinite(this.lastFrameTime)||(this.lastFrameTime=performance.now());let t=performance.now()-this.lastFrameTime;Number.isFinite(t)||(t=0),t/=1e3,t=Math.min(t,.04166666666);let e=this.cnv.getContext("2d");e.fillStyle=X.Independence,e.fillRect(0,0,this.cnv.width,this.cnv.height),e.save(),e.translate(this.viewOffsetX,this.viewOffsetY),e.scale(this.scaling,this.scaling),(o=(s=F[this.mode]).drawFunc)==null||o.call(s,this,t*this.timeMultiplier),this.physicsDraw(),e.restore(),this.physics.balls[0]&&(this.left&&(this.physics.balls[0].ang-=Math.PI*100*t),this.right&&(this.physics.balls[0].ang+=Math.PI*100*t)),t*=this.timeMultiplier,this.physics.update(t/5),this.physics.update(t/5),this.physics.update(t/5),this.physics.update(t/5),this.physics.update(t/5),this.lastFrameTime=performance.now(),requestAnimationFrame(this.drawFunction)};this.startInteraction=(t,e)=>{var s,o;this.mouseX=t/this.scaling-this.viewOffsetX/this.scaling,this.mouseY=e/this.scaling-this.viewOffsetY/this.scaling,this.choosed=this.physics.getObjectAtCoordinates(this.mouseX,this.mouseY),this.choosed||(this.choosed={x:this.mouseX,y:this.mouseY,pinPoint:!0}),this.lastX=this.mouseX,this.lastY=this.mouseY,this.mouseDown=!0,(o=(s=F[this.mode]).startInteractionFunc)==null||o.call(s,this)};this.endInteraction=(t,e)=>{var s,o;this.mouseX=t/this.scaling-this.viewOffsetX/this.scaling,this.mouseY=e/this.scaling-this.viewOffsetY/this.scaling,(o=(s=F[this.mode]).endInteractionFunc)==null||o.call(s,this),this.lastX=0,this.lastY=0,this.mouseDown=!1,this.choosed=!1};this.discardInteraction=()=>{this.lastX=0,this.lastY=0,this.mouseDown=!1,this.choosed=!1};this.keyGotDown=t=>{let e=t.key;e==="s"&&this.spawnNewtonsCradle(this.cnv.width/2,this.cnv.height/2,.5,this.physics),e==="a"&&(this.scaling+=.01),e==="d"&&(this.scaling-=.01),e==="j"&&(this.viewOffsetX-=10),e==="l"&&(this.viewOffsetX+=10),e==="k"&&(this.viewOffsetY-=10),e==="i"&&(this.viewOffsetY+=10),e==="ArrowRight"&&(this.right=!0),e==="ArrowLeft"&&(this.left=!0)};this.keyGotUp=t=>{let e=t.key;e==="ArrowRight"&&(this.right=!1),e==="ArrowLeft"&&(this.left=!1)};this.startTouch=t=>{t.preventDefault();let e=this.canvasHolder.getBoundingClientRect();return t.touches.length>1?(this.discardInteraction(),t.touches.length===2&&(this.touchIDs.push(t.touches[0].identifier),this.touchIDs.push(t.touches[1].identifier),this.touchCoords.push(new n(t.touches[0].clientX-e.left,t.touches[0].clientY-e.top)),this.touchCoords.push(new n(t.touches[1].clientX-e.left,t.touches[1].clientY-e.top))),t.touches.length>2&&(this.touchIDs=[],this.touchCoords=[]),!1):(this.startInteraction(t.changedTouches[0].clientX-e.left,t.changedTouches[0].clientY-e.top),!1)};this.endTouch=t=>{t.preventDefault();let e=this.canvasHolder.getBoundingClientRect();return t.touches.length<=1&&(this.touchIDs=[],this.touchCoords=[]),this.endInteraction(t.changedTouches[0].clientX-e.left,t.changedTouches[0].clientY-e.top),!1};this.moveTouch=t=>{t.preventDefault();let e=this.canvasHolder.getBoundingClientRect();if(t.touches.length===2){let s=[];return t.touches.item(0).identifier===this.touchIDs[0]?(s.push(t.touches.item(0)),s.push(t.touches.item(1))):(s.push(t.touches.item(1)),s.push(t.touches.item(0))),s=s.map(o=>new n(o.clientX-e.left,o.clientY-e.top)),this.processMultiTouchGesture(this.touchCoords,s),this.touchCoords=s,!1}return t.touches.length>2||(this.mouseX=t.changedTouches[0].clientX-e.left,this.mouseY=t.changedTouches[0].clientY-e.top,this.mouseX=this.mouseX/this.scaling-this.viewOffsetX/this.scaling,this.mouseY=this.mouseY/this.scaling-this.viewOffsetY/this.scaling),!1};this.processMultiTouchGesture=(t,e)=>{let s=n.add(t[1],t[0]);s.mult(.5);let o=n.add(e[1],e[0]);o.mult(.5);let a=n.dist(t[1],t[0]),h=n.dist(e[1],e[0]),c=Math.sqrt(h/a),u=n.add(s,o);u.mult(.5);let l=n.sub(o,s);l.mult(c),this.scaleAround(u,c),this.viewOffsetX+=l.x,this.viewOffsetY+=l.y};this.scaleAround=(t,e)=>{this.viewOffsetX=t.x-(t.x-this.viewOffsetX)*e,this.viewOffsetY=t.y-(t.y-this.viewOffsetY)*e,this.scaling*=e};this.startMouse=t=>(t.button===0&&this.startInteraction(t.offsetX,t.offsetY),t.button===2&&(this.rightButtonDown=new n(t.offsetX,t.offsetY),this.cnv.style.cursor="all-scroll"),!1);this.endMouse=t=>(t.button===0&&this.endInteraction(t.offsetX,t.offsetY),t.button===2&&(this.rightButtonDown=!1,this.cnv.style.cursor="default"),!1);this.handleMouseMovement=t=>{if(this.mouseX=t.offsetX,this.mouseY=t.offsetY,this.mouseX=this.mouseX/this.scaling-this.viewOffsetX/this.scaling,this.mouseY=this.mouseY/this.scaling-this.viewOffsetY/this.scaling,this.rightButtonDown){let e=new n(t.offsetX,t.offsetY),s=n.sub(e,this.rightButtonDown);this.viewOffsetX+=s.x,this.viewOffsetY+=s.y,this.rightButtonDown=e}};this.handleMouseWheel=t=>{t.preventDefault();let e=new n(t.offsetX,t.offsetY),s=5e-4;t.deltaMode===WheelEvent.DOM_DELTA_LINE&&(s/=16);let o=1-t.deltaY*s;this.scaleAround(e,o)};this.handleGestureStart=t=>{t.preventDefault();let e=this.canvasHolder.getBoundingClientRect();this.gestureCoord=new n(t.clientX-e.left,t.clientY-e.top),this.gestureScale=1};this.handleGestureChange=t=>{t.preventDefault();let e=this.canvasHolder.getBoundingClientRect(),s=new n(t.clientX-e.left,t.clientY-e.top);if(this.gestureCoord){let o=n.sub(s,this.gestureCoord),a=t.scale/this.gestureScale;this.scaleAround(s,a),this.viewOffsetX+=o.x*a,this.viewOffsetY+=o.y*a}this.gestureScale=t.scale};this.handleGestureEnd=t=>{t.preventDefault(),this.gestureScale=1};this.convertToPhysicsSpace=t=>new n(t.x/this.scaling-this.viewOffsetX/this.scaling,t.y/this.scaling-this.viewOffsetY/this.scaling);this.convertToCanvasSpace=t=>new n(t.x*this.scaling+this.viewOffsetX,t.y*this.scaling+this.viewOffsetY);this.physicsDraw=()=>{let t=this.cnv.getContext("2d");if(t){t.strokeStyle="black",t.fillStyle=X.Turquoise;for(let s=0;s<this.physics.balls.length;s+=1){let o=this.physics.balls[s];t.fillStyle=o.style,t.beginPath(),t.arc(o.pos.x,o.pos.y,o.r,0,2*Math.PI),t.stroke(),t.fill(),t.beginPath(),t.moveTo(o.pos.x,o.pos.y),t.lineTo(o.pos.x+o.r*Math.cos(o.rotation),o.pos.y+o.r*Math.sin(o.rotation)),t.stroke()}this.physics.bodies.forEach(s=>{t.fillStyle=s.style,t.beginPath(),t.moveTo(s.points[s.points.length-1].x,s.points[s.points.length-1].y),s.points.forEach(o=>{t.lineTo(o.x,o.y)}),t.stroke(),t.fill(),this.showAxes&&s.axes.forEach(o=>{t.beginPath(),t.moveTo(s.pos.x,s.pos.y),t.lineTo(s.pos.x+o.x*30,s.pos.y+o.y*30),t.stroke()}),t.beginPath(),t.arc(s.pos.x,s.pos.y,1.5,0,Math.PI*2),t.stroke()});let e=s=>{t.beginPath(),t.moveTo(s.points[s.points.length-1].x,s.points[s.points.length-1].y),s.points.forEach(o=>{t.lineTo(o.x,o.y)}),t.fill()};t.fillStyle=X.Beige,this.physics.walls.forEach(e),this.physics.bounds.forEach(e),this.physics.fixedBalls.forEach(s=>{t.beginPath(),t.arc(s.x,s.y,s.r,0,Math.PI*2),t.fill()}),t.save(),t.lineWidth=2,this.physics.springs.forEach(s=>{if(s instanceof O&&!(s instanceof Y)){let o,a,h,c;s.pinned&&typeof s.pinned=="object"?(o=s.pinned.x,a=s.pinned.y,h=s.objects[0].pos.x,c=s.objects[0].pos.y):(o=s.objects[0].pos.x,a=s.objects[0].pos.y,h=s.objects[1].pos.x,c=s.objects[1].pos.y);let u=new n(h-o,c-a),l=u.copy;u.rotate(Math.PI/2),u.setMag(5);let r=new n(o,a),d=Math.floor(s.length/10);for(let m=1;m<=d;m+=1)t.strokeStyle=X.blue,t.fillStyle=X.blue,m===d&&(u=new n(0,0)),t.beginPath(),t.moveTo(r.x,r.y),t.lineTo(o+m/d*l.x+u.x,a+m/d*l.y+u.y),t.stroke(),r=new n(o+m/d*l.x+u.x,a+m/d*l.y+u.y),u.mult(-1)}else t.strokeStyle=X.blue,t.fillStyle=X.blue,t.beginPath(),t.moveTo(s.objects[0].pos.x,s.objects[0].pos.y),t.lineTo(typeof s.pinned=="object"?s.pinned.x:s.objects[1].pos.x,typeof s.pinned=="object"?s.pinned.y:s.objects[1].pos.y),t.stroke();s.objects.forEach(o=>{t.strokeStyle="black",t.fillStyle=X.blue,t.beginPath(),t.arc(o.pos.x,o.pos.y,2.5,0,Math.PI*2),t.fill(),t.stroke()}),typeof s.pinned=="object"&&(t.strokeStyle="black",t.fillStyle=X.blue,t.beginPath(),t.arc(s.pinned.x,s.pinned.y,3,0,Math.PI*2),t.fill(),t.stroke())}),t.restore(),t.fillStyle=X["Maximum Yellow Red"],t.strokeStyle=X["Maximum Yellow Red"],t.lineWidth=4,this.drawCollisions&&this.physics.collisionData.forEach(s=>{t.beginPath(),t.moveTo(s.cp.x,s.cp.y),t.lineTo(s.cp.x+s.n.x*30,s.cp.y+s.n.y*30),t.stroke(),t.beginPath(),t.arc(s.cp.x,s.cp.y,4,0,Math.PI*2),t.fill()})}};this.spawnNewtonsCradle=(t,e,s,o)=>{let a=[],h=25,c=250,u=8;a.push(new C(new n(t,e),new n(0,0),s*h,1,0,0));let l=1;for(let r=0;r<u-1;r+=1)a.push(new C(new n(t+l*s*h*1.01*2,e),new n(0,0),s*25,1,0,0)),l*=-1,l>0&&(l+=1),r===u-2&&(a[a.length-1].vel.x=-Math.sign(l)*s*h*8);a.forEach(r=>{o.addBall(r);let d=new Y(c);d.attachObject(r),d.pinHere(r.pos.x,r.pos.y-c),o.addSpring(d),d.lockRotation()})};this.modeButtonClicked=t=>{let e=t.target.id.replace("-btn",""),s=dt.indexOf(e);this.switchToMode(s)};this.switchToMode=t=>{var o,a,h,c;let e=document.getElementById(`${dt[this.mode]}-btn`);e&&e.classList.remove("bg-pink-darker"),this.sidebar.innerHTML="",(a=(o=F[this.mode]).deactivated)==null||a.call(o,this),(c=(h=F[t]).activated)==null||c.call(h,this);let s=document.getElementById(`${dt[t]}-btn`);s&&s.classList.add("bg-pink-darker"),this.modeTitleHolder.innerText=F[t].name,this.mode=t,this.sidebar.appendChild(F[this.mode].element)};this.setupModes=()=>{let t=document.getElementById("button-holder");dt.forEach((e,s)=>{var a,h;let o=document.createElement("div");o.classList.add("big-button"),o.id=`${e}-btn`,o.textContent=F[s].name,(h=(a=F[s]).init)==null||h.call(a,this),o.onclick=this.modeButtonClicked,t&&t.appendChild(o)}),this.switchToMode(this.mode)};this.setTimeMultiplier=t=>{Number.isFinite(t)&&t>=0&&(this.timeMultiplier=t,t===0?this.pauseBtn.classList.add("bg-pink-darker"):this.pauseBtn.classList.remove("bg-pink-darker"))};this.getTimeMultiplier=()=>this.timeMultiplier;this.setPhysics=t=>{t instanceof K&&(this.physics=t)};this.getPhysics=()=>this.physics;this.physics=new K,this.mouseX=0,this.mouseY=0,this.mouseDown=!1,this.defaultSize=30,this.k=.5,this.fc=2,this.springConstant=2e3,this.scaling=1,this.viewOffsetX=0,this.viewOffsetY=0,this.mode=0,this.lastX=0,this.lastY=0,this.touchIDs=[],this.touchCoords=[],this.gestureCoord=!1,this.rightButtonDown=!1,this.gestureScale=1,this.timeMultiplier=1,this.lastFrameTime=performance.now(),this.choosed=!1,this.drawCollisions=!1,this.showAxes=!1,this.worldSize={width:0,height:0},this.ceiling=!0,this.left=!1,this.right=!1,this.cnv=document.getElementById("defaulCanvas0"),this.canvasHolder=document.getElementById("canvas-holder"),this.sidebar=document.getElementById("sidebar"),this.modeTitleHolder=document.getElementById("mode-title-text"),this.pauseBtn=document.getElementById("pause"),this.setWorldSize({width:2e3,height:1e3}),this.physics.setGravity(new n(0,1e3)),this.physics.setAirFriction(.9),this.cnv.addEventListener("touchstart",this.startTouch,!1),this.cnv.addEventListener("touchend",this.endTouch,!1),this.cnv.addEventListener("touchmove",this.moveTouch,!1),this.cnv.addEventListener("mousedown",this.startMouse,!1),this.cnv.addEventListener("mouseup",this.endMouse,!1),this.cnv.addEventListener("mousemove",this.handleMouseMovement,!1),this.cnv.addEventListener("wheel",this.handleMouseWheel,{passive:!0}),this.cnv.addEventListener("gesturestart",this.handleGestureStart,!1),this.cnv.addEventListener("gesturechange",this.handleGestureChange,!1),this.cnv.addEventListener("gestureend",this.handleGestureEnd,!1),this.cnv.addEventListener("contextmenu",t=>t.preventDefault()),document.addEventListener("keydown",this.keyGotDown,!1),document.addEventListener("keyup",this.keyGotUp,!1),window.addEventListener("resize",this.resizeCanvas,!1),this.resizeCanvas(),this.setupModes(),bt(this),requestAnimationFrame(this.drawFunction)}setWorldSize(t){this.physics.setBounds(0,0,t.width,t.height),this.worldSize=t}hasCeiling(){return this.ceiling}setCeiling(t){this.physics.setBounds(0,0,this.worldSize.width,this.worldSize.height,t),this.ceiling=t}},ye=be;window.onload=()=>{window.editorApp=new ye,"serviceWorker"in navigator&&navigator.serviceWorker.register("serviceworker.js").then(()=>{},i=>{console.log("ServiceWorker registration failed: ",i)})};})();

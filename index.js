(()=>{var w=class{constructor(t,e){this.x=t,this.y=e}get copy(){return new w(this.x,this.y)}setCoordinates(t,e){this.x=t,this.y=e}get length(){return Math.sqrt(this.x*this.x+this.y*this.y)}get sqlength(){return this.x*this.x+this.y*this.y}get heading(){if(this.x===0&&this.y===0)return 0;if(this.x===0)return this.y>0?Math.PI/2:1.5*Math.PI;if(this.y===0)return this.x>0?0:Math.PI;let t=w.normalized(this);return this.x>0&&this.y>0?Math.asin(t.y):this.x<0&&this.y>0?Math.asin(-t.x)+Math.PI/2:this.x<0&&this.y<0?Math.asin(-t.y)+Math.PI:this.x>0&&this.y<0?Math.asin(t.x)+1.5*Math.PI:0}add(t){this.x+=t.x,this.y+=t.y}sub(t){this.x-=t.x,this.y-=t.y}mult(t){this.x*=t,this.y*=t}div(t){this.x/=t,this.y/=t}lerp(t,e){this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e}dist(t){return new w(this.x-t.x,this.y-t.y).length}pNorm(t){let e=t;return e<1&&(e=1),(Math.abs(this.x**e)+Math.abs(this.y**e))**(1/e)}setMag(t){this.length!==0&&this.mult(t/this.length)}normalize(){this.length!==0&&this.div(this.length)}rotate(t){let e=Math.cos(t),s=Math.sin(t);this.setCoordinates(this.x*e-this.y*s,this.x*s+this.y*e)}static rotateArr(t,e){let s=Math.cos(e),o=Math.sin(e);t.forEach(r=>{r.setCoordinates(r.x*s-r.y*o,r.x*o+r.y*s)})}rotate90(){let{x:t}=this;this.x=-this.y,this.y=t}rotate270(){let{x:t}=this;this.x=this.y,this.y=-t}static add(t,e){return new w(t.x+e.x,t.y+e.y)}static sub(t,e){return new w(t.x-e.x,t.y-e.y)}static mult(t,e){return new w(t.x*e,t.y*e)}static div(t,e){return new w(t.x/e,t.y/e)}static fromAngle(t){return new w(Math.cos(t),Math.sin(t))}static fromAnglePNorm(t,e){let s=new w(Math.cos(t),Math.sin(t));return s.div(s.pNorm(e)),s}static lerp(t,e,s){return w.add(t,w.mult(w.sub(e,t),s))}static dist(t,e){return w.sub(t,e).length}static dot(t,e){return t.x*e.x+t.y*e.y}static cross(t,e){return t.x*e.y-t.y*e.x}static crossScalarFirst(t,e){return new w(-e.y*t,e.x*t)}static crossScalarSecond(t,e){return new w(t.y*e,-t.x*e)}static angle(t,e){return Math.acos(Math.min(Math.max(w.dot(t,e)/Math.sqrt(t.sqlength*e.sqlength),1),-1))}static angleACW(t,e){let s=t.heading,r=e.heading-s;return r<0?2*Math.PI+r:r}static normalized(t){let e=t.length;return e===0?t:new w(t.x/e,t.y/e)}toJSON(){return{x:this.x,y:this.y}}static fromObject(t){return new w(t.x,t.y)}},i=w;var Ct=class{constructor(t,e){this.a=t,this.b=e}get length(){return i.dist(this.a,this.b)}distFromPoint(t){let e=i.sub(this.a,this.b),s=i.sub(t,this.b),o=i.sub(t,this.a),r=s.length,a=o.length,h=e.length;if(h===0)return r;let l=i.angle(s,o),u=i.angle(s,e),d=Math.PI-l-u,c=Math.sin(d)*a*h/2,f=2*c/h;return d>Math.PI/2?a:u>Math.PI/2?r:f}get nearestPointO(){let t=i.sub(this.b,this.a);if(i.dot(this.a,t)>=0)return this.a.copy;if(i.dot(this.b,t)<=0)return this.b.copy;t.normalize();let e=-i.dot(this.a,t);return i.add(this.a,i.mult(t,e))}static intersect(t,e){let s=i.sub(t.b,t.a),o=s.y/s.x,r=t.b.y-t.b.x*o,a=i.sub(e.b,e.a),h=a.y/a.x,l=e.b.y-e.b.x*h;if(s.x===0&&a.x!==0){if(t.a.x>=e.a.x&&t.a.x<=e.b.x||t.a.x<=e.a.x&&t.a.x>=e.b.x){let m=h*t.a.x+l;if(m>t.a.y&&m<t.b.y||m<t.a.y&&m>t.b.y)return new i(t.a.x,m)}return!1}if(a.x===0&&s.x!==0){if(e.a.x>=t.a.x&&e.a.x<=t.b.x||e.a.x<=t.a.x&&e.a.x>=t.b.x){let m=o*e.a.x+r;if(m>e.a.y&&m<e.b.y||m<e.a.y&&m>e.b.y)return new i(e.a.x,m)}return!1}if(s.x===0&&a.x===0){if(t.a.x===e.a.x){let m;t.a.y<t.b.y?m=[t.a.y,t.b.y]:m=[t.b.y,t.a.y];let g;e.a.y<e.b.y?g=[e.a.y,e.b.y]:g=[e.b.y,e.a.y];let x=[m[0]>g[0]?m[0]:g[0],m[1]<g[1]?m[1]:g[1]];if(x[0]<=x[1])return new i(t.a.x,(x[0]+x[1])/2)}return!1}let u;t.a.x<t.b.x?u=[t.a.x,t.b.x]:u=[t.b.x,t.a.x];let d;e.a.x<e.b.x?d=[e.a.x,e.b.x]:d=[e.b.x,e.a.x];let c=[u[0]>d[0]?u[0]:d[0],u[1]<d[1]?u[1]:d[1]];if(o===h&&r===l&&c[0]<=c[1])return new i((c[0]+c[1])/2,(c[0]+c[1])/2*o+r);let f=(l-r)/(o-h);return f>=c[0]&&f<=c[1]?new i(f,f*o+r):!1}},O=Ct;var It=class extends O{get length(){return Number.POSITIVE_INFINITY}distFromPoint(t){let e=i.sub(this.a,this.b);e.setMag(1),e.rotate(Math.PI/2);let s=i.sub(t,this.a);return Math.abs(i.dot(s,e))}static intersect(t,e){let s=i.sub(t.b,t.a),o=s.y/s.x,r=t.b.y-t.b.x*o,a=i.sub(e.b,e.a),h=a.y/a.x,l=e.b.y-e.b.x*h;if(o===h)return t.distFromPoint(e.a)===0?new i((t.a.x+t.b.x+e.a.x+e.b.x)/4,(t.a.y+t.b.y+e.a.y+e.b.y)/4):!1;let u=(l-r)/(o-h);return new i(u,o*u+r)}static intersectWithLineSegment(t,e){let s=i.sub(t.b,t.a),o=s.y/s.x,r=t.b.y-t.b.x*o,a=i.sub(e.b,e.a),h=a.y/a.x,l=e.b.y-e.b.x*h;if(s.x===0){if(a.x===0)return t.a.x===e.a.x?new i((e.a.x+e.b.x)/2,(e.a.y+e.b.y)/2):!1;let c=t.a.x,f=h*c+l;return Math.min(e.a.x,e.b.x)<c&&c<Math.max(e.a.x,e.b.x)&&Math.min(e.a.y,e.b.y)<f&&Math.max(e.a.y,e.b.y)>f?new i(c,f):!1}if(a.x===0){let c=e.a.x,f=o*c+r;return Math.min(e.a.x,e.b.x)<c&&c<Math.max(e.a.x,e.b.x)&&Math.min(e.a.y,e.b.y)<f&&Math.max(e.a.y,e.b.y)>f?new i(c,f):!1}if(o===h)return t.distFromPoint(e.a)===0?new i((e.a.x+e.b.x)/2,(e.a.y+e.b.y)/2):!1;let u=(l-r)/(o-h),d=o*u+r;return Math.min(e.a.x,e.b.x)<u&&u<Math.max(e.a.x,e.b.x)&&Math.min(e.a.y,e.b.y)<d&&Math.max(e.a.y,e.b.y)>d?new i(u,d):!1}},F=It;function H(n,t){this.min=n,this.max=t}H.prototype.size=function(){return this.max-this.min};function _(n){return new H(Math.min(...n),Math.max(...n))}function A(n,t){return new H(Math.max(n.min,t.min),Math.min(n.max,t.max))}var E=class{constructor(t){if(t.length<3)throw new Error("Not enough points in polygon (minimum required: 3)");this.points=t,this.makeAntiClockwise()}getSideVector(t){let e=t;return e<0&&(e+=Math.abs(Math.floor(e))*this.points.length),i.sub(this.points[(e+1)%this.points.length],this.points[e%this.points.length])}getSideSegment(t){let e=t;return e<0&&(e+=Math.abs(Math.floor(e))*this.points.length),new O(i.fromObject(this.points[(e+1)%this.points.length]),i.fromObject(this.points[e%this.points.length]))}getSideLine(t){let e=t;return e<0&&(e+=Math.abs(Math.floor(e))*this.points.length),new O(i.fromObject(this.points[(e+1)%this.points.length]),i.fromObject(this.points[e%this.points.length]))}get sides(){return this.points.length}makeAntiClockwise(){let t=0;for(let e=1;e<=this.sides;e+=1){let s=this.getSideVector(e),o=this.getSideVector(e-1);o.mult(-1),t+=i.angleACW(s,o)}this.sides===3?t>Math.PI*1.5&&this.reverseOrder():this.sides===4?i.angleACW(this.getSideVector(1),this.getSideVector(0))>=Math.PI&&this.reverseOrder():this.sides>4&&t-this.sides*Math.PI>0&&this.reverseOrder()}reverseOrder(){this.points=this.points.reverse()}isPointInside(t){let e=new i(t.x,t.y);if(i.dist(e,this.centerPoint)>this.boundRadius)return!1;let s=this.centerPoint.copy;s.add(i.mult(new i(1.1,.6),this.boundRadius));let o=new O(e,s),r=0;return[...Array(this.sides).keys()].map(a=>this.getSideSegment(a)).forEach(a=>{O.intersect(a,o)&&(r+=1)}),r%2==0?!1:r%2==1}get centerPoint(){let t=new i(0,0);return this.points.forEach(e=>{t.add(e)}),t.div(this.sides),t}get boundRadius(){let t=this.centerPoint;return Math.max(...this.points.map(e=>i.dist(e,t)))}get allSides(){return[...Array(this.sides).keys()].map(t=>this.getSideSegment(t))}static intersection(t,e){if(i.dist(t.centerPoint,e.centerPoint)>t.boundRadius+e.boundRadius)return;let s=[],o=t.allSides,r=e.allSides;if(o.forEach((c,f)=>{r.forEach((m,g)=>{let x=O.intersect(c,m);typeof x=="object"&&"x"in x&&(x.isIntersectionPoint=!0,s.push({intersectionPoint:x,sideNum1:f,sideNum2:g}))})}),s.length===0){if(t.isPointInside(e.points[0]))return new E(e.points.map(c=>i.fromObject(c)));if(e.isPointInside(t.points[0]))return new E(t.points.map(c=>i.fromObject(c)))}let a=new E(t.points);for(let c=a.points.length-1;c>=0;c-=1){let f=s.filter(m=>m.sideNum1===c);f.length>1&&f.sort((m,g)=>i.dist(a.points[c],m.intersectionPoint)-i.dist(a.points[c],g.intersectionPoint)),f.length>0&&a.points.splice(c+1,0,...f.map(m=>m.intersectionPoint))}let h=new E(e.points);for(let c=h.points.length-1;c>=0;c-=1){let f=s.filter(m=>m.sideNum2===c);f.length>1&&f.sort((m,g)=>i.dist(h.points[c],m.intersectionPoint)-i.dist(h.points[c],g.intersectionPoint)),f.length>0&&h.points.splice(c+1,0,...f.map(m=>m.intersectionPoint))}let l={polyNum:1,pointNum:0};for(let c=0;c<a.points.length;c+=1)if("isIntersectionPoint"in a.points[c]){l.pointNum=c;break}else if(h.isPointInside(a.points[c])){l.pointNum=c;break}let u=!1,d=[];for(;!u;){let c=l.polyNum===1?a:h,f=l.polyNum===1?h:a;if(d.push(i.fromObject(c.points[l.pointNum%c.points.length])),d.length>2&&d[0].x===d[d.length-1].x&&d[0].y===d[d.length-1].y){d.pop();break}if(d.length>a.points.length+h.points.length)break;"isIntersectionPoint"in c.points[l.pointNum%c.points.length]?"isIntersectionPoint"in c.points[(l.pointNum+1)%c.points.length]||f.isPointInside(c.points[(l.pointNum+1)%c.points.length])&&!("isIntersectionPoint"in c.points[(l.pointNum+1)%c.points.length])?l.pointNum+=1:(l.pointNum=f.points.indexOf(c.points[l.pointNum%c.points.length])+1,l.polyNum=l.polyNum===1?2:1):l.pointNum+=1}return new E(d)}static createCircle(t,e,s=25){let o=[...Array(s).keys()].map(r=>{let a=i.fromAngle(2*Math.PI*r/s);return a.setMag(t),a.add(e),a});return new E(o)}static fracture(t,e=500){return t.map((o,r)=>{let a=[];for(let l=0;l<t.length;l+=1)if(r!==l){let u=t[l],d=i.div(i.add(o,u),2),c=i.sub(o,u);c.rotate(Math.PI/2),a.push(new F(d,i.add(c,d)))}return a=a.filter((l,u)=>{let d=new O(l.a,o);for(let c=0;c<a.length;c+=1)if(u!==c&&F.intersectWithLineSegment(a[c],d))return!1;return!0}),a=a.sort((l,u)=>i.sub(l.a,l.b).heading-i.sub(u.a,u.b).heading),a.map((l,u)=>{let d=[];for(let f=0;f<a.length;f+=1)if(u!==f){let m=F.intersect(l,a[f]);m instanceof i&&d.push(m)}let c=i.sub(l.a,l.b);return d=d.filter(f=>{let m=i.sub(f,o);return c.setMag(1),i.dot(m,c)>0}),d.length===0&&d.push(i.add(i.mult(c,e*1.2),l.a)),d=d.sort((f,m)=>i.dist(f,o)-i.dist(m,o)),d[0]})}).filter(o=>o.length>=3).map(o=>new E(o))}},ct=E;var R=class{constructor(){this.r=0,this.points=[new i(0,0)]}static Circle(t,e){let s=new R;return s.r=Math.abs(t),s.points[0]=e.copy,s}static Polygon(t){let e=new R;if(t.length<3)throw new Error("A polygon needs at least 3 points to be valid!");return e.points=new ct(t).points.map(s=>i.fromObject(s)),e}getGeometricalData(){let t={center:this.points[0].copy,area:0,secondArea:0};if(this.r!==0)t.area=this.r*this.r*Math.PI,t.secondArea=.5*Math.PI*this.r**4;else{let e=[];for(let a=2;a<this.points.length;a+=1)e.push([this.points[0],this.points[a-1],this.points[a]]);let s=0,o=0,r=new i(0,0);e.forEach(a=>{let h=Math.sqrt((a[0].x-a[1].x)**2+(a[0].y-a[1].y)**2),l=Math.sqrt((a[1].x-a[2].x)**2+(a[1].y-a[2].y)**2),u=Math.sqrt((a[2].x-a[0].x)**2+(a[2].y-a[0].y)**2),d=(h+l+u)/2,c=Math.sqrt(d*(d-h)*(d-l)*(d-u));s+=c,r.x+=c*(a[0].x+a[1].x+a[2].x)/3,r.y+=c*(a[0].y+a[1].y+a[2].y)/3}),r.div(s),t.center=r,t.area=s,e.forEach(a=>{let h=Math.sqrt((a[0].x-a[1].x)**2+(a[0].y-a[1].y)**2),l=Math.sqrt((a[1].x-a[2].x)**2+(a[1].y-a[2].y)**2),u=Math.sqrt((a[2].x-a[0].x)**2+(a[2].y-a[0].y)**2),d=(h+l+u)/2,c=Math.sqrt(d*(d-h)*(d-l)*(d-u)),m=new F(a[1],a[2]).distFromPoint(a[0]),g=i.sub(a[2],a[1]);g.rotate90(),g.add(a[1]),h=new F(a[1],g).distFromPoint(a[0]);let b=(l*l*l*m-l*l*m*h+l*m*h*h+l*m*m*m)/36;b+=new i((a[0].x+a[1].x+a[2].x)/3,(a[0].y+a[1].y+a[2].y)/3).dist(t.center)**2*c,o+=b}),t.secondArea=o}return t}getMinMaxX(){let t=_(this.points.map(e=>e.x));return t.min-=this.r,t.max+=this.r,t}getMinMaxY(){let t=_(this.points.map(e=>e.y));return t.min-=this.r,t.max+=this.r,t}getMinMaxInDirection(t){let e=_(this.points.map(s=>i.dot(s,t)));return e.min-=this.r,e.max+=this.r,e}move(t){this.points.forEach(e=>e.add(t))}rotateAround(t,e){this.points.forEach(s=>{s.sub(t)}),i.rotateArr(this.points,e),this.points.forEach(s=>{s.add(t)})}containsPoint(t){return this.r!==0?i.sub(t,this.points[0]).sqlength<=this.r*this.r:this.points.map((s,o)=>i.sub(this.points[(o+1)%this.points.length],s)).every((s,o)=>i.cross(s,i.sub(t,this.points[o]))>=0)}getClosestPoint(t){let e=this.points.map(a=>i.sub(a,t).sqlength),s=e[0],o=0,r=e.length;for(let a=1;a<r;a+=1)e[a]<s&&(s=e[a],o=a);return this.points[o].copy}static fromObject(t){let e=new R;return e.r=t.r,e.points=t.points.map(s=>i.fromObject(s)),e}get copy(){let t=new R;return t.r=this.r,t.points=this.points.map(e=>e.copy),t}},k=R;var ht={white:"#faf3dd",green:"#02c39a",pink:"#e58c8a",blue:"#3db2f1",black:"#363732",Beige:"#f2f3d9",Independence:"#38405f",Turquoise:"#5dd9c1","Rich Black FOGRA 29":"#0e131f","Independence 2":"#59546c","Roman Silver":"#8b939c","Imperial Red":"#ff0035","Hot Pink":"#fc6dab","Maximum Yellow Red":"#f5b841","Lavender Web":"#dcd6f7"},P=ht,Ot=ht.Turquoise,N=ht.Turquoise;var de=15,V=class{constructor(t,e=1,s=.2,o=.5){this.shape=t,this.k=s,this.fc=o;let r=this.shape.getGeometricalData();this.m=r.area*e,this.pos=r.center,this.am=r.secondArea*e,this.rotation=0,this.ang=0,this.vel=new i(0,0),this.layer=void 0,this.defaultAxes=[],this.axes=[],this.calculateAxes(),this.boundingBox={x:this.shape.getMinMaxX(),y:this.shape.getMinMaxY()},this.minMaxes=[],this.calculateMinMaxes(),this.style=N}calculateAxes(){let t=Math.cos(Math.PI/de);this.defaultAxes=this.normals.map(e=>new i(e.x,Math.abs(e.y)));for(let e=this.defaultAxes.length-2;e>=0;e-=1)for(let s=this.defaultAxes.length-1;s>e;s-=1){let o=this.defaultAxes[s],r=this.defaultAxes[e];Math.abs(i.dot(o,r))>t&&(this.defaultAxes.splice(s,1),this.defaultAxes[e]=o)}this.axes=this.defaultAxes.map(e=>e.copy)}calculateMinMaxes(){this.minMaxes=this.axes.map(t=>this.shape.getMinMaxInDirection(t))}get normals(){if(this.shape.r!==0)return[new i(0,1)];let t=this.shape.points.map((e,s)=>i.sub(this.shape.points[(s+1)%this.shape.points.length],e));return t.forEach(e=>{e.rotate270(),e.normalize()}),t}move(t){this.shape.move(t),this.pos.add(t),this.boundingBox.x.max+=t.x,this.boundingBox.x.min+=t.x,this.boundingBox.y.max+=t.y,this.boundingBox.y.min+=t.y}rotate(t){this.rotation+=t,this.shape.r===0&&this.shape.rotateAround(this.pos,t),i.rotateArr(this.axes,t),this.boundingBox={x:this.shape.getMinMaxX(),y:this.shape.getMinMaxY()}}velInPlace(t){let e=i.sub(t,this.pos);return e.rotate90(),e.mult(this.ang),e.add(this.vel),e}containsPoint(t){return this.shape.containsPoint(t)}fixDown(){this.m=0}static detectCollision(t,e){let s=t,o=e;{let b=A(s.boundingBox.x,o.boundingBox.x);if(b.max<b.min)return!1;let y=A(s.boundingBox.y,o.boundingBox.y);if(y.max<y.min)return!1}let r=t.axes,a=e.axes;if(s.shape.r!==0){let b=o.shape.getClosestPoint(s.pos),y=i.sub(b,s.pos);y.normalize(),r=[y],s.minMaxes=[s.shape.getMinMaxInDirection(y)]}if(o.shape.r!==0){let b=s.shape.getClosestPoint(o.pos),y=i.sub(b,o.pos);y.normalize(),a=[y],o.minMaxes=[o.shape.getMinMaxInDirection(y)]}let h=[...r,...a],l=b=>s.shape.getMinMaxInDirection(b),u=b=>o.shape.getMinMaxInDirection(b),d=[];if(h.some((b,y)=>{let B;y<r.length?B=t.minMaxes[y]:B=l(b);let L;y>=r.length?L=e.minMaxes[y-r.length]:L=u(b);let M=A(B,L);return M.max<M.min?!0:(d.push(M),!1)}))return!1;let c=d.map(b=>b.size()),f=c[0],m=0;for(let b=1;b<c.length;b+=1)f>c[b]&&(f=c[b],m=b);let g=h[m].copy;i.dot(g,i.sub(s.pos,o.pos))>0&&g.mult(-1);let x;if(m<r.length){let b=o.shape.points.map(y=>i.dot(y,g));x=o.shape.points[b.indexOf(Math.min(...b))].copy,o.shape.r!==0&&x.sub(i.mult(g,o.shape.r))}else{let b=s.shape.points.map(y=>i.dot(y,g));x=s.shape.points[b.indexOf(Math.max(...b))].copy,s.shape.r!==0&&x.add(i.mult(g,s.shape.r))}return{normal:g,overlap:f,contactPoint:x}}static fromObject(t){let e=Object.create(V.prototype);return e.am=t.am,e.ang=t.ang,e.axes=t.axes.map(s=>i.fromObject(s)),e.boundingBox={x:new H(t.boundingBox.x.min,t.boundingBox.x.max),y:new H(t.boundingBox.y.min,t.boundingBox.y.max)},e.defaultAxes=t.defaultAxes.map(s=>i.fromObject(s)),e.fc=t.fc,e.k=t.k,e.layer=t.layer,e.m=t.m,e.pos=i.fromObject(t.pos),e.rotation=t.rotation,e.shape=k.fromObject(t.shape),e.style=t.style,e.vel=i.fromObject(t.vel),e.minMaxes=[],e.calculateMinMaxes(),e}get copy(){return V.fromObject(this)}},v=V;var Et=class{constructor(t,e){this.length=t,this.springConstant=e,this.pinned=!1,this.objects=[],this.rotationLocked=!1}pinHere(t,e){this.pinned={x:t,y:e}}unpin(){this.pinned=!1}attachObject(t){let e=this.objects;e.push(t),e.length===2&&(this.pinned=!1),e.length>=3&&(e=[e[e.length-2],e[e.length-1]])}lockRotation(){this.rotationLocked=!0}unlockRotation(){this.rotationLocked=!1}update(t){let e,s;if(this.pinned instanceof Object&&this.objects[0]){[s,e]=[this.pinned,this.objects[0]];let o=new i(s.x-e.pos.x,s.y-e.pos.y),r=o.length-this.length;o.setMag(1),o.mult(r*this.springConstant*t/e.m),e.vel.x+=o.x,e.vel.y+=o.y;let a=e.vel;if(a.rotate(-o.heading),this.rotationLocked){let h=new i(s.x,s.y),u=i.sub(e.pos,h).length,d=u*u*e.m+e.am,c=(e.am*e.ang-u*e.m*a.y)/d;a.y=-c*u,e.ang=c}a.rotate(o.heading)}else if(this.objects[0]&&this.objects[1]){[e,s]=[this.objects[0],this.objects[1]];let o=i.sub(e.pos,s.pos),r=o.length-this.length;o.setMag(1),o.mult(r*this.springConstant*t),s.vel.add(i.div(o,s.m)),e.vel.add(i.div(o,-e.m)),o=i.sub(e.pos,s.pos);let a=e.vel,h=s.vel;if(a.rotate(-o.heading),h.rotate(-o.heading),this.rotationLocked){let l=new i(e.pos.x*e.m+s.pos.x*s.m,e.pos.y*e.m+s.pos.y*s.m);l.div(e.m+s.m);let u=i.sub(e.pos,l),d=i.sub(s.pos,l),c=u.length,f=d.length,m=c*c*e.m+e.am+f*f*s.m+s.am,g=(a.y-h.y)*f/(c+f)+h.y,x=(e.am*e.ang+s.am*s.ang+c*e.m*(a.y-g)-f*s.m*(h.y-g))/m;a.y=x*c+g,h.y=-x*f+g,e.ang=x,s.ang=x}a.rotate(o.heading),h.rotate(o.heading)}}},S=Et;var Tt=class extends S{constructor(t){super(t,0);this.springConstant=0}update(){let t,e;if(this.pinned instanceof Object&&"x"in this.pinned&&this.objects[0]){[e,t]=[this.pinned,this.objects[0]];let s=new i(e.x-t.pos.x,e.y-t.pos.y);s.setMag(1),s.mult(-this.length),t.move(new i(-t.pos.x+e.x+s.x,-t.pos.y+e.y+s.y));let o=t.vel;if(o.rotate(-s.heading),o.x=0,this.rotationLocked){let r=new i(e.x,e.y),h=i.sub(t.pos,r).length,l=h*h*t.m+t.am,u=(t.am*t.ang+h*t.m*o.y)/l;o.y=u*h,t.ang=u}o.rotate(s.heading)}else if(this.objects[0]&&this.objects[1]){[t,e]=[this.objects[0],this.objects[1]];let s=i.sub(t.pos,e.pos),o=this.length-s.length;s.setMag(1);let r=i.mult(s,o*e.m/(t.m+e.m)),a=i.mult(s,-o*t.m/(t.m+e.m));t.move(r),e.move(a);let h=t.vel,l=e.vel;if(h.rotate(-s.heading),l.rotate(-s.heading),h.x=(t.m*h.x+e.m*l.x)/(t.m+e.m),l.x=h.x,this.rotationLocked){let u=new i(t.pos.x*t.m+e.pos.x*e.m,t.pos.y*t.m+e.pos.y*e.m);u.div(t.m+e.m);let d=i.sub(t.pos,u),c=i.sub(e.pos,u),f=d.length,m=c.length,g=f*f*t.m+t.am+m*m*e.m+e.am,x=(h.y-l.y)*m/(f+m)+l.y,b=(t.am*t.ang+e.am*e.ang+f*t.m*(h.y-x)-m*e.m*(l.y-x))/g;h.y=b*f+x,l.y=-b*m+x,t.ang=b,e.ang=b}h.rotate(s.heading),l.rotate(s.heading)}}},T=Tt;function ue(n,t,e,s){let o=s,r=e,a=n,h=t,l=a.vel,u=h.vel,d=a.ang,c=h.ang,f=i.sub(r,a.pos),m=i.sub(r,h.pos),g=a.am,x=h.am,b=a.m,y=h.m,B=(a.k+h.k)/2,L=(a.fc+h.fc)/2,M=a.velInPlace(r),W=h.velInPlace(r),K=i.sub(W,M),Y=1/b+1/y;Y+=i.dot(i.crossScalarFirst(i.cross(f,o)/g,f),o),Y+=i.dot(i.crossScalarFirst(i.cross(m,o)/x,m),o),Y=-((1+B)*i.dot(K,o))/Y;let Q=i.sub(l,i.mult(o,Y/b)),Z=i.add(u,i.mult(o,Y/y)),at=d-Y*i.cross(f,o)/g,rt=c+Y*i.cross(m,o)/x,I=K.copy;if(I.sub(i.mult(o,i.dot(K,o))),I.setMag(1),i.dot(o,I)**2>.5)return[{dVel:i.sub(Q,a.vel),dAng:at-a.ang},{dVel:i.sub(Z,h.vel),dAng:rt-h.ang}];let j=1/b+1/y;j+=i.dot(i.crossScalarFirst(i.cross(f,I)/g,f),I),j+=i.dot(i.crossScalarFirst(i.cross(m,I)/x,m),I),j=-i.dot(K,I)/j;let D=Math.sign(j)*Y*L;return Math.abs(D)>Math.abs(j)&&(D=j),Q=i.sub(Q,i.mult(I,D/b)),Z=i.add(Z,i.mult(I,D/y)),at-=D*i.cross(f,I)/g,rt+=D*i.cross(m,I)/x,[{dVel:i.sub(Q,a.vel),dAng:at-a.ang},{dVel:i.sub(Z,h.vel),dAng:rt-h.ang}]}function Xt(n,t,e){let s=t,o=e,r=n,a=i.sub(s,r.pos),{am:h,m:l}=r,u=i.mult(r.velInPlace(s),-1),d=1/l;d+=i.dot(i.crossScalarFirst(i.cross(a,o)/h,a),o),d=-((1+r.k)*i.dot(u,o))/d;let c=i.sub(r.vel,i.mult(o,d/l)),f=r.ang-d*i.cross(a,o)/h,m=u.copy;if(m.sub(i.mult(o,i.dot(u,o))),m.setMag(1),i.dot(o,m)**2>.5)return r.vel=c,r.ang=f,{dVel:i.sub(c,r.vel),dAng:f-r.ang};let g=1/l;g+=i.dot(i.crossScalarFirst(i.cross(a,m)/h,a),m),g=-i.dot(u,m)/g;let x=Math.sign(g)*d*r.fc;return Math.abs(x)>Math.abs(g)&&(x=g),c=i.sub(c,i.mult(m,x/l)),f-=x*i.cross(a,m)/h,{dVel:i.sub(c,r.vel),dAng:f-r.ang}}function Yt(n){let t=[],e=n.length,s=Array(e).fill(0),o=Array(e).fill(0),r=Array(e).fill(0),a=Array(e).fill(0),h=Array(e).fill(0),l=Array(e).fill(0);n.forEach(u=>u.calculateMinMaxes());for(let u=0;u<e-1;u+=1)for(let d=u+1;d<e;d+=1){let c=n[u],f=n[d];if(c.m===0&&f.m===0)continue;let m=v.detectCollision(c,f);if(m&&typeof m!="boolean"){let g=i.dot(c.velInPlace(m.contactPoint),m.normal),x=i.dot(f.velInPlace(m.contactPoint),m.normal);t.push({n:m.normal,cp:m.contactPoint});let b=-m.overlap,y=m.overlap;if(c.m===0){b=0;let M=Xt(f,m.contactPoint,i.mult(m.normal,-1));a[d]+=M.dVel.x,h[d]+=M.dVel.y,l[d]+=M.dAng,r[d]+=1}else if(f.m===0){y=0;let M=Xt(c,m.contactPoint,i.mult(m.normal,1));a[u]+=M.dVel.x,h[u]+=M.dVel.y,l[u]+=M.dAng,r[u]+=1}else{b*=f.m/(c.m+f.m),y*=c.m/(c.m+f.m);let[M,W]=ue(c,f,m.contactPoint,i.mult(m.normal,1));g>=x&&(a[u]+=M.dVel.x,h[u]+=M.dVel.y,l[u]+=M.dAng,a[d]+=W.dVel.x,h[d]+=W.dVel.y,l[d]+=W.dAng)}let B=i.mult(m.normal,b),L=i.mult(m.normal,y);s[u]+=B.x,s[d]+=L.x,o[u]+=B.y,o[d]+=L.y}}for(let u=0;u<e;u+=1){let d=n[u];if(d.m===0)continue;let c=Math.max(r[u],1);d.move(new i(s[u],o[u])),d.vel.add(new i(a[u]/c,h[u]/c)),d.ang+=l[u]/c}return t}var G=class{constructor(){this.bodies=[],this.springs=[],this.airFriction=1,this.gravity=new i(0,0)}update(t){let e=[];for(let s=0;s<this.bodies.length;s+=1)this.bodies[s].move(new i(this.bodies[s].vel.x*t,this.bodies[s].vel.y*t)),this.bodies[s].rotate(this.bodies[s].ang*t);for(let s=0;s<3;s+=1)this.springs.forEach(o=>{o.update(t/3/2)});for(let s=0;s<this.bodies.length;s+=1)this.bodies[s].m!==0&&this.bodies[s].vel.add(new i(this.gravity.x*t,this.gravity.y*t));e=Yt(this.bodies);for(let s=0;s<3;s+=1)this.springs.forEach(o=>{o.update(t/3/2)});return this.bodies.forEach(s=>{let o=s;s.m!==0&&(o.vel.mult(this.airFriction**t),o.ang*=this.airFriction**t)}),e}get copy(){let t=this.toJSON();return G.fromObject(t)}setAirFriction(t){!Number.isFinite(t)||(this.airFriction=t,this.airFriction<0&&(this.airFriction=0),this.airFriction>1&&(this.airFriction=1))}setGravity(t){this.gravity=t.copy}addBody(t){this.bodies.push(t)}addSoftSquare(t,e,s,o,r=24,a=1){let h={sides:[],points:[]},l=Math.sqrt(e*e/Math.PI);h.points=[...new Array(r).keys()].map(c=>2*c*Math.PI/r).map(c=>i.add(i.mult(i.fromAngle(c),l),t)).map(c=>new v(k.Circle(Math.PI*l/r,c),1,.2,s)),h.sides=h.points.map((c,f)=>{let m=new T(1);return m.attachObject(c),m.attachObject(h.points[(f+1)%h.points.length]),f%2==0&&m.lockRotation(),m}),h.sides.forEach(c=>{let f=c;f.length=.96*4*e/r}),h.points.forEach(c=>{let f=c;f.vel=o.copy}),this.bodies.push(...h.points),this.springs.push(...h.sides);let u=e*e*200*a,d=new S(Math.sqrt(l*l*Math.PI),u/2);d.attachObject(h.points[0]),d.attachObject(h.points[r/2]),this.springs.push(d),d=new S(Math.sqrt(l*l*Math.PI),u/2),d.attachObject(h.points[r/4]),d.attachObject(h.points[3*r/4]),this.springs.push(d),d=new S(Math.sqrt(2*l*l*Math.PI),u),d.attachObject(h.points[r/8]),d.attachObject(h.points[5*r/8]),this.springs.push(d),d=new S(Math.sqrt(2*l*l*Math.PI),u),d.attachObject(h.points[3*r/8]),d.attachObject(h.points[7*r/8]),this.springs.push(d)}addRectWall(t,e,s,o){let r=[];r.push(new i(t-s/2,e-o/2)),r.push(new i(t+s/2,e-o/2)),r.push(new i(t+s/2,e+o/2)),r.push(new i(t-s/2,e+o/2)),this.bodies.push(new v(k.Polygon(r),0))}addRectBody(t,e,s,o,r,a,h=N){let l=[];l.push(new i(t-s/2,e-o/2)),l.push(new i(t+s/2,e-o/2)),l.push(new i(t+s/2,e+o/2)),l.push(new i(t-s/2,e+o/2));let u=new v(k.Polygon(l),1,a,r);u.style=h,this.bodies.push(u)}addFixedBall(t,e,s){this.bodies.push(new v(k.Circle(s,new i(t,e)),0))}addSpring(t){this.springs.push(t)}setBounds(t,e,s,o){let r=(a,h,l,u)=>{let d=[];return d.push(new i(a-l/2,h-u/2)),d.push(new i(a+l/2,h-u/2)),d.push(new i(a+l/2,h+u/2)),d.push(new i(a-l/2,h+u/2)),new v(k.Polygon(d),0)};this.bodies[0]=r(t-s,e,2*s,4*o),this.bodies[1]=r(t+2*s,e,2*s,4*o),this.bodies[2]=r(t,e-o,4*s,o*2),this.bodies[3]=r(t+s/2,e+2*o,5*s,2*o)}getObjectAtCoordinates(t,e){let s=!1,o=new i(t,e);return this.bodies.some(r=>r.containsPoint(o)?(s=r,!0):!1),s}removeObjFromSystem(t){let e=-1;if(t instanceof v&&(e=this.bodies.indexOf(t)),e!==-1){this.bodies.splice(e,1);return}(t instanceof T||t instanceof S)&&(e=this.springs.indexOf(t)),e!==-1&&this.springs.splice(e,1)}getObjectIdentifier(t){return t instanceof v?{type:"body",index:this.bodies.indexOf(t)}:{type:"nothing",index:-1}}toJSON(){let t={};return t.airFriction=this.airFriction,t.gravity=this.gravity.toJSON(),t.bodies=this.bodies.map(e=>e.copy),t.springs=this.springs.map(e=>{let s={};return s.length=e.length,s.pinned=e.pinned,s.rotationLocked=e.rotationLocked,s.springConstant=e.springConstant,e instanceof S?s.type="spring":e instanceof T&&(s.type="stick"),s.objects=e.objects.map(o=>this.getObjectIdentifier(o)),s}),t}stickOrSpringFromObject(t){let e={};return t.type==="spring"?e=new S(t.length,t.springConstant):t.type==="stick"&&(e=new T(t.length)),e.pinned=t.pinned,e.rotationLocked=t.rotationLocked,e.objects=t.objects.map(s=>this.bodies[s.index]),e}static fromObject(t){let e=new G;return e.bodies=t.bodies.map(s=>v.fromObject(s)),e.airFriction=t.airFriction,e.gravity=i.fromObject(t.gravity),e.springs=t.springs.map(s=>e.stickOrSpringFromObject(s)),e}};var z=G;var q,Bt,J;function U(n){Bt=n,n?J.classList.add("bg-pink-darker"):J.classList.remove("bg-pink-darker")}function lt(n){q=n.getPhysics().toJSON(),J=document.getElementById("set start"),U(!1);let t=document.getElementById("pause");t&&(t.onclick=()=>{n.getTimeMultiplier()!==0?n.setTimeMultiplier(0):(n.setTimeMultiplier(1),Bt===!0&&(q=n.getPhysics().toJSON()),U(!1))});let e=document.getElementById("revert");e&&(e.onclick=()=>{n.setTimeMultiplier(0),console.log(z.fromObject(q)),n.setPhysics(z.fromObject(q)),U(!0)});let s=document.getElementById("clear all");s&&(s.onclick=()=>{U(!0);let r=n.getPhysics();r.springs=[],r.bodies=[]}),J&&(J.onclick=()=>{q=n.getPhysics().toJSON(),console.log(q),U(!0),n.setTimeMultiplier(0)});let o=!1;document.addEventListener("visibilitychange",()=>{document.hidden?n.getTimeMultiplier()!==0?(n.setTimeMultiplier(0),o=!0):o=!1:o&&n.setTimeMultiplier(1)})}function p(n,t,...e){let s=document.createElement(n);return t&&Object.entries(t).forEach(([o,r])=>{s[o]=r}),e&&e.forEach(o=>{typeof o=="string"?s.appendChild(document.createTextNode(o)):o instanceof HTMLElement&&s.appendChild(o)}),s}var Lt=document.createElement("template");Lt.innerHTML=`
  <style>
    .slider {
      -webkit-appearance: none;
      height: 0.6rem;
      background: var(--pinky-darker);
      outline: none;
      opacity: 0.7;
      -webkit-transition: 0.2s;
      transition: opacity 0.2s;
      border-radius: 100vh;
      width: 90%;
    }
    .slider:hover {
      opacity: 1;
    }
    .slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 0.8rem;
      height: 0.8rem;
      background: var(--blues-hover);
      opacity: 0.7;
      cursor: pointer;
      border-radius: 100vh;
    }
    .slider::-moz-range-thumb {
      width: 0.8rem;
      height: 0.8rem;
      background: var(--blues-hover);
      opacity: 0.7;
      cursor: pointer;
      border-radius: 100vh;
    }
    .slider-label {
      margin-top: 1em;
      margin-bottom: 0.3em;
      padding-left: 0em;
      font-weight: bold;
    }
    /* For tablets */
    @media (max-width: 768px) {
      .slider-label {
        font-weight: bold;
        margin-top: 0.5em;
        margin-bottom: 0rem;
        font-size: small;
      }
      .slider {
        height: 0.4rem;
      }
      .slider::-webkit-slider-thumb {
        width: 0.55rem;
        height: 0.55rem;
      }
      .slider::-moz-range-thumb {
        width: 0.55rem;
        height: 0.55rem;
      }
    }
  </style>
`;var Ft=class extends HTMLElement{constructor(){super();this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(Lt.content.cloneNode(!0)),this.shadowRoot.appendChild(p("div",null,p("p",{className:"slider-label"},p("slot",null)),p("input",{id:"slider",type:"range",className:"slider"})))}get slider(){return this.shadowRoot.querySelector("#slider")}set min(t){this.slider.min=t}set max(t){this.slider.max=t}set step(t){this.slider.step=t}set value(t){this.slider.value=t}set onChange(t){this.slider.onchange=e=>t(e.target.valueAsNumber),this.slider.oninput=e=>t(e.target.valueAsNumber)}};window.customElements.define("range-slider",Ft);var Nt=document.createElement("template");Nt.innerHTML=`
  <style>
    .picker-label {
        display: flex;
        align-items: center;
        font-weight: bold;
        padding-right: 0.45em;
        margin-top: 1.3em;
    }
    #colorWell {
        margin-left: 0.5rem;
        border-radius: 100vh;
        background-color: var(--turquoise);
        border: none;
        height: 1rem;
        cursor: pointer;
    }
    /* For tablets */
    @media (max-width: 768px) {
      .picker-label {
        margin-top: 0.6em;
        font-size: small;
      }
      #colorWell {
        height: 1em;
      }
    }
  </style>
`;var jt=class extends HTMLElement{constructor(){super();this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(Nt.content.cloneNode(!0)),this.shadowRoot.appendChild(p("div",null,p("label",{htmlFor:"colorWell",className:"picker-label"},p("div",null,p("slot",null)),p("input",{type:"color",id:"colorWell"}))))}get picker(){return this.shadowRoot.querySelector("#colorWell")}set value(t){this.picker.value=t,this.picker.style["background-color"]=t}set onChange(t){let e=s=>{t(s.target.value),this.picker.style["background-color"]=s.target.value};this.picker.onchange=e,this.picker.oninput=e}};window.customElements.define("color-picker",jt);var tt=35,dt=.5,ut=1.5,mt=Ot,Rt=document.createElement("div"),me={name:"Ball creator",description:"",element:Rt,drawFunc(n,t){let e=n.cnv.getContext("2d");e.strokeStyle="black",e.beginPath(),e.arc(n.mouseX,n.mouseY,tt,0,2*Math.PI),e.stroke(),n.lastX!==0&&n.lastY!==0&&(e.beginPath(),e.moveTo(n.mouseX,n.mouseY),e.lineTo(n.lastX,n.lastY),e.stroke())},startInteractionFunc(n){},endInteractionFunc(n){if(n.lastX!==0&&n.lastY!==0){let t=new v(k.Circle(tt,new i(n.lastX,n.lastY)),1,dt,ut);t.vel=new i(n.lastX-n.mouseX,n.lastY-n.mouseY),t.style=mt,Number.isFinite(t.pos.x)&&Number.isFinite(t.pos.y)&&Number.isFinite(t.vel.x)&&Number.isFinite(t.vel.y)||(t.vel.x=0,t.vel.y=0),n.physics.addBody(t)}}};Rt.append(p("range-slider",{min:5,max:120,step:1,value:tt,onChange:n=>{tt=n}},"Size"),p("range-slider",{min:0,max:1,step:.02,value:dt,onChange:n=>{dt=n}},"Bounciness"),p("range-slider",{min:0,max:2,step:.1,value:ut,onChange:n=>{ut=n}},"Coefficient of friction"),p("color-picker",{value:mt,onChange:n=>{mt=n}},"Color:"));var Dt=me;var fe=document.createElement("div"),pe={name:"Delete",description:"",element:fe,drawFunc(n,t){},startInteractionFunc(n){n.choosed&&typeof n.choosed!="boolean"&&n.choosed instanceof v&&n.physics.removeObjFromSystem(n.choosed)}},Ht=pe;var zt=0,qt=0,ge=document.createElement("div"),be={name:"Move",description:"",element:ge,drawFunc(n,t){let{choosed:e}=n;e instanceof v&&(e.move(new i(n.mouseX-e.pos.x,n.mouseY-e.pos.y)),t===0?(e.vel.x=0,e.vel.y=0):(e.vel.x=(n.mouseX-zt)/t,e.vel.y=(n.mouseY-qt)/t),e.ang=0),zt=n.mouseX,qt=n.mouseY},startInteractionFunc(n){let{choosed:t}=n;if(t instanceof v){let e=n;e.cnv.style.cursor="grabbing"}},endInteractionFunc(n){let{choosed:t}=n;if(t instanceof v){let e=n;e.cnv.style.cursor="grab"}},activated(n){let t=n;t.cnv.style.cursor="grab"},deactivated(n){let t=n;t.cnv.style.cursor="default"}},Wt=be;var xe=document.createElement("div"),ye={name:"Rectangle wall",description:"",element:xe,drawFunc(n,t){if(n.lastX!==0&&n.lastY!==0){let e=n.cnv.getContext("2d");e.strokeStyle="black",e.strokeRect(n.mouseX,n.mouseY,n.lastX-n.mouseX,n.lastY-n.mouseY)}},startInteractionFunc(n){},endInteractionFunc(n){if(n.lastX!==0&&n.lastY!==0){if(Math.abs(n.lastX-n.mouseX)<5&&Math.abs(n.lastY-n.mouseY)<5)return;n.physics.addRectWall(n.lastX/2+n.mouseX/2,n.lastY/2+n.mouseY/2,2*Math.abs(n.lastX/2-n.mouseX/2),2*Math.abs(n.lastY/2-n.mouseY/2))}}},Vt=ye;var ft=.2,pt=.5,gt=N,Gt=document.createElement("div"),ve={name:"Rectangle body",description:"",element:Gt,drawFunc(n,t){let e=n.cnv.getContext("2d");n.lastX!==0&&n.lastY!==0&&(e.strokeStyle="black",e.strokeRect(n.mouseX,n.mouseY,n.lastX-n.mouseX,n.lastY-n.mouseY))},startInteractionFunc(n){},endInteractionFunc(n){if(n.lastX!==0&&n.lastY!==0){let t=Math.abs(n.mouseX-n.lastX),e=Math.abs(n.mouseY-n.lastY);if(t/e>50||e/t>50||e===0||t===0)return;n.physics.addRectBody(n.lastX/2+n.mouseX/2,n.lastY/2+n.mouseY/2,2*Math.abs(n.lastX/2-n.mouseX/2),2*Math.abs(n.lastY/2-n.mouseY/2),pt,ft,gt)}},keyGotUpFunc(n){},keyGotDownFunc(n){}};Gt.append(p("range-slider",{min:0,max:.6,step:.02,value:ft,onChange:n=>{ft=n}},"Bounciness"),p("range-slider",{min:0,max:2,step:.1,value:pt,onChange:n=>{pt=n}},"Coefficient of friction"),p("color-picker",{value:gt,onChange:n=>{gt=n}},"Color:"));var Jt=ve;var et=35,bt=.5,xt=.5,st=4,nt=24,yt=N,Ut=document.createElement("div");function $t(n=24,t=4){return[...new Array(n).keys()].map(e=>i.fromAnglePNorm(Math.PI*2*e/n,t))}var we={name:"Squircle creator",description:"",element:Ut,drawFunc(n,t){let e=n.cnv.getContext("2d");e.strokeStyle="black";let s=$t(nt,st);s.forEach(o=>o.mult(et)),e.beginPath(),e.moveTo(n.mouseX+s[0].x,n.mouseY+s[0].y);for(let o=1;o<s.length;o+=1)e.lineTo(n.mouseX+s[o].x,n.mouseY+s[o].y);e.closePath(),e.stroke(),n.mouseDown&&(e.beginPath(),e.moveTo(n.mouseX,n.mouseY),e.lineTo(n.lastX,n.lastY),e.stroke())},startInteractionFunc(n){},endInteractionFunc(n){let t=$t(nt,st),e=new i(n.lastX,n.lastY);if(t.forEach(s=>{s.mult(et),s.add(e)}),n.lastX!==0&&n.lastY!==0){let s=new v(k.Polygon(t),1,bt,xt);s.vel=new i(n.lastX-n.mouseX,n.lastY-n.mouseY),s.style=yt,n.physics.addBody(s)}}};Ut.append(p("range-slider",{min:5,max:120,step:1,value:et,onChange:n=>{et=n}},"Size"),p("range-slider",{min:2,max:7,step:1,value:9-st,onChange:n=>{st=9-n}},"Roundness"),p("range-slider",{min:12,max:36,step:1,value:nt,onChange:n=>{nt=n}},"Resolution"),p("range-slider",{min:0,max:.9,step:.02,value:bt,onChange:n=>{bt=n}},"Bounciness"),p("range-slider",{min:0,max:2,step:.1,value:xt,onChange:n=>{xt=n}},"Coefficient of friction"),p("color-picker",{value:yt,onChange:n=>{yt=n}},"Color:"));var Kt=we;var C=35;var vt=1.5,wt=24,Mt=1,Qt=document.createElement("div"),Me={name:"Soft square creator",description:"",element:Qt,drawFunc(n,t){let e=n.cnv.getContext("2d");e.strokeStyle="black",e.beginPath(),e.moveTo(n.mouseX-C,n.mouseY-C),e.lineTo(n.mouseX+C,n.mouseY-C),e.lineTo(n.mouseX+C,n.mouseY+C),e.lineTo(n.mouseX-C,n.mouseY+C),e.lineTo(n.mouseX-C,n.mouseY-C),e.stroke(),n.lastX!==0&&n.lastY!==0&&(e.beginPath(),e.moveTo(n.mouseX,n.mouseY),e.lineTo(n.lastX,n.lastY),e.stroke())},startInteractionFunc(n){},endInteractionFunc(n){n.lastX!==0&&n.lastY!==0&&n.physics.addSoftSquare(new i(n.lastX,n.lastY),C*2,vt,new i(n.lastX-n.mouseX,n.lastY-n.mouseY),wt,Mt)}};Qt.append(p("range-slider",{min:5,max:100,step:1,value:C,onChange:n=>{C=n}},"Size"),p("range-slider",{min:.4,max:3,step:.1,value:Mt,onChange:n=>{Mt=n}},"Pressure"),p("range-slider",{min:0,max:2,step:.1,value:vt,onChange:n=>{vt=n}},"Coefficient of friction"),p("range-slider",{min:16,max:48,step:8,value:wt,onChange:n=>{wt=n}},"Resolution"));var Zt=Me;var _t=document.createElement("template");_t.innerHTML=`
  <style>
    .checkbox-label {
        font-weight: bold;
        padding-right: 0.45em;
        margin-top: 1.1em;
        display: flex;
    }
    .ch-box {
        display: none;
    }
    .checkbox-display {
        width: 1.15em;
        height: 1.15em;
        display: block;
        background-color: var(--roman-silver);
        margin-bottom: 0.3em;
        margin-right: 0.3em;
        margin-left: 0em;
        padding: 0;
        position: relative;
        border-radius: 0.2em;
        top: 0.2em;
        -webkit-transition: 0.2s;
        transition: background-color 0.2s;
        text-align: center;
        float: left;
    }
    input[type="checkbox"]:checked ~ .checkbox-display {
        background-color: var(--pinky-darker);
    }
    .checkbox-display:hover,
    .checkbox-label:hover > .checkbox-display {
        background-color: var(--independence);
    }
    input[type="checkbox"]:checked ~ .checkbox-display > .checkmark {
        transform: scale(1.2);
    }
    .checkmark {
        width: 75%;
        height: auto;
        fill: white;
        transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        transform: scale(0);
    }
    .label-text {
        margin-top: 0.2em;
        flex: 1;
    }
    .cursor-pointer > * {
        cursor: pointer;
    }
    /* For tablets */
    @media (max-width: 768px) {
      .checkbox-label {
        margin-top: 0.6em;
        font-size: small;
      }
    }
  </style>
`;var At=class extends HTMLElement{constructor(){super();this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(_t.content.cloneNode(!0)),this.shadowRoot.appendChild(p("div",{className:"cursor-pointer"},p("label",{htmlFor:"cbIdentifier",className:"checkbox-label"},p("input",{type:"checkbox",className:"ch-box",id:"cbIdentifier"}),p("div",{className:"checkbox-display"}),p("div",{className:"label-text"},p("slot",null))))),this.shadowRoot.querySelector(".checkbox-display").innerHTML='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="122.877px" height="101.052px" viewBox="0 0 122.877 101.052" id="checkmark-svg" enable-background="new 0 0 122.877 101.052" xml:space="preserve"><g><path d="M4.43,63.63c-2.869-2.755-4.352-6.42-4.427-10.11c-0.074-3.689,1.261-7.412,4.015-10.281 c2.752-2.867,6.417-4.351,10.106-4.425c3.691-0.076,7.412,1.255,10.283,4.012l24.787,23.851L98.543,3.989l1.768,1.349l-1.77-1.355 c0.141-0.183,0.301-0.339,0.479-0.466c2.936-2.543,6.621-3.691,10.223-3.495V0.018l0.176,0.016c3.623,0.24,7.162,1.85,9.775,4.766 c2.658,2.965,3.863,6.731,3.662,10.412h0.004l-0.016,0.176c-0.236,3.558-1.791,7.035-4.609,9.632l-59.224,72.09l0.004,0.004 c-0.111,0.141-0.236,0.262-0.372,0.368c-2.773,2.435-6.275,3.629-9.757,3.569c-3.511-0.061-7.015-1.396-9.741-4.016L4.43,63.63 L4.43,63.63z"/></g></svg>',this.shadowRoot.querySelector("#checkmark-svg").classList.add("checkmark")}get checkbox(){return this.shadowRoot.querySelector("#cbIdentifier")}set checked(t){this.checkbox.checked=t}set onChange(t){this.checkbox.onchange=e=>t(e.target.checked)}};window.customElements.define("check-box",At);var kt=!1,$=1e4,te=document.createElement("div"),ke={name:"Spring creator",description:"",element:te,drawFunc(n,t){let e=n.cnv.getContext("2d");n.lastX!==0&&n.lastY!==0&&(e.strokeStyle="black",e.beginPath(),e.moveTo(n.mouseX,n.mouseY),e.lineTo(n.lastX,n.lastY),e.stroke())},startInteractionFunc(n){},endInteractionFunc(n){if(n.lastX!==0&&n.lastY!==0){let t=n.physics.getObjectAtCoordinates(n.mouseX,n.mouseY),e,s=S;if(typeof t=="boolean"&&(t={x:n.mouseX,y:n.mouseY,pinPoint:!0}),n.choosed===t||n.choosed===void 0&&t===void 0||n.choosed instanceof Object&&t instanceof Object&&"pinPoint"in n.choosed&&"pinPoint"in t||(n.choosed instanceof Object&&t instanceof Object&&"pinPoint"in n.choosed&&"pos"in t?(e=new s(Math.sqrt((n.choosed.x-t.pos.x)**2+(n.choosed.y-t.pos.y)**2),$),e.attachObject(t),e.pinHere(n.choosed.x,n.choosed.y)):t instanceof Object&&n.choosed instanceof Object&&"pos"in n.choosed&&"pinPoint"in t?(e=new s(Math.sqrt((n.choosed.pos.x-t.x)**2+(n.choosed.pos.y-t.y)**2),$),e.attachObject(n.choosed),e.pinHere(t.x,t.y)):n.choosed instanceof Object&&t instanceof Object&&"pos"in n.choosed&&"pos"in t&&(e=new s(Math.sqrt((n.choosed.pos.x-t.pos.x)**2+(n.choosed.pos.y-t.pos.y)**2),$),e.attachObject(n.choosed),e.attachObject(t)),typeof e=="undefined"))return;n.physics.addSpring(e),kt&&e.lockRotation()}}};te.append(p("check-box",{checked:kt,onChange:n=>{kt=n}},"Lock rotation"),p("range-slider",{min:2e3,max:1e5,value:$,step:200,onChange:n=>{$=n}},"Spring stiffness"));var ee=ke;var St=!1,Pt=document.createElement("div"),Se={name:"Stick creator",description:"",element:Pt,drawFunc(n,t){let e=n.cnv.getContext("2d");n.lastX!==0&&n.lastY!==0&&(e.strokeStyle="black",e.beginPath(),e.moveTo(n.mouseX,n.mouseY),e.lineTo(n.lastX,n.lastY),e.stroke())},startInteractionFunc(n){},endInteractionFunc(n){if(n.lastX!==0&&n.lastY!==0){let t=n.physics.getObjectAtCoordinates(n.mouseX,n.mouseY),e,s=T;if(typeof t=="boolean"&&(t={x:n.mouseX,y:n.mouseY,pinPoint:!0}),typeof n.choosed=="boolean"||n.choosed===t||n.choosed===void 0&&t===void 0||"pinPoint"in n.choosed&&"pinPoint"in t||("pinPoint"in n.choosed&&"pos"in t?(e=new s(Math.sqrt((n.choosed.x-t.pos.x)**2+(n.choosed.y-t.pos.y)**2)),e.attachObject(t),e.pinHere(n.choosed.x,n.choosed.y)):"pinPoint"in t&&"pos"in n.choosed?(e=new s(Math.sqrt((n.choosed.pos.x-t.x)**2+(n.choosed.pos.y-t.y)**2)),e.attachObject(n.choosed),e.pinHere(t.x,t.y)):"pos"in n.choosed&&"pos"in t&&(e=new s(Math.sqrt((n.choosed.pos.x-t.pos.x)**2+(n.choosed.pos.y-t.pos.y)**2)),e.attachObject(n.choosed),e.attachObject(t)),typeof e=="undefined"))return;n.physics.addSpring(e),St&&e.lockRotation()}},keyGotUpFunc(n){},keyGotDownFunc(n){}};[p("check-box",{checked:St,onChange:n=>{St=n}},"Lock rotation")].forEach(Pt.appendChild.bind(Pt));var se=Se;var it=20,ne=document.createElement("div"),Pe={name:"Wall drawer",description:"",element:ne,drawFunc(n,t){let e=n.cnv.getContext("2d");e.strokeStyle="black",e.beginPath(),e.arc(n.mouseX,n.mouseY,it,0,2*Math.PI),e.stroke(),n.lastX!==0&&n.lastY!==0&&n.physics.addFixedBall(n.mouseX,n.mouseY,it)}};ne.append(p("range-slider",{min:5,max:70,step:1,value:it,onChange:n=>{it=n}},"Size"));var ie=Pe;var oe=document.createElement("template");oe.innerHTML=`
  <style>
    .number {
      display: block;
      height: 0.6rem;
      background: var(--independence);
      outline: none;
      opacity: 0.7;
      -webkit-transition: 0.2s;
      transition: opacity 0.2s;
      border-bottom-right-radius: 0.3rem;
      border-bottom-left-radius: 0.3rem;
      padding: 0px;
      padding-top: 0.15rem;
      padding-bottom: 0.15rem;
      border: 0px;
      margin-left: 2px;
      margin-right: 2px;
      text-align: center;
      width: 90%;
      color: white;
    }
    .number:hover {
      opacity: 1;
    }
    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    input[type=number] {
      -moz-appearance: textfield;
    }
    .slider {
      -webkit-appearance: none;
      height: 0.6rem;
      background: var(--pinky-darker);
      outline: none;
      opacity: 0.7;
      -webkit-transition: 0.2s;
      transition: opacity 0.2s;
      border-top-left-radius: 0.3rem;
      border-top-right-radius: 0.3rem;
      width: 90%;
      margin-bottom: 0px;
      display: block;
    }
    .slider:hover {
      opacity: 1;
    }
    .slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 0.8rem;
      height: 0.8rem;
      background: var(--blues-hover);
      opacity: 0.7;
      cursor: pointer;
      border-radius: 100vh;
    }
    .slider::-moz-range-thumb {
      width: 0.8rem;
      height: 0.8rem;
      background: var(--blues-hover);
      opacity: 0.7;
      cursor: pointer;
      border-radius: 100vh;
    }
    .slider-label {
      margin-top: 1em;
      margin-bottom: 0.3em;
      padding-left: 0em;
      font-weight: bold;
    }
    /* For tablets */
    @media (max-width: 768px) {
      .slider-label {
        font-weight: bold;
        margin-top: 0.5em;
        margin-bottom: 0rem;
        font-size: small;
      }
      .slider {
        height: 0.4rem;
      }
      .slider::-webkit-slider-thumb {
        width: 0.55rem;
        height: 0.55rem;
      }
      .slider::-moz-range-thumb {
        width: 0.55rem;
        height: 0.55rem;
      }
    }
  </style>
`;var ae=class extends HTMLElement{constructor(){super();this.minNum=0,this.maxNum=0,this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(oe.content.cloneNode(!0)),this.shadowRoot.appendChild(p("div",null,p("p",{className:"slider-label"},p("slot",null)),p("input",{id:"slider",type:"range",className:"slider"}),p("input",{id:"number-input",type:"number",className:"number"})))}get slider(){return this.shadowRoot.querySelector("#slider")}get numInput(){return this.shadowRoot.querySelector("#number-input")}set min(t){this.slider.min=t,this.numInput.min=t,this.minNum=t}set max(t){this.slider.max=t,this.numInput.max=t,this.maxNum=t}set step(t){this.slider.step=t,this.numInput.step=t}set value(t){this.slider.value=t,this.numInput.value=t}normalizeValue(t){return Math.min(Math.max(this.minNum,t),this.maxNum)}set onChange(t){this.slider.onchange=e=>{let s=this.normalizeValue(e.target.valueAsNumber).toString();t(Number.parseFloat(s)),this.value=s},this.slider.oninput=e=>{let s=this.normalizeValue(e.target.valueAsNumber).toString();t(Number.parseFloat(s)),this.value=s},this.numInput.onchange=e=>{let s=this.normalizeValue(e.target.valueAsNumber).toString();t(Number.parseFloat(s)),this.value=s}}};window.customElements.define("range-slider-number",ae);var Ce=document.createElement("div"),Ie={name:"World settings",description:"",element:Ce,init(n){let t=n;this.element.append(p("range-slider",{min:0,max:5e3,step:200,value:t.physics.gravity.y,onChange:e=>{t.physics.gravity.y=e}},"Gravity"),p("range-slider",{min:-5e3,max:5e3,step:1e3,value:t.physics.gravity.x,onChange:e=>{t.physics.gravity.x=e}},"Gravity in X direction"),p("range-slider",{min:0,max:.99,step:.01,value:1-t.physics.airFriction,onChange:e=>{t.physics.setAirFriction(1-e)}},"Air friction"),p("range-slider-number",{min:700,max:1e4,step:10,value:t.worldSize.width,onChange:e=>{t.setWorldSize({width:e,height:t.worldSize.height})}},"World width"),p("range-slider-number",{min:700,max:5e3,step:10,value:t.worldSize.height,onChange:e=>{t.setWorldSize({width:t.worldSize.width,height:e})}},"World height"),p("check-box",{checked:t.drawCollisions,onChange:e=>{t.drawCollisions=e}},"Show collision data"),p("check-box",{checked:t.showAxes,onChange:e=>{t.showAxes=e}},"Show body axes"),p("check-box",{checked:t.showBoundingBoxes,onChange:e=>{t.showBoundingBoxes=e}},"Show boounding boxes"))}},re=Ie;var ce=[Dt,Vt,ie,se,ee,Wt,Zt,Ht,Jt,re,Kt];var X=ce,ot=X.map(n=>n.name),he=class{constructor(){this.resizeCanvas=()=>{let t=this.canvasHolder.getBoundingClientRect();this.cnv.width=t.width,this.cnv.height=window.innerHeight-t.top;let e=window.devicePixelRatio||1,s=t;this.cnv.width=s.width*e,this.cnv.height=s.height*e,this.cnv.style.width=`${s.width}px`,this.cnv.style.height=`${s.height}px`,this.scaling=this.cnv.height/this.worldSize.height,this.scaling/=e,this.scaling*=.9,this.viewOffsetX=.01*this.cnv.width,this.viewOffsetY=.03*this.cnv.height;let o=this.cnv.getContext("2d");o&&(o.scale(e,e),o.lineWidth=e),this.defaultSize=(this.cnv.width+this.cnv.height)/80};this.drawFunction=()=>{var s,o;Number.isFinite(this.lastFrameTime)||(this.lastFrameTime=performance.now());let t=performance.now()-this.lastFrameTime;Number.isFinite(t)||(t=0),t/=1e3,t=Math.min(t,.04166666666);let e=this.cnv.getContext("2d");e.fillStyle=P.Beige,e.fillRect(0,0,this.cnv.width,this.cnv.height),e.save(),e.translate(this.viewOffsetX,this.viewOffsetY),e.scale(this.scaling,this.scaling),this.physicsDraw(),(o=(s=X[this.mode]).drawFunc)==null||o.call(s,this,t*this.timeMultiplier),e.restore(),this.collisionData=[],t*=this.timeMultiplier,this.collisionData.push(...this.physics.update(t/5)),this.collisionData.push(...this.physics.update(t/5)),this.collisionData.push(...this.physics.update(t/5)),this.collisionData.push(...this.physics.update(t/5)),this.collisionData.push(...this.physics.update(t/5)),this.lastFrameTime=performance.now(),requestAnimationFrame(this.drawFunction)};this.startInteraction=(t,e)=>{var s,o;this.mouseX=t/this.scaling-this.viewOffsetX/this.scaling,this.mouseY=e/this.scaling-this.viewOffsetY/this.scaling,this.choosed=this.physics.getObjectAtCoordinates(this.mouseX,this.mouseY),!this.choosed&&typeof this.choosed=="boolean"&&(this.choosed={x:this.mouseX,y:this.mouseY,pinPoint:!0}),this.lastX=this.mouseX,this.lastY=this.mouseY,this.mouseDown=!0,(o=(s=X[this.mode]).startInteractionFunc)==null||o.call(s,this)};this.endInteraction=(t,e)=>{var s,o;this.mouseX=t/this.scaling-this.viewOffsetX/this.scaling,this.mouseY=e/this.scaling-this.viewOffsetY/this.scaling,(o=(s=X[this.mode]).endInteractionFunc)==null||o.call(s,this),this.lastX=0,this.lastY=0,this.mouseDown=!1,this.choosed=!1};this.discardInteraction=()=>{this.lastX=0,this.lastY=0,this.mouseDown=!1,this.choosed=!1};this.keyGotDown=t=>{let e=t.key;e==="s"&&this.spawnNewtonsCradle(this.cnv.width/2,this.cnv.height/2,.5,this.physics),e==="a"&&(this.scaling+=.01),e==="d"&&(this.scaling-=.01),e==="j"&&(this.viewOffsetX-=10),e==="l"&&(this.viewOffsetX+=10),e==="k"&&(this.viewOffsetY-=10),e==="i"&&(this.viewOffsetY+=10)};this.keyGotUp=t=>{};this.startTouch=t=>{t.preventDefault();let e=this.canvasHolder.getBoundingClientRect();return t.touches.length>1?(this.discardInteraction(),t.touches.length===2&&(this.touchIDs.push(t.touches[0].identifier),this.touchIDs.push(t.touches[1].identifier),this.touchCoords.push(new i(t.touches[0].clientX-e.left,t.touches[0].clientY-e.top)),this.touchCoords.push(new i(t.touches[1].clientX-e.left,t.touches[1].clientY-e.top))),t.touches.length>2&&(this.touchIDs=[],this.touchCoords=[]),!1):(this.startInteraction(t.changedTouches[0].clientX-e.left,t.changedTouches[0].clientY-e.top),!1)};this.endTouch=t=>{t.preventDefault();let e=this.canvasHolder.getBoundingClientRect();return t.touches.length<=1&&(this.touchIDs=[],this.touchCoords=[]),this.endInteraction(t.changedTouches[0].clientX-e.left,t.changedTouches[0].clientY-e.top),!1};this.moveTouch=t=>{t.preventDefault();let e=this.canvasHolder.getBoundingClientRect();if(t.touches.length===2){let s=[];return t.touches.item(0).identifier===this.touchIDs[0]?(s.push(t.touches.item(0)),s.push(t.touches.item(1))):(s.push(t.touches.item(1)),s.push(t.touches.item(0))),s=s.map(o=>new i(o.clientX-e.left,o.clientY-e.top)),this.processMultiTouchGesture(this.touchCoords,s),this.touchCoords=s,!1}return t.touches.length>2||(this.mouseX=t.changedTouches[0].clientX-e.left,this.mouseY=t.changedTouches[0].clientY-e.top,this.mouseX=this.mouseX/this.scaling-this.viewOffsetX/this.scaling,this.mouseY=this.mouseY/this.scaling-this.viewOffsetY/this.scaling),!1};this.processMultiTouchGesture=(t,e)=>{let s=i.add(t[1],t[0]);s.mult(.5);let o=i.add(e[1],e[0]);o.mult(.5);let r=i.dist(t[1],t[0]),a=i.dist(e[1],e[0]),h=Math.sqrt(a/r),l=i.add(s,o);l.mult(.5);let u=i.sub(o,s);u.mult(h),this.scaleAround(l,h),this.viewOffsetX+=u.x,this.viewOffsetY+=u.y};this.scaleAround=(t,e)=>{this.viewOffsetX=t.x-(t.x-this.viewOffsetX)*e,this.viewOffsetY=t.y-(t.y-this.viewOffsetY)*e,this.scaling*=e};this.startMouse=t=>(t.button===0&&this.startInteraction(t.offsetX,t.offsetY),t.button===2&&(this.rightButtonDown=new i(t.offsetX,t.offsetY),this.cnv.style.cursor="all-scroll"),!1);this.endMouse=t=>(t.button===0&&this.endInteraction(t.offsetX,t.offsetY),t.button===2&&(this.rightButtonDown=!1,this.cnv.style.cursor="default"),!1);this.handleMouseMovement=t=>{if(this.mouseX=t.offsetX,this.mouseY=t.offsetY,this.mouseX=this.mouseX/this.scaling-this.viewOffsetX/this.scaling,this.mouseY=this.mouseY/this.scaling-this.viewOffsetY/this.scaling,this.rightButtonDown){let e=new i(t.offsetX,t.offsetY),s=i.sub(e,this.rightButtonDown);this.viewOffsetX+=s.x,this.viewOffsetY+=s.y,this.rightButtonDown=e}};this.handleMouseWheel=t=>{t.preventDefault();let e=new i(t.offsetX,t.offsetY),s=5e-4;t.deltaMode===WheelEvent.DOM_DELTA_LINE&&(s/=16);let o=1-t.deltaY*s;this.scaleAround(e,o)};this.convertToPhysicsSpace=t=>new i(t.x/this.scaling-this.viewOffsetX/this.scaling,t.y/this.scaling-this.viewOffsetY/this.scaling);this.convertToCanvasSpace=t=>new i(t.x*this.scaling+this.viewOffsetX,t.y*this.scaling+this.viewOffsetY);this.physicsDraw=()=>{let t=this.cnv.getContext("2d");if(t){t.fillStyle=P.Independence,t.fillRect(0,0,this.worldSize.width,this.worldSize.height),this.physics.bodies.forEach(s=>{if(t.fillStyle=s.style,t.strokeStyle="black",s.m===0&&(t.fillStyle=P.Beige,t.strokeStyle=P.Beige),s.shape.r!==0){let o=s;t.beginPath(),t.arc(o.pos.x,o.pos.y,o.shape.r,0,2*Math.PI),t.stroke(),t.fill(),t.beginPath(),t.moveTo(o.pos.x,o.pos.y),t.lineTo(o.pos.x+o.shape.r*Math.cos(o.rotation),o.pos.y+o.shape.r*Math.sin(o.rotation)),t.stroke()}else t.beginPath(),t.moveTo(s.shape.points[s.shape.points.length-1].x,s.shape.points[s.shape.points.length-1].y),s.shape.points.forEach(o=>{t.lineTo(o.x,o.y)}),t.stroke(),t.fill(),this.showAxes&&(t.strokeStyle="black",s.axes.forEach(o=>{t.beginPath(),t.moveTo(s.pos.x,s.pos.y),t.lineTo(s.pos.x+o.x*30,s.pos.y+o.y*30),t.stroke()}));t.beginPath(),t.arc(s.pos.x,s.pos.y,1.5,0,Math.PI*2),t.stroke()}),t.save(),t.lineWidth=2,this.physics.springs.forEach(s=>{if(s instanceof S&&!(s instanceof T)){let o,r,a,h;s.pinned&&typeof s.pinned=="object"?(o=s.pinned.x,r=s.pinned.y,a=s.objects[0].pos.x,h=s.objects[0].pos.y):(o=s.objects[0].pos.x,r=s.objects[0].pos.y,a=s.objects[1].pos.x,h=s.objects[1].pos.y);let l=new i(a-o,h-r),u=l.copy;l.rotate(Math.PI/2),l.setMag(5);let d=new i(o,r),c=Math.floor(s.length/10);for(let f=1;f<=c;f+=1)t.strokeStyle=P.blue,t.fillStyle=P.blue,f===c&&(l=new i(0,0)),t.beginPath(),t.moveTo(d.x,d.y),t.lineTo(o+f/c*u.x+l.x,r+f/c*u.y+l.y),t.stroke(),d=new i(o+f/c*u.x+l.x,r+f/c*u.y+l.y),l.mult(-1)}else t.strokeStyle=P.blue,t.fillStyle=P.blue,t.beginPath(),t.moveTo(s.objects[0].pos.x,s.objects[0].pos.y),t.lineTo(typeof s.pinned=="object"?s.pinned.x:s.objects[1].pos.x,typeof s.pinned=="object"?s.pinned.y:s.objects[1].pos.y),t.stroke();s.objects.forEach(o=>{t.strokeStyle="black",t.fillStyle=P.blue,t.beginPath(),t.arc(o.pos.x,o.pos.y,2.5,0,Math.PI*2),t.fill(),t.stroke()}),typeof s.pinned=="object"&&(t.strokeStyle="black",t.fillStyle=P.blue,t.beginPath(),t.arc(s.pinned.x,s.pinned.y,3,0,Math.PI*2),t.fill(),t.stroke())}),t.restore(),t.strokeStyle="rgba(255, 255, 255, 0.2)",this.showBoundingBoxes&&this.physics.bodies.forEach(s=>{t.strokeRect(s.boundingBox.x.min,s.boundingBox.y.min,s.boundingBox.x.max-s.boundingBox.x.min,s.boundingBox.y.max-s.boundingBox.y.min)}),t.fillStyle=P["Maximum Yellow Red"],t.strokeStyle=P["Maximum Yellow Red"];let e=t.lineWidth;t.lineWidth=4,this.drawCollisions&&this.collisionData.forEach(s=>{t.beginPath(),t.moveTo(s.cp.x,s.cp.y),t.lineTo(s.cp.x+s.n.x*30,s.cp.y+s.n.y*30),t.stroke(),t.beginPath(),t.arc(s.cp.x,s.cp.y,4,0,Math.PI*2),t.fill()}),t.lineWidth=e}};this.spawnNewtonsCradle=(t,e,s,o)=>{let r=[],a=25,h=250,l=8;r.push(new v(k.Circle(s*a,new i(t,e)),1,1,0));let u=1;for(let d=0;d<l-1;d+=1)r.push(new v(k.Circle(s*a,new i(t+u*s*a*1.01*2,e)),1,1,0)),u*=-1,u>0&&(u+=1),d===l-2&&(r[r.length-1].vel.x=-Math.sign(u)*s*a*8);r.forEach(d=>{o.addBody(d);let c=new T(h);c.attachObject(d),c.pinHere(d.pos.x,d.pos.y-h),o.addSpring(c),c.lockRotation()})};this.modeButtonClicked=t=>{let e=t.target.id.replace("-btn",""),s=ot.indexOf(e);this.switchToMode(s)};this.switchToMode=t=>{var o,r,a,h;let e=document.getElementById(`${ot[this.mode]}-btn`);e&&e.classList.remove("bg-pink-darker"),this.sidebar.innerHTML="",(r=(o=X[this.mode]).deactivated)==null||r.call(o,this),(h=(a=X[t]).activated)==null||h.call(a,this);let s=document.getElementById(`${ot[t]}-btn`);s&&s.classList.add("bg-pink-darker"),this.modeTitleHolder.innerText=X[t].name,this.mode=t,this.sidebar.appendChild(X[this.mode].element)};this.setupModes=()=>{let t=document.getElementById("button-holder");ot.forEach((e,s)=>{var r,a;let o=document.createElement("div");o.classList.add("big-button"),o.id=`${e}-btn`,o.textContent=X[s].name,(a=(r=X[s]).init)==null||a.call(r,this),o.onclick=this.modeButtonClicked,t&&t.appendChild(o)}),this.switchToMode(this.mode)};this.setTimeMultiplier=t=>{Number.isFinite(t)&&t>=0&&(this.timeMultiplier=t,t===0?this.pauseBtn.classList.add("bg-pink-darker"):this.pauseBtn.classList.remove("bg-pink-darker"))};this.getTimeMultiplier=()=>this.timeMultiplier;this.setPhysics=t=>{t instanceof z&&(this.physics=t)};this.getPhysics=()=>this.physics;this.physics=new z,this.mouseX=0,this.mouseY=0,this.mouseDown=!1,this.defaultSize=30,this.k=.5,this.fc=2,this.springConstant=2e3,this.scaling=1,this.viewOffsetX=0,this.viewOffsetY=0,this.mode=0,this.lastX=0,this.lastY=0,this.touchIDs=[],this.touchCoords=[],this.rightButtonDown=!1,this.timeMultiplier=1,this.lastFrameTime=performance.now(),this.choosed=!1,this.drawCollisions=!1,this.showAxes=!1,this.worldSize={width:0,height:0},this.collisionData=[],this.showBoundingBoxes=!1,this.cnv=document.getElementById("defaulCanvas0"),this.canvasHolder=document.getElementById("canvas-holder"),this.sidebar=document.getElementById("sidebar"),this.modeTitleHolder=document.getElementById("mode-title-text"),this.pauseBtn=document.getElementById("pause"),this.setWorldSize({width:2e3,height:1e3}),this.physics.setGravity(new i(0,1e3)),this.physics.setAirFriction(.9),this.cnv.addEventListener("touchstart",this.startTouch,!1),this.cnv.addEventListener("touchend",this.endTouch,!1),this.cnv.addEventListener("touchmove",this.moveTouch,!1),this.cnv.addEventListener("mousedown",this.startMouse,!1),this.cnv.addEventListener("mouseup",this.endMouse,!1),this.cnv.addEventListener("mousemove",this.handleMouseMovement,!1),this.cnv.addEventListener("wheel",this.handleMouseWheel),this.cnv.addEventListener("contextmenu",t=>t.preventDefault()),document.addEventListener("keydown",this.keyGotDown,!1),document.addEventListener("keyup",this.keyGotUp,!1),window.addEventListener("resize",this.resizeCanvas,!1),this.resizeCanvas(),this.setupModes(),lt(this),requestAnimationFrame(this.drawFunction)}setWorldSize(t){this.physics.setBounds(0,0,t.width,t.height),this.worldSize=t}},le=he;window.onload=()=>{window.editorApp=new le,"serviceWorker"in navigator&&navigator.serviceWorker.register("serviceworker.js").then(()=>{},n=>{console.log("ServiceWorker registration failed: ",n)})};})();

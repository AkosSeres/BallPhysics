<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>constraint/spring.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Body.html">Body</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Body.html#.detectCollision">detectCollision</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Body.html#.fromObject">fromObject</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Body.html#applyImpulse">applyImpulse</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Body.html#calculateAxes">calculateAxes</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Body.html#calculateMinMaxes">calculateMinMaxes</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Body.html#containsPoint">containsPoint</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Body.html#fixDown">fixDown</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Body.html#move">move</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Body.html#rotate">rotate</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Body.html#rotateAround">rotateAround</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Body.html#scaleAround">scaleAround</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Body.html#scaleAroundX">scaleAroundX</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Body.html#scaleAroundY">scaleAroundY</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Body.html#velInPlace">velInPlace</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Line.html">Line</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Line.html#.intersect">intersect</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Line.html#.intersectWithLineSegment">intersectWithLineSegment</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Line.html#distFromPoint">distFromPoint</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="LineSegment.html">LineSegment</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="LineSegment.html#.intersect">intersect</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="LineSegment.html#distFromPoint">distFromPoint</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="MinMax.html">MinMax</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="MinMax.html#.fromPoints">fromPoints</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="MinMax.html#add">add</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="MinMax.html#size">size</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Physics.html">Physics</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Physics.html#.fromObject">fromObject</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Physics.html#addBody">addBody</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Physics.html#addFixedBall">addFixedBall</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Physics.html#addRectBody">addRectBody</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Physics.html#addRectWall">addRectWall</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Physics.html#addSoftSquare">addSoftSquare</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Physics.html#addSpring">addSpring</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Physics.html#getFreeLayer">getFreeLayer</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Physics.html#getObjectAtCoordinates">getObjectAtCoordinates</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Physics.html#getObjectIdentifier">getObjectIdentifier</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Physics.html#getSpringsWithBody">getSpringsWithBody</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Physics.html#removeObjFromSystem">removeObjFromSystem</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Physics.html#setAirFriction">setAirFriction</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Physics.html#setBounds">setBounds</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Physics.html#setGravity">setGravity</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Physics.html#stickOrSpringFromObject">stickOrSpringFromObject</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Physics.html#toJSON">toJSON</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Physics.html#update">update</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Polygon.html">Polygon</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Polygon.html#.createCircle">createCircle</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Polygon.html#.fracture">fracture</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Polygon.html#.intersection">intersection</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Polygon.html#getSideLine">getSideLine</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Polygon.html#getSideSegment">getSideSegment</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Polygon.html#getSideVector">getSideVector</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Polygon.html#isPointInside">isPointInside</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Polygon.html#makeAntiClockwise">makeAntiClockwise</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Polygon.html#reverseOrder">reverseOrder</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Shape.html">Shape</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Shape.html#.Circle">Circle</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Shape.html#.fromObject">fromObject</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Shape.html#.Polygon">Polygon</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Shape.html#containsPoint">containsPoint</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Shape.html#getClosestPoint">getClosestPoint</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Shape.html#getConvexHull">getConvexHull</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Shape.html#getGeometricalData">getGeometricalData</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Shape.html#getMinMaxInDirection">getMinMaxInDirection</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Shape.html#getMinMaxX">getMinMaxX</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Shape.html#getMinMaxY">getMinMaxY</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Shape.html#getNormal">getNormal</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Shape.html#getSide">getSide</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Shape.html#getSideLine">getSideLine</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Shape.html#move">move</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Shape.html#rotateAround">rotateAround</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Spring.html">Spring</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Spring.html#arrangeOrientations">arrangeOrientations</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Spring.html#attachObject">attachObject</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Spring.html#getAsSegment">getAsSegment</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Spring.html#getMinMaxX">getMinMaxX</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Spring.html#getMinMaxY">getMinMaxY</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Spring.html#lockRotation">lockRotation</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Spring.html#pinHere">pinHere</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Spring.html#rotateAround">rotateAround</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Spring.html#scaleAround">scaleAround</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Spring.html#unlockRotation">unlockRotation</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Spring.html#unpin">unpin</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Spring.html#update">update</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Spring.html#updateAttachPoint0">updateAttachPoint0</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Spring.html#updateAttachPoint1">updateAttachPoint1</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Stick.html">Stick</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Stick.html#update">update</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Stick.html#updateAttachPoint0">updateAttachPoint0</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Stick.html#updateAttachPoint1">updateAttachPoint1</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Vec2.html">Vec2</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#add">add</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#dist">dist</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#div">div</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#lerp">lerp</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#mult">mult</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#normalize">normalize</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#pNorm">pNorm</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#rotate">rotate</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#rotate90">rotate90</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#rotate270">rotate270</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#rotateAround">rotateAround</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#scaleAround">scaleAround</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#scaleAroundX">scaleAroundX</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#scaleAroundY">scaleAroundY</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#setCoordinates">setCoordinates</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#setMag">setMag</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#sub">sub</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#toJSON">toJSON</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#.add">add</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#.angle">angle</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#.angleACW">angleACW</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#.cross">cross</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#.crossScalarFirst">crossScalarFirst</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#.crossScalarSecond">crossScalarSecond</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#.dist">dist</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#.div">div</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#.dot">dot</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#.fromAngle">fromAngle</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#.fromAnglePNorm">fromAnglePNorm</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#.fromObject">fromObject</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#.lerp">lerp</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#.mult">mult</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#.normalized">normalized</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#.rotateArr">rotateArr</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#.sub">sub</a></span></li><li class="nav-heading"><a href="global.html">Globals</a></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#arrayBuffertoBase64">arrayBuffertoBase64</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#base64ToArrayBuffer">base64ToArrayBuffer</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#codeTable">codeTable</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#collisionResponse">collisionResponse</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#collisionResponseWithWall">collisionResponseWithWall</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#findOverlap">findOverlap</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#minMaxOfArray">minMaxOfArray</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#resolveCollisions">resolveCollisions</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">constraint/spring.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import Body from '../entity/body';
import LineSegment from '../math/linesegment';
import { MinMax } from '../math/minmax';
import Vec2 from '../math/vec2';

/**
 * An object representation of the Spring class for easy conversion to JSON.
 *
 * @typedef {object} SpringAsObject
 * @property {number} length The length of the spring
 * @property {number} springConstant The stiffness of the spring
 * @property {boolean | {x:number, y:number}} pinned This property indicates whether
 * the spring is pinned or not
 * @property {import('../physics').ObjectIdentifier[]} objects The indices of the attached objects
 * @property {boolean} rotationLocked The variable inticating whether or not
 * the attached objects are allowed to rotate freely
 * @property {"spring"} type Indicates that the object is a spring
 */

/**
 * Class representing a string
 * They act like springs in real life
 * You can attach other objects to the ends of them
 * They do not collide with other object neither with each other
 */
class Spring {
  /**
   * Creates a spring
   *
   * @param {number} length The unstreched length of the spring
   * @param {number} springConstant Spring constant
   */
  constructor(length, springConstant) {
    this.length = length;
    this.springConstant = springConstant;
    /** @type {boolean | {x:number, y:number}} */
    this.pinned = false;
    /** @type {Body[]} */
    this.objects = [];
    this.rotationLocked = false;
    this.initialHeading = 0;
    this.initialOrientations = [0, 0];
    /** @type {Vec2[]} */
    this.attachPoints = [];
    /** @type {number[]} */
    this.attachRotations = [];
    /** @type {Vec2[]} */
    this.attachPositions = [];
  }

  /**
   * Returns a copy of the spring
   *
   * @returns {Spring} The copy
   */
  get copy() {
    /** @type {Spring} */
    const ret = Object.create(Spring.prototype);

    ret.length = this.length;
    ret.springConstant = this.springConstant;
    if (typeof this.pinned === 'boolean') {
      ret.pinned = this.pinned;
    } else ret.pinned = { x: this.pinned.x, y: this.pinned.y };
    ret.objects = this.objects;
    ret.rotationLocked = this.rotationLocked;
    ret.initialHeading = this.initialHeading;
    ret.initialOrientations = [...this.initialOrientations];
    ret.attachPoints = this.attachPoints.map((p) => p.copy);
    ret.attachRotations = [...this.attachRotations];
    ret.attachPositions = this.attachPositions.map((pos) => pos.copy);

    return ret;
  }

  /**
   * Pins one side of the the spring to a given coordinate in space
   *
   * @param {number} x x coordinate
   * @param {number} y y coordinate
   */
  pinHere(x, y) {
    this.pinned = {
      x,
      y,
    };
  }

  /**
   * Removes the pinned tag from the spring
   * You can now attach it to another object
   */
  unpin() {
    this.pinned = false;
  }

  /**
   * Attaches one end of the spring to an object (eg. Ball)
   *
   * @param {Body} object The object that the spring is getting attached to
   * @param {Vec2 | undefined} attachPoint The point to attach the spring to on the body
   */
  attachObject(object, attachPoint = undefined) {
    let ob = this.objects;
    ob.push(object);
    if (attachPoint) this.attachPoints.push(attachPoint.copy);
    else this.attachPoints.push(object.pos.copy);
    this.attachPositions.push(object.pos.copy);
    this.attachRotations.push(object.rotation);
    if (ob.length === 2) {
      this.pinned = false;
    }
    if (ob.length >= 3) {
      ob = [ob[ob.length - 2], ob[ob.length - 1]];
      this.attachPoints = [
        this.attachPoints[this.attachPoints.length - 2],
        this.attachPoints[this.attachPoints.length - 1],
      ];
      this.attachPositions = [
        this.attachPositions[this.attachPositions.length - 2],
        this.attachPositions[this.attachPositions.length - 1],
      ];
      this.attachRotations = [
        this.attachRotations[this.attachRotations.length - 2],
        this.attachRotations[this.attachRotations.length - 1],
      ];
    }
  }

  /**
   * Updates the first attach point.
   *
   * @param {Vec2} newAttachPoint The new attach point to have on the first object
   * @param {number} snapRadius The max radius where it snaps to the pos of the object
   */
  updateAttachPoint0(newAttachPoint, snapRadius = 0) {
    const isLocked = this.rotationLocked;
    if (isLocked) this.unlockRotation();
    this.attachPoints[0] = newAttachPoint.copy;
    this.attachPositions[0] = this.objects[0].pos.copy;
    this.attachRotations[0] = this.objects[0].rotation;
    if (this.attachPoints[0].dist(this.attachPositions[0]) &lt;= snapRadius) {
      this.attachPoints[0] = this.attachPositions[0].copy;
    }
    if (isLocked) this.lockRotation();
  }

  /**
   * Updates the seccond attach point.
   *
   * @param {Vec2} newAttachPoint The new attach point to have on the second object
   * or on the pinpoint
   * @param {number} snapRadius The max radius where it snaps to the pos of the object
   */
  updateAttachPoint1(newAttachPoint, snapRadius = 0) {
    const isLocked = this.rotationLocked;
    if (isLocked) this.unlockRotation();
    if (this.objects.length === 2) {
      this.attachPoints[1] = newAttachPoint.copy;
      this.attachPositions[1] = this.objects[1].pos.copy;
      this.attachRotations[1] = this.objects[1].rotation;
      if (this.attachPoints[1].dist(this.attachPositions[1]) &lt;= snapRadius) {
        this.attachPoints[1] = this.attachPositions[1].copy;
      }
    } else if (typeof this.pinned !== 'boolean') {
      this.pinned = newAttachPoint.copy;
    }
    if (isLocked) this.lockRotation();
  }

  /**
   * Returns the current absolute attach points of the spring.
   *
   * @returns {Vec2[]} The array of points
   */
  get points() {
    const ps = this.objects.map((o, i) => {
      const rStart = Vec2.sub(this.attachPoints[i], this.attachPositions[i]);
      rStart.rotate(o.rotation - this.attachRotations[i]);
      return Vec2.add(rStart, o.pos);
    });
    if (typeof this.pinned !== 'boolean') ps.push(Vec2.fromObject(this.pinned));
    return ps;
  }

  /**
   * Locks the objects attached to the ends of the spring
   * to not rotate around the attach point
   */
  lockRotation() {
    this.rotationLocked = true;
    this.initialOrientations = this.objects.map((body) => body.rotation);
    const ps = this.points;
    this.initialHeading = Vec2.sub(ps[1], ps[0]).heading;
  }

  /**
   * Releases the objects attached to the ends of the spring
   * to rotate around the attach point
   */
  unlockRotation() {
    this.rotationLocked = false;
  }

  /**
   * Arranges the rotations of the bodies to match the orientation when got locked.
   */
  arrangeOrientations() {
    const ps = this.points;
    const currentHeading = Vec2.sub(ps[1], ps[0]).heading;
    const dHeading = currentHeading - this.initialHeading;
    this.objects.forEach((body, i) => {
      const rotationGoal = this.initialOrientations[i] + dHeading;
      body.rotate(rotationGoal - body.rotation);
    });
  }

  /**
   * Returns the spring as a LineSegment.
   *
   * @returns {LineSegment} The segment made from the spring
   */
  getAsSegment() {
    const ps = this.points;
    return new LineSegment(ps[0], ps[1]);
  }

  /**
   * Updates the spring bay the elapsed time
   *
   * @param {number} t Elapsed time
   */
  update(t) {
    if (this.rotationLocked) this.arrangeOrientations();
    let p1;
    let p2;
    if (this.pinned instanceof Object &amp;&amp; this.objects[0]) {
      [p2, p1] = [this.pinned, this.objects[0]];
      const ps = this.points;
      const dist = new Vec2(ps[1].x - ps[0].x, ps[1].y - ps[0].y);
      const dl = dist.length - this.length;
      dist.setMag(1);
      dist.mult((dl * this.springConstant * t));
      p1.applyImpulse(ps[1], dist);

      const v = p1.vel;
      v.rotate(-dist.heading);
      if (this.rotationLocked &amp;&amp; p1.m !== 0) {
        const s = new Vec2(p2.x, p2.y);
        const r2 = Vec2.sub(p1.pos, s);
        const len = r2.length;
        const am = len * len * p1.m + p1.am;
        const ang = (p1.am * p1.ang - len * p1.m * v.y) / am;

        v.y = -ang * len;

        p1.ang = ang;
      }
      v.rotate(dist.heading);
    } else if (this.objects[0] &amp;&amp; this.objects[1]) {
      [p1, p2] = [this.objects[0], this.objects[1]];
      const ps = this.points;
      let dist = Vec2.sub(ps[0], ps[1]);
      const dl = dist.length - this.length;
      dist.setMag(1);
      dist.mult(dl * this.springConstant * t);
      p2.applyImpulse(ps[1], dist);
      dist.mult(-1);
      p1.applyImpulse(ps[0], dist);

      dist = Vec2.sub(p1.pos, p2.pos);
      const v1 = p1.vel;
      const v2 = p2.vel;
      v1.rotate(-dist.heading);
      v2.rotate(-dist.heading);

      if (this.rotationLocked &amp;&amp; p1.m !== 0 &amp;&amp; p2.m !== 0) {
        const s = new Vec2(
          p1.pos.x * p1.m + p2.pos.x * p2.m,
          p1.pos.y * p1.m + p2.pos.y * p2.m,
        );
        s.div(p1.m + p2.m);
        const r1 = Vec2.sub(p1.pos, s);
        const r2 = Vec2.sub(p2.pos, s);
        const len1 = r1.length;
        const len2 = r2.length;
        const am = len1 * len1 * p1.m
          + p1.am
          + len2 * len2 * p2.m
          + p2.am;
        const sv = ((v1.y - v2.y) * len2) / (len1 + len2) + v2.y;
        const ang = (p1.am * p1.ang
          + p2.am * p2.ang
          + len1 * p1.m * (v1.y - sv)
          - len2 * p2.m * (v2.y - sv))
          / am;

        v1.y = ang * len1 + sv;
        v2.y = -ang * len2 + sv;

        p1.ang = ang;
        p2.ang = ang;
      }

      v1.rotate(dist.heading);
      v2.rotate(dist.heading);
    }
  }

  /**
   * Rotates the spring around a given center by a given angle.
   *
   * @param {Vec2} center The center of rotation
   * @param {number} angle The angle to rotate by
   */
  rotateAround(center, angle) {
    if (typeof this.pinned === 'boolean') return;
    const p = Vec2.fromObject(this.pinned);
    p.rotateAround(center, angle);
    this.pinned.x = p.x;
    this.pinned.y = p.y;
  }

  /**
   * Scales the spring around a given center by a given factor.
   *
   * @param {Vec2} center The center of scaling
   * @param {number} factor The factor to scale by
   */
  scaleAround(center, factor) {
    if (typeof this.pinned === 'boolean') return;
    const p = Vec2.fromObject(this.pinned);
    p.scaleAround(center, factor);
    this.pinned.x = p.x;
    this.pinned.y = p.y;
    this.length *= factor;
  }

  /**
   * Returns the MinMax of the spring along the x axis.
   *
   * @returns {MinMax} The bouding box of the spring in the x direction
   */
  getMinMaxX() {
    const xPoints = [...this.objects.map((b) => b.pos.x)];
    if (typeof this.pinned !== 'boolean')xPoints.push(this.pinned.x);
    return MinMax.fromPoints(...xPoints);
  }

  /**
   * Returns the MinMax of the spring along the y axis.
   *
   * @returns {MinMax} The bouding box of the spring in the y direction
   */
  getMinMaxY() {
    const yPoints = [...this.objects.map((b) => b.pos.y)];
    if (typeof this.pinned !== 'boolean') yPoints.push(this.pinned.y);
    return MinMax.fromPoints(...yPoints);
  }
}

export default Spring;
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.4</a> on Thu Oct 07 2021 18:20:31 GMT+0000 (Coordinated Universal Time) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>constraint/stick.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Body.html">Body</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Body.html#.detectCollision">detectCollision</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Body.html#.fromObject">fromObject</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Body.html#applyImpulse">applyImpulse</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Body.html#calculateAxes">calculateAxes</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Body.html#calculateMinMaxes">calculateMinMaxes</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Body.html#containsPoint">containsPoint</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Body.html#fixDown">fixDown</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Body.html#move">move</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Body.html#rotate">rotate</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Body.html#rotateAround">rotateAround</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Body.html#scaleAround">scaleAround</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Body.html#scaleAroundX">scaleAroundX</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Body.html#scaleAroundY">scaleAroundY</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Body.html#velInPlace">velInPlace</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Line.html">Line</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Line.html#.intersect">intersect</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Line.html#.intersectWithLineSegment">intersectWithLineSegment</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Line.html#distFromPoint">distFromPoint</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="LineSegment.html">LineSegment</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="LineSegment.html#.intersect">intersect</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="LineSegment.html#distFromPoint">distFromPoint</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="MinMax.html">MinMax</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="MinMax.html#.fromPoints">fromPoints</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="MinMax.html#add">add</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="MinMax.html#size">size</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Physics.html">Physics</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Physics.html#.fromObject">fromObject</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Physics.html#addBody">addBody</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Physics.html#addFixedBall">addFixedBall</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Physics.html#addRectBody">addRectBody</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Physics.html#addRectWall">addRectWall</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Physics.html#addSoftSquare">addSoftSquare</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Physics.html#addSpring">addSpring</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Physics.html#getFreeLayer">getFreeLayer</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Physics.html#getObjectAtCoordinates">getObjectAtCoordinates</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Physics.html#getObjectIdentifier">getObjectIdentifier</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Physics.html#getSpringsWithBody">getSpringsWithBody</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Physics.html#removeObjFromSystem">removeObjFromSystem</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Physics.html#setAirFriction">setAirFriction</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Physics.html#setBounds">setBounds</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Physics.html#setGravity">setGravity</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Physics.html#stickOrSpringFromObject">stickOrSpringFromObject</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Physics.html#toJSON">toJSON</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Physics.html#update">update</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Polygon.html">Polygon</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Polygon.html#.createCircle">createCircle</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Polygon.html#.fracture">fracture</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Polygon.html#.intersection">intersection</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Polygon.html#getSideLine">getSideLine</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Polygon.html#getSideSegment">getSideSegment</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Polygon.html#getSideVector">getSideVector</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Polygon.html#isPointInside">isPointInside</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Polygon.html#makeAntiClockwise">makeAntiClockwise</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Polygon.html#reverseOrder">reverseOrder</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Shape.html">Shape</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Shape.html#.Circle">Circle</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Shape.html#.fromObject">fromObject</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Shape.html#.Polygon">Polygon</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Shape.html#containsPoint">containsPoint</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Shape.html#getClosestPoint">getClosestPoint</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Shape.html#getConvexHull">getConvexHull</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Shape.html#getGeometricalData">getGeometricalData</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Shape.html#getMinMaxInDirection">getMinMaxInDirection</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Shape.html#getMinMaxX">getMinMaxX</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Shape.html#getMinMaxY">getMinMaxY</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Shape.html#getNormal">getNormal</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Shape.html#getSide">getSide</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Shape.html#getSideLine">getSideLine</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Shape.html#move">move</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Shape.html#rotateAround">rotateAround</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Spring.html">Spring</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Spring.html#arrangeOrientations">arrangeOrientations</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Spring.html#attachObject">attachObject</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Spring.html#getAsSegment">getAsSegment</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Spring.html#getMinMaxX">getMinMaxX</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Spring.html#getMinMaxY">getMinMaxY</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Spring.html#lockRotation">lockRotation</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Spring.html#pinHere">pinHere</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Spring.html#rotateAround">rotateAround</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Spring.html#scaleAround">scaleAround</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Spring.html#unlockRotation">unlockRotation</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Spring.html#unpin">unpin</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Spring.html#update">update</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Spring.html#updateAttachPoint0">updateAttachPoint0</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Spring.html#updateAttachPoint1">updateAttachPoint1</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Stick.html">Stick</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Stick.html#update">update</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Stick.html#updateAttachPoint0">updateAttachPoint0</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Stick.html#updateAttachPoint1">updateAttachPoint1</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Vec2.html">Vec2</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#add">add</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#dist">dist</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#div">div</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#lerp">lerp</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#mult">mult</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#normalize">normalize</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#pNorm">pNorm</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#rotate">rotate</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#rotate90">rotate90</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#rotate270">rotate270</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#rotateAround">rotateAround</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#scaleAround">scaleAround</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#scaleAroundX">scaleAroundX</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#scaleAroundY">scaleAroundY</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#setCoordinates">setCoordinates</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#setMag">setMag</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#sub">sub</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#toJSON">toJSON</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#.add">add</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#.angle">angle</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#.angleACW">angleACW</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#.cross">cross</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#.crossScalarFirst">crossScalarFirst</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#.crossScalarSecond">crossScalarSecond</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#.dist">dist</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#.div">div</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#.dot">dot</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#.fromAngle">fromAngle</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#.fromAnglePNorm">fromAnglePNorm</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#.fromObject">fromObject</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#.lerp">lerp</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#.mult">mult</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#.normalized">normalized</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#.rotateArr">rotateArr</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Vec2.html#.sub">sub</a></span></li><li class="nav-heading"><a href="global.html">Globals</a></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#arrayBuffertoBase64">arrayBuffertoBase64</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#base64ToArrayBuffer">base64ToArrayBuffer</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#codeTable">codeTable</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#collisionResponse">collisionResponse</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#collisionResponseWithWall">collisionResponseWithWall</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#findOverlap">findOverlap</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#minMaxOfArray">minMaxOfArray</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#resolveCollisions">resolveCollisions</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">constraint/stick.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import Vec2 from '../math/vec2';
import Spring from './spring';

/**
 * An object representation of the Spring class for easy conversion to JSON.
 *
 * @typedef {object} StickAsObject
 * @property {number} length The length of the stick
 * @property {number} springConstant Always 0 for sticks
 * @property {boolean | {x:number, y:number}} pinned This property indicates whether
 * the stick is pinned or not
 * @property {import('../physics').ObjectIdentifier[]} objects The indices of the attached objects
 * @property {boolean} rotationLocked The variable inticating whether or not
 * the attached objects are allowed to rotate freely
 * @property {"stick"} type Indicates that the object is a stick
 */

/**
 * Stick class for the physics engine
 * Sticks are not strechable objects that do not collide
 * with other objects but they can hold other objects on their ends
 *
 * @implements {Spring}
 */
class Stick extends Spring {
  /**
   * Creates a stick
   *
   * @param {number} length The length of the stick
   */
  constructor(length) {
    super(length, 0);
    this.springConstant = 0;
  }

  /**
   * Returns a copy of the spring
   *
   * @returns {Stick} The copy
   */
  get copy() {
    /** @type {Stick} */
    const ret = Object.create(Stick.prototype);

    ret.length = this.length;
    ret.springConstant = this.springConstant;
    if (typeof this.pinned === 'boolean') {
      ret.pinned = this.pinned;
    } else ret.pinned = { x: this.pinned.x, y: this.pinned.y };
    ret.objects = this.objects;
    ret.rotationLocked = this.rotationLocked;
    ret.initialHeading = this.initialHeading;
    ret.initialOrientations = [...this.initialOrientations];
    ret.attachPoints = this.attachPoints.map((p) => p.copy);
    ret.attachRotations = [...this.attachRotations];
    ret.attachPositions = this.attachPositions.map((pos) => pos.copy);

    return ret;
  }

  /**
   * Updates the first attach point.
   *
   * @param {Vec2} newAttachPoint The new attach point to have on the first object
   * @param {number} snapRadius The max radius where it snaps to the pos of the object
   */
  updateAttachPoint0(newAttachPoint, snapRadius = 0) {
    const isLocked = this.rotationLocked;
    if (isLocked) this.unlockRotation();
    this.attachPoints[0] = newAttachPoint.copy;
    this.attachPositions[0] = this.objects[0].pos.copy;
    this.attachRotations[0] = this.objects[0].rotation;
    if (this.attachPoints[0].dist(this.attachPositions[0]) &lt;= snapRadius) {
      this.attachPoints[0] = this.attachPositions[0].copy;
    }
    this.length = this.getAsSegment().length;
    if (isLocked) this.lockRotation();
  }

  /**
   * Updates the second attach point.
   *
   * @param {Vec2} newAttachPoint The new attach point to have on the second object
   * or on the pinpoint
   * @param {number} snapRadius The max radius where it snaps to the pos of the object
   */
  updateAttachPoint1(newAttachPoint, snapRadius = 0) {
    const isLocked = this.rotationLocked;
    if (isLocked) this.unlockRotation();
    if (this.objects.length === 2) {
      this.attachPoints[1] = newAttachPoint.copy;
      this.attachPositions[1] = this.objects[1].pos.copy;
      this.attachRotations[1] = this.objects[1].rotation;
      if (this.attachPoints[1].dist(this.attachPositions[1]) &lt;= snapRadius) {
        this.attachPoints[1] = this.attachPositions[1].copy;
      }
    } else if (typeof this.pinned !== 'boolean') {
      this.pinned = newAttachPoint.copy;
    }
    this.length = this.getAsSegment().length;
    if (isLocked) this.lockRotation();
  }

  /**
   * Updates the stick trough an elapsed time
   */
  update() {
    if (this.rotationLocked) this.arrangeOrientations();
    let p1;
    let p2;
    if (this.pinned instanceof Object &amp;&amp; 'x' in this.pinned &amp;&amp; this.objects[0]) {
      [p2, p1] = [this.pinned, this.objects[0]];
      if (p1.m === 0) return;
      const ps = this.points;
      let dist = new Vec2(ps[1].x - ps[0].x, ps[1].y - ps[0].y);
      dist.setMag(dist.length - this.length);
      p1.move(dist);
      dist = new Vec2(ps[1].x - ps[0].x, ps[1].y - ps[0].y);
      dist.normalize();
      const cp = ps[0];
      const n = dist;
      const b = p1;
      const r = Vec2.sub(cp, b.pos);
      // Relative velocity in collision point
      const vRelInCP = Vec2.mult(b.velInPlace(cp), -1);
      // Calculate impulse
      let impulse = (1 / b.m);
      impulse += Vec2.dot(
        Vec2.crossScalarFirst(Vec2.cross(r, n) / b.am, r), n,
      );
      impulse = -(Vec2.dot(vRelInCP, n)) / impulse;
      // Calculate post-collision velocity
      const u = Vec2.sub(b.vel, Vec2.mult(n, impulse / b.m));
      // Calculate post-collision angular velocity
      const pAng = b.ang - (impulse * Vec2.cross(r, n)) / b.am;
      p1.vel = u;
      p1.ang = pAng;

      const v = p1.vel;
      v.rotate(-dist.heading);
      if (this.rotationLocked &amp;&amp; p1.m !== 0) {
        const s = new Vec2(p2.x, p2.y);
        const r2 = Vec2.sub(p1.pos, s);
        const len = r2.length;
        const am = len * len * p1.m + p1.am;
        const ang = (p1.am * p1.ang + len * p1.m * v.y) / am;

        v.y = ang * len;

        p1.ang = ang;
      }
      v.rotate(dist.heading);
    } else if (this.objects[0] &amp;&amp; this.objects[1]) {
      [p1, p2] = [this.objects[0], this.objects[1]];
      let ps = this.points;
      let dist = Vec2.sub(ps[0], ps[1]);
      const dl = this.length - dist.length;
      dist.setMag(1);
      const b1 = p1;
      const b2 = p2;
      const m1 = b1.m === 0 ? Infinity : b1.m;
      const m2 = b2.m === 0 ? Infinity : b2.m;
      let move1;
      let move2;
      if (m1 !== Infinity &amp;&amp; m2 !== Infinity) {
        move1 = Vec2.mult(dist, (dl * m2) / (m1 + m2));
        move2 = Vec2.mult(dist, (-dl * m1) / (m1 + m2));
      } else if (m1 === Infinity &amp;&amp; m2 !== Infinity) {
        move1 = new Vec2(0, 0);
        move2 = Vec2.mult(dist, -dl);
      } else if (m1 !== Infinity &amp;&amp; m2 === Infinity) {
        move2 = new Vec2(0, 0);
        move1 = Vec2.mult(dist, dl);
      } else return;
      p1.move(move1);
      p2.move(move2);
      ps = this.points;
      dist = Vec2.sub(ps[1], ps[0]);
      dist.normalize();
      const n = dist;
      const cp0 = ps[0];
      const cp1 = ps[1];
      const ang1 = b1.ang;
      const ang2 = b2.ang;
      const r1 = Vec2.sub(cp0, b1.pos);
      const r2 = Vec2.sub(cp1, b2.pos);
      const am1 = b1.m === 0 ? Infinity : b1.am;
      const am2 = b2.m === 0 ? Infinity : b2.am;
      // Effective velocities in the collision point
      const v1InCP = b1.velInPlace(cp0);
      const v2InCP = b2.velInPlace(cp1);
      // Relative velocity in collision point
      const vRelInCP = Vec2.sub(v2InCP, v1InCP);
      // Calculate impulse
      let impulse = (1 / m1) + (1 / m2);
      impulse += Vec2.dot(
        Vec2.crossScalarFirst(Vec2.cross(r1, n) / am1, r1), n,
      );
      impulse += Vec2.dot(
        Vec2.crossScalarFirst(Vec2.cross(r2, n) / am2, r2), n,
      );
      impulse = -(Vec2.dot(vRelInCP, n)) / impulse;
      // Calculate post-collision velocities
      const u1 = Vec2.sub(b1.vel, Vec2.mult(n, impulse / m1));
      const u2 = Vec2.add(b2.vel, Vec2.mult(n, impulse / m2));
      // Calculate post-collision angular velocities
      const pAng1 = ang1 - (impulse * Vec2.cross(r1, n)) / am1;
      const pAng2 = ang2 + (impulse * Vec2.cross(r2, n)) / am2;
      if (p1.m !== 0) {
        p1.vel = u1;
        p1.ang = pAng1;
      } if (p2.m !== 0) {
        p2.vel = u2;
        p2.ang = pAng2;
      }

      const v1 = p1.vel;
      const v2 = p2.vel;
      v1.rotate(-dist.heading);
      v2.rotate(-dist.heading);
      if (this.rotationLocked &amp;&amp; p1.m !== 0 &amp;&amp; p2.m !== 0) {
        const s = new Vec2(
          p1.pos.x * p1.m + p2.pos.x * p2.m,
          p1.pos.y * p1.m + p2.pos.y * p2.m,
        );
        s.div(p1.m + p2.m);
        const len1 = Vec2.sub(p1.pos, s).length;
        const len2 = Vec2.sub(p2.pos, s).length;
        const am = len1 * len1 * p1.m
          + p1.am
          + len2 * len2 * p2.m
          + p2.am;
        const sv = ((v1.y - v2.y) * len2) / (len1 + len2) + v2.y;
        const ang = (p1.am * p1.ang
          + p2.am * p2.ang
          + len1 * p1.m * (v1.y - sv)
          - len2 * p2.m * (v2.y - sv))
          / am;

        v1.y = ang * len1 + sv;
        v2.y = -ang * len2 + sv;

        p1.ang = ang;
        p2.ang = ang;
      }

      v1.rotate(dist.heading);
      v2.rotate(dist.heading);
    }
  }
}

export default Stick;
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.4</a> on Thu Feb 11 2021 15:56:20 GMT+0000 (Coordinated Universal Time) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>

/*! ballphysics 21-08-2018 */

"use strict";var _createClass=function(){function a(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(t,e,n){return e&&a(t.prototype,e),n&&a(t,n),t}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}!function(t){if("object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Physics=t()}}(function(){return function i(r,h,o){function l(e,t){if(!h[e]){if(!r[e]){var n="function"==typeof require&&require;if(!t&&n)return n(e,!0);if(u)return u(e,!0);var a=new Error("Cannot find module '"+e+"'");throw a.code="MODULE_NOT_FOUND",a}var s=h[e]={exports:{}};r[e][0].call(s.exports,function(t){return l(r[e][1][t]||t)},s,s.exports,i,r,h,o)}return h[e].exports}for(var u="function"==typeof require&&require,t=0;t<o.length;t++)l(o[t]);return l}({1:[function(t,e,n){var R=t("./vec2"),a=function(){function r(t,e,n,a,s,i){_classCallCheck(this,r),this.pos=t.copy,this.lastPos=this.pos.copy,this.r=n,this.fc=.4,this.amc=.4,this.rotation=0,this.ang=s||0,(i||0===i)&&(this.fc=i),this.k=a||.8,this.vel=null!=e?e.copy:new R(0,0)}return _createClass(r,[{key:"move",value:function(t,e){this.pos.x+=t,this.pos.y+=e}},{key:"collided",value:function(t){return this.pos.dist(t.pos)<this.r+t.r}},{key:"m",get:function(){return this.r*this.r*Math.PI}},{key:"am",get:function(){return this.amc*this.m*this.r*this.r}},{key:"copy",get:function(){var t=new r(this.pos.copy,this.vel.copy,this.r,this.k,this.ang,this.fc);return t.lastPos=this.lastPos.copy,t.rotation=this.rotation,t}}],[{key:"collide",value:function(t,e){if(t.collided(e)){var n=t.pos,a=e.pos,s=t.lastPos,i=e.lastPos,r=t.r,h=e.r,o=(t.k+e.k)/2,l=r*r,u=h*h,y=t.vel,g=e.vel,v=(R.sub(n,s),R.sub(a,i),R.dist(n,a)),c=(R.dist(s,i),(t.fc+e.fc)/2),x=n.copy,f=a.copy,p=r+h-v,d=R.sub(n,a);d.setMag(1),d.mult(p*u/(l+u)),x.add(d),d.setMag(1),d.mult(-p*l/(l+u)),f.add(d),t.pos=x,e.pos=f;var b=x.copy,m=f.copy,M=y.copy,w=R.angleACW(new R(y.x,y.y),new R(m.x-b.x,m.y-b.y));M.rotate(w),M.mult(Math.cos(w));var k=g.copy;w=R.angleACW(new R(g.x,g.y),new R(b.x-m.x,b.y-m.y)),k.rotate(w),k.mult(Math.cos(w));var P=y.copy;w=R.angleACW(new R(y.x,y.y),new R(m.x-b.x,m.y-b.y)),P.rotate(-HALF_PI+w),P.mult(Math.sin(w));var I=g.copy;w=R.angleACW(new R(g.x,g.y),new R(b.x-m.x,b.y-m.y)),I.rotate(-HALF_PI+w),I.mult(Math.sin(w));var C=R.mult(M,l);C.add(R.mult(k,u)),C.mult(1+o),C.div(l+u),C.sub(R.mult(M,o));var _=R.mult(M,l);_.add(R.mult(k,u)),_.mult(1+o),_.div(l+u),_.sub(R.mult(k,o));var A=R.dist(C,M),j=R.dist(_,k),W=new R(y.x,y.y),S=new R(g.x,g.y),B=new R(b.x-m.x,b.y-m.y).heading;W.rotate(-B+Math.PI/2),S.rotate(-B+Math.PI/2);var E=(l*(W.x+t.ang*r)+u*(S.x-e.ang*h))/(l+u),q=-A*c*Math.sign(W.x-t.ang*r-E);Math.abs(q)>Math.abs(W.x-t.ang*r-E)&&(q=-W.x+t.ang*r+E);var O=-j*c*Math.sign(S.x+e.ang*h-E);Math.abs(O)>Math.abs(S.x+e.ang*h-E)&&(O=-S.x-e.ang*h+E);var L=new R(q+t.r*t.r*t.m*q/(t.am+t.r*t.r*t.m),0),F=new R(O-e.r*e.r*e.m*O/(e.am+e.r*e.r*e.m),0);L.rotate(B-Math.PI/2),F.rotate(B-Math.PI/2),M=C,k=_,t.vel=R.add(M,P),e.vel=R.add(k,I),t.ang-=t.r*t.r*t.m*q/((t.am+t.r*t.r*t.m)*r),e.ang+=t.r*t.r*t.m*O/((e.am+e.r*e.r*e.m)*h),t.vel.x+=L.x,t.vel.y+=L.y,e.vel.x+=F.x,e.vel.y+=F.y,t.lastPos=x,e.lastPos=f}}}]),r}();e.exports=a},{"./vec2":7}],2:[function(t,e,n){var N=t("./vec2"),U=t("./linesegment"),a=function(){function g(t,e,n,a,s){_classCallCheck(this,g),this.points=t;var i=this.points,r=0,h=0,o=N.angleACW(N.sub(i[1],i[0]),N.sub(i[i.length-1],i[0]));r+=o,h+=2*Math.PI-o;for(var l=1;l<i.length-1;l++)r+=o=N.angleACW(N.sub(i[(l+1)%i.length],i[l]),N.sub(i[l-1],i[l])),h+=2*Math.PI-o;if(r+=o=N.angleACW(N.sub(i[0],i[i.length-1]),N.sub(i[i.length-2],i[i.length-1])),(h+=2*Math.PI-o)<r){for(var u=[],y=i.length-1;0<=y;y--)u.push(i[y]);this.points=u}this.calculatePosAndMass(),this.lastPos=this.pos.copy,this.fc=.4,this.rotation=0,this.ang=a||0,(s||0===s)&&(this.fc=s),this.k=n||.8,this.vel=null!=e?e.copy:new N(0,0),console.log(this)}return _createClass(g,[{key:"move",value:function(e,n){this.pos.x+=e,this.pos.y+=n,this.points.forEach(function(t){t.x+=e,t.y+=n})}},{key:"collideWithBall",value:function(y){var g=this,v=null,c=null,x=void 0;if(this.points.forEach(function(t,e){var n=new N(t.x,t.y);if(n.x-=y.pos.x,n.y-=y.pos.y,n.length<=y.r){v=n.heading+Math.PI,c=n.length;var a=N.fromAngle(v);a.mult(y.r-c),g.move(-1*a.x*y.m/(g.m+y.m),-1*a.y*y.m/(g.m+y.m)),y.move(1*a.x*g.m/(g.m+y.m),1*a.y*g.m/(g.m+y.m)),x=new N(t.x,t.y);var s=N.fromAngle(v);s.mult(-30),stroke("red"),line(x.x,x.y,x.x+s.x,x.y+s.y)}n=new N(t.x,t.y);var i=new N(g.points[(e+1)%g.points.length].x,g.points[(e+1)%g.points.length].y),r=new N(y.pos.x,y.pos.y),h=new N(i.x-n.x,i.y-n.y).heading;n.rotate(-h+Math.PI),i.rotate(-h+Math.PI),r.rotate(-h+Math.PI);var o=r.y-(n.y+i.y)/2;if(o>=-y.r&&o<=y.r&&r.x>=i.x&&r.x<=n.x){v=h-Math.PI/2,c=o;var l=N.fromAngle(v);l.mult(y.r-c),g.move(-1*l.x*y.m/(g.m+y.m),-1*l.y*y.m/(g.m+y.m)),y.move(1*l.x*g.m/(g.m+y.m),1*l.y*g.m/(g.m+y.m)),(x=y.pos.copy).add(N.mult(N.fromAngle(v+Math.PI),o));var u=N.fromAngle(v);u.mult(-30),stroke("red"),line(x.x,x.y,x.x+u.x,x.y+u.y)}}),0===v||v){var t=this.vel.copy,e=y.vel.copy,n=this.ang,a=y.ang,s=N.sub(x,this.pos),i=N.sub(x,y.pos),r=this.am,h=y.am,o=this.m,l=y.m,u=(this.k+y.k)/2,f=(this.fc+y.fc)/2,p=s.copy,d=i.copy;p.rotate(Math.PI/2),d.rotate(-Math.PI/2),p.mult(n),d.mult(a),p.add(t),d.add(e),p.rotate(-v),d.rotate(-v);var b=(1+u)*(o*p.x+l*d.x)/(o+l)-(u+1)*p.x,m=(1+u)*(o*p.x+l*d.x)/(o+l)-(u+1)*d.x,M=(p.y*o+d.y*l)/(o+l),w=-Math.sign(p.y)*f*b,k=-Math.sign(d.y)*f*m;Math.abs(M-p.y)>Math.abs(w)&&(w=M-p.y),Math.abs(M-d.y)>Math.abs(k)&&(k=M-d.y);var P=new N(b,w),I=new N(m,k);P.rotate(v),I.rotate(v),t.add(P),e.add(I),P.rotate(-s.heading),I.rotate(-i.heading);var C=P.y*o*s.length/(r+s.length*s.length*o),_=-I.y*l*i.length/(h+i.length*i.length*l);n+=C,a+=_;var A=N.fromAngle(s.heading-Math.PI/2);A.mult(s.length*C);var j=N.fromAngle(i.heading-Math.PI/2);j.mult(i.length*_),e.sub(j),t.add(A),this.vel=t,y.vel=e,this.ang=n,y.ang=a}}},{key:"calculatePosAndMass",value:function(){var e=[];if(e.push([]),this.points.forEach(function(t){e[0].push({x:t.x,y:t.y})}),this.isConcave){var i=function(t,e){for(var n=0;n<t.length;n++)if(t[n]===e)return!0;return!1},t=function(t,e,n){for(var a=0;a<e.length;a++)if(!i(n,a)){var s=new U(new N(e[a].x,e[a].y),new N(e[(a+1)%e.length].x,e[(a+1)%e.length].y));if(U.intersect(t,s))return!0}return!1},n=!0;t:for(;n;){n=!1;for(var a=0;a<e.length;a++){var s=e[a],r=N.sub(s[1],s[0]),h=N.sub(s[s.length-1],s[0]);if(N.angleACW(r,h)>Math.PI){n=!0;for(var o=2,l=new U(new N(s[0].x,s[0].y),new N(s[o%s.length].x,s[o%s.length].y)),u=new N(l.b.x-l.a.x,l.b.y-l.a.y).heading;!(r.heading>h.heading?u>r.heading&&u<2*Math.PI||0<u&&u<h.heading:u>r.heading&&u<h.heading)||t(new U(new N(s[0%s.length].x,s[0%s.length].y),new N(s[o%s.length].x,s[o%s.length].y)),s,[(s.length-1)%s.length,0%s.length,(o-1)%s.length,o%s.length]);)o++,l=new U(new N(s[0].x,s[0].y),new N(s[o%s.length].x,s[o%s.length].y)),u=new N(l.b.x-l.a.x,l.b.y-l.a.y).heading;for(var y=[],g=[],v=0;v<=o;v++)y.push(s[v%s.length]);for(var c=o;c<=0+s.length;c++)g.push(s[c%s.length]);e[a]=y,e.push(g);continue t}for(var x=1;x<s.length;x++){var f=N.sub(s[(x+1)%s.length],s[x]),p=N.sub(s[x-1],s[x]);if(N.angleACW(f,p)>Math.PI){n=!0;for(var d=x+2,b=new U(new N(s[x].x,s[x].y),new N(s[d%s.length].x,s[d%s.length].y)),m=new N(b.b.x-b.a.x,b.b.y-b.a.y).heading;!(f.heading>p.heading?m>f.heading&&m<2*Math.PI||0<m&&m<p.heading:m>f.heading&&m<p.heading)||t(b,s,[(x-1)%s.length,x%s.length,(d-1)%s.length,d%s.length]);)d++,b=new U(new N(s[x].x,s[x].y),new N(s[d%s.length].x,s[d%s.length].y)),m=new N(b.b.x-b.a.x,b.b.y-b.a.y).heading;for(var M=[],w=[],k=x;k<=d;k++)M.push(s[k%s.length]);for(var P=d;P<=x+s.length;P++)w.push(s[P%s.length]);e[a]=M,e.push(w);continue t}}}}}for(var I=e.length-1;0<=I;I--){var C=e[I];for(console.log(C);3<C.length;)e.push([C[0],C[1],C[2]]),C.splice(1,1)}var _=0,A=new N(0,0);e.forEach(function(t){var e=Math.sqrt(Math.pow(t[0].x-t[1].x,2)+Math.pow(t[0].y-t[1].y,2)),n=Math.sqrt(Math.pow(t[1].x-t[2].x,2)+Math.pow(t[1].y-t[2].y,2)),a=Math.sqrt(Math.pow(t[2].x-t[0].x,2)+Math.pow(t[2].y-t[0].y,2)),s=(e+n+a)/2,i=Math.sqrt(s*(s-e)*(s-n)*(s-a));_+=i,A.x+=i*(t[0].x+t[1].x+t[2].x)/3,A.y+=i*(t[0].y+t[1].y+t[2].y)/3}),A.div(_),this.pos=A,this.m=_,this.am=this.m*this.m*.4}},{key:"rotate",value:function(n){var a=this;this.points.forEach(function(t){var e=new N(t.x,t.y);e.sub(a.pos),e.rotate(n),e.add(a.pos),t.x=e.x,t.y=e.y}),this.rotation+=n}},{key:"isConcave",get:function(){var t=this.points,e=N.angleACW(N.sub(t[1],t[0]),N.sub(t[t.length-1],t[0]));if(e>Math.PI)return!0;for(var n=1;n<t.length-1;n++)if((e=N.angleACW(N.sub(t[(n+1)%t.length],t[n]),N.sub(t[n-1],t[n])))>Math.PI)return!0;return(e=N.angleACW(N.sub(t[0],t[t.length-1]),N.sub(t[t.length-2],t[t.length-1])))>Math.PI}}],[{key:"collide",value:function(n,i){var r=0,t=0,h=new N(0,0),o=[],l=!1;if(n.points.forEach(function(t,e){var s=new U(new N(t.x,t.y),new N(n.points[(e+1)%n.points.length].x,n.points[(e+1)%n.points.length].y));i.points.forEach(function(t,e){var n=new U(new N(t.x,t.y),new N(i.points[(e+1)%i.points.length].x,i.points[(e+1)%i.points.length].y)),a=U.intersect(s,n);if(a){r++,h.add(a),o.push(a),l=!0;N.sub(s.b,s.a),N.sub(n.b,n.a)}})}),l){h.div(r);for(var e=0;e<r/2;e++)t+=N.sub(o[2*e+1],o[2*e]).heading;t/=r/2,t+=Math.PI/2;var a=N.fromAngle(t);a.mult(-30),stroke("red"),line(h.x,h.y,h.x+a.x,h.y+a.y);var s=n.vel.copy,u=i.vel.copy,y=n.ang,g=i.ang,v=N.sub(h,n.pos),c=N.sub(h,i.pos),x=n.am,f=i.am,p=n.m,d=i.m,b=(n.k+i.k)/2,m=(n.fc+i.fc)/2,M=v.copy,w=c.copy;M.rotate(Math.PI/2),w.rotate(Math.PI/2),M.mult(y),w.mult(g);var k=M.copy,P=w.copy;M.add(s),w.add(u),M.rotate(-t),w.rotate(-t),s.rotate(-t),u.rotate(-t),k.rotate(-t),P.rotate(-t);var I=x/v.length/v.length,C=f/c.length/c.length,_=(1+b)*(I*k.x+C*P.x)/(I+C)-(b+1)*k.x,A=(1+b)*(I*k.x+C*P.x)/(I+C)-(b+1)*P.x,j=(x*k.y/v.length+f*P.y/c.length)/(x/v.length+f/c.length),W=(s.y*p+u.y*d)/(p+d);W=j+=W;var S=-Math.sign(k.y)*m*_,B=-Math.sign(P.y)*m*A;Math.abs(j-k.y)>Math.abs(S)&&(S=j-k.y),Math.abs(j-P.y)>Math.abs(B)&&(B=j-P.y);var E=(1+b)*(p*s.x+d*u.x)/(p+d)-(b+1)*s.x,q=(1+b)*(p*s.x+d*u.x)/(p+d)-(b+1)*u.x,O=-Math.sign(s.y)*m*E,L=-Math.sign(u.y)*m*q;Math.abs(W-s.y)>Math.abs(O)&&(O=W-s.y),Math.abs(W-u.y)>Math.abs(L)&&(L=W-u.y);var F=new N(E+_,O+S),R=new N(q+A,L+B);F.rotate(t),R.rotate(t),s.rotate(t),u.rotate(t),s.add(F),u.add(R),F.rotate(-v.heading),R.rotate(-c.heading);var H=F.y*p*v.length/(x+v.length*v.length*p),T=R.y*d*c.length/(f+c.length*c.length*d);y+=H,g+=T;var z=N.fromAngle(v.heading-Math.PI/2);z.mult(v.length*H);var D=N.fromAngle(c.heading-Math.PI/2);D.mult(c.length*T),u.sub(D),s.add(z),n.vel=s,i.vel=u,n.ang=y,i.ang=g}}}]),g}();e.exports=a},{"./linesegment":3,"./vec2":7}],3:[function(t,e,n){var p=t("./vec2"),a=function(){function n(t,e){_classCallCheck(this,n),this.a=t,this.b=e}return _createClass(n,[{key:"distFromPoint",value:function(t){var e=p.sub(this.a,this.b),n=p.sub(t,this.b),a=p.sub(t,this.a),s=n.length,i=a.length,r=e.length;if(0===r)return s;var h=p.angle(n,a),o=p.angle(n,e),l=Math.PI-h-o,u=2*(Math.sin(l)*i*r/2)/r;return l>Math.PI/2?i:o>Math.PI/2?s:u}},{key:"length",get:function(){return p.dist(this.a,this.b)}}],[{key:"intersect",value:function(t,e){var n=p.sub(t.b,t.a),a=n.y/n.x,s=t.b.y-t.b.x*a,i=p.sub(e.b,e.a),r=i.y/i.x,h=e.b.y-e.b.x*r;if(0===n.x&&0!==i.x){if(t.a.x>=e.a.x&&t.a.x<=e.b.x||t.a.x<=e.a.x&&t.a.x>=e.b.x){var o=r*t.a.x+h;if(o>t.a.y&&o<t.b.y||o<t.a.y&&o>t.b.y)return new p(t.a.x,o)}return!1}if(0===i.x&&0!==n.x){if(e.a.x>=t.a.x&&e.a.x<=t.b.x||e.a.x<=t.a.x&&e.a.x>=t.b.x){var l=a*e.a.x+s;if(l>e.a.y&&l<e.b.y||l<e.a.y&&l>e.b.y)return new p(e.a.x,l)}return!1}if(0===n.x&&0===i.x){if(t.a.x===e.a.x){var u=t.a.y<t.b.y?[t.a.y,t.b.y]:[t.b.y,t.a.y],y=e.a.y<e.b.y?[e.a.y,e.b.y]:[e.b.y,e.a.y],g=[y[0]<u[0]?u[0]:y[0],u[1]<y[1]?u[1]:y[1]];if(g[0]<=g[1])return new p(t.a.x,(g[0]+g[1])/2)}return!1}var v=t.a.x<t.b.x?[t.a.x,t.b.x]:[t.b.x,t.a.x],c=e.a.x<e.b.x?[e.a.x,e.b.x]:[e.b.x,e.a.x],x=[c[0]<v[0]?v[0]:c[0],v[1]<c[1]?v[1]:c[1]];if(a===r&&s===h&&x[0]<=x[1])return new p((x[0]+x[1])/2,(x[0]+x[1])/2*a+s);var f=(h-s)/(a-r);return x[0]<=f&&f<=x[1]&&new p(f,f*a+s)}}]),n}();e.exports=a},{"./vec2":7}],4:[function(t,e,n){var et=n.Ball=t("./ball"),nt=n.Body=t("./body"),at=n.Vec2=t("./vec2"),i=n.Wall=t("./wall"),a=n.LineSegment=t("./linesegment"),s=n.Spring=t("./spring"),r=n.Stick=t("./stick"),h=function(){function t(){_classCallCheck(this,t),this.balls=[],this.bodies=[],this.fixedBalls=[],this.walls=[],this.bounds=0,this.springs=[],this.gravity=null}return _createClass(t,[{key:"update",value:function(t){for(var e=0;e<this.balls.length;e++)this.balls[e].lastPos=this.balls[e].pos.copy,this.balls[e].pos.add(at.mult(this.balls[e].vel,t)),this.balls[e].rotation+=this.balls[e].ang*t,this.balls[e].rotation%=2*Math.PI;for(var n=0;n<this.bodies.length;n++)this.bodies[n].lastPos=this.bodies[n].pos.copy,this.bodies[n].move(this.bodies[n].vel.x*t,this.bodies[n].vel.y*t),this.bodies[n].rotate(this.bodies[n].ang*t);for(var a=0;a<this.springs.length;a++){var s=!0,i=!1,r=void 0;try{for(var h,o=this.springs[Symbol.iterator]();!(s=(h=o.next()).done);s=!0){h.value.update(t/this.springs.length/2)}}catch(t){i=!0,r=t}finally{try{!s&&o.return&&o.return()}finally{if(i)throw r}}}for(var l=0;l<this.balls.length;l++){this.gravity&&this.balls[l].vel.add(new at(this.gravity.x*t,this.gravity.y*t));for(var u=l+1;u<this.balls.length;u++)this.balls[l].group==this.balls[u].group&&(this.balls[l].group||this.balls[u].group)||et.collide(this.balls[l],this.balls[u]);var y=!0,g=!1,v=void 0;try{for(var c,x=this.walls[Symbol.iterator]();!(y=(c=x.next()).done);y=!0){c.value.collideWithBall(this.balls[l])}}catch(t){g=!0,v=t}finally{try{!y&&x.return&&x.return()}finally{if(g)throw v}}var f=!0,p=!1,d=void 0;try{for(var b,m=this.fixedBalls[Symbol.iterator]();!(f=(b=m.next()).done);f=!0){var M=b.value,w=this.balls[l],k=void 0,P=void 0,I=new at(M.x,M.y);if(I.x-=w.pos.x,I.y-=w.pos.y,I.mult(-1),I.length<=w.r+M.r&&(k=I.heading,P=I.length),0===k||k){var C=new at(w.pos.x,w.pos.y),_=new at(w.vel.x,w.vel.y);C.rotate(-k+Math.PI/2),_.rotate(-k+Math.PI/2),_.y*=-w.k,C.y+=w.r+M.r-P;var A=_.y*(1+1/w.k),j=Math.abs(A)*w.fc*Math.sign(_.x-w.ang*w.r)*-1;Math.abs(j)>Math.abs(_.x-w.ang*w.r)&&(j=-_.x+w.ang*w.r),_.x+=j-w.r*w.r*w.m*j/(w.am+w.r*w.r*w.m),w.ang-=w.r*w.r*w.m*j/((w.am+w.r*w.r*w.m)*w.r),C.rotate(k-Math.PI/2),_.rotate(k-Math.PI/2),w.pos.x=C.x,w.pos.y=C.y,w.vel.x=_.x,w.vel.y=_.y}}}catch(t){p=!0,d=t}finally{try{!f&&m.return&&m.return()}finally{if(p)throw d}}if(this.bounds){if(this.balls[l].pos.x-this.balls[l].r<this.bounds[0]){(w=this.balls[l]).vel.x*=-w.k,w.pos.x=this.bounds[1]+w.r;var W=w.vel.x*(1+1/w.k),S=Math.abs(W)*w.fc*Math.sign(w.vel.y+w.ang*w.r)*-1;Math.abs(S)>Math.abs(w.vel.y+w.ang*w.r)&&(S=-w.vel.y-w.ang*w.r),w.vel.y+=S-w.r*w.r*w.m*S/(w.am+w.r*w.r*w.m),w.ang+=w.r*w.r*w.m*S/((w.am+w.r*w.r*w.m)*w.r)}else if(this.balls[l].pos.x+this.balls[l].r>this.bounds[0]+this.bounds[2]){var B=this.balls[l];B.vel.x*=-B.k,B.pos.x=this.bounds[0]+this.bounds[2]-B.r;var E=B.vel.x*(1+1/B.k),q=Math.abs(E)*B.fc*Math.sign(B.vel.y-B.ang*B.r)*-1;Math.abs(q)>Math.abs(B.vel.y-B.ang*B.r)&&(q=-B.vel.y+B.ang*B.r),B.vel.y+=q+B.r*B.r*B.m*q/(B.am+B.r*B.r*B.m),B.ang-=B.r*B.r*B.m*q/((B.am+B.r*B.r*B.m)*B.r)}if(this.balls[l].pos.y+this.balls[l].r>this.bounds[1]+this.bounds[3]){var O=this.balls[l];O.vel.y*=-O.k,O.pos.y=this.bounds[1]+this.bounds[3]-O.r;var L=O.vel.y*(1+1/O.k),F=Math.abs(L)*O.fc*Math.sign(O.vel.x+O.ang*O.r)*-1;Math.abs(F)>Math.abs(O.vel.x+O.ang*O.r)&&(F=-O.vel.x-O.ang*O.r),O.vel.x+=F-O.r*O.r*O.m*F/(O.am+O.r*O.r*O.m),O.ang+=O.r*O.r*O.m*F/((O.am+O.r*O.r*O.m)*O.r)}else if(this.balls[l].pos.y-this.balls[l].r<this.bounds[1]){var R=this.balls[l];R.vel.y*=-R.k,R.pos.y=this.bounds[1]+R.r;var H=R.vel.y*(1+1/R.k),T=Math.abs(H)*R.fc*Math.sign(R.vel.x-R.ang*R.r)*-1;Math.abs(T)>Math.abs(R.vel.x-R.ang*R.r)&&(T=-R.vel.x+R.ang*R.r),R.vel.x+=T+R.r*R.r*R.m*T/(R.am+R.r*R.r*R.m),R.ang-=R.r*R.r*R.m*T/((R.am+R.r*R.r*R.m)*R.r)}}}for(var z=0;z<this.bodies.length;z++){var D=!0,N=!1,U=void 0;try{for(var V,G=this.balls[Symbol.iterator]();!(D=(V=G.next()).done);D=!0){var J=V.value;J.group==this.bodies[z].group&&(J.group||this.bodies[z].group)||this.bodies[z].collideWithBall(J)}}catch(t){N=!0,U=t}finally{try{!D&&G.return&&G.return()}finally{if(N)throw U}}for(var K=z+1;K<this.bodies.length;K++)this.bodies[z].group==this.bodies[K].group&&(this.bodies[K].group||this.bodies[z].group)||nt.collide(this.bodies[z],this.bodies[K]);this.gravity&&this.bodies[z].vel.add(new at(this.gravity.x*t,this.gravity.y*t))}for(var Q=0;Q<this.springs.length;Q++){var X=!0,Y=!1,Z=void 0;try{for(var $,tt=this.springs[Symbol.iterator]();!(X=($=tt.next()).done);X=!0){$.value.update(t/this.springs.length/2)}}catch(t){Y=!0,Z=t}finally{try{!X&&tt.return&&tt.return()}finally{if(Y)throw Z}}}}},{key:"setGravity",value:function(t){this.gravity=t.copy}},{key:"addBall",value:function(t){this.balls.push(t)}},{key:"addBody",value:function(t){this.bodies.push(t)}},{key:"addRectWall",value:function(t,e,n,a){var s=[];s.push({x:t-n/2,y:e-a/2}),s.push({x:t+n/2,y:e-a/2}),s.push({x:t+n/2,y:e+a/2}),s.push({x:t-n/2,y:e+a/2}),this.walls.push(new i(s))}},{key:"addWall",value:function(t){this.walls.push(t)}},{key:"addFixedBall",value:function(t,e,n){this.fixedBalls.push({x:t,y:e,r:n})}},{key:"addSpring",value:function(t){this.springs.push(t)}},{key:"setBounds",value:function(t,e,n,a){this.bounds=[t,e,n,a]}},{key:"addField",value:function(t){this.fields.push(t)}},{key:"getObjectAtCoordinates",value:function(t,e){var n=!1,a=new at(t,e);return this.balls.forEach(function(t){t.pos.dist(a)<t.r&&(n=t)}),n}}]),t}();(e.exports=h).Ball=et,h.Body=nt,h.Vec2=at,h.Wall=i,h.LineSegment=a,h.Spring=s,h.Stick=r},{"./ball":1,"./body":2,"./linesegment":3,"./spring":5,"./stick":6,"./vec2":7,"./wall":8}],5:[function(t,e,n){var m=t("./vec2"),a=function(){function n(t,e){_classCallCheck(this,n),this.length=t,this.springConstant=e,this.pinned=!1,this.objects=[],this.rotationLocked=!1}return _createClass(n,[{key:"pinHere",value:function(t,e){this.pinned={x:t,y:e}}},{key:"unpin",value:function(){this.pinned=!1}},{key:"attachObject",value:function(t){this.objects.push(t),2===this.objects.length&&(this.pinned=!1),3<=this.objects.length&&(this.objects=[this.objects[this.objects.length-2],this.objects[this.objects.length-1]])}},{key:"lockRotation",value:function(){this.rotationLocked=!0}},{key:"unlockRotation",value:function(){this.rotationLocked=!1}},{key:"update",value:function(t){var e=void 0,n=void 0;if(this.pinned&&this.objects[0]){n=this.pinned,e=this.objects[0];var a=new m(n.x-e.pos.x,n.y-e.pos.y),s=a.length-this.length;a.setMag(1),a.mult(s*this.springConstant*t/e.m),e.vel.x+=a.x,e.vel.y+=a.y;var i=e.vel;if(i.rotate(-a.heading),this.rotationLocked){var r=new m(n.x,n.y),h=m.sub(e.pos,r),o=h.length*h.length*e.m+e.am,l=(e.am*e.ang-h.length*e.m*i.y)/o;i.y=-l*h.length,e.ang=l}i.rotate(a.heading)}else if(this.objects[0]&&this.objects[1]){e=this.objects[0],n=this.objects[1];var u=m.sub(e.pos,n.pos),y=u.length-this.length;u.setMag(1),u.mult(y*this.springConstant*t),n.vel.add(m.div(u,n.m)),e.vel.add(m.div(u,-e.m)),u=m.sub(e.pos,n.pos);var g=e.vel,v=n.vel;if(g.rotate(-u.heading),v.rotate(-u.heading),this.rotationLocked){var c=new m(e.pos.x*e.m+n.pos.x*n.m,e.pos.y*e.m+n.pos.y*n.m);c.div(e.m+n.m);var x=m.sub(e.pos,c),f=m.sub(n.pos,c),p=x.length*x.length*e.m+e.am+f.length*f.length*n.m+n.am,d=(g.y-v.y)*f.length/(x.length+f.length)+v.y,b=(e.am*e.ang+n.am*n.ang-x.length*e.m*(g.y-d)+f.length*n.m*(v.y-d))/p;g.y=-b*x.length+d,v.y=+b*f.length+d,e.ang=b,n.ang=b}g.rotate(u.heading),v.rotate(u.heading)}}}]),n}();e.exports=a},{"./vec2":7}],6:[function(t,e,n){var a=t("./spring"),b=t("./vec2"),s=function(t){function n(t){_classCallCheck(this,n);var e=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.springConstant=0,e}return _inherits(n,a),_createClass(n,[{key:"update",value:function(t){var e=void 0,n=void 0;if(this.pinned&&this.objects[0]){n=this.pinned,e=this.objects[0];var a=new b(n.x-e.pos.x,n.y-e.pos.y);a.length,this.length;a.setMag(1),a.mult(-this.length),e.pos.x=n.x+a.x,e.pos.y=n.y+a.y;var s=e.vel;if(s.rotate(-a.heading),s.x=0,this.rotationLocked){var i=new b(n.x,n.y),r=b.sub(e.pos,i),h=r.length*r.length*e.m+e.am,o=(e.am*e.ang-r.length*e.m*s.y)/h;s.y=-o*r.length,e.ang=o}s.rotate(a.heading)}else if(this.objects[0]&&this.objects[1]){e=this.objects[0],n=this.objects[1];var l=b.sub(e.pos,n.pos),u=this.length-l.length;l.setMag(1),e.pos.add(b.mult(l,u*n.m/(e.m+n.m))),n.pos.add(b.mult(l,-u*e.m/(e.m+n.m)));var y=e.vel,g=n.vel;if(y.rotate(-l.heading),g.rotate(-l.heading),y.x=g.x=(e.m*y.x+n.m*g.x)/(e.m+n.m),this.rotationLocked){var v=new b(e.pos.x*e.m+n.pos.x*n.m,e.pos.y*e.m+n.pos.y*n.m);v.div(e.m+n.m);var c=b.sub(e.pos,v),x=b.sub(n.pos,v),f=c.length*c.length*e.m+e.am+x.length*x.length*n.m+n.am,p=(y.y-g.y)*x.length/(c.length+x.length)+g.y,d=(e.am*e.ang+n.am*n.ang-c.length*e.m*(y.y-p)+x.length*n.m*(g.y-p))/f;y.y=-d*c.length+p,g.y=+d*x.length+p,e.ang=d,n.ang=d}y.rotate(l.heading),g.rotate(l.heading)}}}]),n}();e.exports=s},{"./spring":5,"./vec2":7}],7:[function(t,e,n){var a=function(){function a(t,e){_classCallCheck(this,a),this.x=t,this.y=e}return _createClass(a,[{key:"add",value:function(t){this.x+=t.x,this.y+=t.y}},{key:"sub",value:function(t){this.x-=t.x,this.y-=t.y}},{key:"mult",value:function(t){this.x*=t,this.y*=t}},{key:"div",value:function(t){this.x/=t,this.y/=t}},{key:"lerp",value:function(t,e){this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e}},{key:"dist",value:function(t){return new a(this.x-t.x,this.y-t.y).length}},{key:"setMag",value:function(t){0!==this.length&&this.mult(t/this.length)}},{key:"rotate",value:function(t){var e=this.heading,n=a.fromAngle(t+e);n.mult(this.length),this.x=n.x,this.y=n.y}},{key:"copy",get:function(){return new a(this.x,this.y)}},{key:"length",get:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"sqlength",get:function(){return this.x*this.x+this.y*this.y}},{key:"heading",get:function(){if(0===this.x&&0===this.y)return 0;if(0===this.x)return 0<this.y?Math.PI/2:1.5*Math.PI;if(0===this.y)return 0<this.x?0:Math.PI;var t=a.normalized(this);return 0<this.x&&0<this.y?Math.asin(t.y):this.x<0&&0<this.y?Math.asin(-t.x)+Math.PI/2:this.x<0&&this.y<0?Math.asin(-t.y)+Math.PI:0<this.x&&this.y<0?Math.asin(t.x)+1.5*Math.PI:0}}],[{key:"add",value:function(t,e){return new a(t.x+e.x,t.y+e.y)}},{key:"sub",value:function(t,e){return new a(t.x-e.x,t.y-e.y)}},{key:"mult",value:function(t,e){return new a(t.x*e,t.y*e)}},{key:"div",value:function(t,e){return new a(t.x/e,t.y/e)}},{key:"fromAngle",value:function(t){return new a(Math.cos(t),Math.sin(t))}},{key:"lerp",value:function(t,e,n){return a.add(t,a.mult(a.sub(e,t),n))}},{key:"dist",value:function(t,e){return a.sub(t,e).length}},{key:"dot",value:function(t,e){return t.x*e.x+t.y*e.y}},{key:"angle",value:function(t,e){return Math.acos(a.dot(t,e)/Math.sqrt(t.sqlength*e.sqlength))}},{key:"angleACW",value:function(t,e){var n=t.heading,a=e.heading-n;return a<0?2*Math.PI+a:a}},{key:"normalized",value:function(t){var e=t.length;return 0===e?t:new a(t.x/e,t.y/e)}}]),a}();e.exports=a},{}],8:[function(t,e,n){var y=t("./vec2"),a=function(){function o(t){_classCallCheck(this,o),this.points=t;var e=this.points,n=0,a=0,s=y.angleACW(y.sub(e[1],e[0]),y.sub(e[e.length-1],e[0]));n+=s,a+=2*Math.PI-s;for(var i=1;i<e.length-1;i++)n+=s=y.angleACW(y.sub(e[(i+1)%e.length],e[i]),y.sub(e[i-1],e[i])),a+=2*Math.PI-s;if(!((n+=s=y.angleACW(y.sub(e[0],e[e.length-1]),y.sub(e[e.length-2],e[e.length-1])))<(a+=2*Math.PI-s))){for(var r=[],h=e.length-1;0<=h;h--)r.push(e[h]);this.points=r}}return _createClass(o,[{key:"collideWithBall",value:function(h){var o=this,l=null,u=null;if(this.points.forEach(function(t,e){var n=new y(t.x,t.y);n.x-=h.pos.x,n.y-=h.pos.y,n.mult(-1),n.length<=h.r&&(l=n.heading,u=n.length),n=new y(t.x,t.y);var a=new y(o.points[(e+1)%o.points.length].x,o.points[(e+1)%o.points.length].y),s=new y(h.pos.x,h.pos.y),i=new y(a.x-n.x,a.y-n.y).heading;n.rotate(-i+Math.PI),a.rotate(-i+Math.PI),s.rotate(-i+Math.PI);var r=s.y-(n.y+a.y)/2;r>=-h.r&&r<=h.r&&s.x>=a.x&&s.x<=n.x&&(l=i-Math.PI/2,u=r)}),0===l||l){var t=new y(h.pos.x,h.pos.y),e=new y(h.vel.x,h.vel.y);t.rotate(-l+Math.PI/2),e.rotate(-l+Math.PI/2),e.y*=-h.k,t.y+=h.r-u;var n=e.y*(1+1/h.k),a=Math.abs(n)*h.fc*Math.sign(e.x-h.ang*h.r)*-1;Math.abs(a)>Math.abs(e.x-h.ang*h.r)&&(a=-e.x+h.ang*h.r),e.x+=a-h.r*h.r*h.m*a/(h.am+h.r*h.r*h.m),h.ang-=h.r*h.r*h.m*a/((h.am+h.r*h.r*h.m)*h.r),t.rotate(l-Math.PI/2),e.rotate(l-Math.PI/2),h.pos.x=t.x,h.pos.y=t.y,h.vel.x=e.x,h.vel.y=e.y}}}]),o}();e.exports=a},{"./vec2":7}]},{},[4])(4)});
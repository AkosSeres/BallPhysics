/*! ballphysics 10-07-2019 */

"use strict";var _createClass=function(){function n(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,a){return e&&n(t.prototype,e),a&&n(t,a),t}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,a=Array(t.length);e<t.length;e++)a[e]=t[e];return a}return Array.from(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}!function(t){if("object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).BallPhysics=t()}}(function(){return function s(i,o,r){function h(e,t){if(!o[e]){if(!i[e]){var a="function"==typeof require&&require;if(!t&&a)return a(e,!0);if(u)return u(e,!0);var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}var l=o[e]={exports:{}};i[e][0].call(l.exports,function(t){return h(i[e][1][t]||t)},l,l.exports,s,i,o,r)}return o[e].exports}for(var u="function"==typeof require&&require,t=0;t<r.length;t++)h(r[t]);return h}({1:[function(t,e,a){Object.defineProperty(a,"__esModule",{value:!0});var S=t("./vec2"),n=function(){function i(t,e,a,n,l,s){_classCallCheck(this,i),this.pos=t.copy,this.lastPos=this.pos.copy,this.r=a,this.fc=.4,this.amc=.4,this.rotation=0,this.ang=l||0,(s||0===s)&&(this.fc=s),this.k=n||.8,this.vel=null!=e?e.copy:new S.default(0,0),this.id="_"+Math.random().toString(36).substr(2,9)}return _createClass(i,[{key:"move",value:function(t,e){this.pos.x+=t,this.pos.y+=e}},{key:"collided",value:function(t){return this.pos.dist(t.pos)<this.r+t.r}},{key:"m",get:function(){return this.r*this.r*Math.PI}},{key:"am",get:function(){return this.amc*this.r*this.r*this.m}},{key:"copy",get:function(){var t=new i(this.pos.copy,this.vel.copy,this.r,this.k,this.ang,this.fc);return t.lastPos=this.lastPos.copy,t.rotation=this.rotation,t}}],[{key:"collide",value:function(t,e){if(t.collided(e)){var a=t.pos,n=e.pos,l=t.r,s=e.r,i=(t.k+e.k)/2,o=t.m,r=e.m,h=S.default.dist(a,n),u=(t.fc+e.fc)/2,f=a.copy,d=n.copy,y=l+s-h,c=S.default.sub(a,n);if(c.setMag(1),c.mult(y*r/(o+r)),f.add(c),c.setMag(1),c.mult(-y*o/(o+r)),d.add(c),t.pos=f,e.pos=d,!(S.default.dot(c,S.default.sub(t.vel,e.vel))<0)){c.setMag(1);var v=S.default.cross(c,t.vel),g=S.default.cross(c,e.vel),p=S.default.dot(c,t.vel),b=S.default.dot(c,e.vel),x=v-l*t.ang,m=g+s*e.ang,w=(x*t.am+m*e.am)/(t.am+e.am),M=w-x,k=w-m,P=M/l,C=k/s,I=(1+i)*((o*p+r*b)/(o+r))-i*p,_=(1+i)*((o*p+r*b)/(o+r))-i*b;t.vel=S.default.mult(c,I),e.vel=S.default.mult(c,_);var j=I-p,O=_-b,A=-Math.sign(M)*(j*u)/(t.amc*l),q=Math.sign(k)*(O*u)/(e.amc*s);1<A/P&&(A=P),1<q/C&&(q=C),A*=t.amc/(t.amc+1),q*=e.amc/(e.amc+1),t.ang-=A,e.ang+=q;var B=v+A*l,E=g+q*s;c.rotate(Math.PI/2),t.vel.add(S.default.mult(c,B)),e.vel.add(S.default.mult(c,E))}}}}]),i}();a.default=n},{"./vec2":8}],2:[function(t,e,a){Object.defineProperty(a,"__esModule",{value:!0});var V=t("./vec2"),J=t("./linesegment"),n=function(){function d(t,e,a,n,l){_classCallCheck(this,d),this.points=t;var s=this.points,i=0,o=0,r=V.default.angleACW(V.default.sub(s[1],s[0]),V.default.sub(s[s.length-1],s[0]));i+=r,o+=2*Math.PI-r;for(var h=1;h<s.length-1;h++)i+=r=V.default.angleACW(V.default.sub(s[(h+1)%s.length],s[h]),V.default.sub(s[h-1],s[h])),o+=2*Math.PI-r;if(i+=r=V.default.angleACW(V.default.sub(s[0],s[s.length-1]),V.default.sub(s[s.length-2],s[s.length-1])),(o+=2*Math.PI-r)<i){for(var u=[],f=s.length-1;0<=f;f--)u.push(s[f]);this.points=u}this.calculatePosAndMass(),this.lastPos=this.pos.copy,this.fc=.4,this.rotation=0,this.ang=n||0,(l||0===l)&&(this.fc=l),this.k=a||.8,this.vel=null!=e?e.copy:new V.default(0,0),this.id="_"+Math.random().toString(36).substr(2,9)}return _createClass(d,[{key:"move",value:function(e,a){this.pos.x+=e,this.pos.y+=a,this.points.forEach(function(t){t.x+=e,t.y+=a})}},{key:"collideWithBall",value:function(h){var u=this,f=void 0,d=void 0,y=void 0;if(this.points.forEach(function(t,e){var a=new V.default(t.x,t.y);if(a.x-=h.pos.x,a.y-=h.pos.y,a.length<=h.r){f=a.heading+Math.PI,d=a.length;var n=V.default.fromAngle(f);n.mult(h.r-d),u.move(-1*n.x*h.m/(u.m+h.m),-1*n.y*h.m/(u.m+h.m)),h.move(1*n.x*u.m/(u.m+h.m),1*n.y*u.m/(u.m+h.m)),y=new V.default(t.x,t.y),V.default.fromAngle(f).mult(-30)}a=new V.default(t.x,t.y);var l=new V.default(u.points[(e+1)%u.points.length].x,u.points[(e+1)%u.points.length].y),s=new V.default(h.pos.x,h.pos.y),i=new V.default(l.x-a.x,l.y-a.y).heading;a.rotate(-i+Math.PI),l.rotate(-i+Math.PI),s.rotate(-i+Math.PI);var o=s.y-(a.y+l.y)/2;if(o>=-h.r&&o<=h.r&&s.x>=l.x&&s.x<=a.x){f=i-Math.PI/2,d=o;var r=V.default.fromAngle(f);r.mult(h.r-d),u.move(-1*r.x*h.m/(u.m+h.m),-1*r.y*h.m/(u.m+h.m)),h.move(1*r.x*u.m/(u.m+h.m),1*r.y*u.m/(u.m+h.m)),(y=h.pos.copy).add(V.default.mult(V.default.fromAngle(f+Math.PI),o)),V.default.fromAngle(f).mult(-30)}}),0===f||f){var t=this.vel.copy,e=h.vel.copy,a=this.ang,n=h.ang,l=V.default.sub(y,this.pos),s=V.default.sub(y,h.pos),i=this.am,o=h.am,r=this.m,c=h.m,v=(this.k+h.k)/2,g=(this.fc+h.fc)/2,p=l.copy,b=s.copy;p.rotate(Math.PI/2),b.rotate(-Math.PI/2),p.mult(a),b.mult(n),p.add(t),b.add(e),p.rotate(-f),b.rotate(-f);var x=(1+v)*(r*p.x+c*b.x)/(r+c)-(v+1)*p.x,m=(1+v)*(r*p.x+c*b.x)/(r+c)-(v+1)*b.x,w=(p.y*r+b.y*c)/(r+c),M=-Math.sign(p.y)*g*x,k=-Math.sign(b.y)*g*m;Math.abs(w-p.y)>Math.abs(M)&&(M=w-p.y),Math.abs(w-b.y)>Math.abs(k)&&(k=w-b.y);var P=new V.default(x,M),C=new V.default(m,k);P.rotate(f),C.rotate(f),t.add(P),e.add(C),P.rotate(-l.heading),C.rotate(-s.heading);var I=P.y*r*l.length/(i+l.length*l.length*r),_=-C.y*c*s.length/(o+s.length*s.length*c);a+=I,n+=_;var j=V.default.fromAngle(l.heading-Math.PI/2);j.mult(l.length*I);var O=V.default.fromAngle(s.heading-Math.PI/2);O.mult(s.length*_),e.sub(O),t.add(j),this.vel=t,h.vel=e,this.ang=a,h.ang=n}}},{key:"calculatePosAndMass",value:function(){var e=[];if(e.push([]),this.points.forEach(function(t){e[0].push(new V.default(t.x,t.y))}),this.isConcave){var s=function(t,e){for(var a=0;a<t.length;a++)if(t[a]===e)return!0;return!1},t=function(t,e,a){for(var n=0;n<e.length;n++)if(!s(a,n)){var l=new J.default(new V.default(e[n].x,e[n].y),new V.default(e[(n+1)%e.length].x,e[(n+1)%e.length].y));if(J.default.intersect(t,l))return!0}return!1},a=!0;t:for(;a;){a=!1;for(var n=0;n<e.length;n++){var l=e[n],i=V.default.sub(l[1],l[0]),o=V.default.sub(l[l.length-1],l[0]);if(V.default.angleACW(i,o)>Math.PI){a=!0;for(var r=2,h=new J.default(new V.default(l[0].x,l[0].y),new V.default(l[r%l.length].x,l[r%l.length].y)),u=new V.default(h.b.x-h.a.x,h.b.y-h.a.y).heading;!(i.heading>o.heading?u>i.heading&&u<2*Math.PI||0<u&&u<o.heading:u>i.heading&&u<o.heading)||t(new J.default(new V.default(l[0%l.length].x,l[0%l.length].y),new V.default(l[r%l.length].x,l[r%l.length].y)),l,[(l.length-1)%l.length,0%l.length,(r-1)%l.length,r%l.length]);)r++,h=new J.default(new V.default(l[0].x,l[0].y),new V.default(l[r%l.length].x,l[r%l.length].y)),u=new V.default(h.b.x-h.a.x,h.b.y-h.a.y).heading;for(var f=[],d=[],y=0;y<=r;y++)f.push(l[y%l.length]);for(var c=r;c<=0+l.length;c++)d.push(l[c%l.length]);e[n]=f,e.push(d);continue t}for(var v=1;v<l.length;v++){var g=V.default.sub(l[(v+1)%l.length],l[v]),p=V.default.sub(l[v-1],l[v]);if(V.default.angleACW(g,p)>Math.PI){a=!0;for(var b=v+2,x=new J.default(new V.default(l[v].x,l[v].y),new V.default(l[b%l.length].x,l[b%l.length].y)),m=new V.default(x.b.x-x.a.x,x.b.y-x.a.y).heading;!(g.heading>p.heading?m>g.heading&&m<2*Math.PI||0<m&&m<p.heading:m>g.heading&&m<p.heading)||t(x,l,[(v-1)%l.length,v%l.length,(b-1)%l.length,b%l.length]);)b++,x=new J.default(new V.default(l[v].x,l[v].y),new V.default(l[b%l.length].x,l[b%l.length].y)),m=new V.default(x.b.x-x.a.x,x.b.y-x.a.y).heading;for(var w=[],M=[],k=v;k<=b;k++)w.push(l[k%l.length]);for(var P=b;P<=v+l.length;P++)M.push(l[P%l.length]);e[n]=w,e.push(M);continue t}}}}}for(var C=e.length-1;0<=C;C--)for(var I=e[C];3<I.length;)e.push([I[0],I[1],I[2]]),I.splice(1,1);var _=0,j=0,O=new V.default(0,0);e.forEach(function(t){var e=Math.sqrt(Math.pow(t[0].x-t[1].x,2)+Math.pow(t[0].y-t[1].y,2)),a=Math.sqrt(Math.pow(t[1].x-t[2].x,2)+Math.pow(t[1].y-t[2].y,2)),n=Math.sqrt(Math.pow(t[2].x-t[0].x,2)+Math.pow(t[2].y-t[0].y,2)),l=(e+a+n)/2,s=Math.sqrt(l*(l-e)*(l-a)*(l-n));_+=s,O.x+=s*(t[0].x+t[1].x+t[2].x)/3,O.y+=s*(t[0].y+t[1].y+t[2].y)/3}),O.div(_),this.pos=O,this.m=_;var A=!0,q=!1,B=void 0;try{for(var E,S=e[Symbol.iterator]();!(A=(E=S.next()).done);A=!0){var W=E.value,F=Math.sqrt(Math.pow(W[0].x-W[1].x,2)+Math.pow(W[0].y-W[1].y,2)),L=Math.sqrt(Math.pow(W[1].x-W[2].x,2)+Math.pow(W[1].y-W[2].y,2)),R=Math.sqrt(Math.pow(W[2].x-W[0].x,2)+Math.pow(W[2].y-W[0].y,2)),D=Math.max(F,L,R),T=(F+L+R)/2,z=Math.sqrt(T*(T-F)*(T-L)*(T-R)),N=2*z/D,U=Math.sqrt(Math.pow(Math.min(F,R,L),2)-N*N),G=N*D*(N*N+D*D)/24,H=Math.sqrt(N*N/36+Math.pow(Math.abs(U-D/2)/3,2));G-=H*H*z,j+=G+=Math.pow(new V.default((W[0].x+W[1].x+W[2].x)/3,(W[0].y+W[1].y+W[2].y)/3).dist(this.pos),2)*z}}catch(t){q=!0,B=t}finally{try{!A&&S.return&&S.return()}finally{if(q)throw B}}this.am=j}},{key:"rotate",value:function(a){var n=this;this.points.forEach(function(t){var e=new V.default(t.x,t.y);e.sub(n.pos),e.rotate(a),e.add(n.pos),t.x=e.x,t.y=e.y}),this.rotation+=a}},{key:"copy",get:function(){for(var t=[],e=0;e<this.points.length;e++)t.push(new V.default(this.points[e].x,this.points[e].y));var a=new d(t,this.vel.copy,this.k,this.ang,this.fc);return a.rotation=this.rotation,a.lastPos=this.lastPos.copy,a.pos=this.pos.copy,a}},{key:"isConcave",get:function(){var t=this.points,e=V.default.angleACW(V.default.sub(t[1],t[0]),V.default.sub(t[t.length-1],t[0]));if(e>Math.PI)return!0;for(var a=1;a<t.length-1;a++)if((e=V.default.angleACW(V.default.sub(t[(a+1)%t.length],t[a]),V.default.sub(t[a-1],t[a])))>Math.PI)return!0;return(e=V.default.angleACW(V.default.sub(t[0],t[t.length-1]),V.default.sub(t[t.length-2],t[t.length-1])))>Math.PI}}],[{key:"collide",value:function(a,s){var i=0,t=0,o=new V.default(0,0),r=[],h=!1;if(a.points.forEach(function(t,e){var l=new J.default(new V.default(t.x,t.y),new V.default(a.points[(e+1)%a.points.length].x,a.points[(e+1)%a.points.length].y));s.points.forEach(function(t,e){var a=new J.default(new V.default(t.x,t.y),new V.default(s.points[(e+1)%s.points.length].x,s.points[(e+1)%s.points.length].y)),n=J.default.intersect(l,a);n&&(i++,o.add(n),r.push(n),h=!0)})}),h){o.div(i);for(var e=0;e<Math.floor(i/2);e++)t+=V.default.sub(r[2*e+1],r[2*e]).heading;t/=i/2,t+=Math.PI/2;var n=V.default.fromAngle(t),l=0,u=0,f=0,d=0,y=!0,c=!1,v=void 0;try{for(var g,p=a.points[Symbol.iterator]();!(y=(g=p.next()).done);y=!0){var b=g.value;l=Math.min(V.default.dot(n,V.default.sub(new V.default(b.x,b.y),o)),l),u=Math.max(V.default.dot(n,V.default.sub(new V.default(b.x,b.y),o)),u)}}catch(t){c=!0,v=t}finally{try{!y&&p.return&&p.return()}finally{if(c)throw v}}var x=!0,m=!1,w=void 0;try{for(var M,k=s.points[Symbol.iterator]();!(x=(M=k.next()).done);x=!0){var P=M.value;f=Math.min(V.default.dot(n,V.default.sub(new V.default(P.x,P.y),o)),f),d=Math.max(V.default.dot(n,V.default.sub(new V.default(P.x,P.y),o)),d)}}catch(t){m=!0,w=t}finally{try{!x&&k.return&&k.return()}finally{if(m)throw w}}Math.abs(l-d)<Math.abs(f-u)?(a.move(-n.x*l,-n.y*l),s.move(-n.x*d,-n.y*d)):(a.move(-n.x*u,-n.y*u),s.move(-n.x*f,-n.y*f));var C=(a.k+s.k)/2,I=V.default.dot(a.vel,n),_=V.default.dot(s.vel,n),j=(1+C)*(a.m*I+s.m*_)/(a.m+s.m)-C*I,O=(1+C)*(a.m*I+s.m*_)/(a.m+s.m)-C*_;a.vel.add(V.default.mult(n.copy,j-I)),s.vel.add(V.default.mult(n.copy,O-_))}}}]),d}();a.default=n},{"./linesegment":3,"./vec2":8}],3:[function(t,e,a){Object.defineProperty(a,"__esModule",{value:!0});var p=t("./vec2"),n=function(){function a(t,e){_classCallCheck(this,a),this.a=t,this.b=e}return _createClass(a,[{key:"distFromPoint",value:function(t){var e=p.default.sub(this.a,this.b),a=p.default.sub(t,this.b),n=p.default.sub(t,this.a),l=a.length,s=n.length,i=e.length;if(0===i)return l;var o=p.default.angle(a,n),r=p.default.angle(a,e),h=Math.PI-o-r,u=2*(Math.sin(h)*s*i/2)/i;return h>Math.PI/2?s:r>Math.PI/2?l:u}},{key:"length",get:function(){return p.default.dist(this.a,this.b)}}],[{key:"intersect",value:function(t,e){var a=p.default.sub(t.b,t.a),n=a.y/a.x,l=t.b.y-t.b.x*n,s=p.default.sub(e.b,e.a),i=s.y/s.x,o=e.b.y-e.b.x*i;if(0!==a.x||0===s.x){if(0!==s.x||0===a.x){if(0!==a.x||0!==s.x){var r=void 0;r=t.a.x<t.b.x?[t.a.x,t.b.x]:[t.b.x,t.a.x];var h=void 0;h=e.a.x<e.b.x?[e.a.x,e.b.x]:[e.b.x,e.a.x];var u=[r[0]>h[0]?r[0]:h[0],r[1]<h[1]?r[1]:h[1]];if(n===i&&l===o&&u[0]<=u[1])return new p.default((u[0]+u[1])/2,(u[0]+u[1])/2*n+l);var f=(o-l)/(n-i);return u[0]<=f&&f<=u[1]?new p.default(f,f*n+l):void 0}if(t.a.x===e.a.x){var d=void 0;d=t.a.y<t.b.y?[t.a.y,t.b.y]:[t.b.y,t.a.y];var y=void 0;y=e.a.y<e.b.y?[e.a.y,e.b.y]:[e.b.y,e.a.y];var c=[d[0]>y[0]?d[0]:y[0],d[1]<y[1]?d[1]:y[1]];if(c[0]<=c[1])return new p.default(t.a.x,(c[0]+c[1])/2)}}else if(e.a.x>=t.a.x&&e.a.x<=t.b.x||e.a.x<=t.a.x&&e.a.x>=t.b.x){var v=n*e.a.x+l;if(v>e.a.y&&v<e.b.y||v<e.a.y&&v>e.b.y)return new p.default(e.a.x,v)}}else if(t.a.x>=e.a.x&&t.a.x<=e.b.x||t.a.x<=e.a.x&&t.a.x>=e.b.x){var g=i*t.a.x+o;if(g>t.a.y&&g<t.b.y||g<t.a.y&&g>t.b.y)return new p.default(t.a.x,g)}}}]),a}();a.default=n},{"./vec2":8}],4:[function(t,e,a){Object.defineProperty(a,"__esModule",{value:!0});var et=t("./vec2");a.Vec2=et.default;var at=t("./ball");a.Ball=at.default;var s=t("./wall");a.Wall=s.default;var n=t("./linesegment");a.LineSegment=n.default;var i=t("./stick");a.Stick=i.default;var h=t("./spring");a.Spring=h.default;var nt=t("./softball");a.SoftBall=nt.default;var lt=t("./body");a.Body=lt.default;var l=function(){function tt(){_classCallCheck(this,tt),this.balls=[],this.bodies=[],this.fixedBalls=[],this.softBalls=[],this.walls=[],this.bounds=[],this.springs=[],this.airFriction=1,this.gravity=new et.default(0,0)}return _createClass(tt,[{key:"update",value:function(e,t){var a=this,n=t?this.copy:new tt;t&&(n.bodies.reverse(),n.balls.reverse(),n.update(e,!1));for(var l=0;l<this.balls.length;l++)this.balls[l].lastPos=this.balls[l].pos.copy,this.balls[l].pos.add(et.default.mult(this.balls[l].vel,e)),this.balls[l].rotation+=this.balls[l].ang*e,this.balls[l].rotation%=2*Math.PI;for(var s=0;s<this.bodies.length;s++)this.bodies[s].lastPos=this.bodies[s].pos.copy,this.bodies[s].move(this.bodies[s].vel.x*e,this.bodies[s].vel.y*e),this.bodies[s].rotate(this.bodies[s].ang*e);for(var i=0;i<3;i++){var o=!0,r=!1,h=void 0;try{for(var u,f=this.springs[Symbol.iterator]();!(o=(u=f.next()).done);o=!0){u.value.update(e/3/2)}}catch(t){r=!0,h=t}finally{try{!o&&f.return&&f.return()}finally{if(r)throw h}}}for(var d=0;d<this.balls.length;d++){this.gravity&&this.balls[d].vel.add(new et.default(this.gravity.x*e,this.gravity.y*e));for(var y=d+1;y<this.balls.length;y++)this.balls[d].layer==this.balls[y].layer&&(this.balls[d].layer||this.balls[y].layer)||at.default.collide(this.balls[d],this.balls[y]);var c=!0,v=!1,g=void 0;try{for(var p,b=this.walls[Symbol.iterator]();!(c=(p=b.next()).done);c=!0){p.value.collideWithBall(this.balls[d])}}catch(t){v=!0,g=t}finally{try{!c&&b.return&&b.return()}finally{if(v)throw g}}var x=!0,m=!1,w=void 0;try{for(var M,k=this.fixedBalls[Symbol.iterator]();!(x=(M=k.next()).done);x=!0){var P=M.value,C=this.balls[d],I=void 0,_=0,j=new et.default(P.x,P.y);j.x-=C.pos.x,j.y-=C.pos.y,j.mult(-1),j.length<=C.r+P.r&&(I=j.heading,_=j.length);t:if(0===I||I){var O=new et.default(C.pos.x,C.pos.y),A=new et.default(C.vel.x,C.vel.y);if(O.rotate(-I+Math.PI/2),A.rotate(-I+Math.PI/2),0<A.y)break t;A.y*=-C.k,O.y+=C.r+P.r-_;var q=A.y*(1+1/C.k),B=Math.sign(A.x-C.ang*C.r)*(q*C.fc)/(C.amc*C.r),E=(A.x-C.ang*C.r)/C.r;1<B/E&&(B=E),B*=C.amc/(C.amc+1),C.ang+=B;var S=B*C.r;A.x-=S,O.rotate(I-Math.PI/2),A.rotate(I-Math.PI/2),C.pos.x=O.x,C.pos.y=O.y,C.vel.x=A.x,C.vel.y=A.y}}}catch(t){m=!0,w=t}finally{try{!x&&k.return&&k.return()}finally{if(m)throw w}}var W=!0,F=!1,L=void 0;try{for(var R,D=this.bounds[Symbol.iterator]();!(W=(R=D.next()).done);W=!0){R.value.collideWithBall(this.balls[d])}}catch(t){F=!0,L=t}finally{try{!W&&D.return&&D.return()}finally{if(F)throw L}}}for(var T=0;T<this.bodies.length;T++){var z=!0,N=!1,U=void 0;try{for(var G,H=this.balls[Symbol.iterator]();!(z=(G=H.next()).done);z=!0){var V=G.value;V.layer==this.bodies[T].layer&&(V.layer||this.bodies[T].layer)||this.bodies[T].collideWithBall(V)}}catch(t){N=!0,U=t}finally{try{!z&&H.return&&H.return()}finally{if(N)throw U}}for(var J=T+1;J<this.bodies.length;J++)this.bodies[T].layer==this.bodies[J].layer&&(this.bodies[J].layer||this.bodies[T].layer)||lt.default.collide(this.bodies[T],this.bodies[J]);this.gravity&&this.bodies[T].vel.add(new et.default(this.gravity.x*e,this.gravity.y*e))}this.softBalls.forEach(function(t){nt.default.updatePressureBasedForces(t,e)});for(var K=0;K<3;K++){var Q=!0,X=!1,Y=void 0;try{for(var Z,$=this.springs[Symbol.iterator]();!(Q=(Z=$.next()).done);Q=!0){Z.value.update(e/3/2)}}catch(t){X=!0,Y=t}finally{try{!Q&&$.return&&$.return()}finally{if(X)throw Y}}}this.balls.forEach(function(t){t.vel.mult(Math.pow(a.airFriction,e)),t.ang*=Math.pow(a.airFriction,e)}),this.bodies.forEach(function(t){t.vel.mult(Math.pow(a.airFriction,e)),t.ang*=Math.pow(a.airFriction,e)}),t&&(n.bodies.reverse(),n.balls.reverse(),this.balls.forEach(function(t,e){t.move(.5*(n.balls[e].pos.x-t.pos.x),.5*(n.balls[e].pos.y-t.pos.y)),t.vel.add(new et.default(.5*(n.balls[e].vel.x-t.vel.x),.5*(n.balls[e].vel.y-t.vel.y))),t.rotation=(t.rotation+n.balls[e].rotation)/2,t.ang=(t.ang+n.balls[e].ang)/2}),this.bodies.forEach(function(t,e){var a=n.bodies[e];t.move(.5*(a.pos.x-t.pos.x),.5*(a.pos.y-t.pos.y)),t.vel.add(new et.default(.5*(a.vel.x-t.vel.x),.5*(a.vel.y-t.vel.y))),t.rotate((a.rotation-t.rotation)/2),t.ang=(t.ang+a.ang)/2}))}},{key:"setAirFriction",value:function(t){isFinite(t)&&(this.airFriction=t,this.airFriction<0&&(this.airFriction=0),1<this.airFriction&&(this.airFriction=1))}},{key:"setGravity",value:function(t){this.gravity=t.copy}},{key:"addBall",value:function(t){this.balls.push(t)}},{key:"addBody",value:function(t){this.bodies.push(t)}},{key:"addSoftBall",value:function(t){var e,a;(e=this.balls).push.apply(e,_toConsumableArray(t.points)),(a=this.springs).push.apply(a,_toConsumableArray(t.sides)),this.softBalls.push(t)}},{key:"addSoftSquare",value:function(t,e,a,n){var l,s,i=new nt.default(t,Math.sqrt(e*e/Math.PI),1,a,24);i.sides.forEach(function(t){t.length=3.84*e/i.resolution}),i.points.forEach(function(t){t.vel=n.copy}),(l=this.balls).push.apply(l,_toConsumableArray(i.points)),(s=this.springs).push.apply(s,_toConsumableArray(i.sides));var o=e*e*200,r=new h.default(Math.sqrt(i.r*i.r*Math.PI),o/2);r.attachObject(i.points[0]),r.attachObject(i.points[i.resolution/2]),this.springs.push(r),(r=new h.default(Math.sqrt(i.r*i.r*Math.PI),o/2)).attachObject(i.points[i.resolution/4]),r.attachObject(i.points[3*i.resolution/4]),this.springs.push(r),(r=new h.default(Math.sqrt(2*i.r*i.r*Math.PI),o)).attachObject(i.points[i.resolution/8]),r.attachObject(i.points[5*i.resolution/8]),this.springs.push(r),(r=new h.default(Math.sqrt(2*i.r*i.r*Math.PI),o)).attachObject(i.points[3*i.resolution/8]),r.attachObject(i.points[7*i.resolution/8]),this.springs.push(r)}},{key:"addRectWall",value:function(t,e,a,n){var l=[];l.push(new et.default(t-a/2,e-n/2)),l.push(new et.default(t+a/2,e-n/2)),l.push(new et.default(t+a/2,e+n/2)),l.push(new et.default(t-a/2,e+n/2)),this.walls.push(new s.default(l))}},{key:"addRectBody",value:function(t,e,a,n,l,s){var i=[];i.push(new et.default(t-a/2,e-n/2)),i.push(new et.default(t+a/2,e-n/2)),i.push(new et.default(t+a/2,e+n/2)),i.push(new et.default(t-a/2,e+n/2)),this.bodies.push(new lt.default(i,new et.default(0,0),.5,0,.3))}},{key:"addWall",value:function(t){this.walls.push(t)}},{key:"addFixedBall",value:function(t,e,a){this.fixedBalls.push({x:t,y:e,r:a})}},{key:"addSpring",value:function(t){this.springs.push(t)}},{key:"setBounds",value:function(t,e,a,n){this.bounds=[];var l=function(t,e,a,n){var l=[];return l.push(new et.default(t-a/2,e-n/2)),l.push(new et.default(t+a/2,e-n/2)),l.push(new et.default(t+a/2,e+n/2)),l.push(new et.default(t-a/2,e+n/2)),new s.default(l)};this.bounds.push(l(t-a,e,2*a,2*n)),this.bounds.push(l(t+2*a,e,2*a,2*n)),this.bounds.push(l(t,e-n,2*a,2*n)),this.bounds.push(l(t,e+2*n,2*a,2*n))}},{key:"getObjectAtCoordinates",value:function(t,e){var a=void 0,n=new et.default(t,e);return this.balls.forEach(function(t){t.pos.dist(n)<t.r&&(a=t)}),a}},{key:"getCopyOfBalls",value:function(){var e=[];return this.balls.forEach(function(t){e.push(t.copy)}),e}},{key:"getCopyOfBodies",value:function(){var e=[];return this.bodies.forEach(function(t){e.push(t.copy)}),e}},{key:"removeObjFromSystem",value:function(t){console.log(this.balls.indexOf(t)),this.balls.splice(this.balls.indexOf(t),1)}},{key:"getItemDataFromId",value:function(e){var t={},a=function(t){return t.id===e},n=this.balls.filter(a);if(1<=n.length)return t.type="ball",t.num=this.balls.indexOf(n[0]),t;var l=this.bodies.filter(a);if(1<=l.length)return t.type="body",t.num=this.bodies.indexOf(l[0]),t;var s=this.springs.filter(a);return 1<=s.length?(t.type="spring",t.num=this.springs.indexOf(s[0]),t):void 0}},{key:"copy",get:function(){var n=this,l=new tt;return l.balls=this.getCopyOfBalls(),l.bodies=this.getCopyOfBodies(),l.fixedBalls=this.fixedBalls,l.walls=this.walls,l.bounds=this.bounds,l.gravity=this.gravity,this.springs.forEach(function(t){var a=new(t.constructor==h.default?h.default:i.default)(t.length,t.springConstant);a.rotationLocked=t.rotationLocked,a.pinned=t.pinned,t.objects.forEach(function(t){var e=n.balls.indexOf(t);-1!=e?a.attachObject(l.balls[e]):-1!=(e=n.bodies.indexOf(t))&&a.attachObject(l.bodies[e])}),l.springs.push(a)}),l}}]),tt}();a.Physics=l},{"./ball":1,"./body":2,"./linesegment":3,"./softball":5,"./spring":6,"./stick":7,"./vec2":8,"./wall":9}],5:[function(t,e,a){Object.defineProperty(a,"__esModule",{value:!0});var q=t("./vec2"),f=t("./ball"),d=t("./stick"),B=t("./linesegment"),n=function(){function u(t,e,a,n,l){_classCallCheck(this,u),this.points=[],this.fc=n||0===n?n:.4,this.pressure=a,this.resolution=l||30,e=Math.abs(e),this.r=e;for(var s=1e6*Math.random(),i=0;i<this.resolution;i++){var o=new q.default(t.x,t.y);o.add(q.default.mult(q.default.fromAngle(i/this.resolution*Math.PI*2),e)),this.points.push(new f.default(o,new q.default(0,0),e*Math.sin(Math.PI/this.resolution),0,0,this.fc)),this.points[this.points.length-1].layer=s}this.sides=[];for(var r=0;r<this.resolution;r++){var h=new d.default(2*e*Math.sin(Math.PI/this.resolution));h.attachObject(this.points[r]),h.attachObject(this.points[(r+1)%this.resolution]),r%2==0&&h.lockRotation(),this.sides.push(h)}}return _createClass(u,null,[{key:"updatePressureBasedForces",value:function(t,a){var e=[];if(e.push([]),t.points.forEach(function(t){e[0].push(new q.default(t.pos.x,t.pos.y))}),function(t){var e=q.default.angleACW(q.default.sub(t[1],t[0]),q.default.sub(t[t.length-1],t[0]));if(e>Math.PI)return!0;for(var a=1;a<t.length-1;a++)if((e=q.default.angleACW(q.default.sub(t[(a+1)%t.length],t[a]),q.default.sub(t[a-1],t[a])))>Math.PI)return!0;return(e=q.default.angleACW(q.default.sub(t[0],t[t.length-1]),q.default.sub(t[t.length-2],t[t.length-1])))>Math.PI}(e[0])){var s=function(t,e){for(var a=0;a<t.length;a++)if(t[a]===e)return!0;return!1},n=function(t,e,a){for(var n=0;n<e.length;n++)if(!s(a,n)){var l=new B.default(new q.default(e[n].x,e[n].y),new q.default(e[(n+1)%e.length].x,e[(n+1)%e.length].y));if(B.default.intersect(t,l))return!0}return!1},l=!0;t:for(;l;){l=!1;for(var i=0;i<e.length;i++){var o=e[i],r=q.default.sub(o[1],o[0]),h=q.default.sub(o[o.length-1],o[0]);if(q.default.angleACW(r,h)>Math.PI){l=!0;for(var u=2,f=new B.default(new q.default(o[0].x,o[0].y),new q.default(o[u%o.length].x,o[u%o.length].y)),d=new q.default(f.b.x-f.a.x,f.b.y-f.a.y).heading;!(r.heading>h.heading?d>r.heading&&d<2*Math.PI||0<d&&d<h.heading:d>r.heading&&d<h.heading)||n(new B.default(new q.default(o[0%o.length].x,o[0%o.length].y),new q.default(o[u%o.length].x,o[u%o.length].y)),o,[(o.length-1)%o.length,0%o.length,(u-1)%o.length,u%o.length]);)u++,f=new B.default(new q.default(o[0].x,o[0].y),new q.default(o[u%o.length].x,o[u%o.length].y)),d=new q.default(f.b.x-f.a.x,f.b.y-f.a.y).heading;for(var y=[],c=[],v=0;v<=u;v++)y.push(o[v%o.length]);for(var g=u;g<=0+o.length;g++)c.push(o[g%o.length]);e[i]=y,e.push(c);continue t}for(var p=1;p<o.length;p++){var b=q.default.sub(o[(p+1)%o.length],o[p]),x=q.default.sub(o[p-1],o[p]);if(q.default.angleACW(b,x)>Math.PI){l=!0;for(var m=p+2,w=new B.default(new q.default(o[p].x,o[p].y),new q.default(o[m%o.length].x,o[m%o.length].y)),M=new q.default(w.b.x-w.a.x,w.b.y-w.a.y).heading;!(b.heading>x.heading?M>b.heading&&M<2*Math.PI||0<M&&M<x.heading:M>b.heading&&M<x.heading)||n(w,o,[(p-1)%o.length,p%o.length,(m-1)%o.length,m%o.length]);)m++,w=new B.default(new q.default(o[p].x,o[p].y),new q.default(o[m%o.length].x,o[m%o.length].y)),M=new q.default(w.b.x-w.a.x,w.b.y-w.a.y).heading;for(var k=[],P=[],C=p;C<=m;C++)k.push(o[C%o.length]);for(var I=m;I<=p+o.length;I++)P.push(o[I%o.length]);e[i]=k,e.push(P);continue t}}}}}for(var _=e.length-1;0<=_;_--)for(var j=e[_];3<j.length;)e.push([j[0],j[1],j[2]]),j.splice(1,1);var O=0;e.forEach(function(t){var e=Math.sqrt(Math.pow(t[0].x-t[1].x,2)+Math.pow(t[0].y-t[1].y,2)),a=Math.sqrt(Math.pow(t[1].x-t[2].x,2)+Math.pow(t[1].y-t[2].y,2)),n=Math.sqrt(Math.pow(t[2].x-t[0].x,2)+Math.pow(t[2].y-t[0].y,2)),l=(e+a+n)/2,s=Math.sqrt(l*(l-e)*(l-a)*(l-n));O+=s});var A=t.pressure*(t.r*t.r*Math.PI/O)-t.pressure;t.sides.forEach(function(t){var e=q.default.sub(t.objects[0].pos,t.objects[1].pos);e.mult(A),e.rotate(Math.PI/2),e.mult(a),t.objects[0].vel.add(q.default.div(e,t.objects[0].m)),t.objects[1].vel.add(q.default.div(e,t.objects[1].m))})}}]),u}();a.default=n},{"./ball":1,"./linesegment":3,"./stick":7,"./vec2":8}],6:[function(t,e,a){Object.defineProperty(a,"__esModule",{value:!0});var m=t("./vec2"),n=function(){function a(t,e){_classCallCheck(this,a),this.length=t,this.springConstant=e,this.pinned=!1,this.objects=[],this.rotationLocked=!1,this.id="_"+Math.random().toString(36).substr(2,9)}return _createClass(a,[{key:"pinHere",value:function(t,e){this.pinned={x:t,y:e}}},{key:"unpin",value:function(){this.pinned=!1}},{key:"attachObject",value:function(t){var e=this.objects;e.push(t),2===e.length&&(this.pinned=!1),3<=e.length&&(e=[e[e.length-2],e[e.length-1]])}},{key:"lockRotation",value:function(){this.rotationLocked=!0}},{key:"unlockRotation",value:function(){this.rotationLocked=!1}},{key:"update",value:function(t){var e=void 0,a=void 0;if(this.pinned&&this.objects[0]){a=this.pinned,e=this.objects[0];var n=new m.default(a.x-e.pos.x,a.y-e.pos.y),l=n.length-this.length;n.setMag(1),n.mult(l*this.springConstant*t/e.m),e.vel.x+=n.x,e.vel.y+=n.y;var s=e.vel;if(s.rotate(-n.heading),this.rotationLocked){var i=new m.default(a.x,a.y),o=m.default.sub(e.pos,i),r=o.length*o.length*e.m+e.am,h=(e.am*e.ang-o.length*e.m*s.y)/r;s.y=-h*o.length,e.ang=h}s.rotate(n.heading)}else if(this.objects[0]&&this.objects[1]){e=this.objects[0],a=this.objects[1];var u=m.default.sub(e.pos,a.pos),f=u.length-this.length;u.setMag(1),u.mult(f*this.springConstant*t),a.vel.add(m.default.div(u,a.m)),e.vel.add(m.default.div(u,-e.m)),u=m.default.sub(e.pos,a.pos);var d=e.vel,y=a.vel;if(d.rotate(-u.heading),y.rotate(-u.heading),this.rotationLocked){var c=new m.default(e.pos.x*e.m+a.pos.x*a.m,e.pos.y*e.m+a.pos.y*a.m);c.div(e.m+a.m);var v=m.default.sub(e.pos,c),g=m.default.sub(a.pos,c),p=v.length*v.length*e.m+e.am+g.length*g.length*a.m+a.am,b=(d.y-y.y)*g.length/(v.length+g.length)+y.y,x=(e.am*e.ang+a.am*a.ang-v.length*e.m*(d.y-b)+g.length*a.m*(y.y-b))/p;d.y=-x*v.length+b,y.y=+x*g.length+b,e.ang=x,a.ang=x}d.rotate(u.heading),y.rotate(u.heading)}}}]),a}();a.default=n},{"./vec2":8}],7:[function(t,e,a){Object.defineProperty(a,"__esModule",{value:!0});var w=t("./vec2"),n=t("./spring"),l=function(t){function a(t){_classCallCheck(this,a);var e=_possibleConstructorReturn(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,t,0));return e.springConstant=0,e}return _inherits(a,n.default),_createClass(a,[{key:"update",value:function(t){var e=void 0,a=void 0;if(this.pinned&&this.objects[0]){a=this.pinned,e=this.objects[0];var n=new w.default(a.x-e.pos.x,a.y-e.pos.y);n.setMag(1),n.mult(-this.length),e.move(-e.pos.x+a.x+n.x,-e.pos.y+a.y+n.y);var l=e.vel;if(l.rotate(-n.heading),l.x=0,this.rotationLocked){var s=new w.default(a.x,a.y),i=w.default.sub(e.pos,s),o=i.length*i.length*e.m+e.am,r=(e.am*e.ang-i.length*e.m*l.y)/o;l.y=-r*i.length,e.ang=r}l.rotate(n.heading)}else if(this.objects[0]&&this.objects[1]){e=this.objects[0],a=this.objects[1];var h=w.default.sub(e.pos,a.pos),u=this.length-h.length;h.setMag(1);var f=w.default.mult(h,u*a.m/(e.m+a.m)),d=w.default.mult(h,-u*e.m/(e.m+a.m));e.move(f.x,f.y),a.move(d.x,d.y);var y=e.vel,c=a.vel;if(y.rotate(-h.heading),c.rotate(-h.heading),y.x=c.x=(e.m*y.x+a.m*c.x)/(e.m+a.m),this.rotationLocked){var v=new w.default(e.pos.x*e.m+a.pos.x*a.m,e.pos.y*e.m+a.pos.y*a.m);v.div(e.m+a.m);var g=w.default.sub(e.pos,v),p=w.default.sub(a.pos,v),b=g.length*g.length*e.m+e.am+p.length*p.length*a.m+a.am,x=(y.y-c.y)*p.length/(g.length+p.length)+c.y,m=(e.am*e.ang+a.am*a.ang-g.length*e.m*(y.y-x)+p.length*a.m*(c.y-x))/b;y.y=-m*g.length+x,c.y=+m*p.length+x,e.ang=m,a.ang=m}y.rotate(h.heading),c.rotate(h.heading)}}}]),a}();a.default=l},{"./spring":6,"./vec2":8}],8:[function(t,e,a){Object.defineProperty(a,"__esModule",{value:!0});var n=function(){function n(t,e){_classCallCheck(this,n),this.x=t,this.y=e}return _createClass(n,[{key:"add",value:function(t){this.x+=t.x,this.y+=t.y}},{key:"sub",value:function(t){this.x-=t.x,this.y-=t.y}},{key:"mult",value:function(t){this.x*=t,this.y*=t}},{key:"div",value:function(t){this.x/=t,this.y/=t}},{key:"lerp",value:function(t,e){this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e}},{key:"dist",value:function(t){return new n(this.x-t.x,this.y-t.y).length}},{key:"setMag",value:function(t){0!==this.length&&this.mult(t/this.length)}},{key:"rotate",value:function(t){var e=this.heading,a=n.fromAngle(t+e);a.mult(this.length),this.x=a.x,this.y=a.y}},{key:"copy",get:function(){return new n(this.x,this.y)}},{key:"length",get:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"sqlength",get:function(){return this.x*this.x+this.y*this.y}},{key:"heading",get:function(){if(0===this.x&&0===this.y)return 0;if(0===this.x)return 0<this.y?Math.PI/2:1.5*Math.PI;if(0===this.y)return 0<this.x?0:Math.PI;var t=n.normalized(this);return 0<this.x&&0<this.y?Math.asin(t.y):this.x<0&&0<this.y?Math.asin(-t.x)+Math.PI/2:this.x<0&&this.y<0?Math.asin(-t.y)+Math.PI:0<this.x&&this.y<0?Math.asin(t.x)+1.5*Math.PI:0}}],[{key:"add",value:function(t,e){return new n(t.x+e.x,t.y+e.y)}},{key:"sub",value:function(t,e){return new n(t.x-e.x,t.y-e.y)}},{key:"mult",value:function(t,e){return new n(t.x*e,t.y*e)}},{key:"div",value:function(t,e){return new n(t.x/e,t.y/e)}},{key:"fromAngle",value:function(t){return new n(Math.cos(t),Math.sin(t))}},{key:"lerp",value:function(t,e,a){return n.add(t,n.mult(n.sub(e,t),a))}},{key:"dist",value:function(t,e){return n.sub(t,e).length}},{key:"dot",value:function(t,e){return t.x*e.x+t.y*e.y}},{key:"cross",value:function(t,e){return t.x*e.y-t.y*e.x}},{key:"angle",value:function(t,e){return Math.acos(n.dot(t,e)/Math.sqrt(t.sqlength*e.sqlength))}},{key:"angleACW",value:function(t,e){var a=t.heading,n=e.heading-a;return n<0?2*Math.PI+n:n}},{key:"normalized",value:function(t){var e=t.length;return 0===e?t:new n(t.x/e,t.y/e)}}]),n}();a.default=n},{}],9:[function(t,e,a){Object.defineProperty(a,"__esModule",{value:!0});var f=t("./vec2"),n=function(){function r(t){_classCallCheck(this,r),this.points=t;var e=this.points,a=0,n=0,l=f.default.angleACW(f.default.sub(e[1],e[0]),f.default.sub(e[e.length-1],e[0]));a+=l,n+=2*Math.PI-l;for(var s=1;s<e.length-1;s++)a+=l=f.default.angleACW(f.default.sub(e[(s+1)%e.length],e[s]),f.default.sub(e[s-1],e[s])),n+=2*Math.PI-l;if(!((a+=l=f.default.angleACW(f.default.sub(e[0],e[e.length-1]),f.default.sub(e[e.length-2],e[e.length-1])))<(n+=2*Math.PI-l))){for(var i=[],o=e.length-1;0<=o;o--)i.push(e[o]);this.points=i}}return _createClass(r,[{key:"collideWithBall",value:function(o){var r=this,h=void 0,u=void 0;if(this.points.forEach(function(t,e){var a=new f.default(t.x,t.y);a.x-=o.pos.x,a.y-=o.pos.y,a.mult(-1),a.length<=o.r&&(h=a.heading,u=a.length),a=new f.default(t.x,t.y);var n=new f.default(r.points[(e+1)%r.points.length].x,r.points[(e+1)%r.points.length].y),l=new f.default(o.pos.x,o.pos.y),s=new f.default(n.x-a.x,n.y-a.y).heading;a.rotate(-s+Math.PI),n.rotate(-s+Math.PI),l.rotate(-s+Math.PI);var i=l.y-(a.y+n.y)/2;i>=-o.r&&i<=o.r&&l.x>=n.x&&l.x<=a.x&&(h=s-Math.PI/2,u=i)}),0===h||h){var t=new f.default(o.pos.x,o.pos.y),e=new f.default(o.vel.x,o.vel.y);if(t.rotate(-h+Math.PI/2),e.rotate(-h+Math.PI/2),0<e.y)return;e.y*=-o.k,t.y+=o.r-u;var a=e.y*(1+1/o.k),n=Math.sign(e.x-o.ang*o.r)*(a*o.fc)/(o.amc*o.r),l=(e.x-o.ang*o.r)/o.r;1<n/l&&(n=l),n*=o.amc/(o.amc+1),o.ang+=n;var s=n*o.r;e.x-=s,t.rotate(h-Math.PI/2),e.rotate(h-Math.PI/2),o.pos.x=t.x,o.pos.y=t.y,o.vel.x=e.x,o.vel.y=e.y}}}]),r}();a.default=n},{"./vec2":8}]},{},[4])(4)});
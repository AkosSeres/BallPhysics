/*! ballphysics 28-12-2018 */

"use strict";var _createClass=function(){function a(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(t,e,n){return e&&a(t.prototype,e),n&&a(t,n),t}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}!function(t){if("object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Physics=t()}}(function(){return function i(r,o,h){function l(e,t){if(!o[e]){if(!r[e]){var n="function"==typeof require&&require;if(!t&&n)return n(e,!0);if(u)return u(e,!0);var a=new Error("Cannot find module '"+e+"'");throw a.code="MODULE_NOT_FOUND",a}var s=o[e]={exports:{}};r[e][0].call(s.exports,function(t){return l(r[e][1][t]||t)},s,s.exports,i,r,o,h)}return o[e].exports}for(var u="function"==typeof require&&require,t=0;t<h.length;t++)l(h[t]);return l}({1:[function(t,e,n){var R=t("./vec2"),a=function(){function r(t,e,n,a,s,i){_classCallCheck(this,r),this.pos=t.copy,this.lastPos=this.pos.copy,this.r=n,this.fc=.4,this.amc=.4,this.rotation=0,this.ang=s||0,(i||0===i)&&(this.fc=i),this.k=a||.8,this.vel=null!=e?e.copy:new R(0,0)}return _createClass(r,[{key:"move",value:function(t,e){this.pos.x+=t,this.pos.y+=e}},{key:"collided",value:function(t){return this.pos.dist(t.pos)<this.r+t.r}},{key:"m",get:function(){return this.r*this.r*Math.PI}},{key:"am",get:function(){return this.amc*this.m*this.r*this.r}},{key:"copy",get:function(){var t=new r(this.pos.copy,this.vel.copy,this.r,this.k,this.ang,this.fc);return t.lastPos=this.lastPos.copy,t.rotation=this.rotation,t}}],[{key:"collide",value:function(t,e){if(t.collided(e)){var n=t.pos,a=e.pos,s=t.lastPos,i=e.lastPos,r=t.r,o=e.r,h=(t.k+e.k)/2,l=r*r,u=o*o,y=t.vel,g=e.vel,v=R.dist(n,a),c=(R.dist(s,i),(t.fc+e.fc)/2),f=n.copy,p=a.copy,x=r+o-v,d=R.sub(n,a);d.setMag(1),d.mult(x*u/(l+u)),f.add(d),d.setMag(1),d.mult(-x*l/(l+u)),p.add(d),t.pos=f,e.pos=p;var b=f.copy,m=p.copy,w=y.copy,M=R.angleACW(new R(y.x,y.y),new R(m.x-b.x,m.y-b.y));w.rotate(M),w.mult(Math.cos(M));var k=g.copy;M=R.angleACW(new R(g.x,g.y),new R(b.x-m.x,b.y-m.y)),k.rotate(M),k.mult(Math.cos(M));var P=y.copy;M=R.angleACW(new R(y.x,y.y),new R(m.x-b.x,m.y-b.y)),P.rotate(-HALF_PI+M),P.mult(Math.sin(M));var C=g.copy;M=R.angleACW(new R(g.x,g.y),new R(b.x-m.x,b.y-m.y)),C.rotate(-HALF_PI+M),C.mult(Math.sin(M));var I=R.mult(w,l);I.add(R.mult(k,u)),I.mult(1+h),I.div(l+u),I.sub(R.mult(w,h));var A=R.mult(w,l);A.add(R.mult(k,u)),A.mult(1+h),A.div(l+u),A.sub(R.mult(k,h));var _=R.dist(I,w),j=R.dist(A,k),B=new R(y.x,y.y),W=new R(g.x,g.y),E=new R(b.x-m.x,b.y-m.y).heading;B.rotate(-E+Math.PI/2),W.rotate(-E+Math.PI/2);var S=(l*(B.x+t.ang*r)+u*(W.x-e.ang*o))/(l+u),q=-_*c*Math.sign(B.x-t.ang*r-S);Math.abs(q)>Math.abs(B.x-t.ang*r-S)&&(q=-B.x+t.ang*r+S);var O=-j*c*Math.sign(W.x+e.ang*o-S);Math.abs(O)>Math.abs(W.x+e.ang*o-S)&&(O=-W.x-e.ang*o+S);var L=new R(q+t.r*t.r*t.m*q/(t.am+t.r*t.r*t.m),0),F=new R(O-e.r*e.r*e.m*O/(e.am+e.r*e.r*e.m),0);L.rotate(E-Math.PI/2),F.rotate(E-Math.PI/2),w=I,k=A,t.vel=R.add(w,P),e.vel=R.add(k,C),t.ang-=t.r*t.r*t.m*q/((t.am+t.r*t.r*t.m)*r),e.ang+=t.r*t.r*t.m*O/((e.am+e.r*e.r*e.m)*o),t.vel.x+=L.x,t.vel.y+=L.y,e.vel.x+=F.x,e.vel.y+=F.y,t.lastPos=f,e.lastPos=p}}}]),r}();e.exports=a},{"./vec2":8}],2:[function(t,e,n){var G=t("./vec2"),J=t("./linesegment"),a=function(){function g(t,e,n,a,s){_classCallCheck(this,g),this.points=t;var i=this.points,r=0,o=0,h=G.angleACW(G.sub(i[1],i[0]),G.sub(i[i.length-1],i[0]));r+=h,o+=2*Math.PI-h;for(var l=1;l<i.length-1;l++)r+=h=G.angleACW(G.sub(i[(l+1)%i.length],i[l]),G.sub(i[l-1],i[l])),o+=2*Math.PI-h;if(r+=h=G.angleACW(G.sub(i[0],i[i.length-1]),G.sub(i[i.length-2],i[i.length-1])),(o+=2*Math.PI-h)<r){for(var u=[],y=i.length-1;0<=y;y--)u.push(i[y]);this.points=u}this.calculatePosAndMass(),this.lastPos=this.pos.copy,this.fc=.4,this.rotation=0,this.ang=a||0,(s||0===s)&&(this.fc=s),this.k=n||.8,this.vel=null!=e?e.copy:new G(0,0)}return _createClass(g,[{key:"move",value:function(e,n){this.pos.x+=e,this.pos.y+=n,this.points.forEach(function(t){t.x+=e,t.y+=n})}},{key:"collideWithBall",value:function(y){var g=this,v=null,c=null,f=void 0;if(this.points.forEach(function(t,e){var n=new G(t.x,t.y);if(n.x-=y.pos.x,n.y-=y.pos.y,n.length<=y.r){v=n.heading+Math.PI,c=n.length;var a=G.fromAngle(v);a.mult(y.r-c),g.move(-1*a.x*y.m/(g.m+y.m),-1*a.y*y.m/(g.m+y.m)),y.move(1*a.x*g.m/(g.m+y.m),1*a.y*g.m/(g.m+y.m)),f=new G(t.x,t.y);var s=G.fromAngle(v);s.mult(-30),stroke("red"),line(f.x,f.y,f.x+s.x,f.y+s.y)}n=new G(t.x,t.y);var i=new G(g.points[(e+1)%g.points.length].x,g.points[(e+1)%g.points.length].y),r=new G(y.pos.x,y.pos.y),o=new G(i.x-n.x,i.y-n.y).heading;n.rotate(-o+Math.PI),i.rotate(-o+Math.PI),r.rotate(-o+Math.PI);var h=r.y-(n.y+i.y)/2;if(h>=-y.r&&h<=y.r&&r.x>=i.x&&r.x<=n.x){v=o-Math.PI/2,c=h;var l=G.fromAngle(v);l.mult(y.r-c),g.move(-1*l.x*y.m/(g.m+y.m),-1*l.y*y.m/(g.m+y.m)),y.move(1*l.x*g.m/(g.m+y.m),1*l.y*g.m/(g.m+y.m)),(f=y.pos.copy).add(G.mult(G.fromAngle(v+Math.PI),h));var u=G.fromAngle(v);u.mult(-30),stroke("red"),line(f.x,f.y,f.x+u.x,f.y+u.y)}}),0===v||v){var t=this.vel.copy,e=y.vel.copy,n=this.ang,a=y.ang,s=G.sub(f,this.pos),i=G.sub(f,y.pos),r=this.am,o=y.am,h=this.m,l=y.m,u=(this.k+y.k)/2,p=(this.fc+y.fc)/2,x=s.copy,d=i.copy;x.rotate(Math.PI/2),d.rotate(-Math.PI/2),x.mult(n),d.mult(a),x.add(t),d.add(e),x.rotate(-v),d.rotate(-v);var b=(1+u)*(h*x.x+l*d.x)/(h+l)-(u+1)*x.x,m=(1+u)*(h*x.x+l*d.x)/(h+l)-(u+1)*d.x,w=(x.y*h+d.y*l)/(h+l),M=-Math.sign(x.y)*p*b,k=-Math.sign(d.y)*p*m;Math.abs(w-x.y)>Math.abs(M)&&(M=w-x.y),Math.abs(w-d.y)>Math.abs(k)&&(k=w-d.y);var P=new G(b,M),C=new G(m,k);P.rotate(v),C.rotate(v),t.add(P),e.add(C),P.rotate(-s.heading),C.rotate(-i.heading);var I=P.y*h*s.length/(r+s.length*s.length*h),A=-C.y*l*i.length/(o+i.length*i.length*l);n+=I,a+=A;var _=G.fromAngle(s.heading-Math.PI/2);_.mult(s.length*I);var j=G.fromAngle(i.heading-Math.PI/2);j.mult(i.length*A),e.sub(j),t.add(_),this.vel=t,y.vel=e,this.ang=n,y.ang=a}}},{key:"calculatePosAndMass",value:function(){var e=[];if(e.push([]),this.points.forEach(function(t){e[0].push({x:t.x,y:t.y})}),this.isConcave){var i=function(t,e){for(var n=0;n<t.length;n++)if(t[n]===e)return!0;return!1},t=function(t,e,n){for(var a=0;a<e.length;a++)if(!i(n,a)){var s=new J(new G(e[a].x,e[a].y),new G(e[(a+1)%e.length].x,e[(a+1)%e.length].y));if(J.intersect(t,s))return!0}return!1},n=!0;t:for(;n;){n=!1;for(var a=0;a<e.length;a++){var s=e[a],r=G.sub(s[1],s[0]),o=G.sub(s[s.length-1],s[0]);if(G.angleACW(r,o)>Math.PI){n=!0;for(var h=2,l=new J(new G(s[0].x,s[0].y),new G(s[h%s.length].x,s[h%s.length].y)),u=new G(l.b.x-l.a.x,l.b.y-l.a.y).heading;!(r.heading>o.heading?u>r.heading&&u<2*Math.PI||0<u&&u<o.heading:u>r.heading&&u<o.heading)||t(new J(new G(s[0%s.length].x,s[0%s.length].y),new G(s[h%s.length].x,s[h%s.length].y)),s,[(s.length-1)%s.length,0%s.length,(h-1)%s.length,h%s.length]);)h++,l=new J(new G(s[0].x,s[0].y),new G(s[h%s.length].x,s[h%s.length].y)),u=new G(l.b.x-l.a.x,l.b.y-l.a.y).heading;for(var y=[],g=[],v=0;v<=h;v++)y.push(s[v%s.length]);for(var c=h;c<=0+s.length;c++)g.push(s[c%s.length]);e[a]=y,e.push(g);continue t}for(var f=1;f<s.length;f++){var p=G.sub(s[(f+1)%s.length],s[f]),x=G.sub(s[f-1],s[f]);if(G.angleACW(p,x)>Math.PI){n=!0;for(var d=f+2,b=new J(new G(s[f].x,s[f].y),new G(s[d%s.length].x,s[d%s.length].y)),m=new G(b.b.x-b.a.x,b.b.y-b.a.y).heading;!(p.heading>x.heading?m>p.heading&&m<2*Math.PI||0<m&&m<x.heading:m>p.heading&&m<x.heading)||t(b,s,[(f-1)%s.length,f%s.length,(d-1)%s.length,d%s.length]);)d++,b=new J(new G(s[f].x,s[f].y),new G(s[d%s.length].x,s[d%s.length].y)),m=new G(b.b.x-b.a.x,b.b.y-b.a.y).heading;for(var w=[],M=[],k=f;k<=d;k++)w.push(s[k%s.length]);for(var P=d;P<=f+s.length;P++)M.push(s[P%s.length]);e[a]=w,e.push(M);continue t}}}}}for(var C=e.length-1;0<=C;C--)for(var I=e[C];3<I.length;)e.push([I[0],I[1],I[2]]),I.splice(1,1);var A=0,_=0,j=new G(0,0);e.forEach(function(t){var e=Math.sqrt(Math.pow(t[0].x-t[1].x,2)+Math.pow(t[0].y-t[1].y,2)),n=Math.sqrt(Math.pow(t[1].x-t[2].x,2)+Math.pow(t[1].y-t[2].y,2)),a=Math.sqrt(Math.pow(t[2].x-t[0].x,2)+Math.pow(t[2].y-t[0].y,2)),s=(e+n+a)/2,i=Math.sqrt(s*(s-e)*(s-n)*(s-a));A+=i,j.x+=i*(t[0].x+t[1].x+t[2].x)/3,j.y+=i*(t[0].y+t[1].y+t[2].y)/3}),j.div(A),this.pos=j,this.m=A;var B=!0,W=!1,E=void 0;try{for(var S,q=e[Symbol.iterator]();!(B=(S=q.next()).done);B=!0){var O=S.value,L=Math.sqrt(Math.pow(O[0].x-O[1].x,2)+Math.pow(O[0].y-O[1].y,2)),F=Math.sqrt(Math.pow(O[1].x-O[2].x,2)+Math.pow(O[1].y-O[2].y,2)),R=Math.sqrt(Math.pow(O[2].x-O[0].x,2)+Math.pow(O[2].y-O[0].y,2)),H=Math.max(L,F,R),T=(L+F+R)/2,z=Math.sqrt(T*(T-L)*(T-F)*(T-R)),D=2*z/H,N=Math.sqrt(Math.pow(Math.min(L,R,F),2)-D*D),U=D*H*(D*D+H*H)/24,V=Math.sqrt(D*D/36+Math.pow(Math.abs(N-H/2)/3,2));U-=V*V*z,_+=U+=Math.pow(new G((O[0].x+O[1].x+O[2].x)/3,(O[0].y+O[1].y+O[2].y)/3).dist(this.pos),2)*z}}catch(t){W=!0,E=t}finally{try{!B&&q.return&&q.return()}finally{if(W)throw E}}this.am=_}},{key:"rotate",value:function(n){var a=this;this.points.forEach(function(t){var e=new G(t.x,t.y);e.sub(a.pos),e.rotate(n),e.add(a.pos),t.x=e.x,t.y=e.y}),this.rotation+=n}},{key:"copy",get:function(){for(var t=[],e=0;e<this.points.length;e++)t.push({x:this.points[e].x,y:this.points[e].y});var n=new g(t,this.vel.copy,this.k,this.ang,this.fc);return n.rotation=this.rotation,n.lastPos=this.lastPos.copy,n.pos=this.pos.copy,n}},{key:"isConcave",get:function(){var t=this.points,e=G.angleACW(G.sub(t[1],t[0]),G.sub(t[t.length-1],t[0]));if(e>Math.PI)return!0;for(var n=1;n<t.length-1;n++)if((e=G.angleACW(G.sub(t[(n+1)%t.length],t[n]),G.sub(t[n-1],t[n])))>Math.PI)return!0;return(e=G.angleACW(G.sub(t[0],t[t.length-1]),G.sub(t[t.length-2],t[t.length-1])))>Math.PI}}],[{key:"collide",value:function(n,i){var r=0,t=0,o=new G(0,0),h=[],l=!1;if(n.points.forEach(function(t,e){var s=new J(new G(t.x,t.y),new G(n.points[(e+1)%n.points.length].x,n.points[(e+1)%n.points.length].y));i.points.forEach(function(t,e){var n=new J(new G(t.x,t.y),new G(i.points[(e+1)%i.points.length].x,i.points[(e+1)%i.points.length].y)),a=J.intersect(s,n);a&&(r++,o.add(a),h.push(a),l=!0)})}),l){o.div(r);for(var e=0;e<Math.floor(r/2);e++)t+=G.sub(h[2*e+1],h[2*e]).heading;t/=r/2,t+=Math.PI/2;var a=G.fromAngle(t);stroke("red"),line(o.x,o.y,o.x+-30*a.x,o.y+-30*a.y);var s=0,u=0,y=0,g=0,v=!0,c=!1,f=void 0;try{for(var p,x=n.points[Symbol.iterator]();!(v=(p=x.next()).done);v=!0)point=p.value,s=Math.min(G.dot(a,G.sub(new G(point.x,point.y),o)),s),u=Math.max(G.dot(a,G.sub(new G(point.x,point.y),o)),u)}catch(t){c=!0,f=t}finally{try{!v&&x.return&&x.return()}finally{if(c)throw f}}var d=!0,b=!1,m=void 0;try{for(var w,M=i.points[Symbol.iterator]();!(d=(w=M.next()).done);d=!0)point=w.value,y=Math.min(G.dot(a,G.sub(new G(point.x,point.y),o)),y),g=Math.max(G.dot(a,G.sub(new G(point.x,point.y),o)),g)}catch(t){b=!0,m=t}finally{try{!d&&M.return&&M.return()}finally{if(b)throw m}}Math.abs(s-g)<Math.abs(y-u)?(n.move(-a.x*s,-a.y*s),i.move(-a.x*g,-a.y*g)):(n.move(-a.x*u,-a.y*u),i.move(-a.x*y,-a.y*y));var k=(n.k+i.k)/2,P=G.dot(n.vel,a),C=G.dot(i.vel,a),I=(1+k)*(n.m*P+i.m*C)/(n.m+i.m)-k*P,A=(1+k)*(n.m*P+i.m*C)/(n.m+i.m)-k*C;n.vel.add(G.mult(a.copy,I-P)),i.vel.add(G.mult(a.copy,A-C))}}}]),g}();e.exports=a},{"./linesegment":3,"./vec2":8}],3:[function(t,e,n){var x=t("./vec2"),a=function(){function n(t,e){_classCallCheck(this,n),this.a=t,this.b=e}return _createClass(n,[{key:"distFromPoint",value:function(t){var e=x.sub(this.a,this.b),n=x.sub(t,this.b),a=x.sub(t,this.a),s=n.length,i=a.length,r=e.length;if(0===r)return s;var o=x.angle(n,a),h=x.angle(n,e),l=Math.PI-o-h,u=2*(Math.sin(l)*i*r/2)/r;return l>Math.PI/2?i:h>Math.PI/2?s:u}},{key:"length",get:function(){return x.dist(this.a,this.b)}}],[{key:"intersect",value:function(t,e){var n=x.sub(t.b,t.a),a=n.y/n.x,s=t.b.y-t.b.x*a,i=x.sub(e.b,e.a),r=i.y/i.x,o=e.b.y-e.b.x*r;if(0===n.x&&0!==i.x){if(t.a.x>=e.a.x&&t.a.x<=e.b.x||t.a.x<=e.a.x&&t.a.x>=e.b.x){var h=r*t.a.x+o;if(h>t.a.y&&h<t.b.y||h<t.a.y&&h>t.b.y)return new x(t.a.x,h)}return!1}if(0===i.x&&0!==n.x){if(e.a.x>=t.a.x&&e.a.x<=t.b.x||e.a.x<=t.a.x&&e.a.x>=t.b.x){var l=a*e.a.x+s;if(l>e.a.y&&l<e.b.y||l<e.a.y&&l>e.b.y)return new x(e.a.x,l)}return!1}if(0===n.x&&0===i.x){if(t.a.x===e.a.x){var u=void 0;u=t.a.y<t.b.y?[t.a.y,t.b.y]:[t.b.y,t.a.y];var y=void 0;y=e.a.y<e.b.y?[e.a.y,e.b.y]:[e.b.y,e.a.y];var g=[u[0]>y[0]?u[0]:y[0],u[1]<y[1]?u[1]:y[1]];if(g[0]<=g[1])return new x(t.a.x,(g[0]+g[1])/2)}return!1}var v=void 0;v=t.a.x<t.b.x?[t.a.x,t.b.x]:[t.b.x,t.a.x];var c=void 0;c=e.a.x<e.b.x?[e.a.x,e.b.x]:[e.b.x,e.a.x];var f=[v[0]>c[0]?v[0]:c[0],v[1]<c[1]?v[1]:c[1]];if(a===r&&s===o&&f[0]<=f[1])return new x((f[0]+f[1])/2,(f[0]+f[1])/2*a+s);var p=(o-s)/(a-r);return f[0]<=p&&p<=f[1]&&new x(p,p*a+s)}}]),n}();e.exports=a},{"./vec2":8}],4:[function(t,e,n){var at=n.Ball=t("./ball"),st=n.SoftBall=t("./softball"),it=n.Body=t("./body"),rt=n.Vec2=t("./vec2"),a=n.Wall=t("./wall"),s=n.LineSegment=t("./linesegment"),i=n.Spring=t("./spring"),r=n.Stick=t("./stick"),o=function(){function t(){_classCallCheck(this,t),this.balls=[],this.bodies=[],this.fixedBalls=[],this.softBalls=[],this.walls=[],this.bounds=0,this.springs=[],this.gravity=null}return _createClass(t,[{key:"update",value:function(e,t){var a=void 0;t&&((a=this.copy).bodies.reverse(),a.balls.reverse(),a.update(e,!1));for(var n=0;n<this.balls.length;n++)this.balls[n].lastPos=this.balls[n].pos.copy,this.balls[n].pos.add(rt.mult(this.balls[n].vel,e)),this.balls[n].rotation+=this.balls[n].ang*e,this.balls[n].rotation%=2*Math.PI;for(var s=0;s<this.bodies.length;s++)this.bodies[s].lastPos=this.bodies[s].pos.copy,this.bodies[s].move(this.bodies[s].vel.x*e,this.bodies[s].vel.y*e),this.bodies[s].rotate(this.bodies[s].ang*e);for(var i=0;i<this.springs.length;i++){var r=!0,o=!1,h=void 0;try{for(var l,u=this.springs[Symbol.iterator]();!(r=(l=u.next()).done);r=!0){l.value.update(e/this.springs.length/2)}}catch(t){o=!0,h=t}finally{try{!r&&u.return&&u.return()}finally{if(o)throw h}}}for(var y=0;y<this.balls.length;y++){this.gravity&&this.balls[y].vel.add(new rt(this.gravity.x*e,this.gravity.y*e));for(var g=y+1;g<this.balls.length;g++)this.balls[y].group==this.balls[g].group&&(this.balls[y].group||this.balls[g].group)||at.collide(this.balls[y],this.balls[g]);var v=!0,c=!1,f=void 0;try{for(var p,x=this.walls[Symbol.iterator]();!(v=(p=x.next()).done);v=!0){p.value.collideWithBall(this.balls[y])}}catch(t){c=!0,f=t}finally{try{!v&&x.return&&x.return()}finally{if(c)throw f}}var d=!0,b=!1,m=void 0;try{for(var w,M=this.fixedBalls[Symbol.iterator]();!(d=(w=M.next()).done);d=!0){var k=w.value,P=this.balls[y],C=void 0,I=void 0,A=new rt(k.x,k.y);if(A.x-=P.pos.x,A.y-=P.pos.y,A.mult(-1),A.length<=P.r+k.r&&(C=A.heading,I=A.length),0===C||C){var _=new rt(P.pos.x,P.pos.y),j=new rt(P.vel.x,P.vel.y);_.rotate(-C+Math.PI/2),j.rotate(-C+Math.PI/2),j.y*=-P.k,_.y+=P.r+k.r-I;var B=j.y*(1+1/P.k),W=Math.abs(B)*P.fc*Math.sign(j.x-P.ang*P.r)*-1;Math.abs(W)>Math.abs(j.x-P.ang*P.r)&&(W=-j.x+P.ang*P.r),j.x+=W-P.r*P.r*P.m*W/(P.am+P.r*P.r*P.m),P.ang-=P.r*P.r*P.m*W/((P.am+P.r*P.r*P.m)*P.r),_.rotate(C-Math.PI/2),j.rotate(C-Math.PI/2),P.pos.x=_.x,P.pos.y=_.y,P.vel.x=j.x,P.vel.y=j.y}}}catch(t){b=!0,m=t}finally{try{!d&&M.return&&M.return()}finally{if(b)throw m}}if(this.bounds){if(this.balls[y].pos.x-this.balls[y].r<this.bounds[0]){(P=this.balls[y]).vel.x*=-P.k,P.pos.x=this.bounds[1]+P.r;var E=P.vel.x*(1+1/P.k),S=Math.abs(E)*P.fc*Math.sign(P.vel.y+P.ang*P.r)*-1;Math.abs(S)>Math.abs(P.vel.y+P.ang*P.r)&&(S=-P.vel.y-P.ang*P.r),P.vel.y+=S-P.r*P.r*P.m*S/(P.am+P.r*P.r*P.m),P.ang+=P.r*P.r*P.m*S/((P.am+P.r*P.r*P.m)*P.r)}else if(this.balls[y].pos.x+this.balls[y].r>this.bounds[0]+this.bounds[2]){var q=this.balls[y];q.vel.x*=-q.k,q.pos.x=this.bounds[0]+this.bounds[2]-q.r;var O=q.vel.x*(1+1/q.k),L=Math.abs(O)*q.fc*Math.sign(q.vel.y-q.ang*q.r)*-1;Math.abs(L)>Math.abs(q.vel.y-q.ang*q.r)&&(L=-q.vel.y+q.ang*q.r),q.vel.y+=L+q.r*q.r*q.m*L/(q.am+q.r*q.r*q.m),q.ang-=q.r*q.r*q.m*L/((q.am+q.r*q.r*q.m)*q.r)}if(this.balls[y].pos.y+this.balls[y].r>this.bounds[1]+this.bounds[3]){var F=this.balls[y];F.vel.y*=-F.k,F.pos.y=this.bounds[1]+this.bounds[3]-F.r;var R=F.vel.y*(1+1/F.k),H=Math.abs(R)*F.fc*Math.sign(F.vel.x+F.ang*F.r)*-1;Math.abs(H)>Math.abs(F.vel.x+F.ang*F.r)&&(H=-F.vel.x-F.ang*F.r),F.vel.x+=H-F.r*F.r*F.m*H/(F.am+F.r*F.r*F.m),F.ang+=F.r*F.r*F.m*H/((F.am+F.r*F.r*F.m)*F.r)}else if(this.balls[y].pos.y-this.balls[y].r<this.bounds[1]){var T=this.balls[y];T.vel.y*=-T.k,T.pos.y=this.bounds[1]+T.r;var z=T.vel.y*(1+1/T.k),D=Math.abs(z)*T.fc*Math.sign(T.vel.x-T.ang*T.r)*-1;Math.abs(D)>Math.abs(T.vel.x-T.ang*T.r)&&(D=-T.vel.x+T.ang*T.r),T.vel.x+=D+T.r*T.r*T.m*D/(T.am+T.r*T.r*T.m),T.ang-=T.r*T.r*T.m*D/((T.am+T.r*T.r*T.m)*T.r)}}}for(var N=0;N<this.bodies.length;N++){var U=!0,V=!1,G=void 0;try{for(var J,K=this.balls[Symbol.iterator]();!(U=(J=K.next()).done);U=!0){var Q=J.value;Q.group==this.bodies[N].group&&(Q.group||this.bodies[N].group)||this.bodies[N].collideWithBall(Q)}}catch(t){V=!0,G=t}finally{try{!U&&K.return&&K.return()}finally{if(V)throw G}}for(var X=N+1;X<this.bodies.length;X++)this.bodies[N].group==this.bodies[X].group&&(this.bodies[X].group||this.bodies[N].group)||it.collide(this.bodies[N],this.bodies[X]);this.gravity&&this.bodies[N].vel.add(new rt(this.gravity.x*e,this.gravity.y*e))}this.softBalls.forEach(function(t){st.updatePressureBasedForces(t,e)});for(var Y=0;Y<this.springs.length;Y++){var Z=!0,$=!1,tt=void 0;try{for(var et,nt=this.springs[Symbol.iterator]();!(Z=(et=nt.next()).done);Z=!0){et.value.update(e/this.springs.length/2)}}catch(t){$=!0,tt=t}finally{try{!Z&&nt.return&&nt.return()}finally{if($)throw tt}}}t&&(a.bodies.reverse(),a.balls.reverse(),this.balls.forEach(function(t,e){t.move(.5*(a.balls[e].pos.x-t.pos.x),.5*(a.balls[e].pos.y-t.pos.y)),t.vel.add(new rt(.5*(a.balls[e].vel.x-t.vel.x),.5*(a.balls[e].vel.y-t.vel.y))),t.rotation=(t.rotation+a.balls[e].rotation)/2,t.ang=(t.ang+a.balls[e].ang)/2}),this.bodies.forEach(function(t,e){var n=a.bodies[e];t.move(.5*(n.pos.x-t.pos.x),.5*(n.pos.y-t.pos.y)),t.vel.add(new rt(.5*(n.vel.x-t.vel.x),.5*(n.vel.y-t.vel.y))),t.rotate((n.rotation-t.rotation)/2),t.ang=(t.ang+n.ang)/2}))}},{key:"setGravity",value:function(t){this.gravity=t.copy}},{key:"addBall",value:function(t){this.balls.push(t)}},{key:"addBody",value:function(t){this.bodies.push(t)}},{key:"addSoftBall",value:function(t){var e,n;(e=this.balls).push.apply(e,_toConsumableArray(t.points)),(n=this.springs).push.apply(n,_toConsumableArray(t.sides)),this.softBalls.push(t)}},{key:"addRectWall",value:function(t,e,n,a){var s=[];s.push({x:t-n/2,y:e-a/2}),s.push({x:t+n/2,y:e-a/2}),s.push({x:t+n/2,y:e+a/2}),s.push({x:t-n/2,y:e+a/2}),this.bodies.push(new it(s,new rt(0,0),.5,0,.3))}},{key:"addWall",value:function(t){this.walls.push(t)}},{key:"addFixedBall",value:function(t,e,n){this.fixedBalls.push({x:t,y:e,r:n})}},{key:"addSpring",value:function(t){this.springs.push(t)}},{key:"setBounds",value:function(t,e,n,a){this.bounds=[t,e,n,a]}},{key:"getObjectAtCoordinates",value:function(t,e){var n=!1,a=new rt(t,e);return this.balls.forEach(function(t){t.pos.dist(a)<t.r&&(n=t)}),n}},{key:"getCopyOfBalls",value:function(){var e=[];return this.balls.forEach(function(t){e.push(t.copy)}),e}},{key:"getCopyOfBodies",value:function(){var e=[];return this.bodies.forEach(function(t){e.push(t.copy)}),e}},{key:"copy",get:function(){var a=this,s=new t;return s.balls=this.getCopyOfBalls(),s.bodies=this.getCopyOfBodies(),s.fixedBalls=this.fixedBalls,s.walls=this.walls,s.bounds=this.bounds,s.gravity=this.gravity,this.springs.forEach(function(t){var n=new(t.constructor==i?i:r)(t.length,t.springConstant);n.rotationLocked=t.rotationLocked,n.pinned=t.pinned,t.objects.forEach(function(t){var e=a.balls.indexOf(t);-1!=e?n.attachObject(s.balls[e]):-1!=(e=a.bodies.indexOf(t))&&n.attachObject(s.bodies[e])}),s.springs.push(n)}),s}}]),t}();(e.exports=o).Ball=at,o.SoftBall=st,o.Body=it,o.Vec2=rt,o.Wall=a,o.LineSegment=s,o.Spring=i,o.Stick=r},{"./ball":1,"./body":2,"./linesegment":3,"./softball":5,"./spring":6,"./stick":7,"./vec2":8,"./wall":9}],5:[function(t,e,n){var W=t("./vec2"),u=t("./ball"),y=t("./stick"),E=t("./linesegment"),a=function(){function l(t,e,n,a,s){_classCallCheck(this,l),this.points=[],this.fc=a||0===a?a:.4,this.pressure=n,this.resolution=s||30,e=Math.abs(e),this.r=e;for(var i=0;i<this.resolution;i++){var r=new W(t.x,t.y);r.add(W.mult(W.fromAngle(i/this.resolution*Math.PI*2),e)),this.points.push(new u(r,new W(0,0),e*Math.sin(Math.PI/this.resolution),0,0,this.fc))}this.sides=[];for(var o=0;o<this.resolution;o++){var h=new y(2*e*Math.sin(Math.PI/this.resolution));h.attachObject(this.points[o]),h.attachObject(this.points[(o+1)%this.resolution]),this.sides.push(h)}}return _createClass(l,null,[{key:"updatePressureBasedForces",value:function(t,n){var e=[];if(e.push([]),t.points.forEach(function(t){e[0].push({x:t.pos.x,y:t.pos.y})}),function(t){var e=W.angleACW(W.sub(t[1],t[0]),W.sub(t[t.length-1],t[0]));if(e>Math.PI)return!0;for(var n=1;n<t.length-1;n++)if((e=W.angleACW(W.sub(t[(n+1)%t.length],t[n]),W.sub(t[n-1],t[n])))>Math.PI)return!0;return(e=W.angleACW(W.sub(t[0],t[t.length-1]),W.sub(t[t.length-2],t[t.length-1])))>Math.PI}(e[0])){var i=function(t,e){for(var n=0;n<t.length;n++)if(t[n]===e)return!0;return!1},a=function(t,e,n){for(var a=0;a<e.length;a++)if(!i(n,a)){var s=new E(new W(e[a].x,e[a].y),new W(e[(a+1)%e.length].x,e[(a+1)%e.length].y));if(E.intersect(t,s))return!0}return!1},s=!0;t:for(;s;){s=!1;for(var r=0;r<e.length;r++){var o=e[r],h=W.sub(o[1],o[0]),l=W.sub(o[o.length-1],o[0]);if(W.angleACW(h,l)>Math.PI){s=!0;for(var u=2,y=new E(new W(o[0].x,o[0].y),new W(o[u%o.length].x,o[u%o.length].y)),g=new W(y.b.x-y.a.x,y.b.y-y.a.y).heading;!(h.heading>l.heading?g>h.heading&&g<2*Math.PI||0<g&&g<l.heading:g>h.heading&&g<l.heading)||a(new E(new W(o[0%o.length].x,o[0%o.length].y),new W(o[u%o.length].x,o[u%o.length].y)),o,[(o.length-1)%o.length,0%o.length,(u-1)%o.length,u%o.length]);)u++,y=new E(new W(o[0].x,o[0].y),new W(o[u%o.length].x,o[u%o.length].y)),g=new W(y.b.x-y.a.x,y.b.y-y.a.y).heading;for(var v=[],c=[],f=0;f<=u;f++)v.push(o[f%o.length]);for(var p=u;p<=0+o.length;p++)c.push(o[p%o.length]);e[r]=v,e.push(c);continue t}for(var x=1;x<o.length;x++){var d=W.sub(o[(x+1)%o.length],o[x]),b=W.sub(o[x-1],o[x]);if(W.angleACW(d,b)>Math.PI){s=!0;for(var m=x+2,w=new E(new W(o[x].x,o[x].y),new W(o[m%o.length].x,o[m%o.length].y)),M=new W(w.b.x-w.a.x,w.b.y-w.a.y).heading;!(d.heading>b.heading?M>d.heading&&M<2*Math.PI||0<M&&M<b.heading:M>d.heading&&M<b.heading)||a(w,o,[(x-1)%o.length,x%o.length,(m-1)%o.length,m%o.length]);)m++,w=new E(new W(o[x].x,o[x].y),new W(o[m%o.length].x,o[m%o.length].y)),M=new W(w.b.x-w.a.x,w.b.y-w.a.y).heading;for(var k=[],P=[],C=x;C<=m;C++)k.push(o[C%o.length]);for(var I=m;I<=x+o.length;I++)P.push(o[I%o.length]);e[r]=k,e.push(P);continue t}}}}}for(var A=e.length-1;0<=A;A--)for(var _=e[A];3<_.length;)e.push([_[0],_[1],_[2]]),_.splice(1,1);var j=0;e.forEach(function(t){var e=Math.sqrt(Math.pow(t[0].x-t[1].x,2)+Math.pow(t[0].y-t[1].y,2)),n=Math.sqrt(Math.pow(t[1].x-t[2].x,2)+Math.pow(t[1].y-t[2].y,2)),a=Math.sqrt(Math.pow(t[2].x-t[0].x,2)+Math.pow(t[2].y-t[0].y,2)),s=(e+n+a)/2,i=Math.sqrt(s*(s-e)*(s-n)*(s-a));j+=i});var B=t.pressure*(t.r*t.r*Math.PI/j)-t.pressure;t.sides.forEach(function(t){var e=W.sub(t.objects[0].pos,t.objects[1].pos);e.mult(B),e.rotate(Math.PI/2),e.mult(n),t.objects[0].vel.add(W.div(e,t.objects[0].m)),t.objects[1].vel.add(W.div(e,t.objects[1].m))})}}]),l}();e.exports=a},{"./ball":1,"./linesegment":3,"./stick":7,"./vec2":8}],6:[function(t,e,n){var m=t("./vec2"),a=function(){function n(t,e){_classCallCheck(this,n),this.length=t,this.springConstant=e,this.pinned=!1,this.objects=[],this.rotationLocked=!1}return _createClass(n,[{key:"pinHere",value:function(t,e){this.pinned={x:t,y:e}}},{key:"unpin",value:function(){this.pinned=!1}},{key:"attachObject",value:function(t){var e=this.objects;e.push(t),2===e.length&&(this.pinned=!1),3<=e.length&&(e=[e[e.length-2],e[e.length-1]])}},{key:"lockRotation",value:function(){this.rotationLocked=!0}},{key:"unlockRotation",value:function(){this.rotationLocked=!1}},{key:"update",value:function(t){var e=void 0,n=void 0;if(this.pinned&&this.objects[0]){n=this.pinned,e=this.objects[0];var a=new m(n.x-e.pos.x,n.y-e.pos.y),s=a.length-this.length;a.setMag(1),a.mult(s*this.springConstant*t/e.m),e.vel.x+=a.x,e.vel.y+=a.y;var i=e.vel;if(i.rotate(-a.heading),this.rotationLocked){var r=new m(n.x,n.y),o=m.sub(e.pos,r),h=o.length*o.length*e.m+e.am,l=(e.am*e.ang-o.length*e.m*i.y)/h;i.y=-l*o.length,e.ang=l}i.rotate(a.heading)}else if(this.objects[0]&&this.objects[1]){e=this.objects[0],n=this.objects[1];var u=m.sub(e.pos,n.pos),y=u.length-this.length;u.setMag(1),u.mult(y*this.springConstant*t),n.vel.add(m.div(u,n.m)),e.vel.add(m.div(u,-e.m)),u=m.sub(e.pos,n.pos);var g=e.vel,v=n.vel;if(g.rotate(-u.heading),v.rotate(-u.heading),this.rotationLocked){var c=new m(e.pos.x*e.m+n.pos.x*n.m,e.pos.y*e.m+n.pos.y*n.m);c.div(e.m+n.m);var f=m.sub(e.pos,c),p=m.sub(n.pos,c),x=f.length*f.length*e.m+e.am+p.length*p.length*n.m+n.am,d=(g.y-v.y)*p.length/(f.length+p.length)+v.y,b=(e.am*e.ang+n.am*n.ang-f.length*e.m*(g.y-d)+p.length*n.m*(v.y-d))/x;g.y=-b*f.length+d,v.y=+b*p.length+d,e.ang=b,n.ang=b}g.rotate(u.heading),v.rotate(u.heading)}}}]),n}();e.exports=a},{"./vec2":8}],7:[function(t,e,n){var a=t("./spring"),w=t("./vec2"),s=function(t){function n(t){_classCallCheck(this,n);var e=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.springConstant=0,e}return _inherits(n,a),_createClass(n,[{key:"update",value:function(t){var e=void 0,n=void 0;if(this.pinned&&this.objects[0]){n=this.pinned,e=this.objects[0];var a=new w(n.x-e.pos.x,n.y-e.pos.y);a.setMag(1),a.mult(-this.length),e.move(-e.pos.x+n.x+a.x,-e.pos.y+n.y+a.y);var s=e.vel;if(s.rotate(-a.heading),s.x=0,this.rotationLocked){var i=new w(n.x,n.y),r=w.sub(e.pos,i),o=r.length*r.length*e.m+e.am,h=(e.am*e.ang-r.length*e.m*s.y)/o;s.y=-h*r.length,e.ang=h}s.rotate(a.heading)}else if(this.objects[0]&&this.objects[1]){e=this.objects[0],n=this.objects[1];var l=w.sub(e.pos,n.pos),u=this.length-l.length;l.setMag(1);var y=w.mult(l,u*n.m/(e.m+n.m)),g=w.mult(l,-u*e.m/(e.m+n.m));e.move(y.x,y.y),n.move(g.x,g.y);var v=e.vel,c=n.vel;if(v.rotate(-l.heading),c.rotate(-l.heading),v.x=c.x=(e.m*v.x+n.m*c.x)/(e.m+n.m),this.rotationLocked){var f=new w(e.pos.x*e.m+n.pos.x*n.m,e.pos.y*e.m+n.pos.y*n.m);f.div(e.m+n.m);var p=w.sub(e.pos,f),x=w.sub(n.pos,f),d=p.length*p.length*e.m+e.am+x.length*x.length*n.m+n.am,b=(v.y-c.y)*x.length/(p.length+x.length)+c.y,m=(e.am*e.ang+n.am*n.ang-p.length*e.m*(v.y-b)+x.length*n.m*(c.y-b))/d;v.y=-m*p.length+b,c.y=+m*x.length+b,e.ang=m,n.ang=m}v.rotate(l.heading),c.rotate(l.heading)}}}]),n}();e.exports=s},{"./spring":6,"./vec2":8}],8:[function(t,e,n){var a=function(){function a(t,e){_classCallCheck(this,a),this.x=t,this.y=e}return _createClass(a,[{key:"add",value:function(t){this.x+=t.x,this.y+=t.y}},{key:"sub",value:function(t){this.x-=t.x,this.y-=t.y}},{key:"mult",value:function(t){this.x*=t,this.y*=t}},{key:"div",value:function(t){this.x/=t,this.y/=t}},{key:"lerp",value:function(t,e){this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e}},{key:"dist",value:function(t){return new a(this.x-t.x,this.y-t.y).length}},{key:"setMag",value:function(t){0!==this.length&&this.mult(t/this.length)}},{key:"rotate",value:function(t){var e=this.heading,n=a.fromAngle(t+e);n.mult(this.length),this.x=n.x,this.y=n.y}},{key:"copy",get:function(){return new a(this.x,this.y)}},{key:"length",get:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"sqlength",get:function(){return this.x*this.x+this.y*this.y}},{key:"heading",get:function(){if(0===this.x&&0===this.y)return 0;if(0===this.x)return 0<this.y?Math.PI/2:1.5*Math.PI;if(0===this.y)return 0<this.x?0:Math.PI;var t=a.normalized(this);return 0<this.x&&0<this.y?Math.asin(t.y):this.x<0&&0<this.y?Math.asin(-t.x)+Math.PI/2:this.x<0&&this.y<0?Math.asin(-t.y)+Math.PI:0<this.x&&this.y<0?Math.asin(t.x)+1.5*Math.PI:0}}],[{key:"add",value:function(t,e){return new a(t.x+e.x,t.y+e.y)}},{key:"sub",value:function(t,e){return new a(t.x-e.x,t.y-e.y)}},{key:"mult",value:function(t,e){return new a(t.x*e,t.y*e)}},{key:"div",value:function(t,e){return new a(t.x/e,t.y/e)}},{key:"fromAngle",value:function(t){return new a(Math.cos(t),Math.sin(t))}},{key:"lerp",value:function(t,e,n){return a.add(t,a.mult(a.sub(e,t),n))}},{key:"dist",value:function(t,e){return a.sub(t,e).length}},{key:"dot",value:function(t,e){return t.x*e.x+t.y*e.y}},{key:"cross",value:function(t,e){return t.x*e.y-t.y*e.x}},{key:"angle",value:function(t,e){return Math.acos(a.dot(t,e)/Math.sqrt(t.sqlength*e.sqlength))}},{key:"angleACW",value:function(t,e){var n=t.heading,a=e.heading-n;return a<0?2*Math.PI+a:a}},{key:"normalized",value:function(t){var e=t.length;return 0===e?t:new a(t.x/e,t.y/e)}}]),a}();e.exports=a},{}],9:[function(t,e,n){var y=t("./vec2"),a=function(){function h(t){_classCallCheck(this,h),this.points=t;var e=this.points,n=0,a=0,s=y.angleACW(y.sub(e[1],e[0]),y.sub(e[e.length-1],e[0]));n+=s,a+=2*Math.PI-s;for(var i=1;i<e.length-1;i++)n+=s=y.angleACW(y.sub(e[(i+1)%e.length],e[i]),y.sub(e[i-1],e[i])),a+=2*Math.PI-s;if(!((n+=s=y.angleACW(y.sub(e[0],e[e.length-1]),y.sub(e[e.length-2],e[e.length-1])))<(a+=2*Math.PI-s))){for(var r=[],o=e.length-1;0<=o;o--)r.push(e[o]);this.points=r}}return _createClass(h,[{key:"collideWithBall",value:function(o){var h=this,l=null,u=null;if(this.points.forEach(function(t,e){var n=new y(t.x,t.y);n.x-=o.pos.x,n.y-=o.pos.y,n.mult(-1),n.length<=o.r&&(l=n.heading,u=n.length),n=new y(t.x,t.y);var a=new y(h.points[(e+1)%h.points.length].x,h.points[(e+1)%h.points.length].y),s=new y(o.pos.x,o.pos.y),i=new y(a.x-n.x,a.y-n.y).heading;n.rotate(-i+Math.PI),a.rotate(-i+Math.PI),s.rotate(-i+Math.PI);var r=s.y-(n.y+a.y)/2;r>=-o.r&&r<=o.r&&s.x>=a.x&&s.x<=n.x&&(l=i-Math.PI/2,u=r)}),0===l||l){var t=new y(o.pos.x,o.pos.y),e=new y(o.vel.x,o.vel.y);t.rotate(-l+Math.PI/2),e.rotate(-l+Math.PI/2),e.y*=-o.k,t.y+=o.r-u;var n=e.y*(1+1/o.k),a=Math.abs(n)*o.fc*Math.sign(e.x-o.ang*o.r)*-1;Math.abs(a)>Math.abs(e.x-o.ang*o.r)&&(a=-e.x+o.ang*o.r),e.x+=a-o.r*o.r*o.m*a/(o.am+o.r*o.r*o.m),o.ang-=o.r*o.r*o.m*a/((o.am+o.r*o.r*o.m)*o.r),t.rotate(l-Math.PI/2),e.rotate(l-Math.PI/2),o.pos.x=t.x,o.pos.y=t.y,o.vel.x=e.x,o.vel.y=e.y}}}]),h}();e.exports=a},{"./vec2":8}]},{},[4])(4)});
(()=>{var Wt=Object.assign,C=class{constructor(t,e){this.x=t,this.y=e}get copy(){return new C(this.x,this.y)}setCoordinates(t,e){this.x=t,this.y=e}get length(){return Math.sqrt(this.x*this.x+this.y*this.y)}get sqlength(){return this.x*this.x+this.y*this.y}get heading(){if(this.x===0&&this.y===0)return 0;if(this.x===0)return this.y>0?Math.PI/2:1.5*Math.PI;if(this.y===0)return this.x>0?0:Math.PI;let t=C.normalized(this);return this.x>0&&this.y>0?Math.asin(t.y):this.x<0&&this.y>0?Math.asin(-t.x)+Math.PI/2:this.x<0&&this.y<0?Math.asin(-t.y)+Math.PI:this.x>0&&this.y<0?Math.asin(t.x)+1.5*Math.PI:0}add(t){this.x+=t.x,this.y+=t.y}sub(t){this.x-=t.x,this.y-=t.y}mult(t){this.x*=t,this.y*=t}div(t){this.x/=t,this.y/=t}lerp(t,e){this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e}dist(t){return new C(this.x-t.x,this.y-t.y).length}pNorm(t){let e=t;return e<1&&(e=1),(Math.abs(this.x**e)+Math.abs(this.y**e))**(1/e)}setMag(t){this.length!==0&&this.mult(t/this.length)}normalize(){this.length!==0&&this.div(this.length)}rotate(t){let e=Math.cos(t),s=Math.sin(t);this.setCoordinates(this.x*e-this.y*s,this.x*s+this.y*e)}static rotateArr(t,e){let s=Math.cos(e),i=Math.sin(e);t.forEach(a=>{a.setCoordinates(a.x*s-a.y*i,a.x*i+a.y*s)})}rotate90(){let{x:t}=this;this.x=-this.y,this.y=t}rotate270(){let{x:t}=this;this.x=this.y,this.y=-t}static add(t,e){return new C(t.x+e.x,t.y+e.y)}static sub(t,e){return new C(t.x-e.x,t.y-e.y)}static mult(t,e){return new C(t.x*e,t.y*e)}static div(t,e){return new C(t.x/e,t.y/e)}static fromAngle(t){return new C(Math.cos(t),Math.sin(t))}static fromAnglePNorm(t,e){let s=new C(Math.cos(t),Math.sin(t));return s.div(s.pNorm(e)),s}static lerp(t,e,s){return C.add(t,C.mult(C.sub(e,t),s))}static dist(t,e){return C.sub(t,e).length}static dot(t,e){return t.x*e.x+t.y*e.y}static cross(t,e){return t.x*e.y-t.y*e.x}static crossScalarFirst(t,e){return new C(-e.y*t,e.x*t)}static crossScalarSecond(t,e){return new C(t.y*e,-t.x*e)}static angle(t,e){return Math.acos(Math.min(Math.max(C.dot(t,e)/Math.sqrt(t.sqlength*e.sqlength),1),-1))}static angleACW(t,e){let s=t.heading,a=e.heading-s;return a<0?2*Math.PI+a:a}static normalized(t){let e=t.length;return e===0?t:new C(t.x/e,t.y/e)}toJSON(){return{x:this.x,y:this.y}}static fromObject(t){return new C(t.x,t.y)}},n=C,Dt=class{constructor(t,e){this.a=t,this.b=e}get length(){return n.dist(this.a,this.b)}distFromPoint(t){let e=n.sub(this.a,this.b),s=n.sub(t,this.b),i=n.sub(t,this.a),a=s.length,r=i.length,h=e.length;if(h===0)return a;let u=n.angle(s,i),l=n.angle(s,e),c=Math.PI-u-l,m=Math.sin(c)*r*h/2,d=2*m/h;return c>Math.PI/2?r:l>Math.PI/2?a:d}get nearestPointO(){let t=n.sub(this.b,this.a);if(n.dot(this.a,t)>=0)return this.a.copy;if(n.dot(this.b,t)<=0)return this.b.copy;t.normalize();let e=-n.dot(this.a,t);return n.add(this.a,n.mult(t,e))}static intersect(t,e){let s=n.sub(t.b,t.a),i=s.y/s.x,a=t.b.y-t.b.x*i,r=n.sub(e.b,e.a),h=r.y/r.x,u=e.b.y-e.b.x*h;if(s.x===0&&r.x!==0){if(t.a.x>=e.a.x&&t.a.x<=e.b.x||t.a.x<=e.a.x&&t.a.x>=e.b.x){let p=h*t.a.x+u;if(p>t.a.y&&p<t.b.y||p<t.a.y&&p>t.b.y)return new n(t.a.x,p)}return!1}if(r.x===0&&s.x!==0){if(e.a.x>=t.a.x&&e.a.x<=t.b.x||e.a.x<=t.a.x&&e.a.x>=t.b.x){let p=i*e.a.x+a;if(p>e.a.y&&p<e.b.y||p<e.a.y&&p>e.b.y)return new n(e.a.x,p)}return!1}if(s.x===0&&r.x===0){if(t.a.x===e.a.x){let p;t.a.y<t.b.y?p=[t.a.y,t.b.y]:p=[t.b.y,t.a.y];let f;e.a.y<e.b.y?f=[e.a.y,e.b.y]:f=[e.b.y,e.a.y];let g=[p[0]>f[0]?p[0]:f[0],p[1]<f[1]?p[1]:f[1]];if(g[0]<=g[1])return new n(t.a.x,(g[0]+g[1])/2)}return!1}let l;t.a.x<t.b.x?l=[t.a.x,t.b.x]:l=[t.b.x,t.a.x];let c;e.a.x<e.b.x?c=[e.a.x,e.b.x]:c=[e.b.x,e.a.x];let m=[l[0]>c[0]?l[0]:c[0],l[1]<c[1]?l[1]:c[1]];if(i===h&&a===u&&m[0]<=m[1])return new n((m[0]+m[1])/2,(m[0]+m[1])/2*i+a);let d=(u-a)/(i-h);return d>=m[0]&&d<=m[1]?new n(d,d*i+a):!1}},M=Dt,qt=class extends M{get length(){return Number.POSITIVE_INFINITY}distFromPoint(t){let e=n.sub(this.a,this.b);e.setMag(1),e.rotate(Math.PI/2);let s=n.sub(t,this.a);return Math.abs(n.dot(s,e))}static intersect(t,e){let s=n.sub(t.b,t.a),i=s.y/s.x,a=t.b.y-t.b.x*i,r=n.sub(e.b,e.a),h=r.y/r.x,u=e.b.y-e.b.x*h;if(i===h)return t.distFromPoint(e.a)===0?new n((t.a.x+t.b.x+e.a.x+e.b.x)/4,(t.a.y+t.b.y+e.a.y+e.b.y)/4):!1;let l=(u-a)/(i-h);return new n(l,i*l+a)}static intersectWithLineSegment(t,e){let s=n.sub(t.b,t.a),i=s.y/s.x,a=t.b.y-t.b.x*i,r=n.sub(e.b,e.a),h=r.y/r.x,u=e.b.y-e.b.x*h;if(s.x===0){if(r.x===0)return t.a.x===e.a.x?new n((e.a.x+e.b.x)/2,(e.a.y+e.b.y)/2):!1;let m=t.a.x,d=h*m+u;return Math.min(e.a.x,e.b.x)<m&&m<Math.max(e.a.x,e.b.x)&&Math.min(e.a.y,e.b.y)<d&&Math.max(e.a.y,e.b.y)>d?new n(m,d):!1}if(r.x===0){let m=e.a.x,d=i*m+a;return Math.min(e.a.x,e.b.x)<m&&m<Math.max(e.a.x,e.b.x)&&Math.min(e.a.y,e.b.y)<d&&Math.max(e.a.y,e.b.y)>d?new n(m,d):!1}if(i===h)return t.distFromPoint(e.a)===0?new n((e.a.x+e.b.x)/2,(e.a.y+e.b.y)/2):!1;let l=(u-a)/(i-h),c=i*l+a;return Math.min(e.a.x,e.b.x)<l&&l<Math.max(e.a.x,e.b.x)&&Math.min(e.a.y,e.b.y)<c&&Math.max(e.a.y,e.b.y)>c?new n(l,c):!1}},U=qt;function V(o,t,e,s){let i=s,a=e,r=o,h=t,u=r.vel,l=h.vel,c=r.ang,m=h.ang,d=n.sub(a,r.pos),p=n.sub(a,h.pos),f=r.am,g=h.am,y=r.m,b=h.m,S=(r.k+h.k)/2,k=(r.fc+h.fc)/2,x=r.velInPlace(a),lt=h.velInPlace(a),P=n.sub(lt,x),I=1/y+1/b;I+=n.dot(n.crossScalarFirst(n.cross(d,i)/f,d),i),I+=n.dot(n.crossScalarFirst(n.cross(p,i)/g,p),i),I=-((1+S)*n.dot(P,i))/I;let ut=n.sub(u,n.mult(i,I/y)),dt=n.add(l,n.mult(i,I/b)),Rt=c-I*n.cross(d,i)/f,Ht=m+I*n.cross(p,i)/g,X=P.copy;X.sub(n.mult(i,n.dot(P,i))),X.setMag(1);let j=1/y+1/b;j+=n.dot(n.crossScalarFirst(n.cross(d,X)/f,d),X),j+=n.dot(n.crossScalarFirst(n.cross(p,X)/g,p),X),j=-n.dot(P,X)/j;let q=Math.sign(j)*I*k;Math.abs(q)>Math.abs(j)&&(q=j),ut=n.sub(ut,n.mult(X,q/y)),dt=n.add(dt,n.mult(X,q/b)),Rt-=q*n.cross(d,X)/f,Ht+=q*n.cross(p,X)/g,r.vel=ut,h.vel=dt,r.ang=Rt,h.ang=Ht}function R(o,t,e){let s=t,i=e,a=o,r=n.sub(s,a.pos),{am:h,m:u}=a,l=n.mult(a.velInPlace(s),-1),c=1/u;c+=n.dot(n.crossScalarFirst(n.cross(r,i)/h,r),i),c=-((1+a.k)*n.dot(l,i))/c;let m=n.sub(a.vel,n.mult(i,c/u)),d=a.ang-c*n.cross(r,i)/h,p=l.copy;p.sub(n.mult(i,n.dot(l,i))),p.setMag(1);let f=1/u;f+=n.dot(n.crossScalarFirst(n.cross(r,p)/h,r),p),f=-n.dot(l,p)/f;let g=Math.sign(f)*c*a.fc;Math.abs(g)>Math.abs(f)&&(g=f),m=n.sub(m,n.mult(p,g/u)),d-=g*n.cross(r,p)/h,a.vel=m,a.ang=d}function L(o,t){this.min=o,this.max=t}L.prototype.size=function(){return this.max-this.min};function Y(o){return new L(Math.min(...o),Math.max(...o))}function $(o,t){return new L(Math.max(o.min,t.min),Math.min(o.max,t.max))}function Gt(o,t,e,s){let i=[...e,...s],a=d=>Y(o.map(p=>n.dot(p,d))),r=d=>Y(t.map(p=>n.dot(p,d))),h=[];if(i.some(d=>{let p=a(d),f=r(d),g=$(p,f);return h.push(g),g.max<g.min}))return!1;let u=h.map(d=>d.size()),l=u[0],c=0;for(let d=1;d<u.length;d+=1)l>u[d]&&(l=u[d],c=d);return{normal:i[c].copy,overlap:l,index:c}}var K=class{constructor(t,e,s,i,a,r){this.pos=t.copy,this.lastPos=this.pos.copy,this.r=s,this.fc=.4,this.amc=.5,this.density=1,this.rotation=0,a?this.ang=a:this.ang=0,(r||r===0)&&(this.fc=r),i?this.k=i:this.k=.8,e!==void 0?this.vel=e.copy:this.vel=new n(0,0),this.layer=void 0}get m(){return this.density*this.r*this.r*Math.PI}get am(){return this.amc*this.r*this.r*this.m}getAmInPoint(t){let e=this.am;return e+=n.sub(this.pos,t).sqlength*this.m,e}get copy(){let t=new K(this.pos.copy,this.vel.copy,this.r,this.k,this.ang,this.fc);return t.lastPos=this.lastPos.copy,t.rotation=this.rotation,t}move(t,e){this.pos.x+=t,this.pos.y+=e}rotate(t){this.rotation+=t}collided(t){return this.pos.dist(t.pos)<this.r+t.r}static collide(t,e){if(!!t.collided(e)){let s=n.dist(t.pos,e.pos),i=t.m,a=e.m,r=t.pos.copy,h=e.pos.copy,u=t,l=e,c=t.r+e.r-s,m=n.sub(t.pos,e.pos);if(m.setMag(1),m.mult(c*a/(i+a)),r.add(m),m.setMag(1),m.mult(-c*i/(i+a)),h.add(m),u.pos=r,l.pos=h,!(n.dot(m,n.sub(t.vel,e.vel))<0)){m.setMag(1);let d=n.add(t.pos,n.mult(m,t.r));return V(t,e,d,m),{cp:d,n:m}}}}containsPoint(t){return n.dist(this.pos,t)<=this.r}velInPlace(t){let e=n.sub(t,this.pos);return e.rotate(Math.PI/2),e.mult(this.ang),e.add(this.vel),e}effectiveMass(t,e){let s=n.sub(t,this.pos);if(s.length===0)return this.m;let i=n.angle(e,s),a=Math.sin(i)**2*s.length**2/this.am;return 1/(a+1/this.m)}applyDeltaVelInPoint(t,e){let s=n.sub(e,this.pos);if(s.length===0){this.vel.add(t);return}let i=n.angle(s,t),a=n.mult(s,n.dot(t,s)/s.length**2);this.vel.add(a);let r=s.copy;r.rotate(Math.PI/2),r.setMag(1);let h=Math.sign(n.dot(t,r)),u=t.length*Math.cos(i),l=1/(1/this.m+s.length**2/this.am),c=u*l/this.m;this.vel.add(n.mult(r,c*h));let m=h*u*l*s.length/this.am;this.ang-=m}toJSON(){let t={};return t.pos=this.pos.toJSON(),t.lastPos=this.lastPos.toJSON(),t.r=this.r,t.fc=this.fc,t.amc=this.amc,t.rotation=this.rotation,t.ang=this.ang,t.fc=this.fc,t.k=this.k,t.vel=this.vel.toJSON(),typeof this.layer!="undefined"&&(t.layer=this.layer),t}static fromObject(t){let e=new K(n.fromObject(t.pos),n.fromObject(t.vel),t.r,t.k,t.ang,t.fc);return e.lastPos=n.fromObject(t.lastPos),e.amc=t.amc,e.rotation=t.rotation,e.vel=n.fromObject(t.vel),typeof t.layer!="undefined"&&(e.layer=t.layer),e}},E=K,Ce=15,tt=class{constructor(t){this.points=t;let e=this.points,s=0,i=0,a=n.angleACW(n.sub(e[1],e[0]),n.sub(e[e.length-1],e[0]));this.points.length>0?[this.center]=[this.points[0]]:this.center=new n(0,0),this.boundRadius=1,this.calculateCenterAndRadius(),this.boundsX=new L(0,0),this.boundsY=new L(0,0),this.calculateBoundingBox(),this.axes=[],this.calculateAxes(),s+=a,i+=Math.PI*2-a;for(let h=1;h<e.length-1;h+=1)a=n.angleACW(n.sub(e[(h+1)%e.length],e[h]),n.sub(e[h-1],e[h])),s+=a,i+=Math.PI*2-a;if(a=n.angleACW(n.sub(e[0],e[e.length-1]),n.sub(e[e.length-2],e[e.length-1])),s+=a,i+=Math.PI*2-a,!(i>s)){let r=[];for(let h=e.length-1;h>=0;h-=1)r.push(e[h]);this.points=r}}calculateBoundingBox(){this.boundsX=Y(this.points.map(t=>t.x)),this.boundsY=Y(this.points.map(t=>t.y))}calculateAxes(){let t=Math.cos(Math.PI/Ce);this.axes=this.normals.map(e=>new n(e.x,Math.abs(e.y)));for(let e=this.axes.length-2;e>=0;e-=1)for(let s=this.axes.length-1;s>e;s-=1){let i=this.axes[s],a=this.axes[e];Math.abs(n.dot(i,a))>t&&(this.axes.splice(s,1),this.axes[e]=i)}}collideWithBall(t){let e,s,i=t,a=this.points.some((r,h)=>{let u=n.sub(i.pos,r);u.sqlength<=t.r*t.r&&(e=r,s=u);let l=this.points[(h+1)%this.points.length].copy,c=new n(l.x-r.x,l.y-r.y),m=c.sqlength;c.setMag(1);let d=c.copy;d.rotate270();let p=n.dot(u,c),f=n.dot(u,d);return f>=-t.r&&f<t.r&&p>=0&&p*p<=m?(e=n.add(r,n.mult(c,p)),s=d,!0):!1});if(typeof s!="undefined"&&(a||s.setMag(1),typeof e!="undefined"))return s.mult(-1),i.pos=n.add(e,n.mult(s,-t.r)),R(i,e,s),{cp:e,n:s}}get normals(){return this.sides.map(t=>{let e=n.sub(t.b,t.a);return e.setMag(1),e.rotate270(),e})}containsPoint(t){let{sides:e}=this,s=Math.max(...this.points.map(h=>n.dist(h,t)))+1,i=n.fromAngle(0);i.setMag(s);let a=new M(t,n.add(i,t));return e.filter(h=>M.intersect(h,a)!==void 0).length%2===1}calculateCenterAndRadius(){this.center=this.points.reduce((t,e)=>n.add(t,e)),this.center.div(this.points.length),this.boundRadius=Math.max(...this.points.map(t=>n.dist(t,this.center)))}get sides(){return this.points.map((t,e)=>new M(t,this.points[(e+1)%this.points.length]))}toJSON(){let t={};return t.points=this.points.map(e=>({x:e.x,y:e.y})),t}static fromObject(t){return new tt(t.points.map(s=>new n(s.x,s.y)))}},G=tt,Ie=15,Q=class{constructor(t,e,s,i,a){this.points=t,this.pos=new n(t[0].x,t[0].y);let r=this.points,h=0,u=0,l=n.angleACW(n.sub(r[1],r[0]),n.sub(r[r.length-1],r[0]));h+=l,u+=Math.PI*2-l;for(let c=1;c<r.length-1;c+=1)l=n.angleACW(n.sub(r[(c+1)%r.length],r[c]),n.sub(r[c-1],r[c])),h+=l,u+=Math.PI*2-l;if(l=n.angleACW(n.sub(r[0],r[r.length-1]),n.sub(r[r.length-2],r[r.length-1])),h+=l,u+=Math.PI*2-l,u<h){let c=[];for(let m=r.length-1;m>=0;m-=1)c.push(r[m]);this.points=c}this.m=1,this.am=1,this.boundRadius=1,this.boundsX=new L(0,0),this.boundsY=new L(0,0),this.defaultAxes=[],this.axes=[],this.recalculateBoundingBox(),this.calculatePosAndMass(),this.calculateAxes(),this.lastPos=this.pos.copy,this.fc=.4,this.rotation=0,i?this.ang=i:this.ang=0,(a||a===0)&&(this.fc=a),s?this.k=s:this.k=.8,e!==void 0?this.vel=e.copy:this.vel=new n(0,0)}calculateAxes(){let t=Math.cos(Math.PI/Ie);this.defaultAxes=this.normals.map(e=>new n(e.x,Math.abs(e.y)));for(let e=this.defaultAxes.length-2;e>=0;e-=1)for(let s=this.defaultAxes.length-1;s>e;s-=1){let i=this.defaultAxes[s],a=this.defaultAxes[e];Math.abs(n.dot(i,a))>t&&(this.defaultAxes.splice(s,1),this.defaultAxes[e]=i)}this.axes=this.defaultAxes.map(e=>e.copy)}support(t){let e=Number.NEGATIVE_INFINITY,s=this.pos;return this.points.forEach(i=>{let a=n.dot(t,i);a>e&&(e=a,s=i)}),s.copy}getAmInPoint(t){let e=this.am;return e+=n.sub(this.pos,t).sqlength*this.m,e}get copy(){let t=this.points.map(s=>new n(s.x,s.y)),e=new Q(t,this.vel.copy,this.k,this.ang,this.fc);return e.rotation=this.rotation,e.lastPos=this.lastPos.copy,e.pos=this.pos.copy,e}move(t,e){this.pos.x+=t,this.pos.y+=e,this.points.forEach(s=>{let i=s;i.x+=t,i.y+=e}),this.boundsX.min+=t,this.boundsX.max+=t,this.boundsY.min+=e,this.boundsY.max+=e}recalculateBoundingBox(){this.boundsX=Y(this.points.map(t=>t.x)),this.boundsY=Y(this.points.map(t=>t.y))}collideWithBall(t){let e,s,i;if(!(n.dist(t.pos,this.pos)>t.r+this.boundRadius)&&(this.points.forEach((a,r)=>{let h=new n(a.x,a.y);if(h.x-=t.pos.x,h.y-=t.pos.y,h.length<=t.r){e=h.heading+Math.PI,s=h.length;let p=n.fromAngle(e);p.mult(t.r-s),this.move(p.x*-1*t.m/(this.m+t.m),p.y*-1*t.m/(this.m+t.m)),t.move(p.x*1*this.m/(this.m+t.m),p.y*1*this.m/(this.m+t.m)),i=new n(a.x,a.y)}h=new n(a.x,a.y);let u=new n(this.points[(r+1)%this.points.length].x,this.points[(r+1)%this.points.length].y),l=new n(t.pos.x,t.pos.y),m=new n(u.x-h.x,u.y-h.y).heading;h.rotate(-m+Math.PI),u.rotate(-m+Math.PI),l.rotate(-m+Math.PI);let d=l.y-(h.y+u.y)/2;if(d>=-t.r&&d<=t.r&&l.x>=u.x&&l.x<=h.x){e=m-Math.PI/2,s=d;let p=n.fromAngle(e);p.mult(t.r-s),this.move(p.x*-1*t.m/(this.m+t.m),p.y*-1*t.m/(this.m+t.m)),t.move(p.x*1*this.m/(this.m+t.m),p.y*1*this.m/(this.m+t.m)),i=t.pos.copy,i.add(n.mult(n.fromAngle(e+Math.PI),d))}}),Number.isFinite(e)&&i)){let a=n.sub(i,t.pos);return a.setMag(-1),V(this,t,i,a),{cp:i,n:a}}}calculatePosAndMass(){let t=[];if(t.push([]),this.points.forEach(a=>{t[0].push(new n(a.x,a.y))}),this.isConcave){let a=(l,c)=>{for(let m=0;m<l.length;m+=1)if(l[m]===c)return!0;return!1},r=(l,c,m)=>{for(let d=0;d<c.length;d+=1)if(!a(m,d)){let p=new M(new n(c[d].x,c[d].y),new n(c[(d+1)%c.length].x,c[(d+1)%c.length].y));if(M.intersect(l,p))return!0}return!1},h=!0,u=()=>{h=!1;for(let l=0;l<t.length;l+=1){let c=t[l],m=n.sub(c[1],c[0]),d=n.sub(c[c.length-1],c[0]),p=n.angleACW(m,d);if(p>Math.PI){h=!0;let f=0,g=f+2,y=new M(new n(c[f].x,c[f].y),new n(c[g%c.length].x,c[g%c.length].y)),b=new n(y.b.x-y.a.x,y.b.y-y.a.y).heading;for(;!(m.heading>d.heading?b>m.heading&&b<2*Math.PI||b>0&&b<d.heading:b>m.heading&&b<d.heading)||r(new M(new n(c[f%c.length].x,c[f%c.length].y),new n(c[g%c.length].x,c[g%c.length].y)),c,[(c.length-1)%c.length,f%c.length,(g-1)%c.length,g%c.length]);)g+=1,y=new M(new n(c[f].x,c[f].y),new n(c[g%c.length].x,c[g%c.length].y)),b=new n(y.b.x-y.a.x,y.b.y-y.a.y).heading;let S=[],k=[];for(let x=f;x<=g;x+=1)S.push(c[x%c.length]);for(let x=g;x<=f+c.length;x+=1)k.push(c[x%c.length]);t[l]=S,t.push(k);return}for(let f=1;f<c.length;f+=1)if(m=n.sub(c[(f+1)%c.length],c[f]),d=n.sub(c[f-1],c[f]),p=n.angleACW(m,d),p>Math.PI){h=!0;let g=f+2,y=new M(new n(c[f].x,c[f].y),new n(c[g%c.length].x,c[g%c.length].y)),b=new n(y.b.x-y.a.x,y.b.y-y.a.y).heading;for(;!(m.heading>d.heading?b>m.heading&&b<2*Math.PI||b>0&&b<d.heading:b>m.heading&&b<d.heading)||r(y,c,[(f-1)%c.length,f%c.length,(g-1)%c.length,g%c.length]);)g+=1,y=new M(new n(c[f].x,c[f].y),new n(c[g%c.length].x,c[g%c.length].y)),b=new n(y.b.x-y.a.x,y.b.y-y.a.y).heading;let S=[],k=[];for(let x=f;x<=g;x+=1)S.push(c[x%c.length]);for(let x=g;x<=f+c.length;x+=1)k.push(c[x%c.length]);t[l]=S,t.push(k);return}}};for(;h;)u()}for(let a=t.length-1;a>=0;a-=1){let r=t[a];for(;r.length>3;)t.push([r[0],r[1],r[2]]),r.splice(1,1)}let e=0,s=0,i=new n(0,0);t.forEach(a=>{let r=Math.sqrt((a[0].x-a[1].x)**2+(a[0].y-a[1].y)**2),h=Math.sqrt((a[1].x-a[2].x)**2+(a[1].y-a[2].y)**2),u=Math.sqrt((a[2].x-a[0].x)**2+(a[2].y-a[0].y)**2),l=(r+h+u)/2,c=Math.sqrt(l*(l-r)*(l-h)*(l-u));e+=c,i.x+=c*(a[0].x+a[1].x+a[2].x)/3,i.y+=c*(a[0].y+a[1].y+a[2].y)/3}),i.div(e),this.pos=i,this.m=e,t.forEach(a=>{let r=Math.sqrt((a[0].x-a[1].x)**2+(a[0].y-a[1].y)**2),h=Math.sqrt((a[1].x-a[2].x)**2+(a[1].y-a[2].y)**2),u=Math.sqrt((a[2].x-a[0].x)**2+(a[2].y-a[0].y)**2),l=(r+h+u)/2,c=Math.sqrt(l*(l-r)*(l-h)*(l-u)),d=new U(a[1],a[2]).distFromPoint(a[0]),p=n.sub(a[2],a[1]);p.rotate90(),p.add(a[1]),r=new U(a[1],p).distFromPoint(a[0]);let g=(h*h*h*d-h*h*d*r+h*d*r*r+h*d*d*d)/36;g+=new n((a[0].x+a[1].x+a[2].x)/3,(a[0].y+a[1].y+a[2].y)/3).dist(this.pos)**2*c,s+=g}),this.am=s,this.boundRadius=Math.max(...this.points.map(a=>n.dist(a,this.pos)))}rotate(t){this.points.forEach(e=>{let s=e;s.sub(this.pos),s.rotate(t),s.add(this.pos)}),this.rotation+=t,this.recalculateBoundingBox(),n.rotateArr(this.axes,t)}get isConcave(){let t=this.points,e=n.angleACW(n.sub(t[1],t[0]),n.sub(t[t.length-1],t[0]));if(e>Math.PI)return!0;for(let s=1;s<t.length-1;s+=1)if(e=n.angleACW(n.sub(t[(s+1)%t.length],t[s]),n.sub(t[s-1],t[s])),e>Math.PI)return!0;return e=n.angleACW(n.sub(t[0],t[t.length-1]),n.sub(t[t.length-2],t[t.length-1])),e>Math.PI}static collide(t,e){let s=t,i=e,a=[...s.axes,...i.axes],r=a.map(P=>Y(s.points.map(I=>n.dot(I,P)))),h=a.map(P=>Y(i.points.map(I=>n.dot(I,P)))),l=a.map((P,I)=>$(r[I],h[I])).map(P=>P.max-P.min);if(!l.some(P=>P<0)){let c=Number.MAX_VALUE,m=0;l.forEach((P,I)=>{P<c&&(c=P,m=I)});let d,p,f=a[m].copy;n.dot(n.sub(s.pos,i.pos),f)>0&&f.mult(-1);let g=n.mult(f,-(c*s.m)/(s.m+i.m)),y=n.mult(f,c*i.m/(s.m+i.m));m<s.axes.length?(d=i,p=s):(d=s,p=i),s.move(g.x,g.y),i.move(y.x,y.y);let b=n.sub(d.pos,p.pos),S;if(n.dot(b,f)>=0)S=d.points.map(P=>n.dot(P,f));else{let P=n.mult(f,-1);S=d.points.map(I=>n.dot(I,P))}let k=d.points[S.indexOf(Math.min(...S))],x=s.velInPlace(k),lt=i.velInPlace(k);if(!(n.dot(x,f)<n.dot(lt,f)))return f.mult(1),V(s,i,k,f),{n:f,cp:k}}}get normals(){return this.sides.map(t=>{let e=n.sub(t.b,t.a);return e.setMag(1),e.rotate270(),e})}collideWithFixedBall(t){let e,s,i=t,a=this.points.some((r,h)=>{let u=n.sub(i,r);u.sqlength<=i.r*i.r&&(e=r,s=u);let l=this.points[(h+1)%this.points.length].copy,c=new n(l.x-r.x,l.y-r.y),m=c.sqlength;c.setMag(1);let d=c.copy;d.rotate270();let p=n.dot(u,c),f=n.dot(u,d);return f>=-i.r&&f<i.r&&p>=0&&p*p<=m?(e=n.add(r,n.mult(c,p)),s=d,!0):!1});if(typeof s!="undefined"&&(a||s.setMag(1),typeof e!="undefined")){let r=n.sub(e,i).length-i.r,h=n.mult(s,r);return this.move(h.x,h.y),R(this,e,s),{cp:e,n:s}}}collideWithWall(t){let e=$(this.boundsX,t.boundsX),s=$(this.boundsY,t.boundsY);if(!(e.size()<=0||s.size()<=0)){let i=Gt(this.points,t.points,this.axes,t.axes);if(typeof i!="boolean"){let{normal:a,overlap:r,index:h}=i;n.dot(n.sub(this.pos,t.center),a)<0&&a.mult(-1);let u=n.mult(a,r),l,c;h<this.axes.length?(l=t,c=n.sub(l.center,this.pos)):(l=this,c=n.sub(this.pos,t.center)),this.move(u.x,u.y);let m;n.dot(c,a)>=0?m=l.points.map(f=>n.dot(f,a)):m=l.points.map(f=>-n.dot(f,a));let d=l.points[m.indexOf(Math.min(...m))],p=this.velInPlace(d);return n.dot(p,a)>0?void 0:(a.mult(-1),R(this,d,a),{n:a,cp:d})}}}containsPoint(t){let{sides:e}=this,s=Math.max(...this.points.map(h=>n.dist(h,t)))+1,i=new n(s,0),a=new M(t,n.add(i,t));return e.filter(h=>M.intersect(h,a)instanceof Object).length%2===1}get sides(){return this.points.map((t,e)=>new M(t,this.points[(e+1)%this.points.length]))}velInPlace(t){let e=n.sub(t,this.pos);return e.rotate(Math.PI/2),e.mult(this.ang),e.add(this.vel),e}effectiveMass(t,e){let s=n.sub(t,this.pos),i=n.angle(e,s),a=Math.sin(i)**2*s.length**2/this.am;return 1/(a+1/this.m)}applyDeltaVelInPoint(t,e){let s=n.sub(e,this.pos);if(s.length===0){this.vel.add(t);return}let i=n.angle(s,t),a=n.mult(s,n.dot(t,s)/s.length**2);this.vel.add(a);let r=s.copy;r.rotate(Math.PI/2),r.setMag(1);let h=Math.sign(n.dot(t,r)),u=t.length*Math.cos(i),l=1/(1/this.m+s.length**2/this.am),c=u*l/this.m;this.vel.add(n.mult(r,c*h));let m=h*u*l*s.length/this.am;this.ang-=m}toJSON(){let t={};return t.points=this.points.map(e=>({x:e.x,y:e.y})),t.vel=this.vel.toJSON(),t.k=this.k,t.ang=this.ang,t.fc=this.fc,t.pos=this.pos.toJSON(),t.lastPos=this.lastPos.toJSON(),t.rotation=this.rotation,t}static fromObject(t){let e=new Q(t.points.map(s=>new n(s.x,s.y)),n.fromObject(t.vel),t.k,t.ang,t.fc);return e.pos=n.fromObject(t.pos),e.lastPos=n.fromObject(t.lastPos),e.rotation=t.rotation,e}},B=Q,zt=class{constructor(t,e){this.length=t,this.springConstant=e,this.pinned=!1,this.objects=[],this.rotationLocked=!1}pinHere(t,e){this.pinned={x:t,y:e}}unpin(){this.pinned=!1}attachObject(t){let e=this.objects;e.push(t),e.length===2&&(this.pinned=!1),e.length>=3&&(e=[e[e.length-2],e[e.length-1]])}lockRotation(){this.rotationLocked=!0}unlockRotation(){this.rotationLocked=!1}update(t){let e,s;if(this.pinned instanceof Object&&this.objects[0]){[s,e]=[this.pinned,this.objects[0]];let i=new n(s.x-e.pos.x,s.y-e.pos.y),a=i.length-this.length;i.setMag(1),i.mult(a*this.springConstant*t/e.m),e.vel.x+=i.x,e.vel.y+=i.y;let r=e.vel;if(r.rotate(-i.heading),this.rotationLocked){let h=new n(s.x,s.y),l=n.sub(e.pos,h).length,c=l*l*e.m+e.am,m=(e.am*e.ang-l*e.m*r.y)/c;r.y=-m*l,e.ang=m}r.rotate(i.heading)}else if(this.objects[0]&&this.objects[1]){[e,s]=[this.objects[0],this.objects[1]];let i=n.sub(e.pos,s.pos),a=i.length-this.length;i.setMag(1),i.mult(a*this.springConstant*t),s.vel.add(n.div(i,s.m)),e.vel.add(n.div(i,-e.m)),i=n.sub(e.pos,s.pos);let r=e.vel,h=s.vel;if(r.rotate(-i.heading),h.rotate(-i.heading),this.rotationLocked){let u=new n(e.pos.x*e.m+s.pos.x*s.m,e.pos.y*e.m+s.pos.y*s.m);u.div(e.m+s.m);let l=n.sub(e.pos,u),c=n.sub(s.pos,u),m=l.length,d=c.length,p=m*m*e.m+e.am+d*d*s.m+s.am,f=(r.y-h.y)*d/(m+d)+h.y,g=(e.am*e.ang+s.am*s.ang+m*e.m*(r.y-f)-d*s.m*(h.y-f))/p;r.y=g*m+f,h.y=-g*d+f,e.ang=g,s.ang=g}r.rotate(i.heading),h.rotate(i.heading)}}},O=zt,Jt=class extends O{constructor(t){super(t,0);this.springConstant=0}update(){let t,e;if(this.pinned instanceof Object&&"x"in this.pinned&&this.objects[0]){[e,t]=[this.pinned,this.objects[0]];let s=new n(e.x-t.pos.x,e.y-t.pos.y);s.setMag(1),s.mult(-this.length),t.move(-t.pos.x+e.x+s.x,-t.pos.y+e.y+s.y);let i=t.vel;if(i.rotate(-s.heading),i.x=0,this.rotationLocked){let a=new n(e.x,e.y),h=n.sub(t.pos,a).length,u=h*h*t.m+t.am,l=(t.am*t.ang+h*t.m*i.y)/u;i.y=l*h,t.ang=l}i.rotate(s.heading)}else if(this.objects[0]&&this.objects[1]){[t,e]=[this.objects[0],this.objects[1]];let s=n.sub(t.pos,e.pos),i=this.length-s.length;s.setMag(1);let a=n.mult(s,i*e.m/(t.m+e.m)),r=n.mult(s,-i*t.m/(t.m+e.m));t.move(a.x,a.y),e.move(r.x,r.y);let h=t.vel,u=e.vel;if(h.rotate(-s.heading),u.rotate(-s.heading),h.x=(t.m*h.x+e.m*u.x)/(t.m+e.m),u.x=h.x,this.rotationLocked){let l=new n(t.pos.x*t.m+e.pos.x*e.m,t.pos.y*t.m+e.pos.y*e.m);l.div(t.m+e.m);let c=n.sub(t.pos,l),m=n.sub(e.pos,l),d=c.length,p=m.length,f=d*d*t.m+t.am+p*p*e.m+e.am,g=(h.y-u.y)*p/(d+p)+u.y,y=(t.am*t.ang+e.am*e.ang+d*t.m*(h.y-g)-p*e.m*(u.y-g))/f;h.y=y*d+g,u.y=-y*p+g,t.ang=y,e.ang=y}h.rotate(s.heading),u.rotate(s.heading)}}},T=Jt,Ut=class{constructor(t,e,s,i,a){this.points=[],i||i===0?this.fc=i:this.fc=.4,this.pressure=s,a?this.resolution=a:this.resolution=30,this.r=Math.abs(e);let r=Math.random()*1e6;for(let h=0;h<this.resolution;h+=1){let u=new n(t.x,t.y);u.add(n.mult(n.fromAngle(h/this.resolution*Math.PI*2),this.r)),this.points.push(new E(u,new n(0,0),this.r*Math.sin(Math.PI/this.resolution),0,0,this.fc)),this.points[this.points.length-1].layer=r}this.sides=[];for(let h=0;h<this.resolution;h+=1){let u=new T(2*this.r*Math.sin(Math.PI/this.resolution));u.attachObject(this.points[h]),u.attachObject(this.points[(h+1)%this.resolution]),h%2===0&&u.lockRotation(),this.sides.push(u)}}static updatePressureBasedForces(t,e){let s=[];if(s.push([]),t.points.forEach(r=>{s[0].push(new n(r.pos.x,r.pos.y))}),(r=>{let h=n.angleACW(n.sub(r[1],r[0]),n.sub(r[r.length-1],r[0]));if(h>Math.PI)return!0;for(let u=1;u<r.length-1;u+=1)if(h=n.angleACW(n.sub(r[(u+1)%r.length],r[u]),n.sub(r[u-1],r[u])),h>Math.PI)return!0;return h=n.angleACW(n.sub(r[0],r[r.length-1]),n.sub(r[r.length-2],r[r.length-1])),h>Math.PI})(s[0])){let r=(l,c)=>{for(let m=0;m<l.length;m+=1)if(l[m]===c)return!0;return!1},h=(l,c,m)=>{for(let d=0;d<c.length;d+=1)if(!r(m,d)){let p=new M(new n(c[d].x,c[d].y),new n(c[(d+1)%c.length].x,c[(d+1)%c.length].y));if(M.intersect(l,p))return!0}return!1},u=!0;t:for(;u;){u=!1;for(let l=0;l<s.length;l+=1){let c=s[l],m=n.sub(c[1],c[0]),d=n.sub(c[c.length-1],c[0]),p=n.angleACW(m,d);if(p>Math.PI){u=!0;let f=0,g=f+2,y=new M(new n(c[f].x,c[f].y),new n(c[g%c.length].x,c[g%c.length].y)),b=new n(y.b.x-y.a.x,y.b.y-y.a.y).heading;for(;!(m.heading>d.heading?b>m.heading&&b<2*Math.PI||b>0&&b<d.heading:b>m.heading&&b<d.heading)||h(new M(new n(c[f%c.length].x,c[f%c.length].y),new n(c[g%c.length].x,c[g%c.length].y)),c,[(c.length-1)%c.length,f%c.length,(g-1)%c.length,g%c.length]);)g+=1,y=new M(new n(c[f].x,c[f].y),new n(c[g%c.length].x,c[g%c.length].y)),b=new n(y.b.x-y.a.x,y.b.y-y.a.y).heading;let S=[],k=[];for(let x=f;x<=g;x+=1)S.push(c[x%c.length]);for(let x=g;x<=f+c.length;x+=1)k.push(c[x%c.length]);s[l]=S,s.push(k);continue t}for(let f=1;f<c.length;f+=1)if(m=n.sub(c[(f+1)%c.length],c[f]),d=n.sub(c[f-1],c[f]),p=n.angleACW(m,d),p>Math.PI){u=!0;let g=f+2,y=new M(new n(c[f].x,c[f].y),new n(c[g%c.length].x,c[g%c.length].y)),b=new n(y.b.x-y.a.x,y.b.y-y.a.y).heading;for(;!(m.heading>d.heading?b>m.heading&&b<2*Math.PI||b>0&&b<d.heading:b>m.heading&&b<d.heading)||h(y,c,[(f-1)%c.length,f%c.length,(g-1)%c.length,g%c.length]);)g+=1,y=new M(new n(c[f].x,c[f].y),new n(c[g%c.length].x,c[g%c.length].y)),b=new n(y.b.x-y.a.x,y.b.y-y.a.y).heading;let S=[],k=[];for(let x=f;x<=g;x+=1)S.push(c[x%c.length]);for(let x=g;x<=f+c.length;x+=1)k.push(c[x%c.length]);s[l]=S,s.push(k);continue t}}}}for(let r=s.length-1;r>=0;r-=1){let h=s[r];for(;h.length>3;)s.push([h[0],h[1],h[2]]),h.splice(1,1)}let i=0;s.forEach(r=>{let h=Math.sqrt((r[0].x-r[1].x)**2+(r[0].y-r[1].y)**2),u=Math.sqrt((r[1].x-r[2].x)**2+(r[1].y-r[2].y)**2),l=Math.sqrt((r[2].x-r[0].x)**2+(r[2].y-r[0].y)**2),c=(h+u+l)/2;i+=Math.sqrt(c*(c-h)*(c-u)*(c-l))});let a=t.pressure*(t.r*t.r*Math.PI/i)-t.pressure;t.sides.forEach(r=>{let h=n.sub(r.objects[0].pos,r.objects[1].pos);h.mult(a),h.rotate(Math.PI/2),h.mult(e),r.objects[0].vel.add(n.div(h,r.objects[0].m)),r.objects[1].vel.add(n.div(h,r.objects[1].m))})}get sideSegments(){return this.points.map((t,e)=>new M(t.pos,this.points[(e+1)%this.points.length].pos))}containsPoint(t){let e=this.sideSegments,s=Math.max(...this.points.map(h=>n.dist(h.pos,t)))+1,i=n.fromAngle(0);i.setMag(s);let a=new M(t,n.add(i,t));return e.filter(h=>M.intersect(h,a)!==void 0).length%2===1}},H=Ut,z=class{constructor(){this.balls=[],this.bodies=[],this.fixedBalls=[],this.softBalls=[],this.walls=[],this.bounds=[],this.springs=[],this.airFriction=1,this.gravity=new n(0,0),this.addBodyNotBall=!1,this.collisionData=[]}update(t,e){this.collisionData=[];let s=e?this.copy:new z;e&&(s.bodies.reverse(),s.balls.reverse(),s.update(t,!1));for(let i=0;i<this.balls.length;i+=1)this.balls[i].lastPos=this.balls[i].pos.copy,this.balls[i].pos.add(n.mult(this.balls[i].vel,t)),this.balls[i].rotation+=this.balls[i].ang*t,this.balls[i].rotation%=Math.PI*2;for(let i=0;i<this.bodies.length;i+=1)this.bodies[i].lastPos=this.bodies[i].pos.copy,this.bodies[i].move(this.bodies[i].vel.x*t,this.bodies[i].vel.y*t),this.bodies[i].rotate(this.bodies[i].ang*t);for(let i=0;i<3;i+=1)this.springs.forEach(a=>{a.update(t/3/2)});for(let i=0;i<this.balls.length;i+=1){this.gravity&&this.balls[i].vel.add(new n(this.gravity.x*t,this.gravity.y*t));for(let a=i+1;a<this.balls.length;a+=1)if(this.balls[i].layer!==this.balls[a].layer||!this.balls[i].layer&&!this.balls[a].layer){let r=E.collide(this.balls[i],this.balls[a]);r&&this.collisionData.push(r)}this.walls.forEach(a=>{let r=a.collideWithBall(this.balls[i]);r&&this.collisionData.push(r)}),this.fixedBalls.forEach(a=>{let r=this.balls[i],h=n.sub(r.pos,a);if(h.sqlength<=(r.r+a.r)**2){let u=h;u.setMag(1),r.pos=n.add(a,n.mult(u,r.r+a.r)),u.mult(-1),R(r,a,u),this.collisionData.push({cp:n.fromObject(a),n:u})}}),this.bounds.forEach(a=>{let r=a.collideWithBall(this.balls[i]);r&&this.collisionData.push(r)})}for(let i=0;i<this.bodies.length;i+=1){this.balls.forEach(a=>{let r=this.bodies[i].collideWithBall(a);r&&this.collisionData.push(r)});for(let a=i+1;a<this.bodies.length;a+=1){let r=B.collide(this.bodies[i],this.bodies[a]);r&&this.collisionData.push(r)}this.bodies.forEach(a=>{this.fixedBalls.forEach(r=>{let h=a.collideWithFixedBall(r);h&&this.collisionData.push(h)})}),this.bodies.forEach(a=>{this.walls.forEach(r=>{let h=a.collideWithWall(r);h&&this.collisionData.push(h)})}),this.bodies.forEach(a=>{this.bounds.forEach(r=>{let h=a.collideWithWall(r);h&&this.collisionData.push(h)})}),this.gravity&&this.bodies[i].vel.add(new n(this.gravity.x*t,this.gravity.y*t))}this.softBalls.forEach(i=>{H.updatePressureBasedForces(i,t)});for(let i=0;i<3;i+=1)this.springs.forEach(a=>{a.update(t/3/2)});this.balls.forEach(i=>{let a=i;a.vel.mult(this.airFriction**t),a.ang*=this.airFriction**t}),this.bodies.forEach(i=>{let a=i;a.vel.mult(this.airFriction**t),a.ang*=this.airFriction**t}),e&&(s.bodies.reverse(),s.balls.reverse(),this.balls.forEach((i,a)=>{i.move((s.balls[a].pos.x-i.pos.x)*.5,(s.balls[a].pos.y-i.pos.y)*.5),i.vel.add(new n((s.balls[a].vel.x-i.vel.x)*.5,(s.balls[a].vel.y-i.vel.y)*.5));let r=i;r.rotation=(i.rotation+s.balls[a].rotation)/2,r.ang=(i.ang+s.balls[a].ang)/2}),this.bodies.forEach((i,a)=>{let r=s.bodies[a];i.move((r.pos.x-i.pos.x)*.5,(r.pos.y-i.pos.y)*.5),i.vel.add(new n((r.vel.x-i.vel.x)*.5,(r.vel.y-i.vel.y)*.5)),i.rotate((r.rotation-i.rotation)/2);let h=i;h.ang=(i.ang+r.ang)/2}))}get copy(){let t=new z;return t.balls=this.getCopyOfBalls(),t.bodies=this.getCopyOfBodies(),t.fixedBalls=this.fixedBalls,t.walls=this.walls,t.bounds=this.bounds,t.gravity=this.gravity,this.springs.forEach(e=>{let s=e instanceof O?O:T,i=new s(e.length,e.springConstant);i.rotationLocked=e.rotationLocked,i.pinned=e.pinned,e.objects.forEach(a=>{let r=-1;a instanceof E&&(r=this.balls.indexOf(a)),r!==-1?i.attachObject(t.balls[r]):(r=-1,a instanceof B&&(r=this.bodies.indexOf(a)),r!==-1&&i.attachObject(t.bodies[r]))}),t.springs.push(i)}),t}setAirFriction(t){!Number.isFinite(t)||(this.airFriction=t,this.airFriction<0&&(this.airFriction=0),this.airFriction>1&&(this.airFriction=1))}setGravity(t){this.gravity=t.copy}addBall(t){if(this.addBodyNotBall){let e=(s,i,a)=>{let r=[];for(let h=0;h<a;h+=1){let u=n.fromAngle(h/a*2*Math.PI);u.mult(i),u.add(s),r.push(u)}return r};this.bodies.push(new B(e(t.pos,t.r,24),t.vel,t.k,t.ang,t.fc))}else this.balls.push(t)}addBody(t){this.bodies.push(t)}addSoftBall(t){this.balls.push(...t.points),this.springs.push(...t.sides),this.softBalls.push(t)}addSoftSquare(t,e,s,i,a=24,r=1){let h=new H(t,Math.sqrt(e*e/Math.PI),r,s,a);h.sides.forEach(c=>{let m=c;m.length=.96*4*e/h.resolution}),h.points.forEach(c=>{let m=c;m.vel=i.copy}),this.balls.push(...h.points),this.springs.push(...h.sides);let u=e*e*200*r,l=new O(Math.sqrt(h.r*h.r*Math.PI),u/2);l.attachObject(h.points[0]),l.attachObject(h.points[h.resolution/2]),this.springs.push(l),l=new O(Math.sqrt(h.r*h.r*Math.PI),u/2),l.attachObject(h.points[h.resolution/4]),l.attachObject(h.points[3*h.resolution/4]),this.springs.push(l),l=new O(Math.sqrt(2*h.r*h.r*Math.PI),u),l.attachObject(h.points[h.resolution/8]),l.attachObject(h.points[5*h.resolution/8]),this.springs.push(l),l=new O(Math.sqrt(2*h.r*h.r*Math.PI),u),l.attachObject(h.points[3*h.resolution/8]),l.attachObject(h.points[7*h.resolution/8]),this.springs.push(l)}addRectWall(t,e,s,i){let a=[];a.push(new n(t-s/2,e-i/2)),a.push(new n(t+s/2,e-i/2)),a.push(new n(t+s/2,e+i/2)),a.push(new n(t-s/2,e+i/2)),this.walls.push(new G(a))}addRectBody(t,e,s,i,a,r){let h=[];h.push(new n(t-s/2,e-i/2)),h.push(new n(t+s/2,e-i/2)),h.push(new n(t+s/2,e+i/2)),h.push(new n(t-s/2,e+i/2)),this.bodies.push(new B(h,new n(0,0),r,0,a))}addWall(t){this.walls.push(t)}addFixedBall(t,e,s){this.fixedBalls.push({x:t,y:e,r:s})}addSpring(t){this.springs.push(t)}setBounds(t,e,s,i){this.bounds=[];let a=(r,h,u,l)=>{let c=[];return c.push(new n(r-u/2,h-l/2)),c.push(new n(r+u/2,h-l/2)),c.push(new n(r+u/2,h+l/2)),c.push(new n(r-u/2,h+l/2)),new G(c)};this.bounds.push(a(t-s,e,2*s,4*i)),this.bounds.push(a(t+2*s,e,2*s,4*i)),this.bounds.push(a(t,e-i,4*s,i*2)),this.bounds.push(a(t,e+2*i,4*s,2*i))}getObjectAtCoordinates(t,e){let s={x:t,y:e,pinPoint:!0},i=new n(t,e);return this.balls.some(a=>a.containsPoint(i)?(s=a,!0):!1)||(this.bodies.some(a=>a.containsPoint(i)?(s=a,!0):!1)||(this.walls.some(a=>a.containsPoint(i)?(s=a,!0):!1)||(this.fixedBalls.forEach(a=>{n.dist(new n(a.x,a.y),new n(t,e))<=a.r&&(s=a)}),this.softBalls.forEach(a=>{a.containsPoint(i)&&(s=a)})))),s}getCopyOfBalls(){return this.balls.map(t=>t.copy)}getCopyOfBodies(){return this.bodies.map(t=>t.copy)}removeObjFromSystem(t){let e=-1;if(t instanceof E&&(e=this.balls.indexOf(t)),e!==-1){let s=!1;if(this.softBalls.forEach(i=>{i.points.includes(this.balls[e])&&(this.removeObjFromSystem(i),s=!0)}),s)return;this.springs.forEach(i=>{i.objects.includes(this.balls[e])&&this.removeObjFromSystem(i)}),this.balls.splice(e,1);return}if(t instanceof B&&(e=this.bodies.indexOf(t)),e!==-1){this.bodies.splice(e,1);return}if(t instanceof G&&(e=this.walls.indexOf(t)),e!==-1){this.walls.splice(e,1);return}if(t instanceof Object&&"r"in t&&"x"in t&&(e=this.fixedBalls.indexOf(t)),e!==-1){this.fixedBalls.splice(e,1);return}if((t instanceof T||t instanceof O)&&(e=this.springs.indexOf(t)),e!==-1){this.springs.splice(e,1);let s=this.springs[e];this.softBalls.forEach(i=>{s instanceof T&&i.sides.includes(s)&&this.removeObjFromSystem(i)});return}if(t instanceof H&&(e=this.softBalls.indexOf(t)),e!==-1){let s=this.softBalls[e];this.softBalls.splice(e,1),s.points.forEach(i=>{this.removeObjFromSystem(i)})}}getObjectIdentifier(t){return t instanceof E?{type:"ball",index:this.balls.indexOf(t)}:t instanceof B?{type:"body",index:this.bodies.indexOf(t)}:{type:"nothing",index:-1}}toJSON(){let t={};return t.airFriction=this.airFriction,t.gravity=this.gravity.toJSON(),t.balls=this.balls.map(e=>e.toJSON()),t.bodies=this.bodies.map(e=>e.toJSON()),t.bounds=this.bounds.map(e=>e.toJSON()),t.fixedBalls=this.fixedBalls.map(e=>Wt({},e)),t.walls=this.walls.map(e=>e.toJSON()),t.springs=this.springs.map(e=>{let s={};return s.length=e.length,s.pinned=e.pinned,s.rotationLocked=e.rotationLocked,s.springConstant=e.springConstant,e instanceof O?s.type="spring":e instanceof T&&(s.type="stick"),s.objects=e.objects.map(i=>this.getObjectIdentifier(i)),s}),t.softBalls=this.softBalls.map(e=>{let s={};return s.fc=e.fc,s.points=e.points.map(i=>this.getObjectIdentifier(i)),s.pressure=e.pressure,s.r=e.r,s.resolution=e.resolution,s.sides=e.sides.map(i=>this.springs.indexOf(i)),s}),t}stickOrSpringFromObject(t){let e={};return t.type==="spring"?e=new O(t.length,t.springConstant):t.type==="stick"&&(e=new T(t.length)),e.pinned=t.pinned,e.rotationLocked=t.rotationLocked,e.objects=t.objects.map(s=>s.type==="ball"?this.balls[s.index]:this.bodies[s.index]),e}softBallFromObject(t){let e=Object.create(H.prototype);return e.fc=t.fc,e.pressure=t.pressure,e.resolution=t.resolution,e.r=t.r,e.points=t.points.map(s=>this.balls[s.index]),e.sides=t.sides.map(s=>this.springs[s]),e}static fromObject(t){let e=new z;return e.balls=t.balls.map(s=>E.fromObject(s)),e.bounds=t.bounds.map(s=>G.fromObject(s)),e.walls=t.walls.map(s=>G.fromObject(s)),e.bodies=t.bodies.map(s=>B.fromObject(s)),e.fixedBalls=t.fixedBalls,e.airFriction=t.airFriction,e.gravity=n.fromObject(t.gravity),e.springs=t.springs.map(s=>e.stickOrSpringFromObject(s)),e.softBalls=t.softBalls.map(s=>e.softBallFromObject(s)),e}},Z=z,et,J;function mt(o){et=o.getPhysics().toJSON(),J=!0;let t=document.getElementById("pause");t&&(t.onclick=()=>{o.getTimeMultiplier()!==0?o.setTimeMultiplier(0):(o.setTimeMultiplier(1),J===!0&&(et=o.getPhysics().toJSON()),J=!1)});let e=document.getElementById("revert");e&&(e.onclick=()=>{o.setTimeMultiplier(0),o.setPhysics(Z.fromObject(et)),J=!0});let s=document.getElementById("clear all");s&&(s.onclick=()=>{J=!0;let a=o.getPhysics();a.balls=[],a.walls=[],a.softBalls=[],a.springs=[],a.bodies=[],a.fixedBalls=[]});let i=document.getElementById("set start");i&&(i.onclick=()=>{et=o.getPhysics().toJSON(),J=!0,o.setTimeMultiplier(0)})}function w(o){let t=document.createElement("div"),e=document.createElement("h3");return e.innerText=o,e.classList.add("modetitlemargin"),t.appendChild(e),t.classList.add("mode-title"),t.classList.add("bg-blue"),t}function v(o,t,e,s,i,a=1){let r=document.createElement("p");r.innerText=o;let h=document.createElement("input");h.type="range",h.min=t.toString(),h.max=e.toString(),h.step=a.toString(),h.value=s.toString(),h.classList.add("slider"),h.classList.add("fix-width"),h.onchange=i;let u=document.createElement("div");return u.appendChild(r),u.appendChild(h),u}function W(o,t,e){let s=o+Math.random().toString(),i=document.createElement("label");i.innerText=o,i.htmlFor=s,i.classList.add("checkbox-label");let a=document.createElement("input");a.type="checkbox",a.name=s,a.value=t.toString(),a.classList.add("ch-box"),a.onchange=e;let r=document.createElement("div");return r.appendChild(a),r.appendChild(i),r}var st=35,ft=.5,pt=1.5,gt=document.createElement("div"),Vt={name:"Ball creator",description:"",element:gt,drawFunc(o,t){let e=o.cnv.getContext("2d");e.strokeStyle="black",e.beginPath(),e.arc(o.mouseX,o.mouseY,st,0,2*Math.PI),e.stroke(),o.lastX!==0&&o.lastY!==0&&(e.beginPath(),e.moveTo(o.mouseX,o.mouseY),e.lineTo(o.lastX,o.lastY),e.stroke())},startInteractionFunc(o){},endInteractionFunc(o){if(o.lastX!==0&&o.lastY!==0){let t=new E(new n(o.lastX,o.lastY),new n(o.lastX-o.mouseX,o.lastY-o.mouseY),st,ft,0,pt);Number.isFinite(t.pos.x)&&Number.isFinite(t.pos.y)&&Number.isFinite(t.vel.x)&&Number.isFinite(t.vel.y)||(t.vel.x=0,t.vel.y=0),o.physics.addBall(t)}},keyGotUpFunc(o){},keyGotDownFunc(o){}};[w(Vt.name),v("Size",5,120,st,o=>{st=o.target.valueAsNumber}),v("Bounciness",0,1,ft,o=>{ft=o.target.valueAsNumber},.02),v("Coefficient of friction",0,2,pt,o=>{pt=o.target.valueAsNumber},.1)].forEach(gt.appendChild.bind(gt));var $t=Vt,yt=document.createElement("div"),Kt={name:"Delete",description:"",element:yt,drawFunc(o,t){},startInteractionFunc(o){o.choosed&&o.physics.removeObjFromSystem(o.choosed)},endInteractionFunc(o){},keyGotUpFunc(o){},keyGotDownFunc(o){}};[w(Kt.name)].forEach(yt.appendChild.bind(yt));var Qt=Kt,_=35,Se=.5,nt=1.5,bt=24,xt=1e6,vt=document.createElement("div"),Zt={name:"Elastic ball creator",description:"",element:vt,drawFunc(o,t){let e=o.cnv.getContext("2d");e.strokeStyle="black",e.beginPath(),e.arc(o.mouseX,o.mouseY,_,0,2*Math.PI),e.stroke(),o.lastX!==0&&o.lastY!==0&&(e.beginPath(),e.moveTo(o.mouseX,o.mouseY),e.lineTo(o.lastX,o.lastY),e.stroke())},startInteractionFunc(o){},endInteractionFunc(o){if(o.lastX!==0&&o.lastY!==0){let t=new E(new n(o.lastX,o.lastY),new n(o.lastX-o.mouseX,o.lastY-o.mouseY),_,Se,0,nt);if(Number.isFinite(t.pos.x)&&Number.isFinite(t.pos.y)&&Number.isFinite(t.vel.x)&&Number.isFinite(t.vel.y)){let e=new H(t.pos,_,xt,nt,bt);e.points.forEach(s=>{let i=s;i.vel=t.vel.copy}),o.physics.addSoftBall(e)}}},keyGotUpFunc(o){},keyGotDownFunc(o){}};[w(Zt.name),v("Size",5,60,_,o=>{_=o.target.valueAsNumber}),v("Pressure",5e5,3e6,xt,o=>{xt=o.target.valueAsNumber},4e3),v("Coefficient of friction",0,2,nt,o=>{nt=o.target.valueAsNumber},.1),v("Resolution",6,24,bt,o=>{bt=o.target.valueAsNumber},1)].forEach(vt.appendChild.bind(vt));var _t=Zt,At=0,te=0,Mt=document.createElement("div"),ee={name:"Move",description:"",element:Mt,drawFunc(o,t){let{choosed:e}=o;e instanceof Object&&"move"in e&&(e.move(o.mouseX-e.pos.x,o.mouseY-e.pos.y),t===0?(e.vel.x=0,e.vel.y=0):(e.vel.x=(o.mouseX-At)/t,e.vel.y=(o.mouseY-te)/t),e.ang=0),At=o.mouseX,te=o.mouseY},startInteractionFunc(o){},endInteractionFunc(o){},keyGotUpFunc(o){},keyGotDownFunc(o){}};[w(ee.name)].forEach(Mt.appendChild.bind(Mt));var se=ee,wt=document.createElement("div"),ne={name:"Rectangle wall",description:"",element:wt,drawFunc(o,t){if(o.lastX!==0&&o.lastY!==0){let e=o.cnv.getContext("2d");e.strokeStyle="black",e.strokeRect(o.mouseX,o.mouseY,o.lastX-o.mouseX,o.lastY-o.mouseY)}},startInteractionFunc(o){},endInteractionFunc(o){o.lastX!==0&&o.lastY!==0&&o.physics.addRectWall(o.lastX/2+o.mouseX/2,o.lastY/2+o.mouseY/2,2*Math.abs(o.lastX/2-o.mouseX/2),2*Math.abs(o.lastY/2-o.mouseY/2))},keyGotUpFunc(o){},keyGotDownFunc(o){}};[w(ne.name)].forEach(wt.appendChild.bind(wt));var ie=ne,Pt=.2,Ct=.5,It=document.createElement("div"),oe={name:"Rectangle body",description:"",element:It,drawFunc(o,t){let e=o.cnv.getContext("2d");o.lastX!==0&&o.lastY!==0&&(e.strokeStyle="black",e.strokeRect(o.mouseX,o.mouseY,o.lastX-o.mouseX,o.lastY-o.mouseY))},startInteractionFunc(o){},endInteractionFunc(o){if(o.lastX!==0&&o.lastY!==0){let t=Math.abs(o.mouseX-o.lastX),e=Math.abs(o.mouseY-o.lastY);if(t/e>50||e/t>50||e===0||t===0)return;o.physics.addRectBody(o.lastX/2+o.mouseX/2,o.lastY/2+o.mouseY/2,2*Math.abs(o.lastX/2-o.mouseX/2),2*Math.abs(o.lastY/2-o.mouseY/2),Ct,Pt)}},keyGotUpFunc(o){},keyGotDownFunc(o){}};[w(oe.name),v("Bounciness",0,.6,Pt,o=>{Pt=o.target.valueAsNumber},.02),v("Coefficient of friction",0,2,Ct,o=>{Ct=o.target.valueAsNumber},.1)].forEach(It.appendChild.bind(It));var ae=oe,it=35,St=.5,kt=.5,ot=4,at=24,Et=document.createElement("div");function re(o=24,t=4){return[...new Array(o).keys()].map(e=>n.fromAnglePNorm(Math.PI*2*e/o,t))}var ce={name:"Squircle creator",description:"",element:Et,drawFunc(o,t){let e=o.cnv.getContext("2d");e.strokeStyle="black";let s=re(at,ot);s.forEach(i=>i.mult(it)),e.beginPath(),e.moveTo(o.mouseX+s[0].x,o.mouseY+s[0].y);for(let i=1;i<s.length;i+=1)e.lineTo(o.mouseX+s[i].x,o.mouseY+s[i].y);e.closePath(),e.stroke(),o.mouseDown&&(e.beginPath(),e.moveTo(o.mouseX,o.mouseY),e.lineTo(o.lastX,o.lastY),e.stroke())},startInteractionFunc(o){},endInteractionFunc(o){let t=re(at,ot),e=new n(o.lastX,o.lastY);if(t.forEach(s=>{s.mult(it),s.add(e)}),o.lastX!==0&&o.lastY!==0){let s=new B(t,new n(o.lastX-o.mouseX,o.lastY-o.mouseY),St,0,kt);o.physics.addBody(s)}}};[w(ce.name),v("Size",5,120,it,o=>{it=o.target.valueAsNumber}),v("Roundness",2,7,9-ot,o=>{ot=9-o.target.valueAsNumber},1),v("Resolution",12,36,at,o=>{at=o.target.valueAsNumber},1),v("Bounciness",0,.9,St,o=>{St=o.target.valueAsNumber},.02),v("Coefficient of friction",0,2,kt,o=>{kt=o.target.valueAsNumber},.1)].forEach(Et.appendChild.bind(Et));var he=ce,F=35,ke=.5,rt=1.5,Ot=24,Ft=1,Tt=document.createElement("div"),le={name:"Soft square creator",description:"",element:Tt,drawFunc(o,t){let e=o.cnv.getContext("2d");e.strokeStyle="black",e.beginPath(),e.moveTo(o.mouseX-F,o.mouseY-F),e.lineTo(o.mouseX+F,o.mouseY-F),e.lineTo(o.mouseX+F,o.mouseY+F),e.lineTo(o.mouseX-F,o.mouseY+F),e.lineTo(o.mouseX-F,o.mouseY-F),e.stroke(),o.lastX!==0&&o.lastY!==0&&(e.beginPath(),e.moveTo(o.mouseX,o.mouseY),e.lineTo(o.lastX,o.lastY),e.stroke())},startInteractionFunc(o){},endInteractionFunc(o){if(o.lastX!==0&&o.lastY!==0){let t=new E(new n(o.lastX,o.lastY),new n(o.lastX-o.mouseX,o.lastY-o.mouseY),F,ke,0,rt);Number.isFinite(t.pos.x)&&Number.isFinite(t.pos.y)&&Number.isFinite(t.vel.x)&&Number.isFinite(t.vel.y)&&o.physics.addSoftSquare(t.pos,F*2,rt,t.vel,Ot,Ft)}},keyGotUpFunc(o){},keyGotDownFunc(o){}};[w(le.name),v("Size",5,100,F,o=>{F=o.target.valueAsNumber}),v("Pressure",.4,7,Ft,o=>{Ft=o.target.valueAsNumber},.1),v("Coefficient of friction",0,2,rt,o=>{rt=o.target.valueAsNumber},.1),v("Resolution",16,48,Ot,o=>{Ot=o.target.valueAsNumber},8)].forEach(Tt.appendChild.bind(Tt));var ue=le,Xt=!1,A=1e4,Yt=document.createElement("div"),de={name:"Spring creator",description:"",element:Yt,drawFunc(o,t){let e=o.cnv.getContext("2d");o.lastX!==0&&o.lastY!==0&&(e.strokeStyle="black",e.beginPath(),e.moveTo(o.mouseX,o.mouseY),e.lineTo(o.lastX,o.lastY),e.stroke())},startInteractionFunc(o){},endInteractionFunc(o){if(o.lastX!==0&&o.lastY!==0){let t=o.physics.getObjectAtCoordinates(o.mouseX,o.mouseY),e,s=O;if(t||(t={x:o.mouseX,y:o.mouseY,pinPoint:!0}),o.choosed===t||o.choosed===void 0&&t===void 0)return;if(o.choosed instanceof Object&&t instanceof Object&&"pinPoint"in o.choosed&&"pinPoint"in t)return;if(o.choosed instanceof Object&&t instanceof Object&&"pinPoint"in o.choosed&&"pos"in t?(e=new s(Math.sqrt((o.choosed.x-t.pos.x)**2+(o.choosed.y-t.pos.y)**2),A),e.attachObject(t),e.pinHere(o.choosed.x,o.choosed.y)):t instanceof Object&&o.choosed instanceof Object&&"pos"in o.choosed&&"pinPoint"in t?(e=new s(Math.sqrt((o.choosed.pos.x-t.x)**2+(o.choosed.pos.y-t.y)**2),A),e.attachObject(o.choosed),e.pinHere(t.x,t.y)):o.choosed instanceof Object&&t instanceof Object&&"pos"in o.choosed&&"pos"in t&&(e=new s(Math.sqrt((o.choosed.pos.x-t.pos.x)**2+(o.choosed.pos.y-t.pos.y)**2),A),e.attachObject(o.choosed),e.attachObject(t)),typeof e=="undefined")return;o.physics.addSpring(e),Xt&&e.lockRotation()}},keyGotUpFunc(o){},keyGotDownFunc(o){}};[w(de.name),W("Rotation locked",Xt,o=>{Xt=o.target.checked}),v("Spring stiffness",2e3,1e5,A,o=>{A=o.target.valueAsNumber},50)].forEach(Yt.appendChild.bind(Yt));var me=de,Bt=!1,Nt=document.createElement("div"),fe={name:"Stick creator",description:"",element:Nt,drawFunc(o,t){let e=o.cnv.getContext("2d");o.lastX!==0&&o.lastY!==0&&(e.strokeStyle="black",e.beginPath(),e.moveTo(o.mouseX,o.mouseY),e.lineTo(o.lastX,o.lastY),e.stroke())},startInteractionFunc(o){},endInteractionFunc(o){if(o.lastX!==0&&o.lastY!==0){let t=o.physics.getObjectAtCoordinates(o.mouseX,o.mouseY),e,s=T;if(t||(t={x:o.mouseX,y:o.mouseY,pinPoint:!0}),o.choosed===t||o.choosed===void 0&&t===void 0)return;if("pinPoint"in o.choosed&&"pinPoint"in t)return;if("pinPoint"in o.choosed&&"pos"in t?(e=new s(Math.sqrt((o.choosed.x-t.pos.x)**2+(o.choosed.y-t.pos.y)**2)),e.attachObject(t),e.pinHere(o.choosed.x,o.choosed.y)):"pinPoint"in t&&"pos"in o.choosed?(e=new s(Math.sqrt((o.choosed.pos.x-t.x)**2+(o.choosed.pos.y-t.y)**2)),e.attachObject(o.choosed),e.pinHere(t.x,t.y)):"pos"in o.choosed&&"pos"in t&&(e=new s(Math.sqrt((o.choosed.pos.x-t.pos.x)**2+(o.choosed.pos.y-t.pos.y)**2)),e.attachObject(o.choosed),e.attachObject(t)),typeof e=="undefined")return;o.physics.addSpring(e),Bt&&e.lockRotation()}},keyGotUpFunc(o){},keyGotDownFunc(o){}};[w(fe.name),W("Rotation locked",Bt,o=>{Bt=o.target.checked})].forEach(Nt.appendChild.bind(Nt));var pe=fe,ct=20,Lt=document.createElement("div"),ge={name:"Wall drawer",description:"",element:Lt,drawFunc(o,t){let e=o.cnv.getContext("2d");e.strokeStyle="black",e.beginPath(),e.arc(o.mouseX,o.mouseY,ct,0,2*Math.PI),e.stroke(),o.lastX!==0&&o.lastY!==0&&o.physics.addFixedBall(o.mouseX,o.mouseY,ct)},startInteractionFunc(o){},endInteractionFunc(o){},keyGotUpFunc(o){},keyGotDownFunc(o){}};[w(ge.name),v("Size",5,70,ct,o=>{ct=o.target.valueAsNumber})].forEach(Lt.appendChild.bind(Lt));var ye=ge,jt=document.createElement("div"),be={name:"World settings",description:"",element:jt,init(o){let t=o;[w(be.name),v("Gravity",0,5e3,t.physics.gravity.y,e=>{t.physics.gravity.y=e.target.valueAsNumber},100),v("Gravity in the X direction",-5e3,5e3,t.physics.gravity.x,e=>{t.physics.gravity.x=e.target.valueAsNumber},1e3),v("Air friction",0,.99,1-t.physics.airFriction,e=>{let s=e.target.valueAsNumber;t.physics.setAirFriction(1-s)},.01),W("Show collision data",t.drawCollisions,e=>{t.drawCollisions=e.target.checked}),W("Show body axes",t.showAxes,e=>{t.showAxes=e.target.checked})].forEach(jt.appendChild.bind(jt))}},xe=be,ve=[$t,ie,ye,pe,me,se,_t,ue,Qt,ae,xe,he];var D=ve,ht=D.map(o=>o.name),N={white:"#faf3dd",green:"#02c39a",pink:"#e58c8a",blue:"#77b6ea",black:"#363732"},Me=class{constructor(){this.resizeCanvas=()=>{let t=this.canvasHolder.getBoundingClientRect();this.cnv.width=t.width,this.cnv.height=window.innerHeight-t.top;let e=window.devicePixelRatio||1,s=t;this.cnv.width=s.width*e,this.cnv.height=s.height*e,this.cnv.style.width=`${s.width}px`,this.cnv.style.height=`${s.height}px`,this.scaling=1/e,this.physics.setBounds(0,0,this.cnv.width,this.cnv.height);let i=this.cnv.getContext("2d");i&&(i.scale(e,e),i.lineWidth=e),this.defaultSize=(this.cnv.width+this.cnv.height)/80};this.drawFunction=()=>{var s,i;Number.isFinite(this.lastFrameTime)||(this.lastFrameTime=performance.now());let t=performance.now()-this.lastFrameTime;Number.isFinite(t)||(t=0),t/=1e3;let e=this.cnv.getContext("2d");e.fillStyle=N.black,e.fillRect(0,0,this.cnv.width,this.cnv.height),e.save(),e.translate(this.viewOffsetX,this.viewOffsetY),e.scale(this.scaling,this.scaling),(i=(s=D[this.mode]).drawFunc)==null||i.call(s,this,t*this.timeMultiplier),this.physicsDraw(),e.restore(),this.physics.balls[0]&&(this.left&&(this.physics.balls[0].ang-=Math.PI*100*t),this.right&&(this.physics.balls[0].ang+=Math.PI*100*t)),t*=this.timeMultiplier,this.physics.update(t/5,!1),this.physics.update(t/5,!1),this.physics.update(t/5,!1),this.physics.update(t/5,!1),this.physics.update(t/5,!1),this.lastFrameTime=performance.now(),requestAnimationFrame(this.drawFunction)};this.startInteraction=(t,e)=>{var s,i;this.mouseX=t/this.scaling-this.viewOffsetX/this.scaling,this.mouseY=e/this.scaling-this.viewOffsetY/this.scaling,this.choosed=this.physics.getObjectAtCoordinates(this.mouseX,this.mouseY),this.choosed||(this.choosed={x:this.mouseX,y:this.mouseY,pinPoint:!0}),this.lastX=this.mouseX,this.lastY=this.mouseY,this.mouseDown=!0,(i=(s=D[this.mode]).startInteractionFunc)==null||i.call(s,this)};this.endInteraction=(t,e)=>{var s,i;(this.mouseX=t/this.scaling-this.viewOffsetX/this.scaling,this.mouseY=e/this.scaling-this.viewOffsetY/this.scaling,(i=(s=D[this.mode]).endInteractionFunc)==null||i.call(s,this),!(this.lastX===0&&this.lastY===0))&&(this.lastX=0,this.lastY=0,this.mouseDown=!1,this.choosed=!1)};this.keyGotDown=t=>{let e=t.key;e==="s"&&this.spawnNewtonsCradle(this.cnv.width/2,this.cnv.height/2,.5,this.physics),e==="a"&&(this.scaling+=.01),e==="d"&&(this.scaling-=.01),e==="j"&&(this.viewOffsetX-=10),e==="l"&&(this.viewOffsetX+=10),e==="k"&&(this.viewOffsetY-=10),e==="i"&&(this.viewOffsetY+=10),e==="ArrowRight"&&(this.right=!0),e==="ArrowLeft"&&(this.left=!0)};this.keyGotUp=t=>{let e=t.key;e==="ArrowRight"&&(this.right=!1),e==="ArrowLeft"&&(this.left=!1)};this.startTouch=t=>{t.preventDefault();let e=this.canvasHolder.getBoundingClientRect();return this.startInteraction(t.changedTouches[0].clientX-e.left,t.changedTouches[0].clientY-e.top),!1};this.endTouch=t=>{t.preventDefault();let e=this.canvasHolder.getBoundingClientRect();return this.endInteraction(t.changedTouches[0].clientX-e.left,t.changedTouches[0].clientY-e.top),!1};this.moveTouch=t=>{t.preventDefault();let e=this.canvasHolder.getBoundingClientRect();return this.mouseX=t.changedTouches[0].clientX-e.left,this.mouseY=t.changedTouches[0].clientY-e.top,this.mouseX=this.mouseX/this.scaling-this.viewOffsetX/this.scaling,this.mouseY=this.mouseY/this.scaling-this.viewOffsetY/this.scaling,!1};this.startMouse=t=>(this.startInteraction(t.offsetX,t.offsetY),!1);this.endMouse=t=>(this.endInteraction(t.offsetX,t.offsetY),!1);this.handleMouseMovement=t=>{this.mouseX=t.offsetX,this.mouseY=t.offsetY,this.mouseX=this.mouseX/this.scaling-this.viewOffsetX/this.scaling,this.mouseY=this.mouseY/this.scaling-this.viewOffsetY/this.scaling};this.physicsDraw=()=>{let t=this.cnv.getContext("2d");if(t){t.fillStyle=N.green,t.strokeStyle="black";for(let s=0;s<this.physics.balls.length;s+=1){let i=this.physics.balls[s];t.beginPath(),t.arc(i.pos.x,i.pos.y,i.r,0,2*Math.PI),t.stroke(),t.fill(),t.beginPath(),t.moveTo(i.pos.x,i.pos.y),t.lineTo(i.pos.x+i.r*Math.cos(i.rotation),i.pos.y+i.r*Math.sin(i.rotation)),t.stroke()}this.physics.bodies.forEach(s=>{t.beginPath(),t.moveTo(s.points[s.points.length-1].x,s.points[s.points.length-1].y),s.points.forEach(i=>{t.lineTo(i.x,i.y)}),t.stroke(),t.fill(),this.showAxes&&s.axes.forEach(i=>{t.beginPath(),t.moveTo(s.pos.x,s.pos.y),t.lineTo(s.pos.x+i.x*30,s.pos.y+i.y*30),t.stroke()}),t.beginPath(),t.arc(s.pos.x,s.pos.y,1.5,0,Math.PI*2),t.stroke()});let e=s=>{t.beginPath(),t.moveTo(s.points[s.points.length-1].x,s.points[s.points.length-1].y),s.points.forEach(i=>{t.lineTo(i.x,i.y)}),t.fill()};t.fillStyle="white",this.physics.walls.forEach(e),this.physics.bounds.forEach(e),this.physics.fixedBalls.forEach(s=>{t.beginPath(),t.arc(s.x,s.y,s.r,0,Math.PI*2),t.fill()}),t.save(),t.lineWidth=2,this.physics.springs.forEach(s=>{if(s instanceof O&&!(s instanceof T)){let i,a,r,h;s.pinned&&typeof s.pinned=="object"?(i=s.pinned.x,a=s.pinned.y,r=s.objects[0].pos.x,h=s.objects[0].pos.y):(i=s.objects[0].pos.x,a=s.objects[0].pos.y,r=s.objects[1].pos.x,h=s.objects[1].pos.y);let u=new n(r-i,h-a),l=u.copy;u.rotate(Math.PI/2),u.setMag(5);let c=new n(i,a),m=Math.floor(s.length/10);for(let d=1;d<=m;d+=1)t.strokeStyle=N.blue,t.fillStyle=N.blue,d===m&&(u=new n(0,0)),t.beginPath(),t.moveTo(c.x,c.y),t.lineTo(i+d/m*l.x+u.x,a+d/m*l.y+u.y),t.stroke(),c=new n(i+d/m*l.x+u.x,a+d/m*l.y+u.y),u.mult(-1)}else t.strokeStyle=N.blue,t.fillStyle=N.blue,t.beginPath(),t.moveTo(s.objects[0].pos.x,s.objects[0].pos.y),t.lineTo(typeof s.pinned=="object"?s.pinned.x:s.objects[1].pos.x,typeof s.pinned=="object"?s.pinned.y:s.objects[1].pos.y),t.stroke();s.objects.forEach(i=>{t.strokeStyle="black",t.fillStyle=N.blue,t.beginPath(),t.arc(i.pos.x,i.pos.y,2.5,0,Math.PI*2),t.fill(),t.stroke()}),typeof s.pinned=="object"&&(t.strokeStyle="black",t.fillStyle=N.blue,t.beginPath(),t.arc(s.pinned.x,s.pinned.y,3,0,Math.PI*2),t.fill(),t.stroke())}),t.restore(),t.fillStyle=N.pink,t.strokeStyle=N.pink,t.lineWidth=4,this.drawCollisions&&this.physics.collisionData.forEach(s=>{t.beginPath(),t.moveTo(s.cp.x,s.cp.y),t.lineTo(s.cp.x+s.n.x*30,s.cp.y+s.n.y*30),t.stroke(),t.beginPath(),t.arc(s.cp.x,s.cp.y,4,0,Math.PI*2),t.fill()})}};this.spawnNewtonsCradle=(t,e,s,i)=>{let a=[],r=25,h=250,u=8;a.push(new E(new n(t,e),new n(0,0),s*r,1,0,0));let l=1;for(let c=0;c<u-1;c+=1)a.push(new E(new n(t+l*s*r*1.01*2,e),new n(0,0),s*25,1,0,0)),l*=-1,l>0&&(l+=1),c===u-2&&(a[a.length-1].vel.x=-Math.sign(l)*s*r*8);a.forEach(c=>{i.addBall(c);let m=new T(h);m.attachObject(c),m.pinHere(c.pos.x,c.pos.y-h),i.addSpring(m),m.lockRotation()})};this.modeButtonClicked=t=>{let e=t.target.id.replace("-btn",""),s=ht.indexOf(e);this.switchToMode(s)};this.switchToMode=t=>{let e=document.getElementById(`${ht[this.mode]}-btn`);e&&e.classList.remove("bg-pink-darker"),this.sidebar.innerHTML="";let s=document.getElementById(`${ht[t]}-btn`);s&&s.classList.add("bg-pink-darker"),this.mode=t,this.sidebar.appendChild(D[this.mode].element)};this.setupModes=()=>{let t=document.getElementById("button-holder");ht.forEach((e,s)=>{var a,r;let i=document.createElement("div");i.classList.add("big-button"),i.classList.add("fix-width"),i.id=`${e}-btn`,i.textContent=D[s].name,(r=(a=D[s]).init)==null||r.call(a,this),i.onclick=this.modeButtonClicked,t&&t.appendChild(i)}),this.switchToMode(this.mode)};this.setTimeMultiplier=t=>{Number.isFinite(t)&&(this.timeMultiplier=t)};this.getTimeMultiplier=()=>this.timeMultiplier;this.setPhysics=t=>{t instanceof Z&&(this.physics=t)};this.getPhysics=()=>this.physics;this.physics=new Z,this.mouseX=0,this.mouseY=0,this.mouseDown=!1,this.defaultSize=30,this.k=.5,this.fc=2,this.springConstant=2e3,this.scaling=1,this.viewOffsetX=0,this.viewOffsetY=0,this.mode=0,this.lastX=0,this.lastY=0,this.timeMultiplier=1,this.lastFrameTime=performance.now(),this.choosed=!1,this.drawCollisions=!1,this.showAxes=!1,this.left=!1,this.right=!1,this.cnv=document.getElementById("defaulCanvas0"),this.canvasHolder=document.getElementById("canvas-holder"),this.sidebar=document.getElementById("sidebar"),this.physics.setBounds(0,0,this.cnv.width,this.cnv.height),this.physics.setGravity(new n(0,1e3)),this.physics.setAirFriction(.9),this.cnv.addEventListener("touchstart",this.startTouch,!1),this.cnv.addEventListener("touchend",this.endTouch,!1),this.cnv.addEventListener("touchmove",this.moveTouch,!1),this.cnv.addEventListener("mousedown",this.startMouse,!1),this.cnv.addEventListener("mouseup",this.endMouse,!1),this.cnv.addEventListener("mousemove",this.handleMouseMovement,!1),document.addEventListener("keydown",this.keyGotDown,!1),document.addEventListener("keyup",this.keyGotUp,!1),window.addEventListener("resize",this.resizeCanvas,!1),this.resizeCanvas(),this.setupModes(),mt(this),requestAnimationFrame(this.drawFunction)}},we=Me;window.onload=()=>{window.editorApp=new we};})();
//# sourceMappingURL=main.js.map

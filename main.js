(()=>{var P=class{constructor(t,e){this.x=t,this.y=e}get copy(){return new P(this.x,this.y)}setCoordinates(t,e){this.x=t,this.y=e}get length(){return Math.sqrt(this.x*this.x+this.y*this.y)}get sqlength(){return this.x*this.x+this.y*this.y}get heading(){if(this.x===0&&this.y===0)return 0;if(this.x===0)return this.y>0?Math.PI/2:1.5*Math.PI;if(this.y===0)return this.x>0?0:Math.PI;let t=P.normalized(this);return this.x>0&&this.y>0?Math.asin(t.y):this.x<0&&this.y>0?Math.asin(-t.x)+Math.PI/2:this.x<0&&this.y<0?Math.asin(-t.y)+Math.PI:this.x>0&&this.y<0?Math.asin(t.x)+1.5*Math.PI:0}add(t){this.x+=t.x,this.y+=t.y}sub(t){this.x-=t.x,this.y-=t.y}mult(t){this.x*=t,this.y*=t}div(t){this.x/=t,this.y/=t}lerp(t,e){this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e}dist(t){return new P(this.x-t.x,this.y-t.y).length}pNorm(t){return t<1&&(t=1),(Math.abs(this.x**t)+Math.abs(this.y**t))**(1/t)}setMag(t){if(this.length===0)return;this.mult(t/this.length)}normalize(){if(this.length===0)return;this.div(this.length)}rotate(t){let e=Math.cos(t),s=Math.sin(t);this.setCoordinates(this.x*e-this.y*s,this.x*s+this.y*e)}static rotateArr(t,e){let s=Math.cos(e),i=Math.sin(e);t.forEach(a=>{a.setCoordinates(a.x*s-a.y*i,a.x*i+a.y*s)})}rotate90(){let{x:t}=this;this.x=-this.y,this.y=t}rotate270(){let{x:t}=this;this.x=this.y,this.y=-t}static add(t,e){return new P(t.x+e.x,t.y+e.y)}static sub(t,e){return new P(t.x-e.x,t.y-e.y)}static mult(t,e){return new P(t.x*e,t.y*e)}static div(t,e){return new P(t.x/e,t.y/e)}static fromAngle(t){return new P(Math.cos(t),Math.sin(t))}static fromAnglePNorm(t,e){let s=new P(Math.cos(t),Math.sin(t));return s.div(s.pNorm(e)),s}static lerp(t,e,s){return P.add(t,P.mult(P.sub(e,t),s))}static dist(t,e){return P.sub(t,e).length}static dot(t,e){return t.x*e.x+t.y*e.y}static cross(t,e){return t.x*e.y-t.y*e.x}static crossScalarFirst(t,e){return new P(-e.y*t,e.x*t)}static crossScalarSecond(t,e){return new P(t.y*e,-t.x*e)}static angle(t,e){return Math.acos(Math.min(Math.max(P.dot(t,e)/Math.sqrt(t.sqlength*e.sqlength),1),-1))}static angleACW(t,e){let s=t.heading,i=e.heading,a=i-s;return a<0?2*Math.PI+a:a}static normalized(t){let e=t.length;return e===0?t:new P(t.x/e,t.y/e)}toJSObject(){return{x:this.x,y:this.y}}static fromObject(t){return new P(t.x,t.y)}},o=P;function U(n,t,e,s){let i=s,a=e,r=n,h=t,u=r.vel,l=h.vel,c=r.ang,m=h.ang,d=o.sub(a,r.pos),g=o.sub(a,h.pos),f=r.am,p=h.am,y=r.m,b=h.m,I=(r.k+h.k)/2,k=(r.fc+h.fc)/2,x=r.velInPlace(a),ut=h.velInPlace(a),C=o.sub(ut,x),S=1/y+1/b;S+=o.dot(o.crossScalarFirst(o.cross(d,i)/f,d),i),S+=o.dot(o.crossScalarFirst(o.cross(g,i)/p,g),i),S=-((1+I)*o.dot(C,i))/S;let dt=o.sub(u,o.mult(i,S/y)),mt=o.add(l,o.mult(i,S/b)),Wt=c-S*o.cross(d,i)/f,Ht=m+S*o.cross(g,i)/p,X=C.copy;X.sub(o.mult(i,o.dot(C,i))),X.setMag(1);let q=1/y+1/b;q+=o.dot(o.crossScalarFirst(o.cross(d,X)/f,d),X),q+=o.dot(o.crossScalarFirst(o.cross(g,X)/p,g),X),q=-o.dot(C,X)/q;let G=S*k;G>q&&(G=q),dt=o.sub(dt,o.mult(X,G/y)),mt=o.add(mt,o.mult(X,G/b)),Wt-=G*o.cross(d,X)/f,Ht+=G*o.cross(g,X)/p,r.vel=dt,h.vel=mt,r.ang=Wt,h.ang=Ht}function N(n,t,e){let s=t,i=e,a=n,r=o.sub(s,a.pos),{am:h,m:u}=a,l=o.mult(a.velInPlace(s),-1),c=1/u;c+=o.dot(o.crossScalarFirst(o.cross(r,i)/h,r),i),c=-((1+a.k)*o.dot(l,i))/c;let m=o.sub(a.vel,o.mult(i,c/u)),d=a.ang-c*o.cross(r,i)/h,g=l.copy;g.sub(o.mult(i,o.dot(l,i))),g.setMag(1);let f=1/u;f+=o.dot(o.crossScalarFirst(o.cross(r,g)/h,r),g),f=-o.dot(l,g)/f;let p=c*a.fc;p>f&&(p=f),m=o.sub(m,o.mult(g,p/u)),d-=p*o.cross(r,g)/h,a.vel=m,a.ang=d}function j(n,t){this.min=n,this.max=t}j.prototype.size=function(){return this.max-this.min};function Y(n){return new j(Math.min(...n),Math.max(...n))}function V(n,t){return new j(Math.max(n.min,t.min),Math.min(n.max,t.max))}function Dt(n,t,e,s){let i=[...e,...s],a=d=>Y(n.map(g=>o.dot(g,d))),r=d=>Y(t.map(g=>o.dot(g,d))),h=[];if(i.some(d=>{let g=a(d),f=r(d),p=V(g,f);return h.push(p),p.max<p.min}))return!1;let u=h.map(d=>d.size()),l=u[0],c=0;for(let d=1;d<u.length;d+=1)l>u[d]&&(l=u[d],c=d);let m=i[c].copy;return{normal:m,overlap:l,index:c}}var $=class{constructor(t,e,s,i,a,r){this.pos=t.copy,this.lastPos=this.pos.copy,this.r=s,this.fc=.4,this.amc=.5,this.density=1,this.rotation=0,a?this.ang=a:this.ang=0,(r||r===0)&&(this.fc=r),i?this.k=i:this.k=.8,e!==void 0?this.vel=e.copy:this.vel=new o(0,0),this.id=`_${Math.random().toString(36).substr(2,9)}`,this.layer=void 0}get m(){return this.density*this.r*this.r*Math.PI}get am(){return this.amc*this.r*this.r*this.m}getAmInPoint(t){let e=this.am;return e+=o.sub(this.pos,t).sqlength*this.m,e}get copy(){let t=new $(this.pos.copy,this.vel.copy,this.r,this.k,this.ang,this.fc);return t.lastPos=this.lastPos.copy,t.rotation=this.rotation,t}move(t,e){this.pos.x+=t,this.pos.y+=e}rotate(t){this.rotation+=t}collided(t){return this.pos.dist(t.pos)<this.r+t.r}static collide(t,e){if(!t.collided(e))return;let s=o.dist(t.pos,e.pos),i=t.m,a=e.m,r=t.pos.copy,h=e.pos.copy,u=t,l=e,c=t.r+e.r-s,m=o.sub(t.pos,e.pos);if(m.setMag(1),m.mult(c*a/(i+a)),r.add(m),m.setMag(1),m.mult(-c*i/(i+a)),h.add(m),u.pos=r,l.pos=h,o.dot(m,o.sub(t.vel,e.vel))<0)return;m.setMag(1);let d=o.add(t.pos,o.mult(m,t.r));return U(t,e,d,m),{cp:d,n:m}}containsPoint(t){return o.dist(this.pos,t)<=this.r}velInPlace(t){let e=o.sub(t,this.pos);return e.rotate(Math.PI/2),e.mult(this.ang),e.add(this.vel),e}effectiveMass(t,e){let s=o.sub(t,this.pos);if(s.length===0)return this.m;let i=o.angle(e,s),a=Math.sin(i)**2*s.length**2/this.am;return 1/(a+1/this.m)}applyDeltaVelInPoint(t,e){let s=o.sub(e,this.pos);if(s.length===0){this.vel.add(t);return}let i=o.angle(s,t),a=o.mult(s,o.dot(t,s)/s.length**2);this.vel.add(a);let r=s.copy;r.rotate(Math.PI/2),r.setMag(1);let h=Math.sign(o.dot(t,r)),u=t.length*Math.cos(i),l=1/(1/this.m+s.length**2/this.am),c=u*l/this.m;this.vel.add(o.mult(r,c*h));let m=h*u*l*s.length/this.am;this.ang-=m}toJSObject(){let t={};return t.pos=this.pos.toJSObject(),t.lastPos=this.lastPos.toJSObject(),t.r=this.r,t.fc=this.fc,t.amc=this.amc,t.rotation=this.rotation,t.ang=this.ang,t.fc=this.fc,t.k=this.k,t.vel=this.vel.toJSObject(),t.id=this.id,typeof this.layer!="undefined"&&(t.layer=this.layer),t}static fromObject(t){let e=new $(o.fromObject(t.pos),o.fromObject(t.vel),t.r,t.k,t.ang,t.fc);return e.lastPos=o.fromObject(t.lastPos),e.amc=t.amc,e.rotation=t.rotation,e.vel=o.fromObject(t.vel),e.id=t.id,typeof t.layer!="undefined"&&(e.layer=t.layer),e}},O=$,qt=class{constructor(t,e){this.a=t,this.b=e}get length(){return o.dist(this.a,this.b)}distFromPoint(t){let e=o.sub(this.a,this.b),s=o.sub(t,this.b),i=o.sub(t,this.a),a=s.length,r=i.length,h=e.length;if(h===0)return a;let u=o.angle(s,i),l=o.angle(s,e),c=Math.PI-u-l,m=Math.sin(c)*r*h/2,d=2*m/h;return c>Math.PI/2?r:l>Math.PI/2?a:d}static intersect(t,e){let s=o.sub(t.b,t.a),i=s.y/s.x,a=t.b.y-t.b.x*i,r=o.sub(e.b,e.a),h=r.y/r.x,u=e.b.y-e.b.x*h;if(s.x===0&&r.x!==0){if(t.a.x>=e.a.x&&t.a.x<=e.b.x||t.a.x<=e.a.x&&t.a.x>=e.b.x){let g=h*t.a.x+u;if(g>t.a.y&&g<t.b.y||g<t.a.y&&g>t.b.y)return new o(t.a.x,g)}return!1}if(r.x===0&&s.x!==0){if(e.a.x>=t.a.x&&e.a.x<=t.b.x||e.a.x<=t.a.x&&e.a.x>=t.b.x){let g=i*e.a.x+a;if(g>e.a.y&&g<e.b.y||g<e.a.y&&g>e.b.y)return new o(e.a.x,g)}return!1}if(s.x===0&&r.x===0){if(t.a.x===e.a.x){let g;t.a.y<t.b.y?g=[t.a.y,t.b.y]:g=[t.b.y,t.a.y];let f;e.a.y<e.b.y?f=[e.a.y,e.b.y]:f=[e.b.y,e.a.y];let p=[g[0]>f[0]?g[0]:f[0],g[1]<f[1]?g[1]:f[1]];if(p[0]<=p[1])return new o(t.a.x,(p[0]+p[1])/2)}return!1}let l;t.a.x<t.b.x?l=[t.a.x,t.b.x]:l=[t.b.x,t.a.x];let c;e.a.x<e.b.x?c=[e.a.x,e.b.x]:c=[e.b.x,e.a.x];let m=[l[0]>c[0]?l[0]:c[0],l[1]<c[1]?l[1]:c[1]];if(i===h&&a===u&&m[0]<=m[1])return new o((m[0]+m[1])/2,(m[0]+m[1])/2*i+a);let d=(u-a)/(i-h);return d>=m[0]&&d<=m[1]?new o(d,d*i+a):!1}},M=qt,Pe=15,tt=class{constructor(t){this.points=t;let e=this.points,s=0,i=0,a=o.angleACW(o.sub(e[1],e[0]),o.sub(e[e.length-1],e[0]));this.points.length>0?[this.center]=[this.points[0]]:this.center=new o(0,0),this.boundRadius=1,this.calculateCenterAndRadius(),this.boundsX=new j(0,0),this.boundsY=new j(0,0),this.calculateBoundingBox(),this.axes=[],this.calculateAxes(),s+=a,i+=Math.PI*2-a;for(let h=1;h<e.length-1;h+=1)a=o.angleACW(o.sub(e[(h+1)%e.length],e[h]),o.sub(e[h-1],e[h])),s+=a,i+=Math.PI*2-a;if(a=o.angleACW(o.sub(e[0],e[e.length-1]),o.sub(e[e.length-2],e[e.length-1])),s+=a,i+=Math.PI*2-a,i>s)return;let r=[];for(let h=e.length-1;h>=0;h-=1)r.push(e[h]);this.points=r}calculateBoundingBox(){this.boundsX=Y(this.points.map(t=>t.x)),this.boundsY=Y(this.points.map(t=>t.y))}calculateAxes(){let t=Math.cos(Math.PI/Pe);this.axes=this.normals.map(e=>new o(e.x,Math.abs(e.y)));for(let e=this.axes.length-2;e>=0;e-=1)for(let s=this.axes.length-1;s>e;s-=1){let i=this.axes[s],a=this.axes[e];if(o.dot(i,a)>t){let r=o.add(i,a);r.normalize(),this.axes.splice(s,1),this.axes[e]=r}}}collideWithBall(t){let e,s,i=t,a=this.points.some((r,h)=>{let u=o.sub(i.pos,r);u.sqlength<=t.r*t.r&&(e=r,s=u);let l=this.points[(h+1)%this.points.length].copy,c=new o(l.x-r.x,l.y-r.y),m=c.sqlength;c.setMag(1);let d=c.copy;d.rotate270();let g=o.dot(u,c),f=o.dot(u,d);return f>=-t.r&&f<t.r&&g>=0&&g*g<=m?(e=o.add(r,o.mult(c,g)),s=d,!0):!1});if(typeof s!="undefined"&&(a||s.setMag(1),typeof e!="undefined"))return s.mult(-1),i.pos=o.add(e,o.mult(s,-t.r)),N(i,e,s),{cp:e,n:s}}get normals(){return this.sides.map(t=>{let e=o.sub(t.b,t.a);return e.setMag(1),e.rotate270(),e})}containsPoint(t){let{sides:e}=this,s=Math.max(...this.points.map(h=>o.dist(h,t)))+1,i=o.fromAngle(0);i.setMag(s);let a=new M(t,o.add(i,t)),r=e.filter(h=>M.intersect(h,a)!==void 0);return r.length%2===1}calculateCenterAndRadius(){this.center=this.points.reduce((t,e)=>o.add(t,e)),this.center.div(this.points.length),this.boundRadius=Math.max(...this.points.map(t=>o.dist(t,this.center)))}get sides(){return this.points.map((t,e)=>new M(t,this.points[(e+1)%this.points.length]))}toJSObject(){let t={};return t.points=this.points.map(e=>({x:e.x,y:e.y})),t}static fromObject(t){let e=new tt(t.points.map(s=>new o(s.x,s.y)));return e}},J=tt,Gt=class extends M{get length(){return Number.POSITIVE_INFINITY}distFromPoint(t){let e=o.sub(this.a,this.b);e.setMag(1),e.rotate(Math.PI/2);let s=o.sub(t,this.a),i=Math.abs(o.dot(s,e));return i}static intersect(t,e){let s=o.sub(t.b,t.a),i=s.y/s.x,a=t.b.y-t.b.x*i,r=o.sub(e.b,e.a),h=r.y/r.x,u=e.b.y-e.b.x*h;if(i===h)return t.distFromPoint(e.a)===0?new o((t.a.x+t.b.x+e.a.x+e.b.x)/4,(t.a.y+t.b.y+e.a.y+e.b.y)/4):!1;let l=(u-a)/(i-h);return new o(l,i*l+a)}static intersectWithLineSegment(t,e){let s=o.sub(t.b,t.a),i=s.y/s.x,a=t.b.y-t.b.x*i,r=o.sub(e.b,e.a),h=r.y/r.x,u=e.b.y-e.b.x*h;if(s.x===0){if(r.x===0)return t.a.x===e.a.x?new o((e.a.x+e.b.x)/2,(e.a.y+e.b.y)/2):!1;let m=t.a.x,d=h*m+u;return Math.min(e.a.x,e.b.x)<m&&m<Math.max(e.a.x,e.b.x)&&Math.min(e.a.y,e.b.y)<d&&Math.max(e.a.y,e.b.y)>d?new o(m,d):!1}if(r.x===0){let m=e.a.x,d=i*m+a;return Math.min(e.a.x,e.b.x)<m&&m<Math.max(e.a.x,e.b.x)&&Math.min(e.a.y,e.b.y)<d&&Math.max(e.a.y,e.b.y)>d?new o(m,d):!1}if(i===h)return t.distFromPoint(e.a)===0?new o((e.a.x+e.b.x)/2,(e.a.y+e.b.y)/2):!1;let l=(u-a)/(i-h),c=i*l+a;return Math.min(e.a.x,e.b.x)<l&&l<Math.max(e.a.x,e.b.x)&&Math.min(e.a.y,e.b.y)<c&&Math.max(e.a.y,e.b.y)>c?new o(l,c):!1}},K=Gt,Se=15,Q=class{constructor(t,e,s,i,a){this.points=t,this.pos=new o(t[0].x,t[0].y);let r=this.points,h=0,u=0,l=o.angleACW(o.sub(r[1],r[0]),o.sub(r[r.length-1],r[0]));h+=l,u+=Math.PI*2-l;for(let c=1;c<r.length-1;c+=1)l=o.angleACW(o.sub(r[(c+1)%r.length],r[c]),o.sub(r[c-1],r[c])),h+=l,u+=Math.PI*2-l;if(l=o.angleACW(o.sub(r[0],r[r.length-1]),o.sub(r[r.length-2],r[r.length-1])),h+=l,u+=Math.PI*2-l,u<h){let c=[];for(let m=r.length-1;m>=0;m-=1)c.push(r[m]);this.points=c}this.m=1,this.am=1,this.boundRadius=1,this.boundsX=new j(0,0),this.boundsY=new j(0,0),this.defaultAxes=[],this.axes=[],this.recalculateBoundingBox(),this.calculatePosAndMass(),this.calculateAxes(),this.lastPos=this.pos.copy,this.fc=.4,this.rotation=0,i?this.ang=i:this.ang=0,(a||a===0)&&(this.fc=a),s?this.k=s:this.k=.8,e!==void 0?this.vel=e.copy:this.vel=new o(0,0),this.id=`_${Math.random().toString(36).substr(2,9)}`}calculateAxes(){let t=Math.cos(Math.PI/Se);this.defaultAxes=this.normals.map(e=>new o(e.x,Math.abs(e.y)));for(let e=this.defaultAxes.length-2;e>=0;e-=1)for(let s=this.defaultAxes.length-1;s>e;s-=1){let i=this.defaultAxes[s],a=this.defaultAxes[e];o.dot(i,a)>t&&(this.defaultAxes.splice(s,1),this.defaultAxes[e]=i)}this.axes=this.defaultAxes.map(e=>e.copy)}getAmInPoint(t){let e=this.am;return e+=o.sub(this.pos,t).sqlength*this.m,e}get copy(){let t=this.points.map(s=>new o(s.x,s.y)),e=new Q(t,this.vel.copy,this.k,this.ang,this.fc);return e.rotation=this.rotation,e.lastPos=this.lastPos.copy,e.pos=this.pos.copy,e}move(t,e){this.pos.x+=t,this.pos.y+=e,this.points.forEach(s=>{let i=s;i.x+=t,i.y+=e}),this.boundsX.min+=t,this.boundsX.max+=t,this.boundsY.min+=e,this.boundsY.max+=e}recalculateBoundingBox(){this.boundsX=Y(this.points.map(t=>t.x)),this.boundsY=Y(this.points.map(t=>t.y))}collideWithBall(t){let e,s,i;if(o.dist(t.pos,this.pos)>t.r+this.boundRadius)return;if(this.points.forEach((a,r)=>{let h=new o(a.x,a.y);if(h.x-=t.pos.x,h.y-=t.pos.y,h.length<=t.r){e=h.heading+Math.PI,s=h.length;let g=o.fromAngle(e);g.mult(t.r-s),this.move(g.x*-1*t.m/(this.m+t.m),g.y*-1*t.m/(this.m+t.m)),t.move(g.x*1*this.m/(this.m+t.m),g.y*1*this.m/(this.m+t.m)),i=new o(a.x,a.y)}h=new o(a.x,a.y);let u=new o(this.points[(r+1)%this.points.length].x,this.points[(r+1)%this.points.length].y),l=new o(t.pos.x,t.pos.y),c=new o(u.x-h.x,u.y-h.y),m=c.heading;h.rotate(-m+Math.PI),u.rotate(-m+Math.PI),l.rotate(-m+Math.PI);let d=l.y-(h.y+u.y)/2;if(d>=-t.r&&d<=t.r&&l.x>=u.x&&l.x<=h.x){e=m-Math.PI/2,s=d;let g=o.fromAngle(e);g.mult(t.r-s),this.move(g.x*-1*t.m/(this.m+t.m),g.y*-1*t.m/(this.m+t.m)),t.move(g.x*1*this.m/(this.m+t.m),g.y*1*this.m/(this.m+t.m)),i=t.pos.copy,i.add(o.mult(o.fromAngle(e+Math.PI),d))}}),Number.isFinite(e)&&i){let a=o.sub(i,t.pos);return a.setMag(-1),U(this,t,i,a),{cp:i,n:a}}}calculatePosAndMass(){let t=[];if(t.push([]),this.points.forEach(a=>{t[0].push(new o(a.x,a.y))}),this.isConcave){let a=(l,c)=>{for(let m=0;m<l.length;m+=1)if(l[m]===c)return!0;return!1},r=(l,c,m)=>{for(let d=0;d<c.length;d+=1)if(!a(m,d)){let g=new M(new o(c[d].x,c[d].y),new o(c[(d+1)%c.length].x,c[(d+1)%c.length].y));if(M.intersect(l,g))return!0}return!1},h=!0,u=()=>{h=!1;for(let l=0;l<t.length;l+=1){let c=t[l],m=o.sub(c[1],c[0]),d=o.sub(c[c.length-1],c[0]),g=o.angleACW(m,d);if(g>Math.PI){h=!0;let f=0,p=f+2,y=new M(new o(c[f].x,c[f].y),new o(c[p%c.length].x,c[p%c.length].y)),b=new o(y.b.x-y.a.x,y.b.y-y.a.y).heading;for(;!(m.heading>d.heading?b>m.heading&&b<2*Math.PI||b>0&&b<d.heading:b>m.heading&&b<d.heading)||r(new M(new o(c[f%c.length].x,c[f%c.length].y),new o(c[p%c.length].x,c[p%c.length].y)),c,[(c.length-1)%c.length,f%c.length,(p-1)%c.length,p%c.length]);)p+=1,y=new M(new o(c[f].x,c[f].y),new o(c[p%c.length].x,c[p%c.length].y)),b=new o(y.b.x-y.a.x,y.b.y-y.a.y).heading;let I=[],k=[];for(let x=f;x<=p;x+=1)I.push(c[x%c.length]);for(let x=p;x<=f+c.length;x+=1)k.push(c[x%c.length]);t[l]=I,t.push(k);return}for(let f=1;f<c.length;f+=1)if(m=o.sub(c[(f+1)%c.length],c[f]),d=o.sub(c[f-1],c[f]),g=o.angleACW(m,d),g>Math.PI){h=!0;let p=f+2,y=new M(new o(c[f].x,c[f].y),new o(c[p%c.length].x,c[p%c.length].y)),b=new o(y.b.x-y.a.x,y.b.y-y.a.y).heading;for(;!(m.heading>d.heading?b>m.heading&&b<2*Math.PI||b>0&&b<d.heading:b>m.heading&&b<d.heading)||r(y,c,[(f-1)%c.length,f%c.length,(p-1)%c.length,p%c.length]);)p+=1,y=new M(new o(c[f].x,c[f].y),new o(c[p%c.length].x,c[p%c.length].y)),b=new o(y.b.x-y.a.x,y.b.y-y.a.y).heading;let I=[],k=[];for(let x=f;x<=p;x+=1)I.push(c[x%c.length]);for(let x=p;x<=f+c.length;x+=1)k.push(c[x%c.length]);t[l]=I,t.push(k);return}}};for(;h;)u()}for(let a=t.length-1;a>=0;a-=1){let r=t[a];for(;r.length>3;)t.push([r[0],r[1],r[2]]),r.splice(1,1)}let e=0,s=0,i=new o(0,0);t.forEach(a=>{let r=Math.sqrt((a[0].x-a[1].x)**2+(a[0].y-a[1].y)**2),h=Math.sqrt((a[1].x-a[2].x)**2+(a[1].y-a[2].y)**2),u=Math.sqrt((a[2].x-a[0].x)**2+(a[2].y-a[0].y)**2),l=(r+h+u)/2,c=Math.sqrt(l*(l-r)*(l-h)*(l-u));e+=c,i.x+=c*(a[0].x+a[1].x+a[2].x)/3,i.y+=c*(a[0].y+a[1].y+a[2].y)/3}),i.div(e),this.pos=i,this.m=e,t.forEach(a=>{let r=Math.sqrt((a[0].x-a[1].x)**2+(a[0].y-a[1].y)**2),h=Math.sqrt((a[1].x-a[2].x)**2+(a[1].y-a[2].y)**2),u=Math.sqrt((a[2].x-a[0].x)**2+(a[2].y-a[0].y)**2),l=(r+h+u)/2,c=Math.sqrt(l*(l-r)*(l-h)*(l-u)),m=new K(a[1],a[2]),d=m.distFromPoint(a[0]),g=o.sub(a[2],a[1]);g.rotate90(),g.add(a[1]);let f=new K(a[1],g);r=f.distFromPoint(a[0]);let p=(h*h*h*d-h*h*d*r+h*d*r*r+h*d*d*d)/36;p+=new o((a[0].x+a[1].x+a[2].x)/3,(a[0].y+a[1].y+a[2].y)/3).dist(this.pos)**2*c,s+=p}),this.am=s,this.boundRadius=Math.max(...this.points.map(a=>o.dist(a,this.pos)))}rotate(t){this.points.forEach(e=>{let s=e;s.sub(this.pos),s.rotate(t),s.add(this.pos)}),this.rotation+=t,this.recalculateBoundingBox(),o.rotateArr(this.axes,t)}get isConcave(){let t=this.points,e=o.angleACW(o.sub(t[1],t[0]),o.sub(t[t.length-1],t[0]));if(e>Math.PI)return!0;for(let s=1;s<t.length-1;s+=1)if(e=o.angleACW(o.sub(t[(s+1)%t.length],t[s]),o.sub(t[s-1],t[s])),e>Math.PI)return!0;return e=o.angleACW(o.sub(t[0],t[t.length-1]),o.sub(t[t.length-2],t[t.length-1])),e>Math.PI}static collide(t,e){let s=t,i=e,a=[...s.axes,...i.axes],r=a.map(C=>Y(s.points.map(S=>o.dot(S,C)))),h=a.map(C=>Y(i.points.map(S=>o.dot(S,C)))),u=a.map((C,S)=>V(r[S],h[S])),l=u.map(C=>C.max-C.min);if(l.some(C=>C<0))return;let c=Number.MAX_VALUE,m=0;l.forEach((C,S)=>{C<c&&(c=C,m=S)});let d,g,f=a[m].copy;o.dot(o.sub(s.pos,i.pos),f)>0&&f.mult(-1);let p=o.mult(f,-(c*s.m)/(s.m+i.m)),y=o.mult(f,c*i.m/(s.m+i.m));m<s.axes.length?(d=i,g=s):(d=s,g=i),s.move(p.x,p.y),i.move(y.x,y.y);let b=o.sub(d.pos,g.pos),I;if(o.dot(b,f)>=0)I=d.points.map(C=>o.dot(C,f));else{let C=o.mult(f,-1);I=d.points.map(S=>o.dot(S,C))}let k=d.points[I.indexOf(Math.min(...I))],x=s.velInPlace(k),ut=i.velInPlace(k);return o.dot(x,f)<o.dot(ut,f)?void 0:(f.mult(1),U(s,i,k,f),{n:f,cp:k})}get normals(){return this.sides.map(t=>{let e=o.sub(t.b,t.a);return e.setMag(1),e.rotate270(),e})}collideWithFixedBall(t){let e,s,i=t,a=this.points.some((r,h)=>{let u=o.sub(i,r);u.sqlength<=i.r*i.r&&(e=r,s=u);let l=this.points[(h+1)%this.points.length].copy,c=new o(l.x-r.x,l.y-r.y),m=c.sqlength;c.setMag(1);let d=c.copy;d.rotate270();let g=o.dot(u,c),f=o.dot(u,d);return f>=-i.r&&f<i.r&&g>=0&&g*g<=m?(e=o.add(r,o.mult(c,g)),s=d,!0):!1});if(typeof s!="undefined"&&(a||s.setMag(1),typeof e!="undefined")){let r=o.sub(e,i).length-i.r,h=o.mult(s,r);return this.move(h.x,h.y),N(this,e,s),{cp:e,n:s}}}collideWithWall(t){let e=V(this.boundsX,t.boundsX),s=V(this.boundsY,t.boundsY);if(e.size()<=0||s.size()<=0)return;let i=Dt(this.points,t.points,this.axes,t.axes);if(typeof i!="boolean"){let{normal:a,overlap:r,index:h}=i;o.dot(o.sub(this.pos,t.center),a)<0&&a.mult(-1);let u=o.mult(a,r),l,c;h<this.axes.length?(l=t,c=o.sub(l.center,this.pos)):(l=this,c=o.sub(this.pos,t.center)),this.move(u.x,u.y);let m;if(o.dot(c,a)>=0)m=l.points.map(f=>o.dot(f,a));else{let f=o.mult(a,-1);m=l.points.map(p=>o.dot(p,f))}let d=l.points[m.indexOf(Math.min(...m))],g=this.velInPlace(d);return o.dot(g,a)>0?void 0:(N(this,d,a),{n:a,cp:d})}}containsPoint(t){let{sides:e}=this,s=Math.max(...this.points.map(h=>o.dist(h,t)))+1,i=new o(s,0),a=new M(t,o.add(i,t)),r=e.filter(h=>M.intersect(h,a)instanceof Object);return r.length%2===1}get sides(){return this.points.map((t,e)=>new M(t,this.points[(e+1)%this.points.length]))}velInPlace(t){let e=o.sub(t,this.pos);return e.rotate(Math.PI/2),e.mult(this.ang),e.add(this.vel),e}effectiveMass(t,e){let s=o.sub(t,this.pos),i=o.angle(e,s),a=Math.sin(i)**2*s.length**2/this.am;return 1/(a+1/this.m)}applyDeltaVelInPoint(t,e){let s=o.sub(e,this.pos);if(s.length===0){this.vel.add(t);return}let i=o.angle(s,t),a=o.mult(s,o.dot(t,s)/s.length**2);this.vel.add(a);let r=s.copy;r.rotate(Math.PI/2),r.setMag(1);let h=Math.sign(o.dot(t,r)),u=t.length*Math.cos(i),l=1/(1/this.m+s.length**2/this.am),c=u*l/this.m;this.vel.add(o.mult(r,c*h));let m=h*u*l*s.length/this.am;this.ang-=m}toJSObject(){let t={};return t.points=this.points.map(e=>({x:e.x,y:e.y})),t.vel=this.vel.toJSObject(),t.k=this.k,t.ang=this.ang,t.fc=this.fc,t.pos=this.pos.toJSObject(),t.lastPos=this.lastPos.toJSObject(),t.rotation=this.rotation,t.id=this.id,t}static fromObject(t){let e=new Q(t.points.map(s=>new o(s.x,s.y)),o.fromObject(t.vel),t.k,t.ang,t.fc);return e.id=t.id,e.pos=o.fromObject(t.pos),e.lastPos=o.fromObject(t.lastPos),e.rotation=t.rotation,e}},L=Q,Jt=class{constructor(t,e){this.length=t,this.springConstant=e,this.pinned=!1,this.objects=[],this.rotationLocked=!1,this.id=`_${Math.random().toString(36).substr(2,9)}`}pinHere(t,e){this.pinned={x:t,y:e}}unpin(){this.pinned=!1}attachObject(t){let e=this.objects;e.push(t),e.length===2&&(this.pinned=!1),e.length>=3&&(e=[e[e.length-2],e[e.length-1]])}lockRotation(){this.rotationLocked=!0}unlockRotation(){this.rotationLocked=!1}update(t){let e,s;if(this.pinned instanceof Object&&this.objects[0]){[s,e]=[this.pinned,this.objects[0]];let i=new o(s.x-e.pos.x,s.y-e.pos.y),a=i.length-this.length;i.setMag(1),i.mult(a*this.springConstant*t/e.m),e.vel.x+=i.x,e.vel.y+=i.y;let r=e.vel;if(r.rotate(-i.heading),this.rotationLocked){let h=new o(s.x,s.y),u=o.sub(e.pos,h),l=u.length,c=l*l*e.m+e.am,m=(e.am*e.ang-l*e.m*r.y)/c;r.y=-m*l,e.ang=m}r.rotate(i.heading)}else if(this.objects[0]&&this.objects[1]){[e,s]=[this.objects[0],this.objects[1]];let i=o.sub(e.pos,s.pos),a=i.length-this.length;i.setMag(1),i.mult(a*this.springConstant*t),s.vel.add(o.div(i,s.m)),e.vel.add(o.div(i,-e.m)),i=o.sub(e.pos,s.pos);let r=e.vel,h=s.vel;if(r.rotate(-i.heading),h.rotate(-i.heading),this.rotationLocked){let u=new o(e.pos.x*e.m+s.pos.x*s.m,e.pos.y*e.m+s.pos.y*s.m);u.div(e.m+s.m);let l=o.sub(e.pos,u),c=o.sub(s.pos,u),m=l.length,d=c.length,g=m*m*e.m+e.am+d*d*s.m+s.am,f=(r.y-h.y)*d/(m+d)+h.y,p=(e.am*e.ang+s.am*s.ang+m*e.m*(r.y-f)-d*s.m*(h.y-f))/g;r.y=p*m+f,h.y=-p*d+f,e.ang=p,s.ang=p}r.rotate(i.heading),h.rotate(i.heading)}}},E=Jt,zt=class extends E{constructor(t){super(t,0);this.springConstant=0}update(){let t,e;if(this.pinned instanceof Object&&"x"in this.pinned&&this.objects[0]){[e,t]=[this.pinned,this.objects[0]];let s=new o(e.x-t.pos.x,e.y-t.pos.y);s.setMag(1),s.mult(-this.length),t.move(-t.pos.x+e.x+s.x,-t.pos.y+e.y+s.y);let i=t.vel;if(i.rotate(-s.heading),i.x=0,this.rotationLocked){let a=new o(e.x,e.y),r=o.sub(t.pos,a),h=r.length,u=h*h*t.m+t.am,l=(t.am*t.ang+h*t.m*i.y)/u;i.y=l*h,t.ang=l}i.rotate(s.heading)}else if(this.objects[0]&&this.objects[1]){[t,e]=[this.objects[0],this.objects[1]];let s=o.sub(t.pos,e.pos),i=this.length-s.length;s.setMag(1);let a=o.mult(s,i*e.m/(t.m+e.m)),r=o.mult(s,-i*t.m/(t.m+e.m));t.move(a.x,a.y),e.move(r.x,r.y);let h=t.vel,u=e.vel;if(h.rotate(-s.heading),u.rotate(-s.heading),h.x=(t.m*h.x+e.m*u.x)/(t.m+e.m),u.x=h.x,this.rotationLocked){let l=new o(t.pos.x*t.m+e.pos.x*e.m,t.pos.y*t.m+e.pos.y*e.m);l.div(t.m+e.m);let c=o.sub(t.pos,l),m=o.sub(e.pos,l),d=c.length,g=m.length,f=d*d*t.m+t.am+g*g*e.m+e.am,p=(h.y-u.y)*g/(d+g)+u.y,y=(t.am*t.ang+e.am*e.ang+d*t.m*(h.y-p)-g*e.m*(u.y-p))/f;h.y=y*d+p,u.y=-y*g+p,t.ang=y,e.ang=y}h.rotate(s.heading),u.rotate(s.heading)}}},F=zt,et=class{constructor(t,e,s,i,a){this.points=[],i||i===0?this.fc=i:this.fc=.4,this.pressure=s,a?this.resolution=a:this.resolution=30,this.r=Math.abs(e);let r=Math.random()*1e6;for(let h=0;h<this.resolution;h+=1){let u=new o(t.x,t.y);u.add(o.mult(o.fromAngle(h/this.resolution*Math.PI*2),this.r)),this.points.push(new O(u,new o(0,0),this.r*Math.sin(Math.PI/this.resolution),0,0,this.fc)),this.points[this.points.length-1].layer=r}this.sides=[];for(let h=0;h<this.resolution;h+=1){let u=new F(2*this.r*Math.sin(Math.PI/this.resolution));u.attachObject(this.points[h]),u.attachObject(this.points[(h+1)%this.resolution]),h%2===0&&u.lockRotation(),this.sides.push(u)}}static updatePressureBasedForces(t,e){let s=[];if(s.push([]),t.points.forEach(r=>{s[0].push(new o(r.pos.x,r.pos.y))}),(r=>{let h=o.angleACW(o.sub(r[1],r[0]),o.sub(r[r.length-1],r[0]));if(h>Math.PI)return!0;for(let u=1;u<r.length-1;u+=1)if(h=o.angleACW(o.sub(r[(u+1)%r.length],r[u]),o.sub(r[u-1],r[u])),h>Math.PI)return!0;return h=o.angleACW(o.sub(r[0],r[r.length-1]),o.sub(r[r.length-2],r[r.length-1])),h>Math.PI})(s[0])){let r=(l,c)=>{for(let m=0;m<l.length;m+=1)if(l[m]===c)return!0;return!1},h=(l,c,m)=>{for(let d=0;d<c.length;d+=1)if(!r(m,d)){let g=new M(new o(c[d].x,c[d].y),new o(c[(d+1)%c.length].x,c[(d+1)%c.length].y));if(M.intersect(l,g))return!0}return!1},u=!0;t:for(;u;){u=!1;for(let l=0;l<s.length;l+=1){let c=s[l],m=o.sub(c[1],c[0]),d=o.sub(c[c.length-1],c[0]),g=o.angleACW(m,d);if(g>Math.PI){u=!0;let f=0,p=f+2,y=new M(new o(c[f].x,c[f].y),new o(c[p%c.length].x,c[p%c.length].y)),b=new o(y.b.x-y.a.x,y.b.y-y.a.y).heading;for(;!(m.heading>d.heading?b>m.heading&&b<2*Math.PI||b>0&&b<d.heading:b>m.heading&&b<d.heading)||h(new M(new o(c[f%c.length].x,c[f%c.length].y),new o(c[p%c.length].x,c[p%c.length].y)),c,[(c.length-1)%c.length,f%c.length,(p-1)%c.length,p%c.length]);)p+=1,y=new M(new o(c[f].x,c[f].y),new o(c[p%c.length].x,c[p%c.length].y)),b=new o(y.b.x-y.a.x,y.b.y-y.a.y).heading;let I=[],k=[];for(let x=f;x<=p;x+=1)I.push(c[x%c.length]);for(let x=p;x<=f+c.length;x+=1)k.push(c[x%c.length]);s[l]=I,s.push(k);continue t}for(let f=1;f<c.length;f+=1)if(m=o.sub(c[(f+1)%c.length],c[f]),d=o.sub(c[f-1],c[f]),g=o.angleACW(m,d),g>Math.PI){u=!0;let p=f+2,y=new M(new o(c[f].x,c[f].y),new o(c[p%c.length].x,c[p%c.length].y)),b=new o(y.b.x-y.a.x,y.b.y-y.a.y).heading;for(;!(m.heading>d.heading?b>m.heading&&b<2*Math.PI||b>0&&b<d.heading:b>m.heading&&b<d.heading)||h(y,c,[(f-1)%c.length,f%c.length,(p-1)%c.length,p%c.length]);)p+=1,y=new M(new o(c[f].x,c[f].y),new o(c[p%c.length].x,c[p%c.length].y)),b=new o(y.b.x-y.a.x,y.b.y-y.a.y).heading;let I=[],k=[];for(let x=f;x<=p;x+=1)I.push(c[x%c.length]);for(let x=p;x<=f+c.length;x+=1)k.push(c[x%c.length]);s[l]=I,s.push(k);continue t}}}}for(let r=s.length-1;r>=0;r-=1){let h=s[r];for(;h.length>3;)s.push([h[0],h[1],h[2]]),h.splice(1,1)}let i=0;s.forEach(r=>{let h=Math.sqrt((r[0].x-r[1].x)**2+(r[0].y-r[1].y)**2),u=Math.sqrt((r[1].x-r[2].x)**2+(r[1].y-r[2].y)**2),l=Math.sqrt((r[2].x-r[0].x)**2+(r[2].y-r[0].y)**2),c=(h+u+l)/2,m=Math.sqrt(c*(c-h)*(c-u)*(c-l));i+=m});let a=t.pressure*(t.r*t.r*Math.PI/i)-t.pressure;t.sides.forEach(r=>{let h=o.sub(r.objects[0].pos,r.objects[1].pos);h.mult(a),h.rotate(Math.PI/2),h.mult(e),r.objects[0].vel.add(o.div(h,r.objects[0].m)),r.objects[1].vel.add(o.div(h,r.objects[1].m))})}get sideSegments(){return this.points.map((t,e)=>new M(t.pos,this.points[(e+1)%this.points.length].pos))}containsPoint(t){let e=this.sideSegments,s=Math.max(...this.points.map(h=>o.dist(h.pos,t)))+1,i=o.fromAngle(0);i.setMag(s);let a=new M(t,o.add(i,t)),r=e.filter(h=>M.intersect(h,a)!==void 0);return r.length%2===1}toJSObject(){let t={};return t.pressure=this.pressure,t.fc=this.fc,t.r=this.r,t.resolution=this.resolution,t.points=this.points.map(e=>e.id),t.sides=this.sides.map(e=>e.id),t}static fromObject(t,e,s){let i=Object.create(et.prototype);return i.pressure=t.pressure,i.fc=t.fc,i.resolution=t.resolution,i.r=t.r,i.points=t.points.map(a=>{let r=e.filter(h=>a===h.id);return r[0]}),i.sides=t.sides.map(a=>{let r=s.filter(h=>a===h.id);return r[0]}),i}},R=et;function Ie(n,t,e){return n==="spring"?new E(t,e):n==="stick"?new F(t):new E(0,0)}function Ut(n,t){let e=Ie(n.type,n.length,n.springConstant);return e.pinned=n.pinned,e.rotationLocked=n.rotationLocked,e.id=n.id,e.objects=n.objects.map(s=>{let i=t.filter(a=>s===a.id);return i[0]}),e}function Vt(n){let t={};return t.length=n.length,t.springConstant=n.springConstant,t.pinned=n.pinned,t.rotationLocked=n.rotationLocked,t.id=n.id,t.objects=n.objects.map(e=>e.id),n instanceof E&&(t.type="spring"),n instanceof F&&(t.type="stick"),t}var W=class{constructor(){this.balls=[],this.bodies=[],this.fixedBalls=[],this.softBalls=[],this.walls=[],this.bounds=[],this.springs=[],this.airFriction=1,this.gravity=new o(0,0),this.addBodyNotBall=!1,this.collisionData=[]}update(t,e){this.collisionData=[];let s=e?this.copy:new W;e&&(s.bodies.reverse(),s.balls.reverse(),s.update(t,!1));for(let i=0;i<this.balls.length;i+=1)this.balls[i].lastPos=this.balls[i].pos.copy,this.balls[i].pos.add(o.mult(this.balls[i].vel,t)),this.balls[i].rotation+=this.balls[i].ang*t,this.balls[i].rotation%=Math.PI*2;for(let i=0;i<this.bodies.length;i+=1)this.bodies[i].lastPos=this.bodies[i].pos.copy,this.bodies[i].move(this.bodies[i].vel.x*t,this.bodies[i].vel.y*t),this.bodies[i].rotate(this.bodies[i].ang*t);for(let i=0;i<3;i+=1)this.springs.forEach(a=>{a.update(t/3/2)});for(let i=0;i<this.balls.length;i+=1){this.gravity&&this.balls[i].vel.add(new o(this.gravity.x*t,this.gravity.y*t));for(let a=i+1;a<this.balls.length;a+=1)if(this.balls[i].layer!==this.balls[a].layer||!this.balls[i].layer&&!this.balls[a].layer){let r=O.collide(this.balls[i],this.balls[a]);r&&this.collisionData.push(r)}this.walls.forEach(a=>{let r=a.collideWithBall(this.balls[i]);r&&this.collisionData.push(r)}),this.fixedBalls.forEach(a=>{let r=this.balls[i],h=o.sub(r.pos,a);if(h.sqlength<=(r.r+a.r)**2){let u=h;u.setMag(1),r.pos=o.add(a,o.mult(u,r.r+a.r)),u.mult(-1),N(r,a,u),this.collisionData.push({cp:o.fromObject(a),n:u})}}),this.bounds.forEach(a=>{let r=a.collideWithBall(this.balls[i]);r&&this.collisionData.push(r)})}for(let i=0;i<this.bodies.length;i+=1){this.balls.forEach(a=>{let r=this.bodies[i].collideWithBall(a);r&&this.collisionData.push(r)});for(let a=i+1;a<this.bodies.length;a+=1){let r=L.collide(this.bodies[i],this.bodies[a]);r&&this.collisionData.push(r)}this.bodies.forEach(a=>{this.fixedBalls.forEach(r=>{let h=a.collideWithFixedBall(r);h&&this.collisionData.push(h)})}),this.bodies.forEach(a=>{this.walls.forEach(r=>{let h=a.collideWithWall(r);h&&this.collisionData.push(h)})}),this.bodies.forEach(a=>{this.bounds.forEach(r=>{let h=a.collideWithWall(r);h&&this.collisionData.push(h)})}),this.gravity&&this.bodies[i].vel.add(new o(this.gravity.x*t,this.gravity.y*t))}this.softBalls.forEach(i=>{R.updatePressureBasedForces(i,t)});for(let i=0;i<3;i+=1)this.springs.forEach(a=>{a.update(t/3/2)});this.balls.forEach(i=>{let a=i;a.vel.mult(this.airFriction**t),a.ang*=this.airFriction**t}),this.bodies.forEach(i=>{let a=i;a.vel.mult(this.airFriction**t),a.ang*=this.airFriction**t}),e&&(s.bodies.reverse(),s.balls.reverse(),this.balls.forEach((i,a)=>{i.move((s.balls[a].pos.x-i.pos.x)*.5,(s.balls[a].pos.y-i.pos.y)*.5),i.vel.add(new o((s.balls[a].vel.x-i.vel.x)*.5,(s.balls[a].vel.y-i.vel.y)*.5));let r=i;r.rotation=(i.rotation+s.balls[a].rotation)/2,r.ang=(i.ang+s.balls[a].ang)/2}),this.bodies.forEach((i,a)=>{let r=s.bodies[a];i.move((r.pos.x-i.pos.x)*.5,(r.pos.y-i.pos.y)*.5),i.vel.add(new o((r.vel.x-i.vel.x)*.5,(r.vel.y-i.vel.y)*.5)),i.rotate((r.rotation-i.rotation)/2);let h=i;h.ang=(i.ang+r.ang)/2}))}get copy(){let t=new W;return t.balls=this.getCopyOfBalls(),t.bodies=this.getCopyOfBodies(),t.fixedBalls=this.fixedBalls,t.walls=this.walls,t.bounds=this.bounds,t.gravity=this.gravity,this.springs.forEach(e=>{let s=e instanceof E?E:F,i=new s(e.length,e.springConstant);i.rotationLocked=e.rotationLocked,i.pinned=e.pinned,e.objects.forEach(a=>{let r=-1;a instanceof O&&(r=this.balls.indexOf(a)),r!==-1?i.attachObject(t.balls[r]):(r=-1,a instanceof L&&(r=this.bodies.indexOf(a)),r!==-1&&i.attachObject(t.bodies[r]))}),t.springs.push(i)}),t}setAirFriction(t){if(!Number.isFinite(t))return;this.airFriction=t,this.airFriction<0&&(this.airFriction=0),this.airFriction>1&&(this.airFriction=1)}setGravity(t){this.gravity=t.copy}addBall(t){if(this.addBodyNotBall){let e=(s,i,a)=>{let r=[];for(let h=0;h<a;h+=1){let u=o.fromAngle(h/a*2*Math.PI);u.mult(i),u.add(s),r.push(u)}return r};this.bodies.push(new L(e(t.pos,t.r,24),t.vel,t.k,t.ang,t.fc))}else this.balls.push(t)}addBody(t){this.bodies.push(t)}addSoftBall(t){this.balls.push(...t.points),this.springs.push(...t.sides),this.softBalls.push(t)}addSoftSquare(t,e,s,i,a=24,r=1){let h=new R(t,Math.sqrt(e*e/Math.PI),r,s,a);h.sides.forEach(c=>{let m=c;m.length=.96*4*e/h.resolution}),h.points.forEach(c=>{let m=c;m.vel=i.copy}),this.balls.push(...h.points),this.springs.push(...h.sides);let u=e*e*200*r,l=new E(Math.sqrt(h.r*h.r*Math.PI),u/2);l.attachObject(h.points[0]),l.attachObject(h.points[h.resolution/2]),this.springs.push(l),l=new E(Math.sqrt(h.r*h.r*Math.PI),u/2),l.attachObject(h.points[h.resolution/4]),l.attachObject(h.points[3*h.resolution/4]),this.springs.push(l),l=new E(Math.sqrt(2*h.r*h.r*Math.PI),u),l.attachObject(h.points[h.resolution/8]),l.attachObject(h.points[5*h.resolution/8]),this.springs.push(l),l=new E(Math.sqrt(2*h.r*h.r*Math.PI),u),l.attachObject(h.points[3*h.resolution/8]),l.attachObject(h.points[7*h.resolution/8]),this.springs.push(l)}addRectWall(t,e,s,i){let a=[];a.push(new o(t-s/2,e-i/2)),a.push(new o(t+s/2,e-i/2)),a.push(new o(t+s/2,e+i/2)),a.push(new o(t-s/2,e+i/2)),this.walls.push(new J(a))}addRectBody(t,e,s,i,a,r){let h=[];h.push(new o(t-s/2,e-i/2)),h.push(new o(t+s/2,e-i/2)),h.push(new o(t+s/2,e+i/2)),h.push(new o(t-s/2,e+i/2)),this.bodies.push(new L(h,new o(0,0),r,0,a))}addWall(t){this.walls.push(t)}addFixedBall(t,e,s){this.fixedBalls.push({x:t,y:e,r:s})}addSpring(t){this.springs.push(t)}setBounds(t,e,s,i){this.bounds=[];let a=(r,h,u,l)=>{let c=[];return c.push(new o(r-u/2,h-l/2)),c.push(new o(r+u/2,h-l/2)),c.push(new o(r+u/2,h+l/2)),c.push(new o(r-u/2,h+l/2)),new J(c)};this.bounds.push(a(t-s,e,2*s,4*i)),this.bounds.push(a(t+2*s,e,2*s,4*i)),this.bounds.push(a(t,e-i,4*s,i*2)),this.bounds.push(a(t,e+2*i,4*s,2*i))}getObjectAtCoordinates(t,e){let s={x:t,y:e,pinPoint:!0},i=new o(t,e);return this.balls.some(a=>a.containsPoint(i)?(s=a,!0):!1)||(this.bodies.some(a=>a.containsPoint(i)?(s=a,!0):!1)||(this.walls.some(a=>a.containsPoint(i)?(s=a,!0):!1)||(this.fixedBalls.forEach(a=>{o.dist(new o(a.x,a.y),new o(t,e))<=a.r&&(s=a)}),this.softBalls.forEach(a=>{a.containsPoint(i)&&(s=a)})))),s}getCopyOfBalls(){return this.balls.map(t=>t.copy)}getCopyOfBodies(){return this.bodies.map(t=>t.copy)}removeObjFromSystem(t){let e=-1;if(t instanceof O&&(e=this.balls.indexOf(t)),e!==-1){let s=!1;if(this.softBalls.forEach(i=>{i.points.includes(this.balls[e])&&(this.removeObjFromSystem(i),s=!0)}),s)return;this.springs.forEach(i=>{i.objects.includes(this.balls[e])&&this.removeObjFromSystem(i)}),this.balls.splice(e,1);return}if(t instanceof L&&(e=this.bodies.indexOf(t)),e!==-1){this.bodies.splice(e,1);return}if(t instanceof J&&(e=this.walls.indexOf(t)),e!==-1){this.walls.splice(e,1);return}if(t instanceof Object&&"r"in t&&"x"in t&&(e=this.fixedBalls.indexOf(t)),e!==-1){this.fixedBalls.splice(e,1);return}if((t instanceof F||t instanceof E)&&(e=this.springs.indexOf(t)),e!==-1){this.springs.splice(e,1);let s=this.springs[e];this.softBalls.forEach(i=>{s instanceof F&&i.sides.includes(s)&&this.removeObjFromSystem(i)});return}if(t instanceof R&&(e=this.softBalls.indexOf(t)),e!==-1){let s=this.softBalls[e];this.softBalls.splice(e,1),s.points.forEach(i=>{this.removeObjFromSystem(i)})}}getItemDataFromId(t){let e=r=>r.id===t,s=this.balls.filter(e);if(s.length>=1)return{type:"ball",num:this.balls.indexOf(s[0])};let i=this.bodies.filter(e);if(i.length>=1)return{type:"body",num:this.bodies.indexOf(i[0])};let a=this.springs.filter(e);return a.length>=1?{type:"spring",num:this.springs.indexOf(a[0])}:{type:"",num:-1}}toJSObject(){let t={};return t.balls=this.balls.map(e=>e.toJSObject()),t.bounds=this.bounds.map(e=>e.toJSObject()),t.walls=this.walls.map(e=>e.toJSObject()),t.bodies=this.bodies.map(e=>e.toJSObject()),t.springs=this.springs.map(e=>Vt(e)),t.softBalls=this.softBalls.map(e=>e.toJSObject()),t.fixedBalls=this.fixedBalls,t.airFriction=this.airFriction,t.gravity=this.gravity.toJSObject(),t}static fromObject(t){let e=new W;return e.balls=t.balls.map(s=>O.fromObject(s)),e.bounds=t.bounds.map(s=>J.fromObject(s)),e.walls=t.walls.map(s=>J.fromObject(s)),e.bodies=t.bodies.map(s=>L.fromObject(s)),e.springs=t.springs.map(s=>Ut(s,e.balls)),e.softBalls=t.softBalls.map(s=>R.fromObject(s,e.balls,e.springs)),e.fixedBalls=t.fixedBalls,e.airFriction=t.airFriction,e.gravity=o.fromObject(t.gravity),e}toJSON(){return JSON.stringify(this.toJSObject())}static fromJSON(t){return W.fromObject(JSON.parse(t))}},Z=W,st,z;function ft(n){st=n.getPhysics().toJSObject(),z=!0;let t=document.getElementById("pause");t&&(t.onclick=()=>{n.getTimeMultiplier()!==0?n.setTimeMultiplier(0):(n.setTimeMultiplier(1),z===!0&&(st=n.getPhysics().toJSObject()),z=!1)});let e=document.getElementById("revert");e&&(e.onclick=()=>{n.setTimeMultiplier(0),n.setPhysics(Z.fromObject(st)),z=!0});let s=document.getElementById("clear all");s&&(s.onclick=()=>{z=!0;let a=n.getPhysics();a.balls=[],a.walls=[],a.softBalls=[],a.springs=[],a.bodies=[]});let i=document.getElementById("set start");i&&(i.onclick=()=>{st=n.getPhysics().toJSObject(),z=!0,n.setTimeMultiplier(0)})}function w(n){let t=document.createElement("div"),e=document.createElement("h3");return e.innerText=n,e.classList.add("modetitlemargin"),t.appendChild(e),t.classList.add("mode-title"),t.classList.add("bg-blue"),t}function v(n,t,e,s,i,a=1){let r=document.createElement("p");r.innerText=n;let h=document.createElement("input");h.type="range",h.min=t.toString(),h.max=e.toString(),h.step=a.toString(),h.value=s.toString(),h.classList.add("slider"),h.classList.add("fix-width"),h.onchange=i;let u=document.createElement("div");return u.appendChild(r),u.appendChild(h),u}function H(n,t,e){let s=n+Math.random().toString(),i=document.createElement("label");i.innerText=n,i.htmlFor=s,i.classList.add("checkbox-label");let a=document.createElement("input");a.type="checkbox",a.name=s,a.value=t.toString(),a.classList.add("ch-box"),a.onchange=e;let r=document.createElement("div");return r.appendChild(a),r.appendChild(i),r}var nt=35,gt=.5,pt=1.5,yt=document.createElement("div"),$t={name:"Ball creator",description:"",element:yt,drawFunc(n,t){let e=n.cnv.getContext("2d");e.strokeStyle="black",e.beginPath(),e.arc(n.mouseX,n.mouseY,nt,0,2*Math.PI),e.stroke(),n.lastX!==0&&n.lastY!==0&&(e.beginPath(),e.moveTo(n.mouseX,n.mouseY),e.lineTo(n.lastX,n.lastY),e.stroke())},startInteractionFunc(n){},endInteractionFunc(n){if(n.lastX!==0&&n.lastY!==0){let t=new O(new o(n.lastX,n.lastY),new o(n.lastX-n.mouseX,n.lastY-n.mouseY),nt,gt,0,pt);Number.isFinite(t.pos.x)&&Number.isFinite(t.pos.y)&&Number.isFinite(t.vel.x)&&Number.isFinite(t.vel.y)||(t.vel.x=0,t.vel.y=0),n.physics.addBall(t)}},keyGotUpFunc(n){},keyGotDownFunc(n){}};[w($t.name),v("Size",5,120,nt,n=>{nt=n.target.valueAsNumber}),v("Bounciness",0,1,gt,n=>{gt=n.target.valueAsNumber},.02),v("Coefficient of friction",0,2,pt,n=>{pt=n.target.valueAsNumber},.1)].forEach(yt.appendChild.bind(yt));var Kt=$t,bt=document.createElement("div"),Qt={name:"Delete",description:"",element:bt,drawFunc(n,t){},startInteractionFunc(n){n.choosed&&n.physics.removeObjFromSystem(n.choosed)},endInteractionFunc(n){},keyGotUpFunc(n){},keyGotDownFunc(n){}};[w(Qt.name)].forEach(bt.appendChild.bind(bt));var Zt=Qt,_=35,ke=.5,it=1.5,xt=24,vt=1e6,Mt=document.createElement("div"),_t={name:"Elastic ball creator",description:"",element:Mt,drawFunc(n,t){let e=n.cnv.getContext("2d");e.strokeStyle="black",e.beginPath(),e.arc(n.mouseX,n.mouseY,_,0,2*Math.PI),e.stroke(),n.lastX!==0&&n.lastY!==0&&(e.beginPath(),e.moveTo(n.mouseX,n.mouseY),e.lineTo(n.lastX,n.lastY),e.stroke())},startInteractionFunc(n){},endInteractionFunc(n){if(n.lastX!==0&&n.lastY!==0){let t=new O(new o(n.lastX,n.lastY),new o(n.lastX-n.mouseX,n.lastY-n.mouseY),_,ke,0,it);if(Number.isFinite(t.pos.x)&&Number.isFinite(t.pos.y)&&Number.isFinite(t.vel.x)&&Number.isFinite(t.vel.y)){let e=new R(t.pos,_,vt,it,xt);e.points.forEach(s=>{let i=s;i.vel=t.vel.copy}),n.physics.addSoftBall(e)}}},keyGotUpFunc(n){},keyGotDownFunc(n){}};[w(_t.name),v("Size",5,60,_,n=>{_=n.target.valueAsNumber}),v("Pressure",5e5,3e6,vt,n=>{vt=n.target.valueAsNumber},4e3),v("Coefficient of friction",0,2,it,n=>{it=n.target.valueAsNumber},.1),v("Resolution",6,24,xt,n=>{xt=n.target.valueAsNumber},1)].forEach(Mt.appendChild.bind(Mt));var At=_t,te=0,ee=0,wt=document.createElement("div"),se={name:"Move",description:"",element:wt,drawFunc(n,t){let{choosed:e}=n;e instanceof Object&&"move"in e&&(e.move(n.mouseX-e.pos.x,n.mouseY-e.pos.y),t===0?(e.vel.x=0,e.vel.y=0):(e.vel.x=(n.mouseX-te)/t,e.vel.y=(n.mouseY-ee)/t),e.ang=0),te=n.mouseX,ee=n.mouseY},startInteractionFunc(n){},endInteractionFunc(n){},keyGotUpFunc(n){},keyGotDownFunc(n){}};[w(se.name)].forEach(wt.appendChild.bind(wt));var ne=se,Ct=document.createElement("div"),ie={name:"Rectangle wall",description:"",element:Ct,drawFunc(n,t){if(n.lastX!==0&&n.lastY!==0){let e=n.cnv.getContext("2d");e.strokeStyle="black",e.strokeRect(n.mouseX,n.mouseY,n.lastX-n.mouseX,n.lastY-n.mouseY)}},startInteractionFunc(n){},endInteractionFunc(n){n.lastX!==0&&n.lastY!==0&&n.physics.addRectWall(n.lastX/2+n.mouseX/2,n.lastY/2+n.mouseY/2,2*Math.abs(n.lastX/2-n.mouseX/2),2*Math.abs(n.lastY/2-n.mouseY/2))},keyGotUpFunc(n){},keyGotDownFunc(n){}};[w(ie.name)].forEach(Ct.appendChild.bind(Ct));var oe=ie,Pt=.2,St=.5,It=document.createElement("div"),ae={name:"Rectangle body",description:"",element:It,drawFunc(n,t){let e=n.cnv.getContext("2d");n.lastX!==0&&n.lastY!==0&&(e.strokeStyle="black",e.strokeRect(n.mouseX,n.mouseY,n.lastX-n.mouseX,n.lastY-n.mouseY))},startInteractionFunc(n){},endInteractionFunc(n){if(n.lastX!==0&&n.lastY!==0){let t=Math.abs(n.mouseX-n.lastX),e=Math.abs(n.mouseY-n.lastY);if(t/e>50||e/t>50||e===0||t===0)return;n.physics.addRectBody(n.lastX/2+n.mouseX/2,n.lastY/2+n.mouseY/2,2*Math.abs(n.lastX/2-n.mouseX/2),2*Math.abs(n.lastY/2-n.mouseY/2),St,Pt)}},keyGotUpFunc(n){},keyGotDownFunc(n){}};[w(ae.name),v("Bounciness",.07,.3,Pt,n=>{Pt=n.target.valueAsNumber},.02),v("Coefficient of friction",0,.6,St,n=>{St=n.target.valueAsNumber},.1)].forEach(It.appendChild.bind(It));var re=ae,ot=35,kt=.2,Et=.5,at=4,rt=24,Ot=document.createElement("div");function ce(n=24,t=4){return[...new Array(n).keys()].map(e=>o.fromAnglePNorm(Math.PI*2*e/n,t))}var he={name:"Squircle creator",description:"",element:Ot,drawFunc(n,t){let e=n.cnv.getContext("2d");e.strokeStyle="black";let s=ce(rt,at);s.forEach(i=>i.mult(ot)),e.beginPath(),e.moveTo(n.mouseX+s[0].x,n.mouseY+s[0].y);for(let i=1;i<s.length;i+=1)e.lineTo(n.mouseX+s[i].x,n.mouseY+s[i].y);e.closePath(),e.stroke(),n.mouseDown&&(e.beginPath(),e.moveTo(n.mouseX,n.mouseY),e.lineTo(n.lastX,n.lastY),e.stroke())},startInteractionFunc(n){},endInteractionFunc(n){let t=ce(rt,at),e=new o(n.mouseX,n.mouseY);if(t.forEach(s=>{s.mult(ot),s.add(e)}),n.lastX!==0&&n.lastY!==0){let s=new L(t,new o(n.lastX-n.mouseX,n.lastY-n.mouseY),kt,0,Et);n.physics.addBody(s)}}};[w(he.name),v("Size",5,120,ot,n=>{ot=n.target.valueAsNumber}),v("Roundness",2,7,9-at,n=>{at=9-n.target.valueAsNumber},1),v("Resolution",12,36,rt,n=>{rt=n.target.valueAsNumber},1),v("Bounciness",.07,.3,kt,n=>{kt=n.target.valueAsNumber},.02),v("Coefficient of friction",0,.6,Et,n=>{Et=n.target.valueAsNumber},.1)].forEach(Ot.appendChild.bind(Ot));var le=he,T=35,Ee=.5,ct=1.5,Ft=24,Tt=1,Xt=document.createElement("div"),ue={name:"Soft square creator",description:"",element:Xt,drawFunc(n,t){let e=n.cnv.getContext("2d");e.strokeStyle="black",e.beginPath(),e.moveTo(n.mouseX-T,n.mouseY-T),e.lineTo(n.mouseX+T,n.mouseY-T),e.lineTo(n.mouseX+T,n.mouseY+T),e.lineTo(n.mouseX-T,n.mouseY+T),e.lineTo(n.mouseX-T,n.mouseY-T),e.stroke(),n.lastX!==0&&n.lastY!==0&&(e.beginPath(),e.moveTo(n.mouseX,n.mouseY),e.lineTo(n.lastX,n.lastY),e.stroke())},startInteractionFunc(n){},endInteractionFunc(n){if(n.lastX!==0&&n.lastY!==0){let t=new O(new o(n.lastX,n.lastY),new o(n.lastX-n.mouseX,n.lastY-n.mouseY),T,Ee,0,ct);Number.isFinite(t.pos.x)&&Number.isFinite(t.pos.y)&&Number.isFinite(t.vel.x)&&Number.isFinite(t.vel.y)&&n.physics.addSoftSquare(t.pos,T*2,ct,t.vel,Ft,Tt)}},keyGotUpFunc(n){},keyGotDownFunc(n){}};[w(ue.name),v("Size",5,100,T,n=>{T=n.target.valueAsNumber}),v("Pressure",.4,7,Tt,n=>{Tt=n.target.valueAsNumber},.1),v("Coefficient of friction",0,2,ct,n=>{ct=n.target.valueAsNumber},.1),v("Resolution",16,48,Ft,n=>{Ft=n.target.valueAsNumber},8)].forEach(Xt.appendChild.bind(Xt));var de=ue,Yt=!1,A=1e4,Bt=document.createElement("div"),me={name:"Spring creator",description:"",element:Bt,drawFunc(n,t){let e=n.cnv.getContext("2d");n.lastX!==0&&n.lastY!==0&&(e.strokeStyle="black",e.beginPath(),e.moveTo(n.mouseX,n.mouseY),e.lineTo(n.lastX,n.lastY),e.stroke())},startInteractionFunc(n){},endInteractionFunc(n){if(n.lastX!==0&&n.lastY!==0){let t=n.physics.getObjectAtCoordinates(n.mouseX,n.mouseY),e,s=E;if(t||(t={x:n.mouseX,y:n.mouseY,pinPoint:!0}),n.choosed===t||n.choosed===void 0&&t===void 0)return;if(n.choosed instanceof Object&&t instanceof Object&&"pinPoint"in n.choosed&&"pinPoint"in t)return;if(n.choosed instanceof Object&&t instanceof Object&&"pinPoint"in n.choosed&&"pos"in t?(e=new s(Math.sqrt((n.choosed.x-t.pos.x)**2+(n.choosed.y-t.pos.y)**2),A),e.attachObject(t),e.pinHere(n.choosed.x,n.choosed.y)):t instanceof Object&&n.choosed instanceof Object&&"pos"in n.choosed&&"pinPoint"in t?(e=new s(Math.sqrt((n.choosed.pos.x-t.x)**2+(n.choosed.pos.y-t.y)**2),A),e.attachObject(n.choosed),e.pinHere(t.x,t.y)):n.choosed instanceof Object&&t instanceof Object&&"pos"in n.choosed&&"pos"in t&&(e=new s(Math.sqrt((n.choosed.pos.x-t.pos.x)**2+(n.choosed.pos.y-t.pos.y)**2),A),e.attachObject(n.choosed),e.attachObject(t)),typeof e=="undefined")return;n.physics.addSpring(e),Yt&&e.lockRotation()}},keyGotUpFunc(n){},keyGotDownFunc(n){}};[w(me.name),H("Rotation locked",Yt,n=>{Yt=n.target.checked}),v("Spring stiffness",2e3,1e5,A,n=>{A=n.target.valueAsNumber},50)].forEach(Bt.appendChild.bind(Bt));var fe=me,jt=!1,Lt=document.createElement("div"),ge={name:"Stick creator",description:"",element:Lt,drawFunc(n,t){let e=n.cnv.getContext("2d");n.lastX!==0&&n.lastY!==0&&(e.strokeStyle="black",e.beginPath(),e.moveTo(n.mouseX,n.mouseY),e.lineTo(n.lastX,n.lastY),e.stroke())},startInteractionFunc(n){},endInteractionFunc(n){if(n.lastX!==0&&n.lastY!==0){let t=n.physics.getObjectAtCoordinates(n.mouseX,n.mouseY),e,s=F;if(t||(t={x:n.mouseX,y:n.mouseY,pinPoint:!0}),n.choosed===t||n.choosed===void 0&&t===void 0)return;if("pinPoint"in n.choosed&&"pinPoint"in t)return;if("pinPoint"in n.choosed&&"pos"in t?(e=new s(Math.sqrt((n.choosed.x-t.pos.x)**2+(n.choosed.y-t.pos.y)**2)),e.attachObject(t),e.pinHere(n.choosed.x,n.choosed.y)):"pinPoint"in t&&"pos"in n.choosed?(e=new s(Math.sqrt((n.choosed.pos.x-t.x)**2+(n.choosed.pos.y-t.y)**2)),e.attachObject(n.choosed),e.pinHere(t.x,t.y)):"pos"in n.choosed&&"pos"in t&&(e=new s(Math.sqrt((n.choosed.pos.x-t.pos.x)**2+(n.choosed.pos.y-t.pos.y)**2)),e.attachObject(n.choosed),e.attachObject(t)),typeof e=="undefined")return;n.physics.addSpring(e),jt&&e.lockRotation()}},keyGotUpFunc(n){},keyGotDownFunc(n){}};[w(ge.name),H("Rotation locked",jt,n=>{jt=n.target.checked})].forEach(Lt.appendChild.bind(Lt));var pe=ge,ht=20,Nt=document.createElement("div"),ye={name:"Wall drawer",description:"",element:Nt,drawFunc(n,t){let e=n.cnv.getContext("2d");e.strokeStyle="black",e.beginPath(),e.arc(n.mouseX,n.mouseY,ht,0,2*Math.PI),e.stroke(),n.lastX!==0&&n.lastY!==0&&n.physics.addFixedBall(n.mouseX,n.mouseY,ht)},startInteractionFunc(n){},endInteractionFunc(n){},keyGotUpFunc(n){},keyGotDownFunc(n){}};[w(ye.name),v("Size",5,70,ht,n=>{ht=n.target.valueAsNumber})].forEach(Nt.appendChild.bind(Nt));var be=ye,Rt=document.createElement("div"),xe={name:"World settings",description:"",element:Rt,init(n){let t=n;[w(xe.name),v("Gravity",0,5e3,t.physics.gravity.y,e=>{t.physics.gravity.y=e.target.valueAsNumber},100),v("Gravity in the X direction",-5e3,5e3,t.physics.gravity.x,e=>{t.physics.gravity.x=e.target.valueAsNumber},1e3),v("Air friction",0,.99,1-t.physics.airFriction,e=>{let s=e.target.valueAsNumber;t.physics.setAirFriction(1-s)},.01),H("Show collision data",t.drawCollisions,e=>{t.drawCollisions=e.target.checked}),H("Show body axes",t.showAxes,e=>{t.showAxes=e.target.checked})].forEach(Rt.appendChild.bind(Rt))}},ve=xe,Me=[Kt,oe,be,pe,fe,ne,At,de,Zt,re,ve,le];var D=Me,lt=D.map(n=>n.name),B={white:"#faf3dd",green:"#02c39a",pink:"#e58c8a",blue:"#77b6ea",black:"#363732"},we=class{constructor(){this.resizeCanvas=()=>{let t=this.canvasHolder.getBoundingClientRect();this.cnv.width=t.width,this.cnv.height=window.innerHeight-t.top;let e=window.devicePixelRatio||1,s=t;this.cnv.width=s.width*e,this.cnv.height=s.height*e,this.cnv.style.width=`${s.width}px`,this.cnv.style.height=`${s.height}px`,this.scaling=1/e,this.physics.setBounds(0,0,this.cnv.width,this.cnv.height);let i=this.cnv.getContext("2d");i&&(i.scale(e,e),i.lineWidth=e),this.defaultSize=(this.cnv.width+this.cnv.height)/80};this.drawFunction=()=>{var s,i;Number.isFinite(this.lastFrameTime)||(this.lastFrameTime=performance.now());let t=performance.now()-this.lastFrameTime;Number.isFinite(t)||(t=0),t/=1e3;let e=this.cnv.getContext("2d");e.fillStyle=B.black,e.fillRect(0,0,this.cnv.width,this.cnv.height),e.save(),e.translate(this.viewOffsetX,this.viewOffsetY),e.scale(this.scaling,this.scaling),(i=(s=D[this.mode]).drawFunc)==null||i.call(s,this,t*this.timeMultiplier),this.physicsDraw(),e.restore(),this.physics.balls[0]&&(this.left&&(this.physics.balls[0].ang-=Math.PI*100*t),this.right&&(this.physics.balls[0].ang+=Math.PI*100*t)),t*=this.timeMultiplier,this.physics.update(t/5,!1),this.physics.update(t/5,!1),this.physics.update(t/5,!1),this.physics.update(t/5,!1),this.physics.update(t/5,!1),this.lastFrameTime=performance.now(),requestAnimationFrame(this.drawFunction)};this.startInteraction=(t,e)=>{var s,i;this.mouseX=t/this.scaling-this.viewOffsetX/this.scaling,this.mouseY=e/this.scaling-this.viewOffsetY/this.scaling,this.choosed=this.physics.getObjectAtCoordinates(this.mouseX,this.mouseY),this.choosed||(this.choosed={x:this.mouseX,y:this.mouseY,pinPoint:!0}),this.lastX=this.mouseX,this.lastY=this.mouseY,(i=(s=D[this.mode]).startInteractionFunc)==null||i.call(s,this)};this.endInteraction=(t,e)=>{var s,i;if(this.mouseX=t/this.scaling-this.viewOffsetX/this.scaling,this.mouseY=e/this.scaling-this.viewOffsetY/this.scaling,(i=(s=D[this.mode]).endInteractionFunc)==null||i.call(s,this),this.lastX===0&&this.lastY===0)return;this.lastX=0,this.lastY=0,this.choosed=!1};this.keyGotDown=t=>{let e=t.key;e==="s"&&this.spawnNewtonsCradle(this.cnv.width/2,this.cnv.height/2,.5,this.physics),e==="a"&&(this.scaling+=.01),e==="d"&&(this.scaling-=.01),e==="j"&&(this.viewOffsetX-=10),e==="l"&&(this.viewOffsetX+=10),e==="k"&&(this.viewOffsetY-=10),e==="i"&&(this.viewOffsetY+=10),e==="ArrowRight"&&(this.right=!0),e==="ArrowLeft"&&(this.left=!0)};this.keyGotUp=t=>{let e=t.key;e==="ArrowRight"&&(this.right=!1),e==="ArrowLeft"&&(this.left=!1)};this.startTouch=t=>{t.preventDefault();let e=this.canvasHolder.getBoundingClientRect();return this.startInteraction(t.changedTouches[0].clientX-e.left,t.changedTouches[0].clientY-e.top),!1};this.endTouch=t=>{t.preventDefault();let e=this.canvasHolder.getBoundingClientRect();return this.endInteraction(t.changedTouches[0].clientX-e.left,t.changedTouches[0].clientY-e.top),!1};this.moveTouch=t=>{t.preventDefault();let e=this.canvasHolder.getBoundingClientRect();return this.mouseX=t.changedTouches[0].clientX-e.left,this.mouseY=t.changedTouches[0].clientY-e.top,this.mouseX=this.mouseX/this.scaling-this.viewOffsetX/this.scaling,this.mouseY=this.mouseY/this.scaling-this.viewOffsetY/this.scaling,!1};this.startMouse=t=>(this.startInteraction(t.offsetX,t.offsetY),!1);this.endMouse=t=>(this.endInteraction(t.offsetX,t.offsetY),!1);this.handleMouseMovement=t=>{this.mouseX=t.offsetX,this.mouseY=t.offsetY,this.mouseX=this.mouseX/this.scaling-this.viewOffsetX/this.scaling,this.mouseY=this.mouseY/this.scaling-this.viewOffsetY/this.scaling};this.physicsDraw=()=>{let t=this.cnv.getContext("2d");if(t){t.fillStyle=B.green,t.strokeStyle="black";for(let s=0;s<this.physics.balls.length;s+=1){let i=this.physics.balls[s];t.beginPath(),t.arc(i.pos.x,i.pos.y,i.r,0,2*Math.PI),t.stroke(),t.fill(),t.beginPath(),t.moveTo(i.pos.x,i.pos.y),t.lineTo(i.pos.x+i.r*Math.cos(i.rotation),i.pos.y+i.r*Math.sin(i.rotation)),t.stroke()}this.physics.bodies.forEach(s=>{t.beginPath(),t.moveTo(s.points[s.points.length-1].x,s.points[s.points.length-1].y),s.points.forEach(i=>{t.lineTo(i.x,i.y)}),t.stroke(),t.fill(),this.showAxes&&s.axes.forEach(i=>{t.beginPath(),t.moveTo(s.pos.x,s.pos.y),t.lineTo(s.pos.x+i.x*30,s.pos.y+i.y*30),t.stroke()}),t.beginPath(),t.arc(s.pos.x,s.pos.y,1.5,0,Math.PI*2),t.stroke()});let e=s=>{t.beginPath(),t.moveTo(s.points[s.points.length-1].x,s.points[s.points.length-1].y),s.points.forEach(i=>{t.lineTo(i.x,i.y)}),t.fill()};t.fillStyle="white",this.physics.walls.forEach(e),this.physics.bounds.forEach(e),this.physics.fixedBalls.forEach(s=>{t.beginPath(),t.arc(s.x,s.y,s.r,0,Math.PI*2),t.fill()}),t.save(),t.lineWidth=2,this.physics.springs.forEach(s=>{if(s instanceof E&&!(s instanceof F)){let i,a,r,h;s.pinned&&typeof s.pinned=="object"?(i=s.pinned.x,a=s.pinned.y,r=s.objects[0].pos.x,h=s.objects[0].pos.y):(i=s.objects[0].pos.x,a=s.objects[0].pos.y,r=s.objects[1].pos.x,h=s.objects[1].pos.y);let u=new o(r-i,h-a),l=u.copy;u.rotate(Math.PI/2),u.setMag(5);let c=new o(i,a),m=Math.floor(s.length/10);for(let d=1;d<=m;d+=1)t.strokeStyle=B.blue,t.fillStyle=B.blue,d===m&&(u=new o(0,0)),t.beginPath(),t.moveTo(c.x,c.y),t.lineTo(i+d/m*l.x+u.x,a+d/m*l.y+u.y),t.stroke(),c=new o(i+d/m*l.x+u.x,a+d/m*l.y+u.y),u.mult(-1)}else t.strokeStyle=B.blue,t.fillStyle=B.blue,t.beginPath(),t.moveTo(s.objects[0].pos.x,s.objects[0].pos.y),t.lineTo(typeof s.pinned=="object"?s.pinned.x:s.objects[1].pos.x,typeof s.pinned=="object"?s.pinned.y:s.objects[1].pos.y),t.stroke();s.objects.forEach(i=>{t.strokeStyle="black",t.fillStyle=B.blue,t.beginPath(),t.arc(i.pos.x,i.pos.y,2.5,0,Math.PI*2),t.fill(),t.stroke()}),typeof s.pinned=="object"&&(t.strokeStyle="black",t.fillStyle=B.blue,t.beginPath(),t.arc(s.pinned.x,s.pinned.y,3,0,Math.PI*2),t.fill(),t.stroke())}),t.restore(),t.fillStyle=B.pink,t.strokeStyle=B.pink,t.lineWidth=4,this.drawCollisions&&this.physics.collisionData.forEach(s=>{t.beginPath(),t.moveTo(s.cp.x,s.cp.y),t.lineTo(s.cp.x+s.n.x*30,s.cp.y+s.n.y*30),t.stroke(),t.beginPath(),t.arc(s.cp.x,s.cp.y,4,0,Math.PI*2),t.fill()})}};this.spawnNewtonsCradle=(t,e,s,i)=>{let a=[],r=25,h=250,u=8;a.push(new O(new o(t,e),new o(0,0),s*r,1,0,0));let l=1;for(let c=0;c<u-1;c+=1)a.push(new O(new o(t+l*s*r*1.01*2,e),new o(0,0),s*25,1,0,0)),l*=-1,l>0&&(l+=1),c===u-2&&(a[a.length-1].vel.x=-Math.sign(l)*s*r*8);a.forEach(c=>{i.addBall(c);let m=new F(h);m.attachObject(c),m.pinHere(c.pos.x,c.pos.y-h),i.addSpring(m),m.lockRotation()})};this.modeButtonClicked=t=>{let e=t.target.id.replace("-btn",""),s=lt.indexOf(e);this.switchToMode(s)};this.switchToMode=t=>{let e=document.getElementById(`${lt[this.mode]}-btn`);e&&e.classList.remove("bg-pink-darker"),this.sidebar.innerHTML="";let s=document.getElementById(`${lt[t]}-btn`);s&&s.classList.add("bg-pink-darker"),this.mode=t,this.sidebar.appendChild(D[this.mode].element)};this.setupModes=()=>{let t=document.getElementById("button-holder");lt.forEach((e,s)=>{var a,r;let i=document.createElement("div");i.classList.add("big-button"),i.classList.add("fix-width"),i.id=`${e}-btn`,i.textContent=D[s].name,(r=(a=D[s]).init)==null||r.call(a,this),i.onclick=this.modeButtonClicked,t&&t.appendChild(i)}),this.switchToMode(this.mode)};this.setTimeMultiplier=t=>{Number.isFinite(t)&&(this.timeMultiplier=t)};this.getTimeMultiplier=()=>this.timeMultiplier;this.setPhysics=t=>{t instanceof Z&&(this.physics=t)};this.getPhysics=()=>this.physics;this.physics=new Z,this.mouseX=0,this.mouseY=0,this.mouseDown=!1,this.defaultSize=30,this.k=.5,this.fc=2,this.springConstant=2e3,this.scaling=1,this.viewOffsetX=0,this.viewOffsetY=0,this.mode=0,this.lastX=0,this.lastY=0,this.timeMultiplier=1,this.lastFrameTime=performance.now(),this.choosed=!1,this.drawCollisions=!1,this.showAxes=!1,this.left=!1,this.right=!1,this.cnv=document.getElementById("defaulCanvas0"),this.canvasHolder=document.getElementById("canvas-holder"),this.sidebar=document.getElementById("sidebar"),this.physics.setBounds(0,0,this.cnv.width,this.cnv.height),this.physics.setGravity(new o(0,1e3)),this.physics.setAirFriction(.9),this.cnv.addEventListener("touchstart",this.startTouch,!1),this.cnv.addEventListener("touchend",this.endTouch,!1),this.cnv.addEventListener("touchmove",this.moveTouch,!1),this.cnv.addEventListener("mousedown",this.startMouse,!1),this.cnv.addEventListener("mouseup",this.endMouse,!1),this.cnv.addEventListener("mousemove",this.handleMouseMovement,!1),document.addEventListener("keydown",this.keyGotDown,!1),document.addEventListener("keyup",this.keyGotUp,!1),window.addEventListener("resize",this.resizeCanvas,!1),this.cnv.addEventListener("mousedown",()=>{this.mouseDown=!0},!1),this.cnv.addEventListener("mouseup",()=>{this.mouseDown=!1},!1),this.resizeCanvas(),this.setupModes(),ft(this),requestAnimationFrame(this.drawFunction)}},Ce=we;window.onload=()=>{window.editorApp=new Ce};})();
//# sourceMappingURL=main.js.map

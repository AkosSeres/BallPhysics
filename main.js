(()=>{var xs=Object.create,Wt=Object.defineProperty,bs=Object.getPrototypeOf,vs=Object.prototype.hasOwnProperty,ws=Object.getOwnPropertyNames,Ms=Object.getOwnPropertyDescriptor,Ps=i=>Wt(i,"__esModule",{value:!0}),U=(i,t)=>()=>(t||(t={exports:{}},i(t.exports,t)),t.exports),Is=(i,t,e)=>{if(Ps(i),t&&typeof t=="object"||typeof t=="function")for(let s of ws(t))!vs.call(i,s)&&s!=="default"&&Wt(i,s,{get:()=>t[s],enumerable:!(e=Ms(t,s))||e.enumerable});return i},_=i=>i&&i.__esModule?i:Is(Wt(i!=null?xs(bs(i)):{},"default",{value:i,enumerable:!0}),i),$=U((Ls,xe)=>{var Y=class{constructor(t,e){this.x=t,this.y=e}get copy(){return new Y(this.x,this.y)}get length(){return Math.sqrt(this.x*this.x+this.y*this.y)}get sqlength(){return this.x*this.x+this.y*this.y}get heading(){if(this.x===0&&this.y===0)return 0;if(this.x===0)return this.y>0?Math.PI/2:1.5*Math.PI;if(this.y===0)return this.x>0?0:Math.PI;let t=Y.normalized(this);return this.x>0&&this.y>0?Math.asin(t.y):this.x<0&&this.y>0?Math.asin(-t.x)+Math.PI/2:this.x<0&&this.y<0?Math.asin(-t.y)+Math.PI:this.x>0&&this.y<0?Math.asin(t.x)+1.5*Math.PI:0}add(t){this.x+=t.x,this.y+=t.y}sub(t){this.x-=t.x,this.y-=t.y}mult(t){this.x*=t,this.y*=t}div(t){this.x/=t,this.y/=t}lerp(t,e){this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e}dist(t){return new Y(this.x-t.x,this.y-t.y).length}setMag(t){if(this.length===0)return;this.mult(t/this.length)}rotate(t){let e=this.heading,s=Y.fromAngle(t+e);s.mult(this.length),this.x=s.x,this.y=s.y}static add(t,e){return new Y(t.x+e.x,t.y+e.y)}static sub(t,e){return new Y(t.x-e.x,t.y-e.y)}static mult(t,e){return new Y(t.x*e,t.y*e)}static div(t,e){return new Y(t.x/e,t.y/e)}static fromAngle(t){return new Y(Math.cos(t),Math.sin(t))}static lerp(t,e,s){return Y.add(t,Y.mult(Y.sub(e,t),s))}static dist(t,e){return Y.sub(t,e).length}static dot(t,e){return t.x*e.x+t.y*e.y}static cross(t,e){return t.x*e.y-t.y*e.x}static crossScalarFirst(t,e){return new Y(-e.y*t,e.x*t)}static crossScalarSecond(t,e){return new Y(t.y*e,-t.x*e)}static angle(t,e){return Math.acos(Math.min(Math.max(Y.dot(t,e)/Math.sqrt(t.sqlength*e.sqlength),1),-1))}static angleACW(t,e){let s=t.heading,n=e.heading,a=n-s;return a<0?2*Math.PI+a:a}static normalized(t){let e=t.length;return e===0?t:new Y(t.x/e,t.y/e)}toJSObject(){let t={};return t.x=this.x,t.y=this.y,t}static fromObject(t){return new Y(t.x,t.y)}};xe.exports=Y}),pt=U((qs,be)=>{var I=$(),gt=class{constructor(t,e,s,n,a,o){this.pos=t.copy,this.lastPos=this.pos.copy,this.r=s,this.fc=.4,this.amc=2/5,this.rotation=0,a?this.ang=a:this.ang=0,(o||o===0)&&(this.fc=o),n?this.k=n:this.k=.8,e!==void 0?this.vel=e.copy:this.vel=new I(0,0),this.id=`_${Math.random().toString(36).substr(2,9)}`}get m(){return this.r*this.r*Math.PI}get am(){return this.amc*this.r*this.r*this.m}getAmInPoint(t){let e=this.am;return e+=I.sub(this.pos,t).sqlength*this.m,e}get copy(){let t=new gt(this.pos.copy,this.vel.copy,this.r,this.k,this.ang,this.fc);return t.lastPos=this.lastPos.copy,t.rotation=this.rotation,t}move(t,e){this.pos.x+=t,this.pos.y+=e}rotate(t){this.rotation+=t}collided(t){return this.pos.dist(t.pos)<this.r+t.r}static collide(t,e){if(!t.collided(e))return;let s=I.dist(t.pos,e.pos),n=t.m,a=e.m,o=t.pos.copy,h=e.pos.copy,u=t,r=e,l=t.r+e.r-s,d=I.sub(t.pos,e.pos);if(d.setMag(1),d.mult(l*a/(n+a)),o.add(d),d.setMag(1),d.mult(-l*n/(n+a)),h.add(d),u.pos=o,r.pos=h,I.dot(d,I.sub(t.vel,e.vel))<0)return;d.setMag(1);let g=I.add(t.pos,I.mult(d,t.r)),f=t.vel.copy,m=e.vel.copy,p=t.ang,M=e.ang,b=I.sub(g,t.pos),P=I.sub(g,e.pos),y=t.am,x=e.am,C=(t.k+e.k)/2,w=(t.fc+e.fc)/2,k=d.copy,T=t.velInPlace(g),R=e.velInPlace(g),E=I.sub(R,T),L=1/n+1/a;L=-(1+C)*I.dot(E,k)/L;let B=I.sub(f,I.mult(k,L/n)),H=I.add(m,I.mult(k,L/a)),J=p-L*I.cross(b,k)/y,ht=M,W=E.copy;W.sub(I.mult(k,I.dot(E,k))),W.setMag(1);let K=1/n+1/a;K+=I.dot(I.crossScalarFirst(I.cross(b,W)/y,b),W),K+=I.dot(I.crossScalarFirst(I.cross(P,W)/x,P),W),K=-(.5*I.dot(E,W))/K;let Q=L*w;Q>K&&(Q=K),B=I.sub(B,I.mult(W,Q/n)),H=I.add(H,I.mult(W,Q/a)),J-=Q*I.cross(b,W)/y,ht+=Q*I.cross(P,W)/x,u.vel=B,r.vel=H,u.ang=J,r.ang=ht}containsPoint(t){return I.dist(this.pos,t)<=this.r}velInPlace(t){let e=I.sub(t,this.pos);return e.rotate(Math.PI/2),e.mult(this.ang),e.add(this.vel),e}effectiveMass(t,e){let s=I.sub(t,this.pos);if(s.length===0)return this.m;let n=I.angle(e,s),a=Math.sin(n)**2*s.length**2/this.am;return 1/(a+1/this.m)}applyDeltaVelInPoint(t,e){let s=I.sub(e,this.pos);if(s.length===0){this.vel.add(t);return}let n=I.angle(s,t),a=I.mult(s,I.dot(t,s)/s.length**2);this.vel.add(a);let o=s.copy;o.rotate(Math.PI/2),o.setMag(1);let h=Math.sign(I.dot(t,o)),u=t.length*Math.cos(n),r=1/(1/this.m+s.length**2/this.am),l=u*r/this.m;this.vel.add(I.mult(o,l*h));let d=h*u*r*s.length/this.am;this.ang-=d}toJSObject(){let t={};return t.pos=this.pos.toJSObject(),t.lastPos=this.lastPos.toJSObject(),t.r=this.r,t.fc=this.fc,t.amc=this.amc,t.rotation=this.rotation,t.ang=this.ang,t.fc=this.fc,t.k=this.k,t.vel=this.vel.toJSObject(),t.id=this.id,this.layer!==void 0&&(t.layer=this.layer),t}static fromObject(t){let e=new gt(I.fromObject(t.pos),I.fromObject(t.vel),t.r,t.k,t.ang,t.fc);return e.lastPos=I.fromObject(t.lastPos),e.amc=t.amc,e.rotation=t.rotation,e.vel=I.fromObject(t.vel),e.id=t.id,t.layer!==void 0&&(e.layer=t.layer),e}};be.exports=gt}),lt=U((Ns,ve)=>{var z=$(),we=class{constructor(t,e){this.a=t,this.b=e}get length(){return z.dist(this.a,this.b)}distFromPoint(t){let e=z.sub(this.a,this.b),s=z.sub(t,this.b),n=z.sub(t,this.a),a=s.length,o=n.length,h=e.length;if(h===0)return a;let u=z.angle(s,n),r=z.angle(s,e),l=Math.PI-u-r,d=Math.sin(l)*o*h/2,g=2*d/h;return l>Math.PI/2?o:r>Math.PI/2?a:g}static intersect(t,e){let s=z.sub(t.b,t.a),n=s.y/s.x,a=t.b.y-t.b.x*n,o=z.sub(e.b,e.a),h=o.y/o.x,u=e.b.y-e.b.x*h;if(s.x===0&&o.x!==0){if(t.a.x>=e.a.x&&t.a.x<=e.b.x||t.a.x<=e.a.x&&t.a.x>=e.b.x){let f=h*t.a.x+u;if(f>t.a.y&&f<t.b.y||f<t.a.y&&f>t.b.y)return new z(t.a.x,f)}return}if(o.x===0&&s.x!==0){if(e.a.x>=t.a.x&&e.a.x<=t.b.x||e.a.x<=t.a.x&&e.a.x>=t.b.x){let f=n*e.a.x+a;if(f>e.a.y&&f<e.b.y||f<e.a.y&&f>e.b.y)return new z(e.a.x,f)}return}if(s.x===0&&o.x===0){if(t.a.x===e.a.x){let f;t.a.y<t.b.y?f=[t.a.y,t.b.y]:f=[t.b.y,t.a.y];let m;e.a.y<e.b.y?m=[e.a.y,e.b.y]:m=[e.b.y,e.a.y];let p=[f[0]>m[0]?f[0]:m[0],f[1]<m[1]?f[1]:m[1]];if(p[0]<=p[1])return new z(t.a.x,(p[0]+p[1])/2)}return}let r;t.a.x<t.b.x?r=[t.a.x,t.b.x]:r=[t.b.x,t.a.x];let l;e.a.x<e.b.x?l=[e.a.x,e.b.x]:l=[e.b.x,e.a.x];let d=[r[0]>l[0]?r[0]:l[0],r[1]<l[1]?r[1]:l[1]];if(n===h&&a===u&&d[0]<=d[1])return new z((d[0]+d[1])/2,(d[0]+d[1])/2*n+a);let g=(u-a)/(n-h);return g>=d[0]&&g<=d[1]?new z(g,g*n+a):void 0}};ve.exports=we}),Pe=U((Rs,Me)=>{var X=$(),Jt=lt(),St=class{constructor(t){this.points=t;let e=this.points,s=0,n=0,a=X.angleACW(X.sub(e[1],e[0]),X.sub(e[e.length-1],e[0]));this.calculateCenterAndRadius(),s+=a,n+=Math.PI*2-a;for(let o=1;o<e.length-1;o++)a=X.angleACW(X.sub(e[(o+1)%e.length],e[o]),X.sub(e[o-1],e[o])),s+=a,n+=Math.PI*2-a;if(a=X.angleACW(X.sub(e[0],e[e.length-1]),X.sub(e[e.length-2],e[e.length-1])),s+=a,n+=Math.PI*2-a,n>s)return;{let o=[];for(let h=e.length-1;h>=0;h--)o.push(e[h]);this.points=o}}collideWithBall(t){let e,s;if(this.points.forEach((n,a)=>{let o=new X(n.x,n.y);o.x-=t.pos.x,o.y-=t.pos.y,o.mult(-1),o.length<=t.r&&(e=o.heading,s=o.length),o=new X(n.x,n.y);let h=new X(this.points[(a+1)%this.points.length].x,this.points[(a+1)%this.points.length].y),u=new X(t.pos.x,t.pos.y),r=new X(h.x-o.x,h.y-o.y),l=r.heading;o.rotate(-l+Math.PI),h.rotate(-l+Math.PI),u.rotate(-l+Math.PI);let d=u.y-(o.y+h.y)/2;d>=-t.r&&d<=t.r&&u.x>=h.x&&u.x<=o.x&&(e=l-Math.PI/2,s=d)}),isFinite(e)){let n=new X(t.pos.x,t.pos.y),a=new X(t.vel.x,t.vel.y);if(n.rotate(-e+Math.PI/2),a.rotate(-e+Math.PI/2),a.y>0)return;a.y*=-t.k,n.y+=t.r-s;let o=a.y*(1+t.k),h=Math.sign(a.x+t.ang*t.r)*(o*t.fc)/(t.amc*t.r),u=(a.x+t.ang*t.r)/t.r;h/u>1&&(h=u),t.ang-=h;let r=h*t.am/t.r/t.m;a.x-=r,n.rotate(e-Math.PI/2),a.rotate(e-Math.PI/2),t.pos.x=n.x,t.pos.y=n.y,t.vel.x=a.x,t.vel.y=a.y}}containsPoint(t){let e=this.sides,s=Math.max(...this.points.map(h=>X.dist(h,t)))+1,n=X.fromAngle(0);n.setMag(s);let a=new Jt(t,X.add(n,t)),o=e.filter(h=>Jt.intersect(h,a)!=null);return o.length%2==1}calculateCenterAndRadius(){this.center=this.points.reduce((t,e)=>X.add(t,e)),this.center.div(this.points.length),this.boundRadius=Math.max(this.points.map(t=>X.dist(t,this.center)))}get sides(){return this.points.map((t,e)=>new Jt(t,this.points[(e+1)%this.points.length]))}toJSObject(){let t={};return t.points=this.points.map(e=>({x:e.x,y:e.y})),t}static fromObject(t){let e=new St(t.points.map(s=>new X(v.x,v.y)));return e}};Me.exports=St}),Ct=U((Ds,Ie)=>{var A=$(),ks=yt(),dt=class{constructor(t,e){this.length=t,this.springConstant=e,this.pinned=!1,this.objects=[],this.rotationLocked=!1,this.id=`_${Math.random().toString(36).substr(2,9)}`}pinHere(t,e){this.pinned={x:t,y:e}}unpin(){this.pinned=!1}attachObject(t){let e=this.objects;e.push(t),e.length===2&&(this.pinned=!1),e.length>=3&&(e=[e[e.length-2],e[e.length-1]])}lockRotation(){this.rotationLocked=!0}unlockRotation(){this.rotationLocked=!1}update(t){let e,s;if(this.pinned&&this.objects[0]){[s,e]=[this.pinned,this.objects[0]];let n=new A(s.x-e.pos.x,s.y-e.pos.y),a=n.length-this.length;n.setMag(1),n.mult(a*this.springConstant*t/e.m),e.vel.x+=n.x,e.vel.y+=n.y;let o=e.vel;if(o.rotate(-n.heading),this.rotationLocked){let h=new A(s.x,s.y),u=A.sub(e.pos,h),r=u.length*u.length*e.m+e.am,l=(e.am*e.ang-u.length*e.m*o.y)/r;o.y=-l*u.length,e.ang=l}o.rotate(n.heading)}else if(this.objects[0]&&this.objects[1]){[e,s]=[this.objects[0],this.objects[1]];let n=A.sub(e.pos,s.pos),a=n.length-this.length;n.setMag(1),n.mult(a*this.springConstant*t),s.vel.add(A.div(n,s.m)),e.vel.add(A.div(n,-e.m)),n=A.sub(e.pos,s.pos);let o=e.vel,h=s.vel;if(o.rotate(-n.heading),h.rotate(-n.heading),this.rotationLocked){let u=new A(e.pos.x*e.m+s.pos.x*s.m,e.pos.y*e.m+s.pos.y*s.m);u.div(e.m+s.m);let r=A.sub(e.pos,u),l=A.sub(s.pos,u),d=r.length*r.length*e.m+e.am+l.length*l.length*s.m+s.am,g=(o.y-h.y)*l.length/(r.length+l.length)+h.y,f=(e.am*e.ang+s.am*s.ang+r.length*e.m*(o.y-g)-l.length*s.m*(h.y-g))/d;o.y=f*r.length+g,h.y=-f*l.length+g,e.ang=f,s.ang=f}o.rotate(n.heading),h.rotate(n.heading)}}toJSObject(){let t={};return t.length=this.length,t.springConstant=this.springConstant,t.pinned=this.pinned,t.rotationLocked=this.rotationLocked,t.id=this.id,t.objects=this.objects.map(e=>e.id),t.type=this instanceof dt?"spring":"stick",t}static fromObject(t,e){let s=dt.createStickOrSpring(t.type,t.length,t.springConstant);return s.pinned=t.pinned,s.rotationLocked=t.rotationLocked,s.id=t.id,s.objects=t.objects.map(n=>{let a=e.filter(o=>n===o.id);return a[0]}),s}static createStickOrSpring(t,e,s){let n;return t==="spring"?n=new dt(e,s):t==="stick"&&(n=new ks(e)),n}};Ie.exports=dt}),yt=U((Hs,ke)=>{var it=$(),Ss=Ct(),Se=class extends Ss{constructor(t){super(t,0);this.springConstant=0}update(){let t,e;if(this.pinned&&this.objects[0]){[e,t]=[this.pinned,this.objects[0]];let s=new it(e.x-t.pos.x,e.y-t.pos.y);s.setMag(1),s.mult(-this.length),t.move(-t.pos.x+e.x+s.x,-t.pos.y+e.y+s.y);let n=t.vel;if(n.rotate(-s.heading),n.x=0,this.rotationLocked){let a=new it(e.x,e.y),o=it.sub(t.pos,a),h=o.length*o.length*t.m+t.am,u=(t.am*t.ang+o.length*t.m*n.y)/h;n.y=u*o.length,t.ang=u}n.rotate(s.heading)}else if(this.objects[0]&&this.objects[1]){[t,e]=[this.objects[0],this.objects[1]];let s=it.sub(t.pos,e.pos),n=this.length-s.length;s.setMag(1);let a=it.mult(s,n*e.m/(t.m+e.m)),o=it.mult(s,-n*t.m/(t.m+e.m));t.move(a.x,a.y),e.move(o.x,o.y);let h=t.vel,u=e.vel;if(h.rotate(-s.heading),u.rotate(-s.heading),h.x=(t.m*h.x+e.m*u.x)/(t.m+e.m),u.x=h.x,this.rotationLocked){let r=new it(t.pos.x*t.m+e.pos.x*e.m,t.pos.y*t.m+e.pos.y*e.m);r.div(t.m+e.m);let l=it.sub(t.pos,r),d=it.sub(e.pos,r),g=l.length*l.length*t.m+t.am+d.length*d.length*e.m+e.am,f=(h.y-u.y)*d.length/(l.length+d.length)+u.y,m=(t.am*t.ang+e.am*e.ang+l.length*t.m*(h.y-f)-d.length*e.m*(u.y-f))/g;h.y=m*l.length+f,u.y=-m*d.length+f,t.ang=m,e.ang=m}h.rotate(s.heading),u.rotate(s.heading)}}};ke.exports=Se}),Ee=U((Ws,Ce)=>{var S=$(),Cs=pt(),Es=yt(),tt=lt(),Et=class{constructor(t,e,s,n,a){this.points=[],n||n===0?this.fc=n:this.fc=.4,this.pressure=s,a?this.resolution=a:this.resolution=30,e=Math.abs(e),this.r=e;let o=Math.random()*1e6;for(let h=0;h<this.resolution;h++){let u=new S(t.x,t.y);u.add(S.mult(S.fromAngle(h/this.resolution*Math.PI*2),e)),this.points.push(new Cs(u,new S(0,0),e*Math.sin(Math.PI/this.resolution),0,0,this.fc)),this.points[this.points.length-1].layer=o}this.sides=[];for(let h=0;h<this.resolution;h++){let u=new Es(2*e*Math.sin(Math.PI/this.resolution));u.attachObject(this.points[h]),u.attachObject(this.points[(h+1)%this.resolution]),h%2===0&&u.lockRotation(),this.sides.push(u)}}static updatePressureBasedForces(t,e){let s=[];if(s.push([]),t.points.forEach(o=>{s[0].push(new S(o.pos.x,o.pos.y))}),function(o){let h=S.angleACW(S.sub(o[1],o[0]),S.sub(o[o.length-1],o[0]));if(h>Math.PI)return!0;for(let u=1;u<o.length-1;u++)if(h=S.angleACW(S.sub(o[(u+1)%o.length],o[u]),S.sub(o[u-1],o[u])),h>Math.PI)return!0;return h=S.angleACW(S.sub(o[0],o[o.length-1]),S.sub(o[o.length-2],o[o.length-1])),h>Math.PI}(s[0])){let o=(r,l)=>{for(let d=0;d<r.length;d++)if(r[d]===l)return!0;return!1},h=function(r,l,d){for(let g=0;g<l.length;g++)if(!o(d,g)){let f=new tt(new S(l[g].x,l[g].y),new S(l[(g+1)%l.length].x,l[(g+1)%l.length].y));if(tt.intersect(r,f))return!0}return!1},u=!0;t:for(;u;){u=!1;for(let r=0;r<s.length;r++){let l=s[r],d=S.sub(l[1],l[0]),g=S.sub(l[l.length-1],l[0]),f=S.angleACW(d,g);if(f>Math.PI){u=!0;let m=0,p=m+2,M=new tt(new S(l[m].x,l[m].y),new S(l[p%l.length].x,l[p%l.length].y)),b=new S(M.b.x-M.a.x,M.b.y-M.a.y).heading;for(;!(d.heading>g.heading?b>d.heading&&b<2*Math.PI||b>0&&b<g.heading:b>d.heading&&b<g.heading)||h(new tt(new S(l[m%l.length].x,l[m%l.length].y),new S(l[p%l.length].x,l[p%l.length].y)),l,[(l.length-1)%l.length,m%l.length,(p-1)%l.length,p%l.length]);)p++,M=new tt(new S(l[m].x,l[m].y),new S(l[p%l.length].x,l[p%l.length].y)),b=new S(M.b.x-M.a.x,M.b.y-M.a.y).heading;let P=[],y=[];for(let x=m;x<=p;x++)P.push(l[x%l.length]);for(let x=p;x<=m+l.length;x++)y.push(l[x%l.length]);s[r]=P,s.push(y);continue t}for(let m=1;m<l.length;m++){let p=S.sub(l[(m+1)%l.length],l[m]),M=S.sub(l[m-1],l[m]),b=S.angleACW(p,M);if(b>Math.PI){u=!0;let P=m+2,y=new tt(new S(l[m].x,l[m].y),new S(l[P%l.length].x,l[P%l.length].y)),x=new S(y.b.x-y.a.x,y.b.y-y.a.y).heading;for(;!(p.heading>M.heading?x>p.heading&&x<2*Math.PI||x>0&&x<M.heading:x>p.heading&&x<M.heading)||h(y,l,[(m-1)%l.length,m%l.length,(P-1)%l.length,P%l.length]);)P++,y=new tt(new S(l[m].x,l[m].y),new S(l[P%l.length].x,l[P%l.length].y)),x=new S(y.b.x-y.a.x,y.b.y-y.a.y).heading;let C=[],w=[];for(let k=m;k<=P;k++)C.push(l[k%l.length]);for(let k=P;k<=m+l.length;k++)w.push(l[k%l.length]);s[r]=C,s.push(w);continue t}}}}}for(let o=s.length-1;o>=0;o--){let h=s[o];for(;h.length>3;)s.push([h[0],h[1],h[2]]),h.splice(1,1)}let n=0;s.forEach(o=>{let h=Math.sqrt(Math.pow(o[0].x-o[1].x,2)+Math.pow(o[0].y-o[1].y,2)),u=Math.sqrt(Math.pow(o[1].x-o[2].x,2)+Math.pow(o[1].y-o[2].y,2)),r=Math.sqrt(Math.pow(o[2].x-o[0].x,2)+Math.pow(o[2].y-o[0].y,2)),l=(h+u+r)/2,d=Math.sqrt(l*(l-h)*(l-u)*(l-r));n+=d});let a=t.pressure*(t.r*t.r*Math.PI/n)-t.pressure;t.sides.forEach(o=>{let h=S.sub(o.objects[0].pos,o.objects[1].pos);h.mult(a),h.rotate(Math.PI/2),h.mult(e),o.objects[0].vel.add(S.div(h,o.objects[0].m)),o.objects[1].vel.add(S.div(h,o.objects[1].m))})}get sideSegments(){return this.points.map((t,e)=>new tt(t.pos,this.points[(e+1)%this.points.length].pos))}containsPoint(t){let e=this.sideSegments,s=Math.max(...this.points.map(h=>S.dist(h.pos,t)))+1,n=S.fromAngle(0);n.setMag(s);let a=new tt(t,S.add(n,t)),o=e.filter(h=>tt.intersect(h,a)!=null);return o.length%2==1}toJSObject(){let t={};return t.pressure=this.pressure,t.fc=this.fc,t.r=this.r,t.resolution=this.resolution,t.points=this.points.map(e=>e.id),t.sides=this.sides.map(e=>e.id),t}static fromObject(t,e,s){let n=Object.create(Et.prototype);return console.log(n),n.pressure=t.pressure,n.fc=t.fc,n.resolution=t.resolution,n.r=t.r,n.points=t.points.map(a=>{let o=e.filter(h=>a==h.id);return o[0]}),n.sides=t.sides.map(a=>{let o=s.filter(h=>a==h.id);return o[0]}),n}};Ce.exports=Et}),Oe=U((Gs,Fe)=>{var c=$(),N=lt(),Js=pt(),xt=class{constructor(t,e,s,n,a){this.points=t,this.pos=new c(t[0].x,t[0].y);let o=this.points,h=0,u=0,r=c.angleACW(c.sub(o[1],o[0]),c.sub(o[o.length-1],o[0]));h+=r,u+=Math.PI*2-r;for(let l=1;l<o.length-1;l+=1)r=c.angleACW(c.sub(o[(l+1)%o.length],o[l]),c.sub(o[l-1],o[l])),h+=r,u+=Math.PI*2-r;if(r=c.angleACW(c.sub(o[0],o[o.length-1]),c.sub(o[o.length-2],o[o.length-1])),h+=r,u+=Math.PI*2-r,u<h){let l=[];for(let d=o.length-1;d>=0;d--)l.push(o[d]);this.points=l}this.calculatePosAndMass(),this.lastPos=this.pos.copy,this.fc=.4,this.rotation=0,n?this.ang=n:this.ang=0,(a||a===0)&&(this.fc=a),s?this.k=s:this.k=.8,e!=null?this.vel=e.copy:this.vel=new c(0,0),this.id=`_${Math.random().toString(36).substr(2,9)}`}getAmInPoint(t){let e=this.am;return e+=c.sub(this.pos,t).sqlength*this.m,e}get copy(){let t=[];for(let s=0;s<this.points.length;s++)t.push(new c(this.points[s].x,this.points[s].y));let e=new xt(t,this.vel.copy,this.k,this.ang,this.fc);return e.rotation=this.rotation,e.lastPos=this.lastPos.copy,e.pos=this.pos.copy,e}move(t,e){this.pos.x+=t,this.pos.y+=e,this.points.forEach(s=>{s.x+=t,s.y+=e})}collideWithBall(t){let e,s,n;if(c.dist(t.pos,this.pos)>t.r+this.boundRadius)return;if(this.points.forEach((a,o)=>{let h=new c(a.x,a.y);if(h.x-=t.pos.x,h.y-=t.pos.y,h.length<=t.r){e=h.heading+Math.PI,s=h.length;let f=c.fromAngle(e);f.mult(t.r-s),this.move(f.x*-1*t.m/(this.m+t.m),f.y*-1*t.m/(this.m+t.m)),t.move(f.x*1*this.m/(this.m+t.m),f.y*1*this.m/(this.m+t.m)),n=new c(a.x,a.y);let m=c.fromAngle(e);m.mult(-30)}h=new c(a.x,a.y);let u=new c(this.points[(o+1)%this.points.length].x,this.points[(o+1)%this.points.length].y),r=new c(t.pos.x,t.pos.y),l=new c(u.x-h.x,u.y-h.y),d=l.heading;h.rotate(-d+Math.PI),u.rotate(-d+Math.PI),r.rotate(-d+Math.PI);let g=r.y-(h.y+u.y)/2;if(g>=-t.r&&g<=t.r&&r.x>=u.x&&r.x<=h.x){e=d-Math.PI/2,s=g;let f=c.fromAngle(e);f.mult(t.r-s),this.move(f.x*-1*t.m/(this.m+t.m),f.y*-1*t.m/(this.m+t.m)),t.move(f.x*1*this.m/(this.m+t.m),f.y*1*this.m/(this.m+t.m)),n=t.pos.copy,n.add(c.mult(c.fromAngle(e+Math.PI),g));let m=c.fromAngle(e);m.mult(-30)}}),e===0||e){let a=this.vel.copy,o=t.vel.copy,h=this.ang,u=t.ang,r=c.sub(n,this.pos),l=c.sub(n,t.pos),d=this.am,g=t.am,f=this.m,m=t.m,p=(this.k+t.k)/2,M=(this.fc+t.fc)/2,b=l.copy;b.setMag(-1);let P=this.velInPlace(n),y=t.velInPlace(n),x=c.sub(y,P),C=1/f+1/m;C+=c.dot(c.crossScalarFirst(c.cross(r,b)/d,r),b),C=-(1+p)*c.dot(x,b)/C;let w=c.sub(a,c.mult(b,C/f)),k=c.add(o,c.mult(b,C/m)),T=h-C*c.cross(r,b)/d,R=u,E=x.copy;E.sub(c.mult(b,c.dot(x,b))),E.setMag(1);let L=1/f+1/m;L+=c.dot(c.crossScalarFirst(c.cross(r,E)/d,r),E),L+=c.dot(c.crossScalarFirst(c.cross(l,E)/g,l),E),L=-c.dot(x,E)/L;let B=C*M;B>L&&(B=L),w=c.sub(w,c.mult(E,B/f)),k=c.add(k,c.mult(E,B/m)),T-=B*c.cross(r,E)/d,R+=B*c.cross(l,E)/g,this.vel=w,t.vel=k,this.ang=T,t.ang=R}}calculatePosAndMass(){let t=[];if(t.push([]),this.points.forEach(a=>{t[0].push(new c(a.x,a.y))}),this.isConcave){let a=(u,r)=>{for(let l=0;l<u.length;l++)if(u[l]===r)return!0;return!1},o=function(u,r,l){for(let d=0;d<r.length;d++)if(!a(l,d)){let g=new N(new c(r[d].x,r[d].y),new c(r[(d+1)%r.length].x,r[(d+1)%r.length].y));if(N.intersect(u,g))return!0}return!1},h=!0;t:for(;h;){h=!1;for(let u=0;u<t.length;u++){let r=t[u],l=c.sub(r[1],r[0]),d=c.sub(r[r.length-1],r[0]),g=c.angleACW(l,d);if(g>Math.PI){h=!0;let f=0,m=f+2,p=new N(new c(r[f].x,r[f].y),new c(r[m%r.length].x,r[m%r.length].y)),M=new c(p.b.x-p.a.x,p.b.y-p.a.y).heading;for(;!(l.heading>d.heading?M>l.heading&&M<2*Math.PI||M>0&&M<d.heading:M>l.heading&&M<d.heading)||o(new N(new c(r[f%r.length].x,r[f%r.length].y),new c(r[m%r.length].x,r[m%r.length].y)),r,[(r.length-1)%r.length,f%r.length,(m-1)%r.length,m%r.length]);)m++,p=new N(new c(r[f].x,r[f].y),new c(r[m%r.length].x,r[m%r.length].y)),M=new c(p.b.x-p.a.x,p.b.y-p.a.y).heading;let b=[],P=[];for(let y=f;y<=m;y++)b.push(r[y%r.length]);for(let y=m;y<=f+r.length;y++)P.push(r[y%r.length]);t[u]=b,t.push(P);continue t}for(let f=1;f<r.length;f++){let m=c.sub(r[(f+1)%r.length],r[f]),p=c.sub(r[f-1],r[f]),M=c.angleACW(m,p);if(M>Math.PI){h=!0;let b=f+2,P=new N(new c(r[f].x,r[f].y),new c(r[b%r.length].x,r[b%r.length].y)),y=new c(P.b.x-P.a.x,P.b.y-P.a.y).heading;for(;!(m.heading>p.heading?y>m.heading&&y<2*Math.PI||y>0&&y<p.heading:y>m.heading&&y<p.heading)||o(P,r,[(f-1)%r.length,f%r.length,(b-1)%r.length,b%r.length]);)b++,P=new N(new c(r[f].x,r[f].y),new c(r[b%r.length].x,r[b%r.length].y)),y=new c(P.b.x-P.a.x,P.b.y-P.a.y).heading;let x=[],C=[];for(let w=f;w<=b;w++)x.push(r[w%r.length]);for(let w=b;w<=f+r.length;w++)C.push(r[w%r.length]);t[u]=x,t.push(C);continue t}}}}}for(let a=t.length-1;a>=0;a--){let o=t[a];for(;o.length>3;)t.push([o[0],o[1],o[2]]),o.splice(1,1)}let e=0,s=0,n=new c(0,0);t.forEach(a=>{let o=Math.sqrt(Math.pow(a[0].x-a[1].x,2)+Math.pow(a[0].y-a[1].y,2)),h=Math.sqrt(Math.pow(a[1].x-a[2].x,2)+Math.pow(a[1].y-a[2].y,2)),u=Math.sqrt(Math.pow(a[2].x-a[0].x,2)+Math.pow(a[2].y-a[0].y,2)),r=(o+h+u)/2,l=Math.sqrt(r*(r-o)*(r-h)*(r-u));e+=l,n.x+=l*(a[0].x+a[1].x+a[2].x)/3,n.y+=l*(a[0].y+a[1].y+a[2].y)/3}),n.div(e),this.pos=n,this.m=e;for(let a of t){let o=Math.sqrt(Math.pow(a[0].x-a[1].x,2)+Math.pow(a[0].y-a[1].y,2)),h=Math.sqrt(Math.pow(a[1].x-a[2].x,2)+Math.pow(a[1].y-a[2].y,2)),u=Math.sqrt(Math.pow(a[2].x-a[0].x,2)+Math.pow(a[2].y-a[0].y,2)),r=Math.max(o,h,u),l=(o+h+u)/2,d=Math.sqrt(l*(l-o)*(l-h)*(l-u)),g=2*d/r,f=Math.sqrt(Math.min(o,u,h)**2-g*g),m=g*r*(g*g+r*r)/24,p=Math.sqrt(g*g/36+(Math.abs(f-r/2)/3)**2);m-=p*p*d,m+=new c((a[0].x+a[1].x+a[2].x)/3,(a[0].y+a[1].y+a[2].y)/3).dist(this.pos)**2*d,s+=m}this.am=s,this.boundRadius=Math.max(...this.points.map(a=>c.dist(a,this.pos)))}rotate(t){this.points.forEach(e=>{let s=new c(e.x,e.y);s.sub(this.pos),s.rotate(t),s.add(this.pos),e.x=s.x,e.y=s.y}),this.rotation+=t}get isConcave(){let t=this.points,e=c.angleACW(c.sub(t[1],t[0]),c.sub(t[t.length-1],t[0]));if(e>Math.PI)return!0;for(let s=1;s<t.length-1;s++)if(e=c.angleACW(c.sub(t[(s+1)%t.length],t[s]),c.sub(t[s-1],t[s])),e>Math.PI)return!0;return e=c.angleACW(c.sub(t[0],t[t.length-1]),c.sub(t[t.length-2],t[t.length-1])),e>Math.PI}static collide(t,e){let s=0,n=0,a=new c(0,0),o=[],h=!1;if(t.points.forEach((w,k)=>{let T=new N(new c(w.x,w.y),new c(t.points[(k+1)%t.points.length].x,t.points[(k+1)%t.points.length].y));e.points.forEach((R,E)=>{let L=new N(new c(R.x,R.y),new c(e.points[(E+1)%e.points.length].x,e.points[(E+1)%e.points.length].y)),B=N.intersect(T,L);B&&(s++,a.add(B),o.push(B),h=!0)})}),!h)return;a.div(s);for(let w=0;w<Math.floor(s/2);w++)n+=c.sub(o[2*w+1],o[2*w]).heading;n/=s/2,n+=Math.PI/2;let u=c.fromAngle(n),r=t.ang,l=t.vel.copy,d=e.ang,g=e.vel.copy,f=0,m=0,p=0,M=0;for(let w of t.points)f=Math.min(c.dot(u,c.sub(new c(w.x,w.y),a)),f),m=Math.max(c.dot(u,c.sub(new c(w.x,w.y),a)),m);for(let w of e.points)p=Math.min(c.dot(u,c.sub(new c(w.x,w.y),a)),p),M=Math.max(c.dot(u,c.sub(new c(w.x,w.y),a)),M);Math.abs(f-M)<Math.abs(p-m)?(t.move(-u.x*f,-u.y*f),e.move(-u.x*M,-u.y*M)):(t.move(-u.x*m,-u.y*m),e.move(-u.x*p,-u.y*p));let b=o,P=[],y=[],x=[],C=[];for(let w of b){let k=c.fromAngle(n),T=w,R=t.vel.copy,E=e.vel.copy,L=t.ang,B=e.ang,H=c.sub(T,t.pos),J=c.sub(T,e.pos),ht=t.am,W=e.am,K=t.m,Q=e.m,ms=(t.k+e.k)/2,gs=(t.fc+e.fc)/2,ps=t.velInPlace(T),ys=e.velInPlace(T),kt=c.sub(ys,ps),nt=1/K+1/Q;nt+=c.dot(c.crossScalarFirst(c.cross(H,k)/ht,H),k),nt+=c.dot(c.crossScalarFirst(c.cross(J,k)/W,J),k),nt=-(1+ms)*c.dot(kt,k)/nt;let Dt=c.sub(R,c.mult(k,nt/K)),Ht=c.add(E,c.mult(k,nt/Q)),pe=L-nt*c.cross(H,k)/ht,ye=B+nt*c.cross(J,k)/W,Z=kt.copy;Z.sub(c.mult(k,c.dot(kt,k))),Z.setMag(1);let ct=1/K+1/Q;ct+=c.dot(c.crossScalarFirst(c.cross(H,Z)/ht,H),Z),ct+=c.dot(c.crossScalarFirst(c.cross(J,Z)/W,J),Z),ct=-c.dot(kt,Z)/ct;let ut=nt*gs;ut>ct&&(ut=ct),Dt=c.sub(Dt,c.mult(Z,ut/K)),Ht=c.add(Ht,c.mult(Z,ut/Q)),pe-=ut*c.cross(H,Z)/ht,ye+=ut*c.cross(J,Z)/W,t.vel=Dt,e.vel=Ht,t.ang=pe,e.ang=ye,P.push(t.ang),x.push(t.vel),y.push(e.ang),C.push(e.vel),t.ang=r,t.vel=l,e.ang=d,e.vel=g}if(P.length!=x.length)return;if(P.length==0)return;if(x.length==0)return;if(y.length!=C.length)return;if(y.length==0)return;if(C.length==0)return;t.vel=x.reduce((w,k)=>c.add(w,k)),t.vel.div(x.length),t.ang=P.reduce((w,k)=>w+k),t.ang/=P.length,e.vel=C.reduce((w,k)=>c.add(w,k)),e.vel.div(C.length),e.ang=y.reduce((w,k)=>w+k),e.ang/=y.length}collideWithFixedBall(t){let e=new c(t.x,t.y),s;if(c.dist(e,this.pos)>this.boundRadius+t.r)return;for(let x of this.sides){let C,w;if(C=c.angle(c.sub(x.a,x.b),c.sub(e,x.b)),w=c.angle(c.sub(x.b,x.a),c.sub(e,x.a)),C<Math.PI/2&&w<Math.PI/2){let k=x.distFromPoint(e);if(k<=t.r){let T=c.sub(x.a,x.b);T.rotate(Math.PI/2),T.setMag(t.r*2);let R=c.mult(T,-1),E=new N(c.add(T,e),c.add(R,e));s=N.intersect(E,x),s!=null&&(T=c.sub(s,e),T.setMag(t.r-T.length),this.move(T.x,T.y))}}}if(!s||s==null){for(let x of this.points)if(c.dist(x,e)<t.r){let C=c.sub(x,e);C.setMag(t.r-C.length),this.move(C.x,C.y),C.setMag(t.r),s=c.add(e,C);break}}if(!s||s==null)return;let n=c.sub(s,e);n.setMag(1);let a=s,o=this.vel.copy,{ang:h}=this,u=c.sub(a,this.pos),{am:r}=this,{m:l}=this,{k:d}=this,{fc:g}=this,f=c.mult(this.velInPlace(a),-1),m=1/l;m+=c.dot(c.crossScalarFirst(c.cross(u,n)/r,u),n),m=-(1+d)*c.dot(f,n)/m;let p=c.sub(o,c.mult(n,m/l)),M=h-m*c.cross(u,n)/r,b=f.copy;b.sub(c.mult(n,c.dot(f,n))),b.setMag(1);let P=1/l;P+=c.dot(c.crossScalarFirst(c.cross(u,b)/r,u),b),P=-c.dot(f,b)/P;let y=m*g;y>P&&(y=P),p=c.sub(p,c.mult(b,y/l)),M-=y*c.cross(u,b)/r,this.vel=p,this.ang=M}collideWithWall(t){if(this.boundRadius+t.boundRadius<c.dist(this.pos,t.center))return;let{sides:e}=this,s=[],n=[];for(let m of e)for(let p of t.sides){let M=N.intersect(m,p);M!=null&&n.push(M)}if(n.length<2)return;let a=this.vel.copy,o=this.ang,h=[],u=[],r=c.sub(...n);r.rotate(Math.PI/2);let l=c.sub(n[0],this.pos);c.dot(r,l)>0&&r.mult(-1),r.setMag(1),c.dot(r,c.sub(this.pos,t.center))<0&&r.mult(-1),s.push(new N(...n)),s.push(new N(n[0],c.add(n[0],c.mult(r,20)))),s.push(new N(n[1],c.add(n[1],c.mult(r,20))));let d=[],g=n[0];for(let m of t.points){let p=c.sub(m,g),M=c.dot(p,r);M>0&&d.push(M)}if(d.length>0){let m=r.copy;m.mult(Math.max(...d)),this.move(m.x,m.y)}d=[];let f=c.add(...n);if(f.div(2),this.containsPoint(f))for(let m of e)d.push(m.distFromPoint(f));if(d.length>0){let m=r.copy;m.mult(Math.min(...d)),m.length<this.boundRadius/2&&this.move(m.x,m.y)}for(let m of n){let p=r;p.setMag(1);let M=m,b=this.vel.copy,{ang:P}=this,y=c.sub(M,this.pos),{am:x}=this,{m:C}=this,{k:w}=this,{fc:k}=this,T=c.mult(this.velInPlace(M),-1),R=1/C;R+=c.dot(c.crossScalarFirst(c.cross(y,p)/x,y),p),R=-(1+w)*c.dot(T,p)/R;let E=c.sub(b,c.mult(p,R/C)),L=P-R*c.cross(y,p)/x,B=T.copy;B.sub(c.mult(p,c.dot(T,p))),B.setMag(1);let H=1/C;H+=c.dot(c.crossScalarFirst(c.cross(y,B)/x,y),B),H=-c.dot(T,B)/H;let J=R*k;J>H&&(J=H),E=c.sub(E,c.mult(B,J/C)),L-=J*c.cross(y,B)/x,this.vel=E,this.ang=L,h.push(this.vel),this.vel=a.copy,u.push(this.ang),this.ang=o}return u.length!=h.length||(u.length==0||h.length==0)?void 0:(this.vel=h.reduce((m,p)=>c.add(m,p)),this.vel.div(h.length),this.ang=u.reduce((m,p)=>m+p),this.ang/=u.length,(!isFinite(this.vel.x)||!isFinite(this.vel.y)||!isFinite(this.ang))&&(this.vel=a,this.ang=o),s)}containsPoint(t){let{sides:e}=this,s=Math.max(...this.points.map(h=>c.dist(h,t)))+1,n=c.fromAngle(0);n.setMag(s);let a=new N(t,c.add(n,t)),o=e.filter(h=>N.intersect(h,a)!=null);return o.length%2==1}get sides(){return this.points.map((t,e)=>new N(t,this.points[(e+1)%this.points.length]))}velInPlace(t){let e=c.sub(t,this.pos);return e.rotate(Math.PI/2),e.mult(this.ang),e.add(this.vel),e}effectiveMass(t,e){let s=c.sub(t,this.pos),n=c.angle(e,s),a=Math.sin(n)**2*s.length**2/this.am;return 1/(a+1/this.m)}applyDeltaVelInPoint(t,e){let s=c.sub(e,this.pos);if(s.length==0){this.vel.add(t);return}let n=c.angle(s,t),a=c.mult(s,c.dot(t,s)/s.length**2);this.vel.add(a);let o=s.copy;o.rotate(Math.PI/2),o.setMag(1);let h=Math.sign(c.dot(t,o)),u=t.length*Math.cos(n),r=1/(1/this.m+s.length**2/this.am),l=u*r/this.m;this.vel.add(c.mult(o,l*h));let d=h*u*r*s.length/this.am;console.log(n),this.ang-=d}toJSObject(){let t={};return t.points=this.points.map(e=>({x:e.x,y:e.y})),t.vel=this.vel.toJSObject(),t.k=this.k,t.ang=this.ang,t.fc=this.fc,t.pos=this.pos.toJSObject(),t.lastPos=this.lastPos.toJSObject(),t.rotation=this.rotation,t.id=this.id,t}static fromObject(t){let e=new xt(t.points.map(s=>({x:s.x,y:s.y})),c.fromObject(t.vel),t.k,t.ang,t.fc);return e.id=t.id,e.pos=c.fromObject(t.pos),e.lastPos=c.fromObject(t.lastPos),e.rotation=t.rotation,e}};Fe.exports=xt}),Gt=U((Vs,Te)=>{var G=$(),Fs=lt(),Be=class extends Fs{constructor(t,e){super(t,e)}get length(){return Number.POSITIVE_INFINITY}distFromPoint(t){let e=G.sub(this.a,this.b);e.setMag(1),e.rotate(Math.PI/2);let s=G.sub(t,this.a),n=Math.abs(G.dot(s,e));return n}static intersect(t,e){let s=G.sub(t.b,t.a),n=s.y/s.x,a=t.b.y-t.b.x*n,o=G.sub(e.b,e.a),h=o.y/o.x,u=e.b.y-e.b.x*h;if(n===h)return t.distFromPoint(e.a)==0?new G((t.a.x+t.b.x+e.a.x+e.b.x)/4,(t.a.y+t.b.y+e.a.y+e.b.y)/4):void 0;{let r=(u-a)/(n-h);return new G(r,n*r+a)}}static intersectWithLineSegment(t,e){let s=G.sub(t.b,t.a),n=s.y/s.x,a=t.b.y-t.b.x*n,o=G.sub(e.b,e.a),h=o.y/o.x,u=e.b.y-e.b.x*h;if(s.x===0){if(o.x===0)return t.a.x==e.a.x?new G((e.a.x+e.b.x)/2,(e.a.y+e.b.y)/2):void 0;let r=t.a.x,l=h*r+u;return Math.min(e.a.x,e.b.x)<r&&r<Math.max(e.a.x,e.b.x)&&Math.min(e.a.y,e.b.y)<l&&Math.max(e.a.y,e.b.y)>l?new G(r,l):void 0}if(o.x===0){let r=e.a.x,l=n*r+a;return Math.min(e.a.x,e.b.x)<r&&r<Math.max(e.a.x,e.b.x)&&Math.min(e.a.y,e.b.y)<l&&Math.max(e.a.y,e.b.y)>l?new G(r,l):void 0}if(n===h)return t.distFromPoint(e.a)===0?new G((e.a.x+e.b.x)/2,(e.a.y+e.b.y)/2):void 0;{let r=(u-a)/(n-h),l=n*r+a;return Math.min(e.a.x,e.b.x)<r&&r<Math.max(e.a.x,e.b.x)&&Math.min(e.a.y,e.b.y)<l&&Math.max(e.a.y,e.b.y)>l?new G(r,l):void 0}}};Te.exports=Be}),Ye=U((zs,Xe)=>{var F=$(),bt=lt(),Ft=Gt(),et=class{constructor(t){if(t.length<3)throw new Error("Not enough points in polygon (minimum required: 3)");this.points=t,this.makeAntiClockwise()}getSideVector(t){return t<0&&(t+=Math.abs(Math.floor(t))*this.points.length),F.sub(this.points[(t+1)%this.points.length],this.points[t%this.points.length])}getSideSegment(t){return t<0&&(t+=Math.abs(Math.floor(t))*this.points.length),new bt(this.points[(t+1)%this.points.length],this.points[t%this.points.length])}getSideLine(t){return t<0&&(t+=Math.abs(Math.floor(t))*this.points.length),new Ft(this.points[(t+1)%this.points.length],this.points[t%this.points.length])}get sides(){return this.points.length}makeAntiClockwise(){let t=0;for(let e=1;e<=this.sides;e++){let s=this.getSideVector(e),n=this.getSideVector(e-1);n.mult(-1),t+=F.angleACW(s,n)}if(this.sides===3)t>Math.PI*1.5&&this.reverseOrder();else if(this.sides===4)F.angleACW(this.getSideVector(1),this.getSideVector(0))>=Math.PI&&this.reverseOrder();else if(this.sides>4){let e=t-this.sides*Math.PI;e>0&&this.reverseOrder()}}reverseOrder(){this.points=this.points.reverse()}isPointInside(t){if(F.dist(t,this.centerPoint)>this.boundRadius)return!1;let e=this.centerPoint.copy;e.add(F.mult(new F(1.1,.6),this.boundRadius));let s=new bt(t,e),n=0;if([...Array(this.sides).keys()].map(a=>this.getSideSegment(a)).forEach(a=>{bt.intersect(a,s)&&n++}),n%2==0)return!1;if(n%2==1)return!0}get centerPoint(){let t=new F(0,0);return this.points.forEach(e=>{t.add(e)}),t.div(this.sides),t}get boundRadius(){let t=this.centerPoint;return Math.max(...this.points.map(e=>F.dist(e,t)))}get allSides(){return[...Array(this.sides).keys()].map(t=>this.getSideSegment(t))}static intersection(t,e){if(F.dist(t.centerPoint,e.centerPoint)>t.boundRadius+e.boundRadius)return;let s=[],n=t.allSides,a=e.allSides;if(n.forEach((d,g)=>{a.forEach((f,m)=>{let p=bt.intersect(d,f);p&&(p.isIntersectionPoint=!0,s.push({intersectionPoint:p,sideNumber1:g,sideNumber2:m}))})}),s.length===0){if(t.isPointInside(e.points[0]))return new et(e.points.map(d=>d.copy));if(e.isPointInside(t.points[0]))return new et(t.points.map(d=>d.copy))}let o=new et(t.points.map(d=>d.copy));for(let d=o.points.length-1;d>=0;d--){let g=s.filter(f=>f.sideNumber1==d);g.length>1&&g.sort((f,m)=>F.dist(o.points[d],f.intersectionPoint)-F.dist(o.points[d],m.intersectionPoint)),g.length>0&&o.points.splice(d+1,0,...g.map(f=>f.intersectionPoint))}let h=new et(e.points.map(d=>d.copy));for(let d=h.points.length-1;d>=0;d--){let g=s.filter(f=>f.sideNumber2==d);g.length>1&&g.sort((f,m)=>F.dist(h.points[d],f.intersectionPoint)-F.dist(h.points[d],m.intersectionPoint)),g.length>0&&h.points.splice(d+1,0,...g.map(f=>f.intersectionPoint))}let u={polyNum:1,pointNum:0};for(let d=0;d<o.points.length;d++)if(o.points[d].isIntersectionPoint){u.pointNum=d;break}else if(h.isPointInside(o.points[d])){u.pointNum=d;break}let r=!1,l=[];for(;!r;){let d=u.polyNum===1?o:h,g=u.polyNum===1?h:o;if(l.push(d.points[u.pointNum%d.points.length].copy),l.length>2&&l[0].x==l[l.length-1].x&&l[0].y==l[l.length-1].y){l.pop();break}if(l.length>o.points.length+h.points.length)break;d.points[u.pointNum%d.points.length].isIntersectionPoint?d.points[(u.pointNum+1)%d.points.length].isIntersectionPoint||g.isPointInside(d.points[(u.pointNum+1)%d.points.length])&&!d.points[(u.pointNum+1)%d.points.length].isIntersectionPoint?u.pointNum++:(u.pointNum=g.points.indexOf(d.points[u.pointNum%d.points.length])+1,u.polyNum=u.polyNum===1?2:1):u.pointNum++}return new et(l)}static createCircle(t,e,s=25){let n=[...Array(s).keys()].map(a=>{let o=F.fromAngle(2*Math.PI*a/s);return o.setMag(t),o.add(e),o});return new et(n)}static fracture(t,e=500){let s=t.map((n,a)=>{let o=[];for(let u=0;u<t.length;u++){if(a===u)continue;let r=t[u],l=F.div(F.add(n,r),2),d=F.sub(n,r);d.rotate(Math.PI/2),o.push(new Ft(l,F.add(d,l)))}o=o.filter((u,r)=>{let l=new bt(u.a,n);for(let d=0;d<o.length;d++){if(r===d)continue;let g=Ft.intersectWithLineSegment(o[d],l);if(g)return!1}return!0}),o=o.sort((u,r)=>F.sub(u.a,u.b).heading-F.sub(r.a,r.b).heading);let h=o.map((u,r)=>{let l=[];for(let g=0;g<o.length;g++){if(r===g)continue;let f=Ft.intersect(u,o[g]);f&&l.push(f)}let d=F.sub(u.a,u.b);return l=l.filter(g=>{let f=F.sub(g,n);d.setMag(1);let m=F.dot(f,d);return m>0}),l.length===0&&l.push(F.add(F.mult(d,e*1.2),u.a)),l=l.sort((g,f)=>F.dist(g,n)-F.dist(f,n)),l[0]});return h});return s.filter(n=>n.length>=3).map(n=>new et(n))}};Xe.exports=et}),Le=U((Us,je)=>{je.exports={name:"ballphysics",version:"1.6.0",description:"2D rigid body physics engine to-be",main:"./src/physics.js",scripts:{test:"jest --verbose ./tests",lint:"eslint . --ext .ts,.js",watch:'nodemon --ignore "dest/*.*" -e js,ts,css,html --exec npm run build',build:"esbuild editor/src/index.ts --bundle --minify --sourcemap --target=chrome58,firefox57,safari11,edge16 --outfile=dest/main.js && cp editor/static/index.html dest/index.html"},repository:{type:"git",url:"git+https://github.com/AkosSeres/BallPhysics.git"},keywords:["physics","2d","rigid","balls"],author:"Akos Seres",license:"LGPL-2.1",bugs:{url:"https://github.com/AkosSeres/BallPhysics/issues"},homepage:"https://github.com/AkosSeres/BallPhysics#readme",devDependencies:{"@typescript-eslint/eslint-plugin":"^4.11.0","@typescript-eslint/parser":"^4.11.0",esbuild:"^0.8.26",eslint:"^7.2.0","eslint-config-airbnb":"^18.2.1","eslint-config-airbnb-typescript":"^12.0.0","eslint-plugin-import":"^2.22.1","eslint-plugin-jsdoc":"^30.7.9","eslint-plugin-jsx-a11y":"^6.4.1","eslint-plugin-react":"^7.21.5","eslint-plugin-react-hooks":"^4.0.0",jest:"^26.4.2",nodemon:"^2.0.6",typescript:"^4.1.3"},dependencies:{}}}),at=U(($s,qe)=>{var O=$(),Vt=pt(),vt=Pe(),Os=lt(),Ne=yt(),ot=Ct(),Ot=Ee(),wt=Oe(),Ts=Gt(),Bs=Ye(),D=class{constructor(){this.balls=[],this.bodies=[],this.fixedBalls=[],this.softBalls=[],this.walls=[],this.bounds=[],this.springs=[],this.airFriction=1,this.gravity=new O(0,0),this.debugData=[]}update(t,e){this.debugData=[];let s=e?this.copy:new D;e&&(s.bodies.reverse(),s.balls.reverse(),s.update(t,!1));for(let n=0;n<this.balls.length;n+=1)this.balls[n].lastPos=this.balls[n].pos.copy,this.balls[n].pos.add(O.mult(this.balls[n].vel,t)),this.balls[n].rotation+=this.balls[n].ang*t,this.balls[n].rotation%=Math.PI*2;for(let n=0;n<this.bodies.length;n+=1)this.bodies[n].lastPos=this.bodies[n].pos.copy,this.bodies[n].move(this.bodies[n].vel.x*t,this.bodies[n].vel.y*t),this.bodies[n].rotate(this.bodies[n].ang*t);for(let n=0;n<3;n+=1)this.springs.forEach(a=>{a.update(t/3/2)});for(let n=0;n<this.balls.length;n+=1){this.gravity&&this.balls[n].vel.add(new O(this.gravity.x*t,this.gravity.y*t));for(let a=n+1;a<this.balls.length;a+=1)(this.balls[n].layer!==this.balls[a].layer||!this.balls[n].layer&&!this.balls[a].layer)&&Vt.collide(this.balls[n],this.balls[a]);for(let a of this.walls)a.collideWithBall(this.balls[n]);for(let a of this.fixedBalls){let o=this.balls[n],h,u=0,r=new O(a.x,a.y);r.x-=o.pos.x,r.y-=o.pos.y,r.mult(-1),r.length<=o.r+a.r&&(h=r.heading,u=r.length);t:if(isFinite(h)){let l=o.pos.copy,d=o.vel.copy;if(l.rotate(-h+Math.PI/2),d.rotate(-h+Math.PI/2),d.y>0)break t;d.y*=-o.k,l.y+=o.r+a.r-u;let g=d.y*(1+o.k),f=Math.sign(d.x+o.ang*o.r)*(g*o.fc)/(o.amc*o.r),m=(d.x+o.ang*o.r)/o.r;f/m>1&&(f=m),o.ang-=f;let p=f*o.am/o.r/o.m;d.x-=p,l.rotate(h-Math.PI/2),d.rotate(h-Math.PI/2),o.pos.x=l.x,o.pos.y=l.y,o.vel.x=d.x,o.vel.y=d.y}}for(let a of this.bounds)a.collideWithBall(this.balls[n])}for(let n=0;n<this.bodies.length;n++){for(let a of this.balls)(a.layer!=this.bodies[n].layer||!a.layer&&!this.bodies[n].layer)&&this.bodies[n].collideWithBall(a);for(let a=n+1;a<this.bodies.length;a++)(this.bodies[n].layer!=this.bodies[a].layer||!this.bodies[a].layer&&!this.bodies[n].layer)&&wt.collide(this.bodies[n],this.bodies[a]);for(let a of this.bodies)for(let o of this.fixedBalls)a.collideWithFixedBall(o);for(let a of this.bodies)for(let o of this.walls){let h=a.collideWithWall(o);h&&this.debugData.push(...h)}for(let a of this.bodies)for(let o of this.bounds){let h=a.collideWithWall(o);h&&this.debugData.push(...h)}this.gravity&&this.bodies[n].vel.add(new O(this.gravity.x*t,this.gravity.y*t))}this.softBalls.forEach(n=>{Ot.updatePressureBasedForces(n,t)});for(let n=0;n<3;n++)for(let a of this.springs)a.update(t/3/2);this.balls.forEach(n=>{n.vel.mult(Math.pow(this.airFriction,t)),n.ang*=Math.pow(this.airFriction,t)}),this.bodies.forEach(n=>{n.vel.mult(Math.pow(this.airFriction,t)),n.ang*=Math.pow(this.airFriction,t)}),e&&(s.bodies.reverse(),s.balls.reverse(),this.balls.forEach((n,a)=>{n.move((s.balls[a].pos.x-n.pos.x)*.5,(s.balls[a].pos.y-n.pos.y)*.5),n.vel.add(new O((s.balls[a].vel.x-n.vel.x)*.5,(s.balls[a].vel.y-n.vel.y)*.5)),n.rotation=(n.rotation+s.balls[a].rotation)/2,n.ang=(n.ang+s.balls[a].ang)/2}),this.bodies.forEach((n,a)=>{let o=s.bodies[a];n.move((o.pos.x-n.pos.x)*.5,(o.pos.y-n.pos.y)*.5),n.vel.add(new O((o.vel.x-n.vel.x)*.5,(o.vel.y-n.vel.y)*.5)),n.rotate((o.rotation-n.rotation)/2),n.ang=(n.ang+o.ang)/2}))}get copy(){let t=new D;return t.balls=this.getCopyOfBalls(),t.bodies=this.getCopyOfBodies(),t.fixedBalls=this.fixedBalls,t.walls=this.walls,t.bounds=this.bounds,t.gravity=this.gravity,this.springs.forEach(e=>{let s=e.constructor==ot?ot:Ne,n=new s(e.length,e.springConstant);n.rotationLocked=e.rotationLocked,n.pinned=e.pinned,e.objects.forEach(a=>{let o=this.balls.indexOf(a);o!=-1?n.attachObject(t.balls[o]):(o=this.bodies.indexOf(a),o!=-1&&n.attachObject(t.bodies[o]))}),t.springs.push(n)}),t}setAirFriction(t){if(!isFinite(t))return;this.airFriction=t,this.airFriction<0&&(this.airFriction=0),this.airFriction>1&&(this.airFriction=1)}setGravity(t){this.gravity=t.copy}addBall(t){if(typeof addBodyNotBall!="undefined"&&isFinite(addBodyNotBall)&&addBodyNotBall>2){let e=(s,n,a)=>{let o=[];for(let h=0;h<a;h++){let u=O.fromAngle(h/a*2*Math.PI);u.mult(n),u.add(s),o.push(u)}return o};this.bodies.push(new wt(e(t.pos,t.r,addBodyNotBall),t.vel,t.k,t.ang,t.fc))}else this.balls.push(t)}addBody(t){this.bodies.push(t)}addSoftBall(t){this.balls.push(...t.points),this.springs.push(...t.sides),this.softBalls.push(t)}addSoftSquare(t,e,s,n,a=24,o=1){let h=new Ot(t,Math.sqrt(e*e/Math.PI),o,s,a);h.sides.forEach(l=>{l.length=.96*4*e/h.resolution}),h.points.forEach(l=>{l.vel=n.copy}),this.balls.push(...h.points),this.springs.push(...h.sides);let u=e*e*200*o,r=new ot(Math.sqrt(h.r*h.r*Math.PI),u/2);r.attachObject(h.points[0]),r.attachObject(h.points[h.resolution/2]),this.springs.push(r),r=new ot(Math.sqrt(h.r*h.r*Math.PI),u/2),r.attachObject(h.points[h.resolution/4]),r.attachObject(h.points[3*h.resolution/4]),this.springs.push(r),r=new ot(Math.sqrt(2*h.r*h.r*Math.PI),u),r.attachObject(h.points[h.resolution/8]),r.attachObject(h.points[5*h.resolution/8]),this.springs.push(r),r=new ot(Math.sqrt(2*h.r*h.r*Math.PI),u),r.attachObject(h.points[3*h.resolution/8]),r.attachObject(h.points[7*h.resolution/8]),this.springs.push(r)}addRectWall(t,e,s,n){let a=[];a.push(new O(t-s/2,e-n/2)),a.push(new O(t+s/2,e-n/2)),a.push(new O(t+s/2,e+n/2)),a.push(new O(t-s/2,e+n/2)),this.walls.push(new vt(a))}addRectBody(t,e,s,n,a,o){let h=[];h.push(new O(t-s/2,e-n/2)),h.push(new O(t+s/2,e-n/2)),h.push(new O(t+s/2,e+n/2)),h.push(new O(t-s/2,e+n/2)),this.bodies.push(new wt(h,new O(0,0),o,0,a))}addWall(t){this.walls.push(t)}addFixedBall(t,e,s){this.fixedBalls.push({x:t,y:e,r:s})}addSpring(t){this.springs.push(t)}setBounds(t,e,s,n){this.bounds=[];let a=(o,h,u,r)=>{let l=[];return l.push(new O(o-u/2,h-r/2)),l.push(new O(o+u/2,h-r/2)),l.push(new O(o+u/2,h+r/2)),l.push(new O(o-u/2,h+r/2)),new vt(l)};this.bounds.push(a(t-s,e,2*s,4*n)),this.bounds.push(a(t+2*s,e,2*s,4*n)),this.bounds.push(a(t,e-n,4*s,n*2)),this.bounds.push(a(t,e+2*n,4*s,2*n))}getObjectAtCoordinates(t,e){let s=!1,n=new O(t,e);return this.balls.forEach(a=>{a.containsPoint(n)&&(s=a)}),this.bodies.forEach(a=>{a.containsPoint(n)&&(s=a)}),this.walls.forEach(a=>{a.containsPoint(n)&&(s=a)}),this.fixedBalls.forEach(a=>{O.dist(new O(a.x,a.y),new O(t,e))<=a.r&&(s=a)}),this.softBalls.forEach(a=>{a.containsPoint(n)&&(s=a)}),s}getCopyOfBalls(){let t=[];return this.balls.forEach(e=>{t.push(e.copy)}),t}getCopyOfBodies(){let t=[];return this.bodies.forEach(e=>{t.push(e.copy)}),t}removeObjFromSystem(t){let e=this.balls.indexOf(t);if(e!==-1){let s=!1;if(this.softBalls.forEach(n=>{n.points.includes(this.balls[e])&&(this.removeObjFromSystem(n),s=!0)}),s)return;this.springs.forEach(n=>{n.objects.includes(this.balls[e])&&this.removeObjFromSystem(n)}),this.balls.splice(e,1);return}if(e=this.bodies.indexOf(t),e!==-1){this.bodies.splice(e,1);return}if(e=this.walls.indexOf(t),e!==-1){this.walls.splice(e,1);return}if(e=this.fixedBalls.indexOf(t),e!==-1){this.fixedBalls.splice(e,1);return}if(e=this.springs.indexOf(t),e!==-1){this.springs.splice(e,1);let s=!1;return this.softBalls.forEach(n=>{n.points.includes(this.springs[e])&&(this.removeObjFromSystem(n),s=!0)}),s,void 0}if(e=this.softBalls.indexOf(t),e!==-1){let s=this.softBalls[e];this.softBalls.splice(e,1),s.points.forEach(n=>{this.removeObjFromSystem(n)})}}getItemDataFromId(t){let e={type:"",num:0},s=h=>h.id===t,n=this.balls.filter(s);if(n.length>=1)return e.type="ball",e.num=this.balls.indexOf(n[0]),e;let a=this.bodies.filter(s);if(a.length>=1)return e.type="body",e.num=this.bodies.indexOf(a[0]),e;let o=this.springs.filter(s);return o.length>=1&&(e.type="spring",e.num=this.springs.indexOf(o[0])),e}toJSObject(){let t={};return t.balls=this.balls.map(e=>e.toJSObject()),t.bounds=this.bounds.map(e=>e.toJSObject()),t.walls=this.walls.map(e=>e.toJSObject()),t.bodies=this.bodies.map(e=>e.toJSObject()),t.springs=this.springs.map(e=>e.toJSObject()),t.softBalls=this.softBalls.map(e=>e.toJSObject()),t.fixedBalls=this.fixedBalls,t.airFriction=this.airFriction,t.gravity=this.gravity.toJSObject(),t.version=Le().version,t}static fromObject(t){let e=new D;return e.balls=t.balls.map(s=>Vt.fromObject(s)),e.bounds=t.bounds.map(s=>vt.fromObject(s)),e.walls=t.walls.map(s=>vt.fromObject(s)),e.bodies=t.bodies.map(s=>wt.fromObject(s)),e.springs=t.springs.map(s=>ot.fromObject(s,e.balls)),e.softBalls=t.softBalls.map(s=>Ot.fromObject(s,e.balls,e.springs)),e.fixedBalls=t.fixedBalls,e.airFriction=t.airFriction,e.gravity=O.fromObject(t.gravity),e}toJSON(){return JSON.stringify(this.toJSObject())}static fromJSON(t){return D.fromObject(JSON.parse(t))}};D.Ball=Vt;D.Body=wt;D.Vec2=O;D.Wall=vt;D.LineSegment=Os;D.Spring=ot;D.Stick=Ne;D.SoftBall=Ot;D.Line=Ts;D.Polygon=Bs;qe.exports=D}),fe=_(at()),me=_(pt()),st=_($()),us=_(Ct()),ge=_(yt()),Re=_(at()),Tt,ft;function zt(i){Tt=i.getPhysics().toJSObject(),ft=!0;let t=document.getElementById("pause");t&&(t.onclick=()=>{i.getTimeMultiplier()!==0?i.setTimeMultiplier(0):(i.setTimeMultiplier(1),ft===!0&&(Tt=i.getPhysics().toJSObject()),ft=!1)});let e=document.getElementById("revert");e&&(e.onclick=()=>{i.setTimeMultiplier(0),i.setPhysics(Re.default.fromObject(Tt)),ft=!0});let s=document.getElementById("clear all");s&&(s.onclick=()=>{ft=!0;let a=i.getPhysics();a.balls=[],a.walls=[],a.softBalls=[],a.springs=[],a.bodies=[]});let n=document.getElementById("set start");n&&(n.onclick=()=>{Tt=i.getPhysics().toJSObject(),ft=!0,i.setTimeMultiplier(0)})}var Xt=_(at());function q(i){let t=document.createElement("div"),e=document.createElement("h3");return e.innerText=i,e.classList.add("modetitlemargin"),t.appendChild(e),t.classList.add("mode-title"),t.classList.add("bg-blue"),t}function j(i,t,e,s,n,a=1){let o=document.createElement("p");o.innerText=i;let h=document.createElement("input");h.type="range",h.min=t.toString(),h.max=e.toString(),h.step=a.toString(),h.value=s.toString(),h.classList.add("slider"),h.classList.add("fix-width"),h.onchange=n;let u=document.createElement("div");return u.appendChild(o),u.appendChild(h),u}function Bt(i,t,e){let s=i+Math.random().toString(),n=document.createElement("label");n.innerText=i,n.htmlFor=s,n.classList.add("checkbox-label");let a=document.createElement("input");a.type="checkbox",a.name=s,a.value=t.toString(),a.classList.add("ch-box"),a.onchange=e;let o=document.createElement("div");return o.appendChild(a),o.appendChild(n),o}var Yt=35,Ut=.5,$t=1.5,Kt=document.createElement("div"),De={name:"Ball creator",description:"",element:Kt,drawFunc(i,t){let e=i.cnv.getContext("2d");e.strokeStyle="black",e.beginPath(),e.arc(i.mouseX,i.mouseY,Yt,0,2*Math.PI),e.stroke(),i.lastX!==0&&i.lastY!==0&&(e.beginPath(),e.moveTo(i.mouseX,i.mouseY),e.lineTo(i.lastX,i.lastY),e.stroke())},startInteractionFunc(i){},endInteractionFunc(i){if(i.lastX!==0&&i.lastY!==0){let t=new Xt.default.Ball(new Xt.default.Vec2(i.lastX,i.lastY),new Xt.default.Vec2(i.lastX-i.mouseX,i.lastY-i.mouseY),Yt,Ut,0,$t);Number.isFinite(t.pos.x)&&Number.isFinite(t.pos.y)&&Number.isFinite(t.vel.x)&&Number.isFinite(t.vel.y)||(t.vel.x=0,t.vel.y=0),i.physics.addBall(t)}},keyGotUpFunc(i){},keyGotDownFunc(i){}};[q(De.name),j("Size",5,120,Yt,i=>{Yt=i.target.valueAsNumber}),j("Bounciness",0,1,Ut,i=>{Ut=i.target.valueAsNumber},.02),j("Coefficient of friction",0,2,$t,i=>{$t=i.target.valueAsNumber},.1)].forEach(Kt.appendChild.bind(Kt));var He=De,Qt=document.createElement("div"),We={name:"Delete",description:"",element:Qt,drawFunc(i,t){},startInteractionFunc(i){i.choosed&&i.physics.removeObjFromSystem(i.choosed)},endInteractionFunc(i){},keyGotUpFunc(i){},keyGotDownFunc(i){}};[q(We.name)].forEach(Qt.appendChild.bind(Qt));var Je=We,Mt=_(at()),Pt=35,Xs=.5,jt=1.5,Zt=24,_t=1e6,At=document.createElement("div"),Ge={name:"Elastic ball creator",description:"",element:At,drawFunc(i,t){let e=i.cnv.getContext("2d");e.strokeStyle="black",e.beginPath(),e.arc(i.mouseX,i.mouseY,Pt,0,2*Math.PI),e.stroke(),i.lastX!==0&&i.lastY!==0&&(e.beginPath(),e.moveTo(i.mouseX,i.mouseY),e.lineTo(i.lastX,i.lastY),e.stroke())},startInteractionFunc(i){},endInteractionFunc(i){if(i.lastX!==0&&i.lastY!==0){let t=new Mt.default.Ball(new Mt.default.Vec2(i.lastX,i.lastY),new Mt.default.Vec2(i.lastX-i.mouseX,i.lastY-i.mouseY),Pt,Xs,0,jt);if(Number.isFinite(t.pos.x)&&Number.isFinite(t.pos.y)&&Number.isFinite(t.vel.x)&&Number.isFinite(t.vel.y)){let e=new Mt.default.SoftBall(t.pos,Pt,_t,jt,Zt);e.points.forEach(s=>{let n=s;n.vel=t.vel.copy}),i.physics.addSoftBall(e)}}},keyGotUpFunc(i){},keyGotDownFunc(i){}};[q(Ge.name),j("Size",5,60,Pt,i=>{Pt=i.target.valueAsNumber}),j("Pressure",5e5,3e6,_t,i=>{_t=i.target.valueAsNumber},4e3),j("Coefficient of friction",0,2,jt,i=>{jt=i.target.valueAsNumber},.1),j("Resolution",6,24,Zt,i=>{Zt=i.target.valueAsNumber},1)].forEach(At.appendChild.bind(At));var Ve=Ge,ze=0,Ue=0,te=document.createElement("div"),$e={name:"Move",description:"",element:te,drawFunc(i,t){let{choosed:e}=i;e&&!e.pinPoint&&(e.move(i.mouseX-e.pos.x,i.mouseY-e.pos.y),t===0?(e.vel.x=0,e.vel.y=0):(e.vel.x=(i.mouseX-ze)/t,e.vel.y=(i.mouseY-Ue)/t),e.ang=0),ze=i.mouseX,Ue=i.mouseY},startInteractionFunc(i){},endInteractionFunc(i){},keyGotUpFunc(i){},keyGotDownFunc(i){}};[q($e.name)].forEach(te.appendChild.bind(te));var Ke=$e,ee=document.createElement("div"),Qe={name:"Rectangle wall",description:"",element:ee,drawFunc(i,t){if(i.lastX!==0&&i.lastY!==0){let e=i.cnv.getContext("2d");e.strokeStyle="black",e.strokeRect(i.mouseX,i.mouseY,i.lastX-i.mouseX,i.lastY-i.mouseY)}},startInteractionFunc(i){},endInteractionFunc(i){i.lastX!==0&&i.lastY!==0&&i.physics.addRectWall(i.lastX/2+i.mouseX/2,i.lastY/2+i.mouseY/2,2*Math.abs(i.lastX/2-i.mouseX/2),2*Math.abs(i.lastY/2-i.mouseY/2))},keyGotUpFunc(i){},keyGotDownFunc(i){}};[q(Qe.name)].forEach(ee.appendChild.bind(ee));var Ze=Qe,se=.2,ne=.5,ie=document.createElement("div"),_e={name:"Rectangle body (experimental)",description:"",element:ie,drawFunc(i,t){let e=i.cnv.getContext("2d");i.lastX!==0&&i.lastY!==0&&(e.strokeStyle="black",e.strokeRect(i.mouseX,i.mouseY,i.lastX-i.mouseX,i.lastY-i.mouseY))},startInteractionFunc(i){},endInteractionFunc(i){i.lastX!==0&&i.lastY!==0&&i.physics.addRectBody(i.lastX/2+i.mouseX/2,i.lastY/2+i.mouseY/2,2*Math.abs(i.lastX/2-i.mouseX/2),2*Math.abs(i.lastY/2-i.mouseY/2),ne,se)},keyGotUpFunc(i){},keyGotDownFunc(i){}};[q(_e.name),j("Bounciness",.07,.3,se,i=>{se=i.target.valueAsNumber},.02),j("Coefficient of friction",0,.6,ne,i=>{ne=i.target.valueAsNumber},.1)].forEach(ie.appendChild.bind(ie));var Ae=_e,Lt=_(at()),V=35,Ys=.5,qt=1.5,oe=24,ae=1,re=document.createElement("div"),ts={name:"Soft square creator",description:"",element:re,drawFunc(i,t){let e=i.cnv.getContext("2d");e.strokeStyle="black",e.beginPath(),e.moveTo(i.mouseX-V,i.mouseY-V),e.lineTo(i.mouseX+V,i.mouseY-V),e.lineTo(i.mouseX+V,i.mouseY+V),e.lineTo(i.mouseX-V,i.mouseY+V),e.lineTo(i.mouseX-V,i.mouseY-V),e.stroke(),i.lastX!==0&&i.lastY!==0&&(e.beginPath(),e.moveTo(i.mouseX,i.mouseY),e.lineTo(i.lastX,i.lastY),e.stroke())},startInteractionFunc(i){},endInteractionFunc(i){if(i.lastX!==0&&i.lastY!==0){let t=new Lt.default.Ball(new Lt.default.Vec2(i.lastX,i.lastY),new Lt.default.Vec2(i.lastX-i.mouseX,i.lastY-i.mouseY),V,Ys,0,qt);Number.isFinite(t.pos.x)&&Number.isFinite(t.pos.y)&&Number.isFinite(t.vel.x)&&Number.isFinite(t.vel.y)&&i.physics.addSoftSquare(t.pos,V*2,qt,t.vel,oe,ae)}},keyGotUpFunc(i){},keyGotDownFunc(i){}};[q(ts.name),j("Size",5,100,V,i=>{V=i.target.valueAsNumber}),j("Pressure",.4,7,ae,i=>{ae=i.target.valueAsNumber},.1),j("Coefficient of friction",0,2,qt,i=>{qt=i.target.valueAsNumber},.1),j("Resolution",16,48,oe,i=>{oe=i.target.valueAsNumber},8)].forEach(re.appendChild.bind(re));var es=ts,ss=_(at()),he=!1,It=1e4,le=document.createElement("div"),ns={name:"Spring creator",description:"",element:le,drawFunc(i,t){let e=i.cnv.getContext("2d");i.lastX!==0&&i.lastY!==0&&(e.strokeStyle="black",e.beginPath(),e.moveTo(i.mouseX,i.mouseY),e.lineTo(i.lastX,i.lastY),e.stroke())},startInteractionFunc(i){},endInteractionFunc(i){if(i.lastX!==0&&i.lastY!==0){let t=i.physics.getObjectAtCoordinates(i.mouseX,i.mouseY),e,s=ss.default.Spring;if(t||(t={x:i.mouseX,y:i.mouseY,pinPoint:!0}),i.choosed===t||i.choosed===void 0&&t===void 0)return;if(i.choosed.pinPoint&&t.pinPoint)return;i.choosed.pinPoint?(e=new s(Math.sqrt((i.choosed.x-t.pos.x)**2+(i.choosed.y-t.pos.y)**2),It),e.attachObject(t),e.pinHere(i.choosed.x,i.choosed.y)):t.pinPoint?(e=new s(Math.sqrt((i.choosed.pos.x-t.x)**2+(i.choosed.pos.y-t.y)**2),It),e.attachObject(i.choosed),e.pinHere(t.x,t.y)):(e=new s(Math.sqrt((i.choosed.pos.x-t.pos.x)**2+(i.choosed.pos.y-t.pos.y)**2),It),e.attachObject(i.choosed),e.attachObject(t)),i.physics.addSpring(e),he&&e.lockRotation()}},keyGotUpFunc(i){},keyGotDownFunc(i){}};[q(ns.name),Bt("Rotation locked",he,i=>{he=i.target.checked}),j("Spring stiffness",2e3,1e5,It,i=>{It=i.target.valueAsNumber},50)].forEach(le.appendChild.bind(le));var is=ns,os=_(at()),ce=!1,ue=document.createElement("div"),as={name:"Stick creator",description:"",element:ue,drawFunc(i,t){let e=i.cnv.getContext("2d");i.lastX!==0&&i.lastY!==0&&(e.strokeStyle="black",e.beginPath(),e.moveTo(i.mouseX,i.mouseY),e.lineTo(i.lastX,i.lastY),e.stroke())},startInteractionFunc(i){},endInteractionFunc(i){if(i.lastX!==0&&i.lastY!==0){let t=i.physics.getObjectAtCoordinates(i.mouseX,i.mouseY),e,s=os.default.Stick;if(t||(t={x:i.mouseX,y:i.mouseY,pinPoint:!0}),i.choosed===t||i.choosed===void 0&&t===void 0)return;if("pinPoint"in(i==null?void 0:i.choosed)&&"pinPoint"in t)return;"pinPoint"in(i==null?void 0:i.choosed)?(e=new s(Math.sqrt((i.choosed.x-t.pos.x)**2+(i.choosed.y-t.pos.y)**2)),e.attachObject(t),e.pinHere(i.choosed.x,i.choosed.y)):t.pinPoint?(e=new s(Math.sqrt((i.choosed.pos.x-t.x)**2+(i.choosed.pos.y-t.y)**2)),e.attachObject(i.choosed),e.pinHere(t.x,t.y)):(e=new s(Math.sqrt((i.choosed.pos.x-t.pos.x)**2+(i.choosed.pos.y-t.pos.y)**2)),e.attachObject(i.choosed),e.attachObject(t)),i.physics.addSpring(e),ce&&e.lockRotation()}},keyGotUpFunc(i){},keyGotDownFunc(i){}};[q(as.name),Bt("Rotation locked",ce,i=>{ce=i.target.checked})].forEach(ue.appendChild.bind(ue));var rs=as,Nt=20,de=document.createElement("div"),hs={name:"Wall drawer",description:"",element:de,drawFunc(i,t){let e=i.cnv.getContext("2d");e.strokeStyle="black",e.beginPath(),e.arc(i.mouseX,i.mouseY,Nt,0,2*Math.PI),e.stroke(),i.lastX!==0&&i.lastY!==0&&i.physics.addFixedBall(i.mouseX,i.mouseY,Nt)},startInteractionFunc(i){},endInteractionFunc(i){},keyGotUpFunc(i){},keyGotDownFunc(i){}};[q(hs.name),j("Size",5,70,Nt,i=>{Nt=i.target.valueAsNumber})].forEach(de.appendChild.bind(de));var ls=hs,cs=[He,Ze,ls,rs,is,Ke,Ve,es,Je,Ae];var mt=cs,Rt=mt.map(i=>i.name),rt={white:"#faf3dd",green:"#02c39a",pink:"#e58c8a",blue:"#77b6ea",black:"#363732"},ds=class{constructor(){this.resizeCanvas=()=>{let t=this.canvasHolder.getBoundingClientRect();this.cnv.width=t.width,this.cnv.height=window.innerHeight-t.top;let e=window.devicePixelRatio||1,s=t;this.cnv.width=s.width*e,this.cnv.height=s.height*e,this.cnv.style.width=`${s.width}px`,this.cnv.style.height=`${s.height}px`,this.scaling=1/e,this.physics.setBounds(0,0,this.cnv.width,this.cnv.height);let n=this.cnv.getContext("2d");n&&(n.scale(e,e),n.lineWidth=e),this.defaultSize=(this.cnv.width+this.cnv.height)/80};this.drawFunction=()=>{var s,n;Number.isFinite(this.lastFrameTime)||(this.lastFrameTime=performance.now());let t=performance.now()-this.lastFrameTime;Number.isFinite(t)||(t=0),t/=1e3;let e=this.cnv.getContext("2d");e.fillStyle=rt.black,e.fillRect(0,0,this.cnv.width,this.cnv.height),e.save(),e.translate(this.viewOffsetX,this.viewOffsetY),e.scale(this.scaling,this.scaling),(n=(s=mt[this.mode]).drawFunc)==null||n.call(s,this,t*this.timeMultiplier),this.physicsDraw(),e.restore(),this.physics.balls[0]&&(this.right&&(this.physics.balls[0].ang-=Math.PI*100*t),this.left&&(this.physics.balls[0].ang+=Math.PI*100*t)),t*=this.timeMultiplier,this.physics.update(t/5,!1),this.physics.update(t/5,!1),this.physics.update(t/5,!1),this.physics.update(t/5,!1),this.physics.update(t/5,!1),this.lastFrameTime=performance.now(),requestAnimationFrame(this.drawFunction)};this.startInteraction=(t,e)=>{var s,n;this.mouseX=t/this.scaling-this.viewOffsetX/this.scaling,this.mouseY=e/this.scaling-this.viewOffsetY/this.scaling,this.choosed=this.physics.getObjectAtCoordinates(this.mouseX,this.mouseY),this.choosed||(this.choosed={x:this.mouseX,y:this.mouseY,pinPoint:!0}),this.lastX=this.mouseX,this.lastY=this.mouseY,(n=(s=mt[this.mode]).startInteractionFunc)==null||n.call(s,this)};this.endInteraction=(t,e)=>{var s,n;if(this.mouseX=t/this.scaling-this.viewOffsetX/this.scaling,this.mouseY=e/this.scaling-this.viewOffsetY/this.scaling,(n=(s=mt[this.mode]).endInteractionFunc)==null||n.call(s,this),this.lastX===0&&this.lastY===0)return;this.lastX=0,this.lastY=0,this.choosed=!1};this.keyGotDown=t=>{let e=t.key;e==="s"&&this.spawnNewtonsCradle(this.cnv.width/2,this.cnv.height/2,.5,this.physics),e==="a"&&(this.scaling+=.01),e==="d"&&(this.scaling-=.01),e==="j"&&(this.viewOffsetX-=10),e==="l"&&(this.viewOffsetX+=10),e==="k"&&(this.viewOffsetY-=10),e==="i"&&(this.viewOffsetY+=10),e==="ArrowRight"&&(this.right=!0),e==="ArrowLeft"&&(this.left=!0)};this.keyGotUp=t=>{let e=t.key;e==="ArrowRight"&&(this.right=!1),e==="ArrowLeft"&&(this.left=!1)};this.startTouch=t=>{t.preventDefault();let e=this.canvasHolder.getBoundingClientRect();return this.startInteraction(t.changedTouches[0].clientX-e.left,t.changedTouches[0].clientY-e.top),!1};this.endTouch=t=>{t.preventDefault();let e=this.canvasHolder.getBoundingClientRect();return this.endInteraction(t.changedTouches[0].clientX-e.left,t.changedTouches[0].clientY-e.top),!1};this.moveTouch=t=>{t.preventDefault();let e=this.canvasHolder.getBoundingClientRect();return this.mouseX=t.changedTouches[0].clientX-e.left,this.mouseY=t.changedTouches[0].clientY-e.top,this.mouseX=this.mouseX/this.scaling-this.viewOffsetX/this.scaling,this.mouseY=this.mouseY/this.scaling-this.viewOffsetY/this.scaling,!1};this.startMouse=t=>(this.startInteraction(t.offsetX,t.offsetY),!1);this.endMouse=t=>(this.endInteraction(t.offsetX,t.offsetY),!1);this.handleMouseMovement=t=>{this.mouseX=t.offsetX,this.mouseY=t.offsetY,this.mouseX=this.mouseX/this.scaling-this.viewOffsetX/this.scaling,this.mouseY=this.mouseY/this.scaling-this.viewOffsetY/this.scaling};this.physicsDraw=()=>{let t=this.cnv.getContext("2d");if(t){t.fillStyle=rt.green,t.strokeStyle="black";for(let s=0;s<this.physics.balls.length;s+=1){let n=this.physics.balls[s];t.beginPath(),t.arc(n.pos.x,n.pos.y,n.r,0,2*Math.PI),t.stroke(),t.fill(),t.beginPath(),t.moveTo(n.pos.x,n.pos.y),t.lineTo(n.pos.x+n.r*Math.cos(n.rotation),n.pos.y+n.r*Math.sin(n.rotation)),t.stroke()}this.physics.bodies.forEach(s=>{t.beginPath(),t.moveTo(s.points[s.points.length-1].x,s.points[s.points.length-1].y),s.points.forEach(n=>{t.lineTo(n.x,n.y)}),t.stroke(),t.fill(),t.beginPath(),t.arc(s.pos.x,s.pos.y,1.5,0,Math.PI*2),t.stroke()});let e=s=>{t.beginPath(),t.moveTo(s.points[s.points.length-1].x,s.points[s.points.length-1].y),s.points.forEach(n=>{t.lineTo(n.x,n.y)}),t.fill()};t.fillStyle="white",this.physics.walls.forEach(e),this.physics.bounds.forEach(e),this.physics.fixedBalls.forEach(s=>{t.beginPath(),t.arc(s.x,s.y,s.r,0,Math.PI*2),t.fill()}),t.save(),t.lineWidth=2,this.physics.springs.forEach(s=>{if(s instanceof us.default&&!(s instanceof ge.default)){let n,a,o,h;s.pinned&&typeof s.pinned=="object"?(n=s.pinned.x,a=s.pinned.y,o=s.objects[0].pos.x,h=s.objects[0].pos.y):(n=s.objects[0].pos.x,a=s.objects[0].pos.y,o=s.objects[1].pos.x,h=s.objects[1].pos.y);let u=new st.default(o-n,h-a),r=u.copy;u.rotate(Math.PI/2),u.setMag(5);let l=new st.default(n,a),d=Math.floor(s.length/10);for(let g=1;g<=d;g+=1)t.strokeStyle=rt.blue,t.fillStyle=rt.blue,g===d&&(u=new st.default(0,0)),t.beginPath(),t.moveTo(l.x,l.y),t.lineTo(n+g/d*r.x+u.x,a+g/d*r.y+u.y),t.stroke(),l=new st.default(n+g/d*r.x+u.x,a+g/d*r.y+u.y),u.mult(-1)}else t.strokeStyle=rt.blue,t.fillStyle=rt.blue,t.beginPath(),t.moveTo(s.objects[0].pos.x,s.objects[0].pos.y),t.lineTo(typeof s.pinned=="object"?s.pinned.x:s.objects[1].pos.x,typeof s.pinned=="object"?s.pinned.y:s.objects[1].pos.y),t.stroke();s.objects.forEach(n=>{t.strokeStyle="black",t.fillStyle=rt.blue,t.beginPath(),t.arc(n.pos.x,n.pos.y,2.5,0,Math.PI*2),t.fill(),t.stroke()}),typeof s.pinned=="object"&&(t.strokeStyle="black",t.fillStyle=rt.blue,t.beginPath(),t.arc(s.pinned.x,s.pinned.y,3,0,Math.PI*2),t.fill(),t.stroke())}),t.restore(),this.physics.debugData.forEach(s=>{t.strokeStyle="red",t.beginPath(),t.moveTo(s.a.x,s.a.y),t.lineTo(s.b.x,s.b.y),t.stroke()})}};this.spawnNewtonsCradle=(t,e,s,n)=>{let a=[],o=25,h=250,u=8;a.push(new me.default(new st.default(t,e),new st.default(0,0),s*o,1,0,0));let r=1;for(let l=0;l<u-1;l+=1)a.push(new me.default(new st.default(t+r*s*o*1.01*2,e),new st.default(0,0),s*25,1,0,0)),r*=-1,r>0&&(r+=1),l===u-2&&(a[a.length-1].vel.x=-Math.sign(r)*s*o*8);a.forEach(l=>{n.addBall(l);let d=new ge.default(h);d.attachObject(l),d.pinHere(l.pos.x,l.pos.y-h),n.addSpring(d),d.lockRotation()})};this.modeButtonClicked=t=>{let e=t.target.id.replace("-btn",""),s=Rt.indexOf(e);this.switchToMode(s)};this.switchToMode=t=>{let e=document.getElementById(`${Rt[this.mode]}-btn`);e&&e.classList.remove("bg-pink-darker"),this.sidebar.innerHTML="";let s=document.getElementById(`${Rt[t]}-btn`);s&&s.classList.add("bg-pink-darker"),this.mode=t,this.sidebar.appendChild(mt[this.mode].element)};this.setupModes=()=>{let t=document.getElementById("button-holder");Rt.forEach((e,s)=>{let n=document.createElement("div");n.classList.add("big-button"),n.classList.add("fix-width"),n.id=`${e}-btn`,n.textContent=mt[s].name,n.onclick=this.modeButtonClicked,t&&t.appendChild(n)}),this.switchToMode(this.mode)};this.setTimeMultiplier=t=>{Number.isFinite(t)&&(this.timeMultiplier=t)};this.getTimeMultiplier=()=>this.timeMultiplier;this.setPhysics=t=>{t instanceof fe.default&&(this.physics=t)};this.getPhysics=()=>this.physics;this.physics=new fe.default,this.mouseX=0,this.mouseY=0,this.mouseDown=!1,this.defaultSize=30,this.k=.5,this.fc=2,this.springConstant=2e3,this.scaling=1,this.viewOffsetX=0,this.viewOffsetY=0,this.mode=0,this.lastX=0,this.lastY=0,this.timeMultiplier=1,this.lastFrameTime=performance.now(),this.choosed=!1,this.left=!1,this.right=!1,this.cnv=document.getElementById("defaulCanvas0"),this.canvasHolder=document.getElementById("canvas-holder"),this.sidebar=document.getElementById("sidebar"),this.physics.setBounds(0,0,this.cnv.width,this.cnv.height),this.physics.setGravity(new st.default(0,1e3)),this.physics.setAirFriction(.9),this.cnv.addEventListener("touchstart",this.startTouch,!1),this.cnv.addEventListener("touchend",this.endTouch,!1),this.cnv.addEventListener("touchmove",this.moveTouch,!1),this.cnv.addEventListener("mousedown",this.startMouse,!1),this.cnv.addEventListener("mouseup",this.endMouse,!1),this.cnv.addEventListener("mousemove",this.handleMouseMovement,!1),document.addEventListener("keydown",this.keyGotDown,!1),document.addEventListener("keyup",this.keyGotUp,!1),window.addEventListener("resize",this.resizeCanvas,!1),this.cnv.addEventListener("mousedown",()=>{this.mouseDown=!0},!1),this.cnv.addEventListener("mouseup",()=>{this.mouseDown=!1},!1),this.resizeCanvas(),this.setupModes(),zt(this),requestAnimationFrame(this.drawFunction)}},fs=ds;window.onload=()=>{window.editorApp=new fs};})();
//# sourceMappingURL=main.js.map

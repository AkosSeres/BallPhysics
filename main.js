(()=>{var T=(u,t)=>()=>(t||(t={exports:{}},u(t.exports,t)),t.exports),_=T((ss,oe)=>{var D=class{constructor(t,e){this.x=t,this.y=e}get copy(){return new D(this.x,this.y)}get length(){return Math.sqrt(this.x*this.x+this.y*this.y)}get sqlength(){return this.x*this.x+this.y*this.y}get heading(){if(this.x===0&&this.y===0)return 0;if(this.x===0)return this.y>0?Math.PI/2:1.5*Math.PI;if(this.y===0)return this.x>0?0:Math.PI;let t=D.normalized(this);return this.x>0&&this.y>0?Math.asin(t.y):this.x<0&&this.y>0?Math.asin(-t.x)+Math.PI/2:this.x<0&&this.y<0?Math.asin(-t.y)+Math.PI:this.x>0&&this.y<0?Math.asin(t.x)+1.5*Math.PI:0}add(t){this.x+=t.x,this.y+=t.y}sub(t){this.x-=t.x,this.y-=t.y}mult(t){this.x*=t,this.y*=t}div(t){this.x/=t,this.y/=t}lerp(t,e){this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e}dist(t){return new D(this.x-t.x,this.y-t.y).length}setMag(t){if(this.length===0)return;this.mult(t/this.length)}rotate(t){let e=this.heading,i=D.fromAngle(t+e);i.mult(this.length),this.x=i.x,this.y=i.y}static add(t,e){return new D(t.x+e.x,t.y+e.y)}static sub(t,e){return new D(t.x-e.x,t.y-e.y)}static mult(t,e){return new D(t.x*e,t.y*e)}static div(t,e){return new D(t.x/e,t.y/e)}static fromAngle(t){return new D(Math.cos(t),Math.sin(t))}static lerp(t,e,i){return D.add(t,D.mult(D.sub(e,t),i))}static dist(t,e){return D.sub(t,e).length}static dot(t,e){return t.x*e.x+t.y*e.y}static cross(t,e){return t.x*e.y-t.y*e.x}static angle(t,e){return Math.acos(D.dot(t,e)/Math.sqrt(t.sqlength*e.sqlength))}static angleACW(t,e){let i=t.heading,s=e.heading,n=s-i;return n<0?2*Math.PI+n:n}static normalized(t){let e=t.length;return e===0?t:new D(t.x/e,t.y/e)}toJSObject(){let t={};return t.x=this.x,t.y=this.y,t}static fromObject(t){return new D(t.x,t.y)}};oe.exports=D}),Gt=T((ns,le)=>{var L=_(),It=class{constructor(t,e,i,s,n,o){this.pos=t.copy,this.lastPos=this.pos.copy,this.r=i,this.fc=.4,this.amc=2/5,this.rotation=0,n?this.ang=n:this.ang=0,(o||o===0)&&(this.fc=o),s?this.k=s:this.k=.8,e!=null?this.vel=e.copy:this.vel=new L(0,0),this.id="_"+Math.random().toString(36).substr(2,9)}get m(){return this.r*this.r*Math.PI}get am(){return this.amc*this.r*this.r*this.m}getAmInPoint(t){let e=this.am;return e+=L.sub(this.pos,t).sqlength*this.m,e}get copy(){let t=new It(this.pos.copy,this.vel.copy,this.r,this.k,this.ang,this.fc);return t.lastPos=this.lastPos.copy,t.rotation=this.rotation,t}move(t,e){this.pos.x+=t,this.pos.y+=e}rotate(t){this.rotation+=t}collided(t){return this.pos.dist(t.pos)<this.r+t.r}static collide(t,e){if(!t.collided(e))return;let i=t.pos,s=e.pos,n=t.r,o=e.r,l=(t.k+e.k)/2,h=t.m,a=e.m,d=L.dist(i,s),f=(t.fc+e.fc)/2,y=i.copy,g=s.copy,p=n+o-d,w=L.sub(i,s);if(w.setMag(1),w.mult(p*a/(h+a)),y.add(w),w.setMag(1),w.mult(-p*h/(h+a)),g.add(w),t.pos=y,e.pos=g,L.dot(w,L.sub(t.vel,e.vel))<0)return;w.setMag(1);let S=L.cross(w,t.vel),M=L.cross(w,e.vel),m=L.dot(w,t.vel),b=L.dot(w,e.vel),I=n*t.ang,q=o*e.ang,j=S-I,P=M+q,x=1/(1/h+n*n/t.am),X=1/(1/a+o*o/e.am),V=(j*x+P*X)/(x+X),U=V-j,Q=V-P,C=U/n,H=Q/o,Yt=(1+l)*((h*m+a*b)/(h+a))-l*m,Ht=(1+l)*((h*m+a*b)/(h+a))-l*b;t.vel=L.mult(w,Yt),e.vel=L.mult(w,Ht);let kt=Yt-m,St=Ht-b,at=-Math.sign(U)*(kt*f)/(t.amc*n),ht=Math.sign(Q)*(St*f)/(e.amc*o);at/C>1&&(at=C),ht/H>1&&(ht=H),at*=t.amc/(t.amc+1),ht*=e.amc/(e.amc+1),t.ang-=at,e.ang+=ht;let Et=S+at*n,xt=M+ht*o;w.rotate(Math.PI/2),t.vel.add(L.mult(w,Et)),e.vel.add(L.mult(w,xt))}containsPoint(t){return L.dist(this.pos,t)<=this.r}toJSObject(){let t={};return t.pos=this.pos.toJSObject(),t.lastPos=this.lastPos.toJSObject(),t.r=this.r,t.fc=this.fc,t.amc=this.amc,t.rotation=this.rotation,t.ang=this.ang,t.fc=this.fc,t.k=this.k,t.vel=this.vel.toJSObject(),t.id=this.id,this.layer!=null&&(t.layer=this.layer),t}static fromObject(t){let e=new It(L.fromObject(t.pos),L.fromObject(t.vel),t.r,t.k,t.ang,t.fc);return e.lastPos=L.fromObject(t.lastPos),e.amc=t.amc,e.rotation=t.rotation,e.vel=L.fromObject(t.vel),e.id=t.id,t.layer!=null&&(e.layer=t.layer),e}};le.exports=It}),wt=T((os,re)=>{var K=_(),ae=class{constructor(t,e){this.a=t,this.b=e}get length(){return K.dist(this.a,this.b)}distFromPoint(t){let e=K.sub(this.a,this.b),i=K.sub(t,this.b),s=K.sub(t,this.a),n=i.length,o=s.length,l=e.length;if(l===0)return n;let h=K.angle(i,s),a=K.angle(i,e),d=Math.PI-h-a,f=Math.sin(d)*o*l/2,y=2*f/l;return d>Math.PI/2?o:a>Math.PI/2?n:y}static intersect(t,e){let i=K.sub(t.b,t.a),s=i.y/i.x,n=t.b.y-t.b.x*s,o=K.sub(e.b,e.a),l=o.y/o.x,h=e.b.y-e.b.x*l;if(i.x===0&&o.x!==0){if(t.a.x>=e.a.x&&t.a.x<=e.b.x||t.a.x<=e.a.x&&t.a.x>=e.b.x){let g=l*t.a.x+h;if(g>t.a.y&&g<t.b.y||g<t.a.y&&g>t.b.y)return new K(t.a.x,g)}return}if(o.x===0&&i.x!==0){if(e.a.x>=t.a.x&&e.a.x<=t.b.x||e.a.x<=t.a.x&&e.a.x>=t.b.x){let g=s*e.a.x+n;if(g>e.a.y&&g<e.b.y||g<e.a.y&&g>e.b.y)return new K(e.a.x,g)}return}if(i.x===0&&o.x===0){if(t.a.x===e.a.x){let g;t.a.y<t.b.y?g=[t.a.y,t.b.y]:g=[t.b.y,t.a.y];let p;e.a.y<e.b.y?p=[e.a.y,e.b.y]:p=[e.b.y,e.a.y];let w=[g[0]>p[0]?g[0]:p[0],g[1]<p[1]?g[1]:p[1]];if(w[0]<=w[1])return new K(t.a.x,(w[0]+w[1])/2)}return}let a;t.a.x<t.b.x?a=[t.a.x,t.b.x]:a=[t.b.x,t.a.x];let d;e.a.x<e.b.x?d=[e.a.x,e.b.x]:d=[e.b.x,e.a.x];let f=[a[0]>d[0]?a[0]:d[0],a[1]<d[1]?a[1]:d[1]];if(s===l&&n===h&&f[0]<=f[1])return new K((f[0]+f[1])/2,(f[0]+f[1])/2*s+n);let y=(h-n)/(s-l);return y>=f[0]&&y<=f[1]?new K(y,y*s+n):void 0}};re.exports=ae}),de=T((ls,he)=>{var W=_(),Ut=wt(),Vt=class{constructor(t){this.points=t;let e=this.points,i=0,s=0,n=W.angleACW(W.sub(e[1],e[0]),W.sub(e[e.length-1],e[0]));this.calculateCenterAndRadius(),i+=n,s+=Math.PI*2-n;for(let o=1;o<e.length-1;o++)n=W.angleACW(W.sub(e[(o+1)%e.length],e[o]),W.sub(e[o-1],e[o])),i+=n,s+=Math.PI*2-n;if(n=W.angleACW(W.sub(e[0],e[e.length-1]),W.sub(e[e.length-2],e[e.length-1])),i+=n,s+=Math.PI*2-n,s>i)return;{let o=[];for(let l=e.length-1;l>=0;l--)o.push(e[l]);this.points=o}}collideWithBall(t){let e,i;if(this.points.forEach((s,n)=>{let o=new W(s.x,s.y);o.x-=t.pos.x,o.y-=t.pos.y,o.mult(-1),o.length<=t.r&&(e=o.heading,i=o.length),o=new W(s.x,s.y);let l=new W(this.points[(n+1)%this.points.length].x,this.points[(n+1)%this.points.length].y),h=new W(t.pos.x,t.pos.y),a=new W(l.x-o.x,l.y-o.y),d=a.heading;o.rotate(-d+Math.PI),l.rotate(-d+Math.PI),h.rotate(-d+Math.PI);let f=h.y-(o.y+l.y)/2;f>=-t.r&&f<=t.r&&h.x>=l.x&&h.x<=o.x&&(e=d-Math.PI/2,i=f)}),e===0||e){let s=new W(t.pos.x,t.pos.y),n=new W(t.vel.x,t.vel.y);if(s.rotate(-e+Math.PI/2),n.rotate(-e+Math.PI/2),n.y>0)return;n.y*=-t.k,s.y+=t.r-i;let o=n.y*(1+1/t.k),l=Math.sign(n.x-t.ang*t.r)*(o*t.fc)/(t.amc*t.r),h=(n.x-t.ang*t.r)/t.r;l/h>1&&(l=h),t.ang+=l;let a=l*t.am/t.r/t.m;n.x-=a,s.rotate(e-Math.PI/2),n.rotate(e-Math.PI/2),t.pos.x=s.x,t.pos.y=s.y,t.vel.x=n.x,t.vel.y=n.y}}containsPoint(t){let e=this.sides,i=Math.max(...this.points.map(l=>W.dist(l,t)))+1,s=W.fromAngle(0);s.setMag(i);let n=new Ut(t,W.add(s,t)),o=e.filter(l=>Ut.intersect(l,n)!=null);return o.length%2==1}calculateCenterAndRadius(){this.center=this.points.reduce((t,e)=>W.add(t,e)),this.center.div(this.points.length),this.boundRadius=Math.max(this.points.map(t=>W.dist(t,this.center)))}get sides(){return this.points.map((t,e)=>new Ut(t,this.points[(e+1)%this.points.length]))}toJSObject(){let t={};return t.points=this.points.map(e=>({x:e.x,y:e.y})),t}static fromObject(t){let e=new Vt(t.points.map(i=>new W(v.x,v.y)));return e}};he.exports=Vt}),Kt=T((rs,ce)=>{var st=_(),Ot=class{constructor(t,e){this.length=t,this.springConstant=e,this.pinned=!1,this.objects=[],this.rotationLocked=!1,this.id="_"+Math.random().toString(36).substr(2,9)}pinHere(t,e){this.pinned={x:t,y:e}}unpin(){this.pinned=!1}attachObject(t){let e=this.objects;e.push(t),e.length===2&&(this.pinned=!1),e.length>=3&&(e=[e[e.length-2],e[e.length-1]])}lockRotation(){this.rotationLocked=!0}unlockRotation(){this.rotationLocked=!1}update(t){let e,i;if(this.pinned&&this.objects[0]){i=this.pinned,e=this.objects[0];let s=new st(i.x-e.pos.x,i.y-e.pos.y),n=s.length-this.length;s.setMag(1),s.mult(n*this.springConstant*t/e.m),e.vel.x+=s.x,e.vel.y+=s.y;let o=e.vel;if(o.rotate(-s.heading),this.rotationLocked){let l=new st(i.x,i.y),h=st.sub(e.pos,l),a=h.length*h.length*e.m+e.am,d=(e.am*e.ang-h.length*e.m*o.y)/a;o.y=-d*h.length,e.ang=d}o.rotate(s.heading)}else if(this.objects[0]&&this.objects[1]){e=this.objects[0],i=this.objects[1];let s=st.sub(e.pos,i.pos),n=s.length-this.length;s.setMag(1),s.mult(n*this.springConstant*t),i.vel.add(st.div(s,i.m)),e.vel.add(st.div(s,-e.m)),s=st.sub(e.pos,i.pos);let o=e.vel,l=i.vel;if(o.rotate(-s.heading),l.rotate(-s.heading),this.rotationLocked){let h=new st(e.pos.x*e.m+i.pos.x*i.m,e.pos.y*e.m+i.pos.y*i.m);h.div(e.m+i.m);let a=st.sub(e.pos,h),d=st.sub(i.pos,h),f=a.length*a.length*e.m+e.am+d.length*d.length*i.m+i.am,y=(o.y-l.y)*d.length/(a.length+d.length)+l.y,g=(e.am*e.ang+i.am*i.ang-a.length*e.m*(o.y-y)+d.length*i.m*(l.y-y))/f;o.y=-g*a.length+y,l.y=+g*d.length+y,e.ang=g,i.ang=g}o.rotate(s.heading),l.rotate(s.heading)}}toJSObject(){let t={};return t.length=this.length,t.springConstant=this.springConstant,t.pinned=this.pinned,t.rotationLocked=this.rotationLocked,t.id=this.id,t.objects=this.objects.map(e=>e.id),t.type=this.__proto__==Ot.prototype?"spring":"stick",t}static fromObject(t,e){let i=new ai,s=i.createStickOrSpring(t.type,t.length,t.springConstant);return s.pinned=t.pinned,s.rotationLocked=t.rotationLocked,s.id=t.id,s.objects=t.objects.map(n=>{let o=e.filter(l=>n==l.id);return o[0]}),s}};function ai(){this.createStickOrSpring=function(u,t,e){let i;if(u=="spring")i=new Ot(t,e);else if(u=="stick"){let s=Dt();i=new s(t)}return i}}ce.exports=Ot}),Dt=T((as,ue)=>{var lt=_(),hi=Kt(),fe=class extends hi{constructor(t){super(t,0);this.springConstant=0}update(t){let e,i;if(this.pinned&&this.objects[0]){i=this.pinned,e=this.objects[0];let s=new lt(i.x-e.pos.x,i.y-e.pos.y);s.setMag(1),s.mult(-this.length),e.move(-e.pos.x+i.x+s.x,-e.pos.y+i.y+s.y);let n=e.vel;if(n.rotate(-s.heading),n.x=0,this.rotationLocked){let o=new lt(i.x,i.y),l=lt.sub(e.pos,o),h=l.length*l.length*e.m+e.am,a=(e.am*e.ang-l.length*e.m*n.y)/h;n.y=-a*l.length,e.ang=a}n.rotate(s.heading)}else if(this.objects[0]&&this.objects[1]){e=this.objects[0],i=this.objects[1];let s=lt.sub(e.pos,i.pos),n=this.length-s.length;s.setMag(1);let o=lt.mult(s,n*i.m/(e.m+i.m)),l=lt.mult(s,-n*e.m/(e.m+i.m));e.move(o.x,o.y),i.move(l.x,l.y);let h=e.vel,a=i.vel;if(h.rotate(-s.heading),a.rotate(-s.heading),h.x=a.x=(e.m*h.x+i.m*a.x)/(e.m+i.m),this.rotationLocked){let d=new lt(e.pos.x*e.m+i.pos.x*i.m,e.pos.y*e.m+i.pos.y*i.m);d.div(e.m+i.m);let f=lt.sub(e.pos,d),y=lt.sub(i.pos,d),g=f.length*f.length*e.m+e.am+y.length*y.length*i.m+i.am,p=(h.y-a.y)*y.length/(f.length+y.length)+a.y,w=(e.am*e.ang+i.am*i.ang-f.length*e.m*(h.y-p)+y.length*i.m*(a.y-p))/g;h.y=-w*f.length+p,a.y=+w*y.length+p,e.ang=w,i.ang=w}h.rotate(s.heading),a.rotate(s.heading)}}};ue.exports=fe}),pe=T((hs,ge)=>{var O=_(),di=Gt(),ci=Dt(),nt=wt(),Lt=class{constructor(t,e,i,s,n){this.points=[],s||s===0?this.fc=s:this.fc=.4,this.pressure=i,n?this.resolution=n:this.resolution=30,e=Math.abs(e),this.r=e;let o=Math.random()*1e6;for(let l=0;l<this.resolution;l++){let h=new O(t.x,t.y);h.add(O.mult(O.fromAngle(l/this.resolution*Math.PI*2),e)),this.points.push(new di(h,new O(0,0),e*Math.sin(Math.PI/this.resolution),0,0,this.fc)),this.points[this.points.length-1].layer=o}this.sides=[];for(let l=0;l<this.resolution;l++){let h=new ci(2*e*Math.sin(Math.PI/this.resolution));h.attachObject(this.points[l]),h.attachObject(this.points[(l+1)%this.resolution]),l%2===0&&h.lockRotation(),this.sides.push(h)}}static updatePressureBasedForces(t,e){let i=[];if(i.push([]),t.points.forEach(o=>{i[0].push(new O(o.pos.x,o.pos.y))}),function(o){let l=O.angleACW(O.sub(o[1],o[0]),O.sub(o[o.length-1],o[0]));if(l>Math.PI)return!0;for(let h=1;h<o.length-1;h++)if(l=O.angleACW(O.sub(o[(h+1)%o.length],o[h]),O.sub(o[h-1],o[h])),l>Math.PI)return!0;return l=O.angleACW(O.sub(o[0],o[o.length-1]),O.sub(o[o.length-2],o[o.length-1])),l>Math.PI}(i[0])){let o=(a,d)=>{for(let f=0;f<a.length;f++)if(a[f]===d)return!0;return!1},l=function(a,d,f){for(let y=0;y<d.length;y++)if(!o(f,y)){let g=new nt(new O(d[y].x,d[y].y),new O(d[(y+1)%d.length].x,d[(y+1)%d.length].y));if(nt.intersect(a,g))return!0}return!1},h=!0;t:for(;h;){h=!1;for(let a=0;a<i.length;a++){let d=i[a],f=O.sub(d[1],d[0]),y=O.sub(d[d.length-1],d[0]),g=O.angleACW(f,y);if(g>Math.PI){h=!0;let p=0,w=p+2,S=new nt(new O(d[p].x,d[p].y),new O(d[w%d.length].x,d[w%d.length].y)),M=new O(S.b.x-S.a.x,S.b.y-S.a.y).heading;for(;!(f.heading>y.heading?M>f.heading&&M<2*Math.PI||M>0&&M<y.heading:M>f.heading&&M<y.heading)||l(new nt(new O(d[p%d.length].x,d[p%d.length].y),new O(d[w%d.length].x,d[w%d.length].y)),d,[(d.length-1)%d.length,p%d.length,(w-1)%d.length,w%d.length]);)w++,S=new nt(new O(d[p].x,d[p].y),new O(d[w%d.length].x,d[w%d.length].y)),M=new O(S.b.x-S.a.x,S.b.y-S.a.y).heading;let m=[],b=[];for(let I=p;I<=w;I++)m.push(d[I%d.length]);for(let I=w;I<=p+d.length;I++)b.push(d[I%d.length]);i[a]=m,i.push(b);continue t}for(let p=1;p<d.length;p++){let w=O.sub(d[(p+1)%d.length],d[p]),S=O.sub(d[p-1],d[p]),M=O.angleACW(w,S);if(M>Math.PI){h=!0;let m=p+2,b=new nt(new O(d[p].x,d[p].y),new O(d[m%d.length].x,d[m%d.length].y)),I=new O(b.b.x-b.a.x,b.b.y-b.a.y).heading;for(;!(w.heading>S.heading?I>w.heading&&I<2*Math.PI||I>0&&I<S.heading:I>w.heading&&I<S.heading)||l(b,d,[(p-1)%d.length,p%d.length,(m-1)%d.length,m%d.length]);)m++,b=new nt(new O(d[p].x,d[p].y),new O(d[m%d.length].x,d[m%d.length].y)),I=new O(b.b.x-b.a.x,b.b.y-b.a.y).heading;let q=[],j=[];for(let P=p;P<=m;P++)q.push(d[P%d.length]);for(let P=m;P<=p+d.length;P++)j.push(d[P%d.length]);i[a]=q,i.push(j);continue t}}}}}for(let o=i.length-1;o>=0;o--){let l=i[o];for(;l.length>3;)i.push([l[0],l[1],l[2]]),l.splice(1,1)}let s=0;i.forEach(o=>{let l=Math.sqrt(Math.pow(o[0].x-o[1].x,2)+Math.pow(o[0].y-o[1].y,2)),h=Math.sqrt(Math.pow(o[1].x-o[2].x,2)+Math.pow(o[1].y-o[2].y,2)),a=Math.sqrt(Math.pow(o[2].x-o[0].x,2)+Math.pow(o[2].y-o[0].y,2)),d=(l+h+a)/2,f=Math.sqrt(d*(d-l)*(d-h)*(d-a));s+=f});let n=t.pressure*(t.r*t.r*Math.PI/s)-t.pressure;t.sides.forEach(o=>{let l=O.sub(o.objects[0].pos,o.objects[1].pos);l.mult(n),l.rotate(Math.PI/2),l.mult(e),o.objects[0].vel.add(O.div(l,o.objects[0].m)),o.objects[1].vel.add(O.div(l,o.objects[1].m))})}get sideSegments(){return this.points.map((t,e)=>new nt(t.pos,this.points[(e+1)%this.points.length].pos))}containsPoint(t){let e=this.sideSegments,i=Math.max(...this.points.map(l=>O.dist(l.pos,t)))+1,s=O.fromAngle(0);s.setMag(i);let n=new nt(t,O.add(s,t)),o=e.filter(l=>nt.intersect(l,n)!=null);return o.length%2==1}toJSObject(){let t={};return t.pressure=this.pressure,t.fc=this.fc,t.r=this.r,t.resolution=this.resolution,t.points=this.points.map(e=>e.id),t.sides=this.sides.map(e=>e.id),t}static fromObject(t,e,i){let s=Object.create(Lt.prototype);return console.log(s),s.pressure=t.pressure,s.fc=t.fc,s.resolution=t.resolution,s.r=t.r,s.points=t.points.map(n=>{let o=e.filter(l=>n==l.id);return o[0]}),s.sides=t.sides.map(n=>{let o=i.filter(l=>n==l.id);return o[0]}),s}};ge.exports=Lt}),we=T((ds,ye)=>{var c=_(),R=wt(),jt=class{constructor(t,e,i,s,n){this.points=t;let o=this.points,l=0,h=0,a=c.angleACW(c.sub(o[1],o[0]),c.sub(o[o.length-1],o[0]));l+=a,h+=Math.PI*2-a;for(let d=1;d<o.length-1;d++)a=c.angleACW(c.sub(o[(d+1)%o.length],o[d]),c.sub(o[d-1],o[d])),l+=a,h+=Math.PI*2-a;if(a=c.angleACW(c.sub(o[0],o[o.length-1]),c.sub(o[o.length-2],o[o.length-1])),l+=a,h+=Math.PI*2-a,h<l){let d=[];for(let f=o.length-1;f>=0;f--)d.push(o[f]);this.points=d}this.calculatePosAndMass(),this.lastPos=this.pos.copy,this.fc=.4,this.rotation=0,s?this.ang=s:this.ang=0,(n||n===0)&&(this.fc=n),i?this.k=i:this.k=.8,e!=null?this.vel=e.copy:this.vel=new c(0,0),this.id="_"+Math.random().toString(36).substr(2,9)}getAmInPoint(t){let e=this.am;return e+=c.sub(this.pos,t).sqlength*this.m,e}get copy(){let t=[];for(let i=0;i<this.points.length;i++)t.push(new c(this.points[i].x,this.points[i].y));let e=new jt(t,this.vel.copy,this.k,this.ang,this.fc);return e.rotation=this.rotation,e.lastPos=this.lastPos.copy,e.pos=this.pos.copy,e}move(t,e){this.pos.x+=t,this.pos.y+=e,this.points.forEach(i=>{i.x+=t,i.y+=e})}collideWithBall(t){let e,i,s;if(c.dist(t.pos,this.pos)>t.r+this.boundRadius)return;if(this.points.forEach((n,o)=>{let l=new c(n.x,n.y);if(l.x-=t.pos.x,l.y-=t.pos.y,l.length<=t.r){e=l.heading+Math.PI,i=l.length;let g=c.fromAngle(e);g.mult(t.r-i),this.move(g.x*-1*t.m/(this.m+t.m),g.y*-1*t.m/(this.m+t.m)),t.move(g.x*1*this.m/(this.m+t.m),g.y*1*this.m/(this.m+t.m)),s=new c(n.x,n.y);let p=c.fromAngle(e);p.mult(-30)}l=new c(n.x,n.y);let h=new c(this.points[(o+1)%this.points.length].x,this.points[(o+1)%this.points.length].y),a=new c(t.pos.x,t.pos.y),d=new c(h.x-l.x,h.y-l.y),f=d.heading;l.rotate(-f+Math.PI),h.rotate(-f+Math.PI),a.rotate(-f+Math.PI);let y=a.y-(l.y+h.y)/2;if(y>=-t.r&&y<=t.r&&a.x>=h.x&&a.x<=l.x){e=f-Math.PI/2,i=y;let g=c.fromAngle(e);g.mult(t.r-i),this.move(g.x*-1*t.m/(this.m+t.m),g.y*-1*t.m/(this.m+t.m)),t.move(g.x*1*this.m/(this.m+t.m),g.y*1*this.m/(this.m+t.m)),s=t.pos.copy,s.add(c.mult(c.fromAngle(e+Math.PI),y));let p=c.fromAngle(e);p.mult(-30)}}),e===0||e){let n=this.vel.copy,o=t.vel.copy,l=this.ang,h=t.ang,a=c.sub(s,this.pos),d=c.sub(s,t.pos),f=this.am,y=t.am,g=this.m,p=t.m,w=(this.k+t.k)/2,S=(this.fc+t.fc)/2,M=a.copy,m=d.copy;M.rotate(Math.PI/2),m.rotate(-Math.PI/2),M.mult(l),m.mult(h),M.add(n),m.add(o),M.rotate(-e),m.rotate(-e);let b=(1+w)*(g*M.x+p*m.x)/(g+p)-(w+1)*M.x,I=(1+w)*(g*M.x+p*m.x)/(g+p)-(w+1)*m.x,q=(M.y*g+m.y*p)/(g+p),j=-Math.sign(M.y)*S*b,P=-Math.sign(m.y)*S*I;Math.abs(q-M.y)>Math.abs(j)&&(j=q-M.y),Math.abs(q-m.y)>Math.abs(P)&&(P=q-m.y);let x=new c(b,j),X=new c(I,P);x.rotate(e),X.rotate(e),n.add(x),o.add(X),x.rotate(-a.heading),X.rotate(-d.heading);let V=x.y*g*a.length/(f+a.length*a.length*g),U=-(X.y*p*d.length)/(y+d.length*d.length*p);l+=V,h+=U;let Q=c.fromAngle(a.heading-Math.PI/2);Q.mult(a.length*V);let C=c.fromAngle(d.heading-Math.PI/2);C.mult(d.length*U),o.sub(C),n.add(Q),this.vel=n,t.vel=o,this.ang=l,t.ang=h}}calculatePosAndMass(){let t=[];if(t.push([]),this.points.forEach(n=>{t[0].push(new c(n.x,n.y))}),this.isConcave){let n=(h,a)=>{for(let d=0;d<h.length;d++)if(h[d]===a)return!0;return!1},o=function(h,a,d){for(let f=0;f<a.length;f++)if(!n(d,f)){let y=new R(new c(a[f].x,a[f].y),new c(a[(f+1)%a.length].x,a[(f+1)%a.length].y));if(R.intersect(h,y))return!0}return!1},l=!0;t:for(;l;){l=!1;for(let h=0;h<t.length;h++){let a=t[h],d=c.sub(a[1],a[0]),f=c.sub(a[a.length-1],a[0]),y=c.angleACW(d,f);if(y>Math.PI){l=!0;let g=0,p=g+2,w=new R(new c(a[g].x,a[g].y),new c(a[p%a.length].x,a[p%a.length].y)),S=new c(w.b.x-w.a.x,w.b.y-w.a.y).heading;for(;!(d.heading>f.heading?S>d.heading&&S<2*Math.PI||S>0&&S<f.heading:S>d.heading&&S<f.heading)||o(new R(new c(a[g%a.length].x,a[g%a.length].y),new c(a[p%a.length].x,a[p%a.length].y)),a,[(a.length-1)%a.length,g%a.length,(p-1)%a.length,p%a.length]);)p++,w=new R(new c(a[g].x,a[g].y),new c(a[p%a.length].x,a[p%a.length].y)),S=new c(w.b.x-w.a.x,w.b.y-w.a.y).heading;let M=[],m=[];for(let b=g;b<=p;b++)M.push(a[b%a.length]);for(let b=p;b<=g+a.length;b++)m.push(a[b%a.length]);t[h]=M,t.push(m);continue t}for(let g=1;g<a.length;g++){let p=c.sub(a[(g+1)%a.length],a[g]),w=c.sub(a[g-1],a[g]),S=c.angleACW(p,w);if(S>Math.PI){l=!0;let M=g+2,m=new R(new c(a[g].x,a[g].y),new c(a[M%a.length].x,a[M%a.length].y)),b=new c(m.b.x-m.a.x,m.b.y-m.a.y).heading;for(;!(p.heading>w.heading?b>p.heading&&b<2*Math.PI||b>0&&b<w.heading:b>p.heading&&b<w.heading)||o(m,a,[(g-1)%a.length,g%a.length,(M-1)%a.length,M%a.length]);)M++,m=new R(new c(a[g].x,a[g].y),new c(a[M%a.length].x,a[M%a.length].y)),b=new c(m.b.x-m.a.x,m.b.y-m.a.y).heading;let I=[],q=[];for(let j=g;j<=M;j++)I.push(a[j%a.length]);for(let j=M;j<=g+a.length;j++)q.push(a[j%a.length]);t[h]=I,t.push(q);continue t}}}}}for(let n=t.length-1;n>=0;n--){let o=t[n];for(;o.length>3;)t.push([o[0],o[1],o[2]]),o.splice(1,1)}let e=0,i=0,s=new c(0,0);t.forEach(n=>{let o=Math.sqrt(Math.pow(n[0].x-n[1].x,2)+Math.pow(n[0].y-n[1].y,2)),l=Math.sqrt(Math.pow(n[1].x-n[2].x,2)+Math.pow(n[1].y-n[2].y,2)),h=Math.sqrt(Math.pow(n[2].x-n[0].x,2)+Math.pow(n[2].y-n[0].y,2)),a=(o+l+h)/2,d=Math.sqrt(a*(a-o)*(a-l)*(a-h));e+=d,s.x+=d*(n[0].x+n[1].x+n[2].x)/3,s.y+=d*(n[0].y+n[1].y+n[2].y)/3}),s.div(e),this.pos=s,this.m=e;for(let n of t){let o=Math.sqrt(Math.pow(n[0].x-n[1].x,2)+Math.pow(n[0].y-n[1].y,2)),l=Math.sqrt(Math.pow(n[1].x-n[2].x,2)+Math.pow(n[1].y-n[2].y,2)),h=Math.sqrt(Math.pow(n[2].x-n[0].x,2)+Math.pow(n[2].y-n[0].y,2)),a=Math.max(o,l,h),d=(o+l+h)/2,f=Math.sqrt(d*(d-o)*(d-l)*(d-h)),y=2*f/a,g=Math.sqrt(Math.min(o,h,l)**2-y*y),p=y*a*(y*y+a*a)/24,w=Math.sqrt(y*y/36+(Math.abs(g-a/2)/3)**2);p-=w*w*f,p+=new c((n[0].x+n[1].x+n[2].x)/3,(n[0].y+n[1].y+n[2].y)/3).dist(this.pos)**2*f,i+=p}this.am=i,this.boundRadius=Math.max(...this.points.map(n=>c.dist(n,this.pos)))}rotate(t){this.points.forEach(e=>{let i=new c(e.x,e.y);i.sub(this.pos),i.rotate(t),i.add(this.pos),e.x=i.x,e.y=i.y}),this.rotation+=t}get isConcave(){let t=this.points,e=c.angleACW(c.sub(t[1],t[0]),c.sub(t[t.length-1],t[0]));if(e>Math.PI)return!0;for(let i=1;i<t.length-1;i++)if(e=c.angleACW(c.sub(t[(i+1)%t.length],t[i]),c.sub(t[i-1],t[i])),e>Math.PI)return!0;return e=c.angleACW(c.sub(t[0],t[t.length-1]),c.sub(t[t.length-2],t[t.length-1])),e>Math.PI}static collide(t,e){let i=0,s=0,n=new c(0,0),o=[],l=!1;if(t.points.forEach((P,x)=>{let X=new R(new c(P.x,P.y),new c(t.points[(x+1)%t.points.length].x,t.points[(x+1)%t.points.length].y));e.points.forEach((V,U)=>{let Q=new R(new c(V.x,V.y),new c(e.points[(U+1)%e.points.length].x,e.points[(U+1)%e.points.length].y)),C=R.intersect(X,Q);C&&(i++,n.add(C),o.push(C),l=!0)})}),!l)return;n.div(i);for(let P=0;P<Math.floor(i/2);P++)s+=c.sub(o[2*P+1],o[2*P]).heading;s/=i/2,s+=Math.PI/2;let h=c.fromAngle(s),a=t.ang,d=t.vel.copy,f=e.ang,y=e.vel.copy,g=0,p=0,w=0,S=0;for(let P of t.points)g=Math.min(c.dot(h,c.sub(new c(P.x,P.y),n)),g),p=Math.max(c.dot(h,c.sub(new c(P.x,P.y),n)),p);for(let P of e.points)w=Math.min(c.dot(h,c.sub(new c(P.x,P.y),n)),w),S=Math.max(c.dot(h,c.sub(new c(P.x,P.y),n)),S);Math.abs(g-S)<Math.abs(w-p)?(t.move(-h.x*g,-h.y*g),e.move(-h.x*S,-h.y*S)):(t.move(-h.x*p,-h.y*p),e.move(-h.x*w,-h.y*w));let M=(t.k+e.k)/2,m=o,b=[],I=[],q=[],j=[];for(let P of m){let x=c.fromAngle(s),X=t.vel,V=e.vel,U=t.pos,Q=e.pos,C=c.sub(U,P),H=c.sub(Q,P),Yt=c.angleACW(x,C),Ht=c.angleACW(x,H),kt=c.angle(x,C),St=c.angle(x,H),at=X.copy,ht=V.copy,Et=C.copy,xt=H.copy;Et.mult(-1*t.ang),xt.mult(-1*e.ang),xt.rotate(Math.PI/2),xt.rotate(Math.PI/2),at.add(Et),ht.add(xt);let et=c.dot(x,at),it=c.dot(x,ht);if(c.dot(x,C)>c.dot(x,H)){if(et>=it)return}else if(it>=et)return;let Tt=t.m*Math.abs(Math.cos(kt))+Math.abs(Math.sin(kt))*t.am/C.length/C.length,Wt=e.m*Math.abs(Math.cos(St))+Math.abs(Math.sin(St))*e.am/H.length/H.length,ft=(1+M)*((Tt*et+Wt*it)/(Tt+Wt))-M*et,gt=(1+M)*((Tt*et+Wt*it)/(Tt+Wt))-M*it,Z,$;c.dot(x,C)>c.dot(x,H)?(gt>=ft,Z=c.mult(c.normalized(x),-ft+et),$=c.mult(c.normalized(x),-gt+it)):(gt<=ft,Z=c.mult(c.normalized(x),-ft+et),$=c.mult(c.normalized(x),-gt+it)),Z=c.mult(c.normalized(x),ft-et),$=c.mult(c.normalized(x),gt-it);let vt=Z.copy,bt=$.copy;Z.mult(Math.cos(kt)),$.mult(Math.cos(St)),c.dot(Z,C)<0&&Z.mult(-1),c.dot($,H)<0&&$.mult(-1),t.vel.add(Z),e.vel.add($),vt.sub(c.mult(x,c.dot(x,Z))),vt.div(C.length),vt.rotate(Math.PI/2),vt=c.dot(vt,C)/C.length,t.ang+=vt,bt.sub(c.mult(x,c.dot(x,$))),bt.div(H.length),bt.rotate(Math.PI/2),bt=c.dot(bt,H)/H.length,e.ang+=bt,b.push(t.ang),q.push(t.vel),I.push(e.ang),j.push(e.vel),t.ang=a,t.vel=d,e.ang=f,e.vel=y;break}if(b.length!=q.length)return;if(b.length==0)return;if(q.length==0)return;if(I.length!=j.length)return;if(I.length==0)return;if(j.length==0)return;t.vel=q.reduce((P,x)=>c.add(P,x)),t.vel.div(q.length),t.ang=b.reduce((P,x)=>P+x),t.ang/=b.length,e.vel=j.reduce((P,x)=>c.add(P,x)),e.vel.div(j.length),e.ang=I.reduce((P,x)=>P+x),e.ang/=I.length}collideWithFixedBall(t){let e=new c(t.x,t.y),i;if(c.dist(e,this.pos)>this.boundRadius+t.r)return;for(let I of this.sides){let q,j;if(q=c.angle(c.sub(I.a,I.b),c.sub(e,I.b)),j=c.angle(c.sub(I.b,I.a),c.sub(e,I.a)),q<Math.PI/2&&j<Math.PI/2){let P=I.distFromPoint(e);if(P<=t.r){let x=c.sub(I.a,I.b);x.rotate(Math.PI/2),x.setMag(t.r*2);let X=c.mult(x,-1),V=new R(c.add(x,e),c.add(X,e));i=R.intersect(V,I),i!=null&&(x=c.sub(i,e),x.setMag(t.r-x.length),this.move(x.x,x.y))}}}if(!i||i==null){t:for(let I of this.points)if(c.dist(I,e)<t.r){let q=c.sub(I,e);q.setMag(t.r-q.length),this.move(q.x,q.y),q.setMag(t.r),i=c.add(e,q);break t}}if(!i||i==null)return;let s=this.vel,n=this.pos,o=c.sub(i,e);o.setMag(1);let l=c.sub(n,i),h=c.angleACW(o,l),a=s.copy,d=l.copy;d.mult(-1*this.ang),d.rotate(Math.PI/2),a.add(d);let f=c.dot(o,a);if(f>=0)return;f*=1+this.k;let y=c.mult(c.normalized(o),-1*f),g=y.copy;y.mult(Math.cos(h)),this.vel.add(y),g=g.length/l.length,g*=Math.sin(h),this.ang+=g;let p=this.m*Math.abs(Math.cos(h))+this.am/l.length/l.length*Math.abs(Math.sin(h)),w=this.m*Math.abs(Math.sin(h))+this.am/l.length/l.length*Math.abs(Math.cos(h));y=c.mult(c.normalized(o),-1*f);let S=o.copy;if(S.rotate(Math.PI/2),S.mult(Math.sign(c.dot(S,a))),S.length==0)return;let M=c.dot(a,S),m=c.mult(y,p),b=c.div(m,w);w==0&&(b=0),b.mult(this.fc),b=c.mult(S,b.length),b.length>M&&b.setMag(M),h=c.angleACW(S,l),y=b,g=y.copy,y.mult(Math.cos(h)),this.vel.add(y),g=g.length/l.length,g*=Math.sin(h),this.ang-=g}collideWithWall(t){if(this.boundRadius+t.boundRadius<c.dist(this.pos,t.center))return;let e=this.sides,i=[],s=[];for(let p of e)for(let w of t.sides){let S=R.intersect(p,w);S!=null&&s.push(S)}if(s.length<2)return;let n=this.vel.copy,o=this.ang,l=[],h=[],a=c.sub(...s);a.rotate(Math.PI/2);let d=c.sub(s[0],this.pos);c.dot(a,d)>0&&a.mult(-1),a.setMag(1),c.dot(a,c.sub(this.pos,t.center))<0&&a.mult(-1),i.push(new R(...s)),i.push(new R(s[0],c.add(s[0],c.mult(a,20)))),i.push(new R(s[1],c.add(s[1],c.mult(a,20))));let f=[],y=s[0];for(let p of t.points){let w=c.sub(p,y),S=c.dot(w,a);S>0&&f.push(S)}if(f.length>0){let p=a.copy;p.mult(Math.max(...f)),this.move(p.x,p.y)}f=[];let g=c.add(...s);if(g.div(2),this.containsPoint(g))for(let p of e)f.push(p.distFromPoint(g));if(f.length>0){let p=a.copy;p.mult(Math.min(...f)),p.length<this.boundRadius/2&&this.move(p.x,p.y)}for(let p of s){let w=this.vel,S=this.pos,M=c.sub(S,p),m=c.angleACW(a,M),b=w.copy,I=M.copy;I.mult(-1*this.ang),I.rotate(Math.PI/2),b.add(I);let q=c.dot(a,b);if(q>=0)return;q*=1+this.k;let j=c.mult(c.normalized(a),-1*q),P=j.copy;j.mult(Math.cos(m)),this.vel.add(j),P=P.length/M.length,P*=Math.sin(m),this.ang+=P;let x=this.m*Math.abs(Math.cos(m))+this.am/M.length/M.length*Math.abs(Math.sin(m)),X=this.m*Math.abs(Math.sin(m))+this.am/M.length/M.length*Math.abs(Math.cos(m));j=c.mult(c.normalized(a),-1*q);let V=a.copy;if(V.rotate(Math.PI/2),V.mult(Math.sign(c.dot(V,b))),V.length==0)return;let U=c.dot(b,V),Q=c.mult(j,x),C=c.div(Q,X);X==0&&(C=0),C.mult(this.fc),C=c.mult(V,C.length),C.length>U&&C.setMag(U),m=c.angleACW(V,M),j=C,P=j.copy,j.mult(Math.cos(m)),this.vel.add(j),P=P.length/M.length,P*=Math.sin(m),this.ang-=P,l.push(this.vel),this.vel=n.copy,h.push(this.ang),this.ang=o}return h.length!=l.length||(h.length==0||l.length==0)?void 0:(this.vel=l.reduce((p,w)=>c.add(p,w)),this.vel.div(l.length),this.ang=h.reduce((p,w)=>p+w),this.ang/=h.length,(!isFinite(this.vel.x)||!isFinite(this.vel.y)||!isFinite(this.ang))&&(this.vel=n,this.ang=o),i)}containsPoint(t){let e=this.sides,i=Math.max(...this.points.map(l=>c.dist(l,t)))+1,s=c.fromAngle(0);s.setMag(i);let n=new R(t,c.add(s,t)),o=e.filter(l=>R.intersect(l,n)!=null);return o.length%2==1}get sides(){return this.points.map((t,e)=>new R(t,this.points[(e+1)%this.points.length]))}toJSObject(){let t={};return t.points=this.points.map(e=>({x:e.x,y:e.y})),t.vel=this.vel.toJSObject(),t.k=this.k,t.ang=this.ang,t.fc=this.fc,t.pos=this.pos.toJSObject(),t.lastPos=this.lastPos.toJSObject(),t.rotation=this.rotation,t.id=this.id,t}static fromObject(t){let e=new jt(t.points.map(i=>({x:i.x,y:i.y})),c.fromObject(t.vel),t.k,t.ang,t.fc);return e.id=t.id,e.pos=c.fromObject(t.pos),e.lastPos=c.fromObject(t.lastPos),e.rotation=t.rotation,e}};ye.exports=jt}),Qt=T((cs,me)=>{var G=_(),ui=wt(),xe=class extends ui{constructor(t,e){super(t,e)}get length(){return Number.POSITIVE_INFINITY}distFromPoint(t){let e=G.sub(this.a,this.b);e.setMag(1),e.rotate(Math.PI/2);let i=G.sub(t,this.a),s=Math.abs(G.dot(i,e));return s}static intersect(t,e){let i=G.sub(t.b,t.a),s=i.y/i.x,n=t.b.y-t.b.x*s,o=G.sub(e.b,e.a),l=o.y/o.x,h=e.b.y-e.b.x*l;if(s===l)return t.distFromPoint(e.a)==0?new G((t.a.x+t.b.x+e.a.x+e.b.x)/4,(t.a.y+t.b.y+e.a.y+e.b.y)/4):void 0;{let a=(h-n)/(s-l);return new G(a,s*a+n)}}static intersectWithLineSegment(t,e){let i=G.sub(t.b,t.a),s=i.y/i.x,n=t.b.y-t.b.x*s,o=G.sub(e.b,e.a),l=o.y/o.x,h=e.b.y-e.b.x*l;if(i.x===0){if(o.x===0)return t.a.x==e.a.x?new G((e.a.x+e.b.x)/2,(e.a.y+e.b.y)/2):void 0;let a=t.a.x,d=l*a+h;return Math.min(e.a.x,e.b.x)<a&&a<Math.max(e.a.x,e.b.x)&&Math.min(e.a.y,e.b.y)<d&&Math.max(e.a.y,e.b.y)>d?new G(a,d):void 0}if(o.x===0){let a=e.a.x,d=s*a+n;return Math.min(e.a.x,e.b.x)<a&&a<Math.max(e.a.x,e.b.x)&&Math.min(e.a.y,e.b.y)<d&&Math.max(e.a.y,e.b.y)>d?new G(a,d):void 0}if(s===l)return t.distFromPoint(e.a)===0?new G((e.a.x+e.b.x)/2,(e.a.y+e.b.y)/2):void 0;{let a=(h-n)/(s-l),d=s*a+n;return Math.min(e.a.x,e.b.x)<a&&a<Math.max(e.a.x,e.b.x)&&Math.min(e.a.y,e.b.y)<d&&Math.max(e.a.y,e.b.y)>d?new G(a,d):void 0}}};me.exports=xe}),be=T((us,ve)=>{var F=_(),At=wt(),Rt=Qt(),ot=class{constructor(t){if(t.length<3)throw new Error("Not enough points in polygon (minimum required: 3)");this.points=t,this.makeAntiClockwise()}getSideVector(t){return t<0&&(t+=Math.abs(Math.floor(t))*this.points.length),F.sub(this.points[(t+1)%this.points.length],this.points[t%this.points.length])}getSideSegment(t){return t<0&&(t+=Math.abs(Math.floor(t))*this.points.length),new At(this.points[(t+1)%this.points.length],this.points[t%this.points.length])}getSideLine(t){return t<0&&(t+=Math.abs(Math.floor(t))*this.points.length),new Rt(this.points[(t+1)%this.points.length],this.points[t%this.points.length])}get sides(){return this.points.length}makeAntiClockwise(){let t=0;for(let e=1;e<=this.sides;e++){let i=this.getSideVector(e),s=this.getSideVector(e-1);s.mult(-1),t+=F.angleACW(i,s)}if(this.sides===3)t>Math.PI*1.5&&this.reverseOrder();else if(this.sides===4)F.angleACW(this.getSideVector(1),this.getSideVector(0))>=Math.PI&&this.reverseOrder();else if(this.sides>4){let e=t-this.sides*Math.PI;e>0&&this.reverseOrder()}}reverseOrder(){this.points=this.points.reverse()}isPointInside(t){if(F.dist(t,this.centerPoint)>this.boundRadius)return!1;let e=this.centerPoint.copy;e.add(F.mult(new F(1.1,.6),this.boundRadius));let i=new At(t,e),s=0;if([...Array(this.sides).keys()].map(n=>this.getSideSegment(n)).forEach(n=>{At.intersect(n,i)&&s++}),s%2==0)return!1;if(s%2==1)return!0}get centerPoint(){let t=new F(0,0);return this.points.forEach(e=>{t.add(e)}),t.div(this.sides),t}get boundRadius(){let t=this.centerPoint;return Math.max(...this.points.map(e=>F.dist(e,t)))}get allSides(){return[...Array(this.sides).keys()].map(t=>this.getSideSegment(t))}static intersection(t,e){if(F.dist(t.centerPoint,e.centerPoint)>t.boundRadius+e.boundRadius)return;let i=[],s=t.allSides,n=e.allSides;if(s.forEach((f,y)=>{n.forEach((g,p)=>{let w=At.intersect(f,g);w&&(w.isIntersectionPoint=!0,i.push({intersectionPoint:w,sideNumber1:y,sideNumber2:p}))})}),i.length===0){if(t.isPointInside(e.points[0]))return new ot(e.points.map(f=>f.copy));if(e.isPointInside(t.points[0]))return new ot(t.points.map(f=>f.copy))}let o=new ot(t.points.map(f=>f.copy));for(let f=o.points.length-1;f>=0;f--){let y=i.filter(g=>g.sideNumber1==f);y.length>1&&y.sort((g,p)=>F.dist(o.points[f],g.intersectionPoint)-F.dist(o.points[f],p.intersectionPoint)),y.length>0&&o.points.splice(f+1,0,...y.map(g=>g.intersectionPoint))}let l=new ot(e.points.map(f=>f.copy));for(let f=l.points.length-1;f>=0;f--){let y=i.filter(g=>g.sideNumber2==f);y.length>1&&y.sort((g,p)=>F.dist(l.points[f],g.intersectionPoint)-F.dist(l.points[f],p.intersectionPoint)),y.length>0&&l.points.splice(f+1,0,...y.map(g=>g.intersectionPoint))}let h={polyNum:1,pointNum:0};for(let f=0;f<o.points.length;f++)if(o.points[f].isIntersectionPoint){h.pointNum=f;break}else if(l.isPointInside(o.points[f])){h.pointNum=f;break}let a=!1,d=[];for(;!a;){let f=h.polyNum===1?o:l,y=h.polyNum===1?l:o;if(d.push(f.points[h.pointNum%f.points.length].copy),d.length>2&&d[0].x==d[d.length-1].x&&d[0].y==d[d.length-1].y){d.pop();break}if(d.length>o.points.length+l.points.length)break;f.points[h.pointNum%f.points.length].isIntersectionPoint?f.points[(h.pointNum+1)%f.points.length].isIntersectionPoint||y.isPointInside(f.points[(h.pointNum+1)%f.points.length])&&!f.points[(h.pointNum+1)%f.points.length].isIntersectionPoint?h.pointNum++:(h.pointNum=y.points.indexOf(f.points[h.pointNum%f.points.length])+1,h.polyNum=h.polyNum===1?2:1):h.pointNum++}return new ot(d)}static createCircle(t,e,i=25){let s=[...Array(i).keys()].map(n=>{let o=F.fromAngle(2*Math.PI*n/i);return o.setMag(t),o.add(e),o});return new ot(s)}static fracture(t,e=500){let i=t.map((s,n)=>{let o=[];for(let h=0;h<t.length;h++){if(n===h)continue;let a=t[h],d=F.div(F.add(s,a),2),f=F.sub(s,a);f.rotate(Math.PI/2),o.push(new Rt(d,F.add(f,d)))}o=o.filter((h,a)=>{let d=new At(h.a,s);for(let f=0;f<o.length;f++){if(a===f)continue;let y=Rt.intersectWithLineSegment(o[f],d);if(y)return!1}return!0}),o=o.sort((h,a)=>F.sub(h.a,h.b).heading-F.sub(a.a,a.b).heading);let l=o.map((h,a)=>{let d=[];for(let y=0;y<o.length;y++){if(a===y)continue;let g=Rt.intersect(h,o[y]);g&&d.push(g)}let f=F.sub(h.a,h.b);return d=d.filter(y=>{let g=F.sub(y,s);f.setMag(1);let p=F.dot(g,f);return p>0}),d.length===0&&d.push(F.add(F.mult(f,e*1.2),h.a)),d=d.sort((y,g)=>F.dist(y,s)-F.dist(g,s)),d[0]});return l});return i.filter(s=>s.length>=3).map(s=>new ot(s))}};ve.exports=ot}),Pe=T((fs,Me)=>{Me.exports={name:"ballphysics",version:"1.6.0",description:"2D rigid body physics engine to-be",main:"./src/physics.js",scripts:{test:"jest --verbose ./tests",build:"esbuild editor/src/index.js --bundle --minify --sourcemap --target=chrome58,firefox57,safari11,edge16 --outfile=dest/main.js && cp editor/static/index.html dest/index.html"},repository:{type:"git",url:"git+https://github.com/AkosSeres/BallPhysics.git"},keywords:["physics","2d","rigid","balls"],author:"Akos Seres",license:"LGPL-2.1",bugs:{url:"https://github.com/AkosSeres/BallPhysics/issues"},homepage:"https://github.com/AkosSeres/BallPhysics#readme",devDependencies:{esbuild:"^0.8.26",eslint:"^6.0.1","eslint-config-google":"^0.9.1",jest:"^26.4.2"},dependencies:{}}}),ct=T((gs,ke)=>{var B=_(),Zt=Gt(),qt=de(),fi=wt(),Se=Dt(),dt=Kt(),Nt=pe(),Ct=we(),gi=Qt(),pi=be(),z=class{constructor(){this.balls=[],this.bodies=[],this.fixedBalls=[],this.softBalls=[],this.walls=[],this.bounds=[],this.springs=[],this.airFriction=1,this.gravity=new B(0,0),this.debugData=[]}update(t,e){this.debugData=[];let i=e?this.copy:new z;e&&(i.bodies.reverse(),i.balls.reverse(),i.update(t,!1));for(let s=0;s<this.balls.length;s++)this.balls[s].lastPos=this.balls[s].pos.copy,this.balls[s].pos.add(B.mult(this.balls[s].vel,t)),this.balls[s].rotation+=this.balls[s].ang*t,this.balls[s].rotation%=Math.PI*2;for(let s=0;s<this.bodies.length;s++)this.bodies[s].lastPos=this.bodies[s].pos.copy,this.bodies[s].move(this.bodies[s].vel.x*t,this.bodies[s].vel.y*t),this.bodies[s].rotate(this.bodies[s].ang*t);for(let s=0;s<3;s++)for(let n of this.springs)n.update(t/3/2);for(let s=0;s<this.balls.length;s++){this.gravity&&this.balls[s].vel.add(new B(this.gravity.x*t,this.gravity.y*t));for(let n=s+1;n<this.balls.length;n++)(this.balls[s].layer!=this.balls[n].layer||!this.balls[s].layer&&!this.balls[n].layer)&&Zt.collide(this.balls[s],this.balls[n]);for(let n of this.walls)n.collideWithBall(this.balls[s]);for(let n of this.fixedBalls){let o=this.balls[s],l,h=0,a=new B(n.x,n.y);a.x-=o.pos.x,a.y-=o.pos.y,a.mult(-1),a.length<=o.r+n.r&&(l=a.heading,h=a.length);t:if(l===0||l){let d=new B(o.pos.x,o.pos.y),f=new B(o.vel.x,o.vel.y);if(d.rotate(-l+Math.PI/2),f.rotate(-l+Math.PI/2),f.y>0)break t;f.y*=-o.k,d.y+=o.r+n.r-h;let y=f.y*(1+1/o.k),g=Math.sign(f.x-o.ang*o.r)*(y*o.fc)/(o.amc*o.r),p=(f.x-o.ang*o.r)/o.r;g/p>1&&(g=p),g*=o.amc/(o.amc+1),o.ang+=g;let w=g*o.r;f.x-=w,d.rotate(l-Math.PI/2),f.rotate(l-Math.PI/2),o.pos.x=d.x,o.pos.y=d.y,o.vel.x=f.x,o.vel.y=f.y}}for(let n of this.bounds)n.collideWithBall(this.balls[s])}for(let s=0;s<this.bodies.length;s++){for(let n of this.balls)(n.layer!=this.bodies[s].layer||!n.layer&&!this.bodies[s].layer)&&this.bodies[s].collideWithBall(n);for(let n=s+1;n<this.bodies.length;n++)(this.bodies[s].layer!=this.bodies[n].layer||!this.bodies[n].layer&&!this.bodies[s].layer)&&Ct.collide(this.bodies[s],this.bodies[n]);for(let n of this.bodies)for(let o of this.fixedBalls)n.collideWithFixedBall(o);for(let n of this.bodies)for(let o of this.walls){let l=n.collideWithWall(o);l&&this.debugData.push(...l)}for(let n of this.bodies)for(let o of this.bounds){let l=n.collideWithWall(o);l&&this.debugData.push(...l)}this.gravity&&this.bodies[s].vel.add(new B(this.gravity.x*t,this.gravity.y*t))}this.softBalls.forEach(s=>{Nt.updatePressureBasedForces(s,t)});for(let s=0;s<3;s++)for(let n of this.springs)n.update(t/3/2);this.balls.forEach(s=>{s.vel.mult(Math.pow(this.airFriction,t)),s.ang*=Math.pow(this.airFriction,t)}),this.bodies.forEach(s=>{s.vel.mult(Math.pow(this.airFriction,t)),s.ang*=Math.pow(this.airFriction,t)}),e&&(i.bodies.reverse(),i.balls.reverse(),this.balls.forEach((s,n)=>{s.move((i.balls[n].pos.x-s.pos.x)*.5,(i.balls[n].pos.y-s.pos.y)*.5),s.vel.add(new B((i.balls[n].vel.x-s.vel.x)*.5,(i.balls[n].vel.y-s.vel.y)*.5)),s.rotation=(s.rotation+i.balls[n].rotation)/2,s.ang=(s.ang+i.balls[n].ang)/2}),this.bodies.forEach((s,n)=>{let o=i.bodies[n];s.move((o.pos.x-s.pos.x)*.5,(o.pos.y-s.pos.y)*.5),s.vel.add(new B((o.vel.x-s.vel.x)*.5,(o.vel.y-s.vel.y)*.5)),s.rotate((o.rotation-s.rotation)/2),s.ang=(s.ang+o.ang)/2}))}get copy(){let t=new z;return t.balls=this.getCopyOfBalls(),t.bodies=this.getCopyOfBodies(),t.fixedBalls=this.fixedBalls,t.walls=this.walls,t.bounds=this.bounds,t.gravity=this.gravity,this.springs.forEach(e=>{let i=e.constructor==dt?dt:Se,s=new i(e.length,e.springConstant);s.rotationLocked=e.rotationLocked,s.pinned=e.pinned,e.objects.forEach(n=>{let o=this.balls.indexOf(n);o!=-1?s.attachObject(t.balls[o]):(o=this.bodies.indexOf(n),o!=-1&&s.attachObject(t.bodies[o]))}),t.springs.push(s)}),t}setAirFriction(t){if(!isFinite(t))return;this.airFriction=t,this.airFriction<0&&(this.airFriction=0),this.airFriction>1&&(this.airFriction=1)}setGravity(t){this.gravity=t.copy}addBall(t){if(typeof addBodyNotBall!="undefined"&&isFinite(addBodyNotBall)&&addBodyNotBall>2){let e=(i,s,n)=>{let o=[];for(let l=0;l<n;l++){let h=B.fromAngle(l/n*2*Math.PI);h.mult(s),h.add(i),o.push(h)}return o};this.bodies.push(new Ct(e(t.pos,t.r,addBodyNotBall),t.vel,t.k,t.ang,t.fc))}else this.balls.push(t)}addBody(t){this.bodies.push(t)}addSoftBall(t){this.balls.push(...t.points),this.springs.push(...t.sides),this.softBalls.push(t)}addSoftSquare(t,e,i,s){let n=new Nt(t,Math.sqrt(e*e/Math.PI),1,i,24);n.sides.forEach(h=>{h.length=.96*4*e/n.resolution}),n.points.forEach(h=>{h.vel=s.copy}),this.balls.push(...n.points),this.springs.push(...n.sides);let o=e*e*200,l=new dt(Math.sqrt(n.r*n.r*Math.PI),o/2);l.attachObject(n.points[0]),l.attachObject(n.points[n.resolution/2]),this.springs.push(l),l=new dt(Math.sqrt(n.r*n.r*Math.PI),o/2),l.attachObject(n.points[n.resolution/4]),l.attachObject(n.points[3*n.resolution/4]),this.springs.push(l),l=new dt(Math.sqrt(2*n.r*n.r*Math.PI),o),l.attachObject(n.points[n.resolution/8]),l.attachObject(n.points[5*n.resolution/8]),this.springs.push(l),l=new dt(Math.sqrt(2*n.r*n.r*Math.PI),o),l.attachObject(n.points[3*n.resolution/8]),l.attachObject(n.points[7*n.resolution/8]),this.springs.push(l)}addRectWall(t,e,i,s){let n=[];n.push(new B(t-i/2,e-s/2)),n.push(new B(t+i/2,e-s/2)),n.push(new B(t+i/2,e+s/2)),n.push(new B(t-i/2,e+s/2)),this.walls.push(new qt(n))}addRectBody(t,e,i,s,n,o){let l=[];l.push(new B(t-i/2,e-s/2)),l.push(new B(t+i/2,e-s/2)),l.push(new B(t+i/2,e+s/2)),l.push(new B(t-i/2,e+s/2)),this.bodies.push(new Ct(l,new B(0,0),o,0,n))}addWall(t){this.walls.push(t)}addFixedBall(t,e,i){this.fixedBalls.push({x:t,y:e,r:i})}addSpring(t){this.springs.push(t)}setBounds(t,e,i,s){this.bounds=[];let n=(o,l,h,a)=>{let d=[];return d.push(new B(o-h/2,l-a/2)),d.push(new B(o+h/2,l-a/2)),d.push(new B(o+h/2,l+a/2)),d.push(new B(o-h/2,l+a/2)),new qt(d)};this.bounds.push(n(t-i,e,2*i,4*s)),this.bounds.push(n(t+2*i,e,2*i,4*s)),this.bounds.push(n(t,e-s,4*i,s*2)),this.bounds.push(n(t,e+2*s,4*i,2*s))}getObjectAtCoordinates(t,e){let i,s=new B(t,e);return this.balls.forEach(n=>{n.containsPoint(s)&&(i=n)}),this.bodies.forEach(n=>{n.containsPoint(s)&&(i=n)}),this.walls.forEach(n=>{n.containsPoint(s)&&(i=n)}),this.fixedBalls.forEach(n=>{B.dist(new B(n.x,n.y),new B(t,e))<=n.r&&(i=n)}),this.softBalls.forEach(n=>{n.containsPoint(s)&&(i=n)}),i}getCopyOfBalls(){let t=[];return this.balls.forEach(e=>{t.push(e.copy)}),t}getCopyOfBodies(){let t=[];return this.bodies.forEach(e=>{t.push(e.copy)}),t}removeObjFromSystem(t){let e=this.balls.indexOf(t);if(e!=-1){let i=!1;if(this.softBalls.forEach(s=>{s.points.includes(this.balls[e])&&(this.removeObjFromSystem(s),i=!0)}),i)return;this.springs.forEach(s=>{s.objects.includes(this.balls[e])&&this.removeObjFromSystem(s)}),this.balls.splice(e,1);return}if(e=this.bodies.indexOf(t),e!=-1){this.bodies.splice(e,1);return}if(e=this.walls.indexOf(t),e!=-1){this.walls.splice(e,1);return}if(e=this.fixedBalls.indexOf(t),e!=-1){this.fixedBalls.splice(e,1);return}if(e=this.springs.indexOf(t),e!=-1){this.springs.splice(e,1);let i=!1;return this.softBalls.forEach(s=>{s.points.includes(this.springs[e])&&(this.removeObjFromSystem(s),i=!0)}),i,void 0}if(e=this.softBalls.indexOf(t),e!=-1){let i=this.softBalls[e];this.softBalls.splice(e,1),i.points.forEach(s=>{this.removeObjFromSystem(s)});return}}getItemDataFromId(){let t={},e=o=>o.id===id,i=this.balls.filter(e);if(i.length>=1)return t.type="ball",t.num=this.balls.indexOf(i[0]),t;let s=this.bodies.filter(e);if(s.length>=1)return t.type="body",t.num=this.bodies.indexOf(s[0]),t;let n=this.springs.filter(e);if(n.length>=1)return t.type="spring",t.num=this.springs.indexOf(n[0]),t}toJSObject(){let t={};return t.balls=this.balls.map(e=>e.toJSObject()),t.bounds=this.bounds.map(e=>e.toJSObject()),t.walls=this.walls.map(e=>e.toJSObject()),t.bodies=this.bodies.map(e=>e.toJSObject()),t.springs=this.springs.map(e=>e.toJSObject()),t.softBalls=this.softBalls.map(e=>e.toJSObject()),t.fixedBalls=this.fixedBalls,t.airFriction=this.airFriction,t.gravity=this.gravity.toJSObject(),t.version=Pe().version,t}static fromObject(t){let e=new z;return e.balls=t.balls.map(i=>Zt.fromObject(i)),e.bounds=t.bounds.map(i=>qt.fromObject(i)),e.walls=t.walls.map(i=>qt.fromObject(i)),e.bodies=t.bodies.map(i=>Ct.fromObject(i)),e.springs=t.springs.map(i=>dt.fromObject(i,e.balls)),e.softBalls=t.softBalls.map(i=>Nt.fromObject(i,e.balls,e.springs)),e.fixedBalls=t.fixedBalls,e.airFriction=t.airFriction,e.gravity=B.fromObject(t.gravity),e}toJSON(){return JSON.stringify(this.toJSObject())}static fromJSON(t){return z.fromObject(JSON.parse(t))}};z.Ball=Zt;z.Body=Ct;z.Vec2=B;z.Wall=qt;z.LineSegment=fi;z.Spring=dt;z.Stick=Se;z.SoftBall=Nt;z.Line=gi;z.Polygon=pi;ke.exports=z}),Oe=T((ps,Ie)=>{var yi=ct();Ie.exports=function(u){this.startingState=u.getPhysics().toJSObject(),this.inStartingState=!0,document.getElementById("pause").onclick=()=>{u.getTimeMultiplier()!==0?u.setTimeMultiplier(0):(u.setTimeMultiplier(1),this.inStartingState==!0&&(this.startingState=u.getPhysics().toJSObject()),this.inStartingState=!1)},document.getElementById("revert").onclick=()=>{u.setTimeMultiplier(0),u.setPhysics(yi.fromObject(this.startingState)),this.inStartingState=!0},document.getElementById("clear all").onclick=()=>{this.inStartingState=!0;let t=u.getPhysics();t.balls=[],t.walls=[],t.softBalls=[],t.springs=[],t.bodies=[]},document.getElementById("set start").onclick=()=>{this.startingState=u.getPhysics().toJSObject(),this.inStartingState=!0,u.setTimeMultiplier(0)}}}),tt=T((ys,je)=>{var Ae=class{constructor(t,e,i,s,n,o,l){this.name=t,this.description=e,this.drawFunc=i,this.startInteractionFunc=s,this.endInteractionFunc=n,this.keyGotUpFunc=o,this.keyGotDownFunc=l}};je.exports=Ae}),Ce=T((ws,qe)=>{var wi=tt(),$t=ct(),mi=new wi("Ball creator","",function(u,t,e,i,s,n,o,l,h,a){u.strokeStyle="black",u.beginPath(),u.arc(t,e,n,0,2*Math.PI),u.stroke(),i!=0&&s!=0&&(u.beginPath(),u.moveTo(t,e),u.lineTo(i,s),u.stroke())},function(u,t,e,i,s){},function(u,t,e,i,s,n,o){if(n!=0&&o!=0){let l=new $t.Ball(new $t.Vec2(n,o),new $t.Vec2(n-i,o-s),defaultSize,k,0,fc);isFinite(l.pos.x)&&isFinite(l.pos.y)&&isFinite(l.vel.x)&&isFinite(l.vel.y)||(l.vel.x=0,l.vel.y=0),u.addBall(l)}},function(){},function(){});qe.exports=mi}),Fe=T((ms,Be)=>{var xi=tt(),vi=new xi("Rectangle wall","",function(u,t,e,i,s,n,o,l,h,a){i!=0&&s!=0&&(u.strokeStyle="black",u.strokeRect(t,e,i-t,s-e))},function(u,t,e,i,s){},function(u,t,e,i,s,n,o){n!=0&&o!=0&&u.addRectWall(n/2+i/2,o/2+s/2,2*Math.abs(n/2-i/2),2*Math.abs(o/2-s/2))},function(){},function(){});Be.exports=vi}),Te=T((xs,Ee)=>{var bi=tt(),Mi=new bi("Wall drawer","",function(u,t,e,i,s,n,o,l,h,a,d){u.strokeStyle="black",u.beginPath(),u.arc(t,e,n,0,2*Math.PI),u.stroke(),i!=0&&s!=0&&l.addFixedBall(t/d.scaling-d.viewOffsetX/d.scaling,e/d.scaling-d.viewOffsetY/d.scaling,n)},function(u,t,e,i,s){},function(u,t,e,i,s,n,o){},function(){},function(){});Ee.exports=Mi}),Ve=T((vs,We)=>{var Pi=tt(),ki=ct(),Si=new Pi("Stick creator","",function(u,t,e,i,s,n,o,l,h,a){i!=0&&s!=0&&(u.strokeStyle="black",u.beginPath(),u.moveTo(t,e),u.lineTo(i,s),u.stroke())},function(u,t,e,i,s,n){},function(u,t,e,i,s,n,o,l){if(n!=0&&o!=0){t:{let h=u.getObjectAtCoordinates(i,s),a,d=ki.Stick;if(h||(h={x:i,y:s,pinPoint:!0}),l==h||l==null&&h==null)break t;if(l.pinPoint&&h.pinPoint)break t;l.pinPoint?(a=new d(Math.sqrt(Math.pow(l.x-h.pos.x,2)+Math.pow(l.y-h.pos.y,2)),springConstant),a.attachObject(h),a.pinHere(l.x,l.y)):h.pinPoint?(a=new d(Math.sqrt(Math.pow(l.pos.x-h.x,2)+Math.pow(l.pos.y-h.y,2)),springConstant),a.attachObject(l),a.pinHere(h.x,h.y)):(a=new d(Math.sqrt(Math.pow(l.pos.x-h.pos.x,2)+Math.pow(l.pos.y-h.pos.y,2)),springConstant),a.attachObject(l),a.attachObject(h)),u.addSpring(a),lockRotation&&a.lockRotation()}}},function(){},function(){});We.exports=Si}),Le=T((bs,De)=>{var Ii=tt(),Oi=ct(),ji=new Ii("Spring creator","",function(u,t,e,i,s,n,o,l,h,a){i!=0&&s!=0&&(u.strokeStyle="black",u.beginPath(),u.moveTo(t,e),u.lineTo(i,s),u.stroke())},function(u,t,e,i,s,n){},function(u,t,e,i,s,n,o,l){if(n!=0&&o!=0){t:{let h=u.getObjectAtCoordinates(i,s),a,d=Oi.Spring;if(h||(h={x:i,y:s,pinPoint:!0}),l==h||l==null&&h==null)break t;if(l.pinPoint&&h.pinPoint)break t;l.pinPoint?(a=new d(Math.sqrt(Math.pow(l.x-h.pos.x,2)+Math.pow(l.y-h.pos.y,2)),springConstant),a.attachObject(h),a.pinHere(l.x,l.y)):h.pinPoint?(a=new d(Math.sqrt(Math.pow(l.pos.x-h.x,2)+Math.pow(l.pos.y-h.y,2)),springConstant),a.attachObject(l),a.pinHere(h.x,h.y)):(a=new d(Math.sqrt(Math.pow(l.pos.x-h.pos.x,2)+Math.pow(l.pos.y-h.pos.y,2)),springConstant),a.attachObject(l),a.attachObject(h)),u.addSpring(a),lockRotation&&a.lockRotation()}}},function(){},function(){});De.exports=ji}),Xe=T((Ms,Re)=>{var Ai=tt(),Ne=0,Je=0,ze=(u,t,e)=>({x:u/e.scaling-e.viewOffsetX/e.scaling,y:t/e.scaling-e.viewOffsetY/e.scaling}),qi=new Ai("Move","",function(u,t,e,i,s,n,o,l,h,a,d){let f=ze(t,e,d),y=ze(Ne,Je,d);h&&!h.pinPoint&&(h.move(f.x-h.pos.x,f.y-h.pos.y),a===0?(h.vel.x=0,h.vel.y=0):(h.vel.x=(f.x-y.x)/a,h.vel.y=(f.y-y.y)/a),h.ang=0),Ne=t,Je=e},function(u,t,e,i,s){},function(u,t,e,i,s,n,o){},function(){},function(){});Re.exports=qi}),He=T((Ps,Ye)=>{var Ci=tt(),Jt=ct(),Bi=new Ci("Elastic ball creator","",function(u,t,e,i,s,n,o,l,h,a){u.strokeStyle="black",u.beginPath(),u.arc(t,e,n,0,2*Math.PI),u.stroke(),i!=0&&s!=0&&(u.beginPath(),u.moveTo(t,e),u.lineTo(i,s),u.stroke())},function(u,t,e,i,s){},function(u,t,e,i,s,n,o){if(n!=0&&o!=0){let l=new Jt.Ball(new Jt.Vec2(n,o),new Jt.Vec2(n-i,o-s),defaultSize,k,0,fc);if(isFinite(l.pos.x)&&isFinite(l.pos.y)&&isFinite(l.vel.x)&&isFinite(l.vel.y)){let h=new Jt.SoftBall(l.pos,defaultSize,1e6,fc,24);h.points.forEach(a=>{a.vel=l.vel.copy}),u.addSoftBall(h)}}},function(){},function(){});Ye.exports=Bi}),Ue=T((ks,Ge)=>{var Fi=tt(),_t=ct(),Ei=new Fi("Soft square creator","",function(u,t,e,i,s,n,o,l,h,a){u.strokeStyle="black",u.beginPath(),u.moveTo(t-n,e-n),u.lineTo(t+n,e-n),u.lineTo(t+n,e+n),u.lineTo(t-n,e+n),u.lineTo(t-n,e-n),u.stroke(),i!=0&&s!=0&&(u.beginPath(),u.moveTo(t,e),u.lineTo(i,s),u.stroke())},function(u,t,e,i,s){},function(u,t,e,i,s,n,o){if(n!=0&&o!=0){let l=new _t.Ball(new _t.Vec2(n,o),new _t.Vec2(n-i,o-s),defaultSize,k,0,fc);isFinite(l.pos.x)&&isFinite(l.pos.y)&&isFinite(l.vel.x)&&isFinite(l.vel.y)&&u.addSoftSquare(l.pos,defaultSize*2,fc,l.vel)}},function(){},function(){});Ge.exports=Ei}),Qe=T((Ss,Ke)=>{var Ti=tt(),Wi=new Ti("Delete","",function(u,t,e,i,s,n,o,l,h,a){},function(u,t,e,i,s,n){n&&u.removeObjFromSystem(n)},function(u,t,e,i,s,n,o){},function(){},function(){});Ke.exports=Wi}),$e=T((Is,Ze)=>{var Vi=tt(),Di=new Vi("Rectangle body (experimental)","",function(u,t,e,i,s,n,o,l,h,a){i!=0&&s!=0&&(u.strokeStyle="black",u.strokeRect(t,e,i-t,s-e))},function(u,t,e,i,s){},function(u,t,e,i,s,n,o,l,h,a){n!=0&&o!=0&&u.addRectBody(n/2+i/2,o/2+s/2,2*Math.abs(n/2-i/2),2*Math.abs(o/2-s/2),.18,.1)},function(){},function(){});Ze.exports=Di}),Bt=ct(),_e=Bt,ti=Bt.Ball,rt=Bt.Vec2,Li=Bt.Spring,ei=Bt.Stick,Ri=Oe(),A,E,N=0,J=0,te=0;window.defaultSize;window.k=.5;window.fc=2;window.springConstant=2e3;window.scaling=1;window.viewOffsetX=0;window.viewOffsetY=0;var Y=0,Mt=0,Pt=0,zt=1,Xt;window.lockRotation=!1;window.time=!0;var mt=!1,ii=0;my=0;var Ft=!1,ut=[Ce(),Fe(),Te(),Ve(),Le(),Xe(),He(),Ue(),Qe(),$e()],ee=!1,ie=!1;window.onload=()=>{E=document.getElementById("defaulCanvas0"),A=new _e,A.setBounds(0,0,E.width,E.height),A.setGravity(new rt(0,1e3)),A.setAirFriction(.9),E.addEventListener("touchstart",zi,!1),E.addEventListener("touchend",Xi,!1),E.addEventListener("touchmove",Yi,!1),E.addEventListener("mousedown",Hi,!1),E.addEventListener("mouseup",Gi,!1),E.addEventListener("mousemove",Ui,!1),document.addEventListener("keydown",Ni,!1),document.addEventListener("keyup",Ji,!1),window.addEventListener("resize",si,!1),E.addEventListener("mousedown",function(){te=1},!1),E.addEventListener("mouseup",function(){te=0},!1),si(),window.defaultSize=(E.width+E.height)/80,Ri(new Ki),requestAnimationFrame(ni)};function si(){E.width=window.innerWidth,E.height=window.innerHeight,A.setBounds(0,0,E.width,E.height)}function ni(){isFinite(Xt)||(Xt=performance.now());let u=performance.now()-Xt;isFinite(u)||(u=0),u/=1e3,N=isFinite(N)?N:ii,J=isFinite(J)?J:my,N&&isFinite(N)&&(ii=N),J&&isFinite(J)&&(my=J);let t=E.getContext("2d");if(t.fillStyle="rgb(51, 51, 51)",t.fillRect(0,0,E.width,E.height),t.strokeStyle="black",t.fillStyle="white",t.fillText("BallPhysics",10,10),t.fillText("Mode: "+ut[Y].name,10,25),t.fillText(Math.round(N).toString()+" "+Math.round(J).toString(),10,40),t.fillText(Math.round(Mt).toString()+" "+Math.round(Pt).toString(),10,55),ut[Y].drawFunc(t,N,J,Mt,Pt,defaultSize*window.scaling,te,A,mt,u*zt,{scaling:window.scaling,viewOffsetX:window.viewOffsetX,viewOffsetY:window.viewOffsetY}),t.strokeStyle="black",Qi(E),!time)return;A.balls[0]&&(ie&&(A.balls[0].ang-=Math.PI*100*u),ee&&(A.balls[0].ang+=Math.PI*100*u)),u*=zt,A.update(u/5,Ft),A.update(u/5,Ft),A.update(u/5,Ft),A.update(u/5,Ft),A.update(u/5,Ft),pmouseX=N,pmouseY=J,Xt=performance.now(),requestAnimationFrame(ni)}function oi(u,t){N=u,J=t,mt=A.getObjectAtCoordinates(N/window.scaling-window.viewOffsetX/window.scaling,J/window.scaling-window.viewOffsetY/window.scaling),mt||(mt={x:N/window.scaling-window.viewOffsetX/window.scaling,y:J/window.scaling-window.viewOffsetY/window.scaling,pinPoint:!0}),Mt=N,Pt=J,ut[Y].startInteractionFunc(A,u/window.scaling-window.viewOffsetX/window.scaling,t/window.scaling-window.viewOffsetY/window.scaling,N/window.scaling-window.viewOffsetX/window.scaling,J/window.scaling-window.viewOffsetY/window.scaling,mt)}function li(u,t){if(N=u,J=t,ut[Y].endInteractionFunc(A,u/window.scaling-window.viewOffsetX/window.scaling,t/window.scaling-window.viewOffsetY/window.scaling,N/window.scaling-window.viewOffsetX/window.scaling,J/window.scaling-window.viewOffsetY/window.scaling,Mt/window.scaling-window.viewOffsetX/window.scaling,Pt/window.scaling-window.viewOffsetY/window.scaling,mt,fc,k),Mt===0&&Pt===0)return;Mt=0,Pt=0,mt=!1}function Ni(u){keyCode=u.key,keyCode==="ArrowUp"&&(Y+=1,Y%=ut.length),keyCode==="ArrowDown"&&(Y-=1,Y=Y===-1?ut.length-1:Y),keyCode==="s"&&Zi(E.width/2,E.height/2,.5,A),keyCode==="a"&&(window.scaling+=.01),keyCode==="d"&&(window.scaling-=.01),keyCode==="j"&&(window.viewOffsetX-=10),keyCode==="l"&&(window.viewOffsetX+=10),keyCode==="k"&&(window.viewOffsetY-=10),keyCode==="i"&&(window.viewOffsetY+=10),keyCode==="ArrowRight"&&(ie=!0),keyCode==="ArrowLeft"&&(ee=!0)}function Ji(u){keyCode=u.key,keyCode==="ArrowRight"&&(ie=!1),keyCode==="ArrowLeft"&&(ee=!1)}function zi(u){if(u.preventDefault(),E.width-u.changedTouches[0].clientX<E.width/100){Y+=1,Y%=ut.length;return}if(u.changedTouches[0].clientX<E.width/100){Y-=1,Y=Y===-1?ut.length-1:Y;return}return oi(u.changedTouches[0].clientX,u.changedTouches[0].clientY),!1}function Xi(u){return u.preventDefault(),li(u.changedTouches[0].clientX,u.changedTouches[0].clientY),!1}function Yi(u){return u.preventDefault(),N=u.changedTouches[0].clientX,J=u.changedTouches[0].clientY,!1}function Hi(u){return oi(u.clientX,u.clientY),!1}function Gi(u){return li(u.clientX,u.clientY),!1}function Ui(u){N=u.clientX,J=u.clientY}var Qi=function(u){let t=u.getContext("2d");t.save(),t.translate(window.viewOffsetX,window.viewOffsetY),t.scale(window.scaling,window.scaling),t.fillStyle="green",t.strokeStyle="black";for(let i=0;i<A.balls.length;i++)t.beginPath(),t.arc(A.balls[i].pos.x,A.balls[i].pos.y,A.balls[i].r,0,2*Math.PI),t.stroke(),t.fill(),t.save(),t.translate(A.balls[i].pos.x,A.balls[i].pos.y),t.rotate(-Math.PI/2-A.balls[i].rotation),t.beginPath(),t.moveTo(0,0),t.lineTo(0,A.balls[i].r),t.stroke(),t.restore();A.bodies.forEach(i=>{t.beginPath(),t.moveTo(i.points[i.points.length-1].x,i.points[i.points.length-1].y),i.points.forEach(s=>{t.lineTo(s.x,s.y)}),t.stroke(),t.fill(),t.beginPath(),t.arc(i.pos.x,i.pos.y,1.5,0,Math.PI*2),t.stroke()});let e=i=>{t.beginPath(),t.moveTo(i.points[i.points.length-1].x,i.points[i.points.length-1].y),i.points.forEach(s=>{t.lineTo(s.x,s.y)}),t.fill()};t.fillStyle="white",A.walls.forEach(e),t.fillStyle="yellow",A.bounds.forEach(e),A.fixedBalls.forEach(i=>{t.beginPath(),t.arc(i.x,i.y,i.r,0,Math.PI*2),t.fill()}),t.save(),t.lineWidth=2,t.strokeStyle="#ADD8E6",t.fillStyle="#ADD8E6",A.springs.forEach(i=>{if(i instanceof Li&&!(i instanceof ei)){let s,n,o,l;i.pinned?(s=i.pinned.x,n=i.pinned.y,o=i.objects[0].pos.x,l=i.objects[0].pos.y):(s=i.objects[0].pos.x,n=i.objects[0].pos.y,o=i.objects[1].pos.x,l=i.objects[1].pos.y);let h=new rt(o-s,l-n),a=h.copy;h.rotate(Math.PI/2),h.setMag(5);let d=new rt(s,n),f=Math.floor(i.length/10);for(let y=1;y<=f;y++)y===f&&(h=new rt(0,0)),t.beginPath(),t.moveTo(d.x,d.y),t.lineTo(s+y/f*a.x+h.x,n+y/f*a.y+h.y),t.stroke(),d=new rt(s+y/f*a.x+h.x,n+y/f*a.y+h.y),h.mult(-1)}else t.beginPath(),t.moveTo(i.objects[0].pos.x,i.objects[0].pos.y),t.lineTo(i.pinned?i.pinned.x:i.objects[1].pos.x,i.pinned?i.pinned.y:i.objects[1].pos.y),t.stroke();i.objects.forEach(s=>{t.beginPath(),t.arc(s.pos.x,s.pos.y,2.5,0,Math.PI*2),t.fill(),t.stroke()}),i.pinned&&(t.beginPath(),t.arc(i.pinned.x,i.pinned.y,3,0,Math.PI*2),t.fill(),t.stroke())}),t.restore();for(segment of A.debugData)t.strokeStyle="red",t.beginPath(),t.moveTo(segment.a.x,segment.a.y),t.lineTo(segment.b.x,segment.b.y),t.stroke();t.restore()};function Zi(u,t,e,i){let s=[],n=25,o=250,l=8;s.push(new ti(new rt(u,t),new rt(0,0),e*n,1,0,0));let h=1;for(let a=0;a<l-1;a++)s.push(new ti(new rt(u+h*e*n*1.01*2,t),new rt(0,0),e*25,1,0,0)),h*=-1,h>0&&(h+=1),a===l-2&&(s[s.length-1].vel.x=-Math.sign(h)*e*n*8);s.forEach(a=>{i.addBall(a);let d=new ei(o);d.attachObject(a),d.pinHere(a.pos.x,a.pos.y-o),i.addSpring(d),d.lockRotation()})}function $i(u){isFinite(u)&&(zt=u)}function _i(){return zt}function ts(u){u instanceof _e&&(A=u)}function es(){return A}var Ki=function(){this.setTimeMultiplier=$i,this.getTimeMultiplier=_i,this.getPhysics=es,this.setPhysics=ts};})();
//# sourceMappingURL=main.js.map

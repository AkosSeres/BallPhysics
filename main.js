(()=>{var as=Object.create,kt=Object.defineProperty,ls=Object.getPrototypeOf,hs=Object.prototype.hasOwnProperty,cs=Object.getOwnPropertyNames,us=Object.getOwnPropertyDescriptor,pe=n=>kt(n,"__esModule",{value:!0}),z=(n,t)=>()=>(t||(t={exports:{}},n(t.exports,t)),t.exports),ds=(n,t)=>{pe(n);for(var e in t)kt(n,e,{get:t[e],enumerable:!0})},fs=(n,t,e)=>{if(pe(n),t&&typeof t=="object"||typeof t=="function")for(let s of cs(t))!hs.call(n,s)&&s!=="default"&&kt(n,s,{get:()=>t[s],enumerable:!(e=us(t,s))||e.enumerable});return n},$=n=>n&&n.__esModule?n:fs(kt(n!=null?as(ls(n)):{},"default",{value:n,enumerable:!0}),n),U=z((Is,ye)=>{var L=class{constructor(t,e){this.x=t,this.y=e}get copy(){return new L(this.x,this.y)}get length(){return Math.sqrt(this.x*this.x+this.y*this.y)}get sqlength(){return this.x*this.x+this.y*this.y}get heading(){if(this.x===0&&this.y===0)return 0;if(this.x===0)return this.y>0?Math.PI/2:1.5*Math.PI;if(this.y===0)return this.x>0?0:Math.PI;let t=L.normalized(this);return this.x>0&&this.y>0?Math.asin(t.y):this.x<0&&this.y>0?Math.asin(-t.x)+Math.PI/2:this.x<0&&this.y<0?Math.asin(-t.y)+Math.PI:this.x>0&&this.y<0?Math.asin(t.x)+1.5*Math.PI:0}add(t){this.x+=t.x,this.y+=t.y}sub(t){this.x-=t.x,this.y-=t.y}mult(t){this.x*=t,this.y*=t}div(t){this.x/=t,this.y/=t}lerp(t,e){this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e}dist(t){return new L(this.x-t.x,this.y-t.y).length}setMag(t){if(this.length===0)return;this.mult(t/this.length)}rotate(t){let e=this.heading,s=L.fromAngle(t+e);s.mult(this.length),this.x=s.x,this.y=s.y}static add(t,e){return new L(t.x+e.x,t.y+e.y)}static sub(t,e){return new L(t.x-e.x,t.y-e.y)}static mult(t,e){return new L(t.x*e,t.y*e)}static div(t,e){return new L(t.x/e,t.y/e)}static fromAngle(t){return new L(Math.cos(t),Math.sin(t))}static lerp(t,e,s){return L.add(t,L.mult(L.sub(e,t),s))}static dist(t,e){return L.sub(t,e).length}static dot(t,e){return t.x*e.x+t.y*e.y}static cross(t,e){return t.x*e.y-t.y*e.x}static crossScalarFirst(t,e){return new L(-e.y*t,e.x*t)}static crossScalarSecond(t,e){return new L(t.y*e,-t.x*e)}static angle(t,e){return Math.acos(Math.min(Math.max(L.dot(t,e)/Math.sqrt(t.sqlength*e.sqlength),1),-1))}static angleACW(t,e){let s=t.heading,i=e.heading,r=i-s;return r<0?2*Math.PI+r:r}static normalized(t){let e=t.length;return e===0?t:new L(t.x/e,t.y/e)}toJSObject(){let t={};return t.x=this.x,t.y=this.y,t}static fromObject(t){return new L(t.x,t.y)}};ye.exports=L}),ut=z((ks,xe)=>{var P=U(),ct=class{constructor(t,e,s,i,r,o){this.pos=t.copy,this.lastPos=this.pos.copy,this.r=s,this.fc=.4,this.amc=2/5,this.rotation=0,r?this.ang=r:this.ang=0,(o||o===0)&&(this.fc=o),i?this.k=i:this.k=.8,e!=null?this.vel=e.copy:this.vel=new P(0,0),this.id="_"+Math.random().toString(36).substr(2,9)}get m(){return this.r*this.r*Math.PI}get am(){return this.amc*this.r*this.r*this.m}getAmInPoint(t){let e=this.am;return e+=P.sub(this.pos,t).sqlength*this.m,e}get copy(){let t=new ct(this.pos.copy,this.vel.copy,this.r,this.k,this.ang,this.fc);return t.lastPos=this.lastPos.copy,t.rotation=this.rotation,t}move(t,e){this.pos.x+=t,this.pos.y+=e}rotate(t){this.rotation+=t}collided(t){return this.pos.dist(t.pos)<this.r+t.r}static collide(t,e){if(!t.collided(e))return;let s=P.dist(t.pos,e.pos),i=t.m,r=e.m,o=t.pos.copy,l=e.pos.copy,u=t.r+e.r-s,a=P.sub(t.pos,e.pos);if(a.setMag(1),a.mult(u*r/(i+r)),o.add(a),a.setMag(1),a.mult(-u*i/(i+r)),l.add(a),t.pos=o,e.pos=l,P.dot(a,P.sub(t.vel,e.vel))<0)return;a.setMag(1);let h=P.add(t.pos,P.mult(a,t.r)),d=t.vel.copy,g=e.vel.copy,f=t.ang,m=e.ang,p=P.sub(h,t.pos),b=P.sub(h,e.pos),M=t.am,S=e.am,y=(t.k+e.k)/2,x=(t.fc+e.fc)/2,k=a.copy,w=t.velInPlace(h),C=e.velInPlace(h),E=P.sub(C,w),X=1/i+1/r;X=-(1+y)*P.dot(E,k)/X;let T=P.sub(d,P.mult(k,X/i)),D=P.add(g,P.mult(k,X/r)),Y=f-X*P.cross(p,k)/M,H=m,B=E.copy;B.sub(P.mult(k,P.dot(E,k))),B.setMag(1);let K=1/i+1/r;K+=P.dot(P.crossScalarFirst(P.cross(p,B)/M,p),B),K+=P.dot(P.crossScalarFirst(P.cross(b,B)/S,b),B),K=-.5*P.dot(E,B)/K;let Q=X*x;Q>K&&(Q=K),T=P.sub(T,P.mult(B,Q/i)),D=P.add(D,P.mult(B,Q/r)),Y=Y-Q*P.cross(p,B)/M,H=H+Q*P.cross(b,B)/S,t.vel=T,e.vel=D,t.ang=Y,e.ang=H}containsPoint(t){return P.dist(this.pos,t)<=this.r}velInPlace(t){let e=P.sub(t,this.pos);return e.rotate(Math.PI/2),e.mult(this.ang),e.add(this.vel),e}effectiveMass(t,e){let s=P.sub(t,this.pos);if(s.length===0)return this.m;let i=P.angle(e,s),r=Math.sin(i)**2*s.length**2/this.am;return isNaN(i)&&console.log(e,s,i),1/(r+1/this.m)}applyDeltaVelInPoint(t,e){let s=P.sub(e,this.pos);if(s.length===0){this.vel.add(t);return}let i=P.angle(s,t),r=P.mult(s,P.dot(t,s)/s.length**2);this.vel.add(r);let o=s.copy;o.rotate(Math.PI/2),o.setMag(1);let l=Math.sign(P.dot(t,o)),u=t.length*Math.cos(i),a=1/(1/this.m+s.length**2/this.am),h=u*a/this.m;this.vel.add(P.mult(o,h*l));let d=l*u*a*s.length/this.am;this.ang-=d}toJSObject(){let t={};return t.pos=this.pos.toJSObject(),t.lastPos=this.lastPos.toJSObject(),t.r=this.r,t.fc=this.fc,t.amc=this.amc,t.rotation=this.rotation,t.ang=this.ang,t.fc=this.fc,t.k=this.k,t.vel=this.vel.toJSObject(),t.id=this.id,this.layer!=null&&(t.layer=this.layer),t}static fromObject(t){let e=new ct(P.fromObject(t.pos),P.fromObject(t.vel),t.r,t.k,t.ang,t.fc);return e.lastPos=P.fromObject(t.lastPos),e.amc=t.amc,e.rotation=t.rotation,e.vel=P.fromObject(t.vel),e.id=t.id,t.layer!=null&&(e.layer=t.layer),e}};xe.exports=ct}),at=z((Cs,be)=>{var V=U(),ve=class{constructor(t,e){this.a=t,this.b=e}get length(){return V.dist(this.a,this.b)}distFromPoint(t){let e=V.sub(this.a,this.b),s=V.sub(t,this.b),i=V.sub(t,this.a),r=s.length,o=i.length,l=e.length;if(l===0)return r;let u=V.angle(s,i),a=V.angle(s,e),h=Math.PI-u-a,d=Math.sin(h)*o*l/2,g=2*d/l;return h>Math.PI/2?o:a>Math.PI/2?r:g}static intersect(t,e){let s=V.sub(t.b,t.a),i=s.y/s.x,r=t.b.y-t.b.x*i,o=V.sub(e.b,e.a),l=o.y/o.x,u=e.b.y-e.b.x*l;if(s.x===0&&o.x!==0){if(t.a.x>=e.a.x&&t.a.x<=e.b.x||t.a.x<=e.a.x&&t.a.x>=e.b.x){let f=l*t.a.x+u;if(f>t.a.y&&f<t.b.y||f<t.a.y&&f>t.b.y)return new V(t.a.x,f)}return}if(o.x===0&&s.x!==0){if(e.a.x>=t.a.x&&e.a.x<=t.b.x||e.a.x<=t.a.x&&e.a.x>=t.b.x){let f=i*e.a.x+r;if(f>e.a.y&&f<e.b.y||f<e.a.y&&f>e.b.y)return new V(e.a.x,f)}return}if(s.x===0&&o.x===0){if(t.a.x===e.a.x){let f;t.a.y<t.b.y?f=[t.a.y,t.b.y]:f=[t.b.y,t.a.y];let m;e.a.y<e.b.y?m=[e.a.y,e.b.y]:m=[e.b.y,e.a.y];let p=[f[0]>m[0]?f[0]:m[0],f[1]<m[1]?f[1]:m[1]];if(p[0]<=p[1])return new V(t.a.x,(p[0]+p[1])/2)}return}let a;t.a.x<t.b.x?a=[t.a.x,t.b.x]:a=[t.b.x,t.a.x];let h;e.a.x<e.b.x?h=[e.a.x,e.b.x]:h=[e.b.x,e.a.x];let d=[a[0]>h[0]?a[0]:h[0],a[1]<h[1]?a[1]:h[1]];if(i===l&&r===u&&d[0]<=d[1])return new V((d[0]+d[1])/2,(d[0]+d[1])/2*i+r);let g=(u-r)/(i-l);return g>=d[0]&&g<=d[1]?new V(g,g*i+r):void 0}};be.exports=ve}),Me=z((Es,we)=>{var j=U(),Jt=at(),Ct=class{constructor(t){this.points=t;let e=this.points,s=0,i=0,r=j.angleACW(j.sub(e[1],e[0]),j.sub(e[e.length-1],e[0]));this.calculateCenterAndRadius(),s+=r,i+=Math.PI*2-r;for(let o=1;o<e.length-1;o++)r=j.angleACW(j.sub(e[(o+1)%e.length],e[o]),j.sub(e[o-1],e[o])),s+=r,i+=Math.PI*2-r;if(r=j.angleACW(j.sub(e[0],e[e.length-1]),j.sub(e[e.length-2],e[e.length-1])),s+=r,i+=Math.PI*2-r,i>s)return;{let o=[];for(let l=e.length-1;l>=0;l--)o.push(e[l]);this.points=o}}collideWithBall(t){let e,s;if(this.points.forEach((i,r)=>{let o=new j(i.x,i.y);o.x-=t.pos.x,o.y-=t.pos.y,o.mult(-1),o.length<=t.r&&(e=o.heading,s=o.length),o=new j(i.x,i.y);let l=new j(this.points[(r+1)%this.points.length].x,this.points[(r+1)%this.points.length].y),u=new j(t.pos.x,t.pos.y),a=new j(l.x-o.x,l.y-o.y),h=a.heading;o.rotate(-h+Math.PI),l.rotate(-h+Math.PI),u.rotate(-h+Math.PI);let d=u.y-(o.y+l.y)/2;d>=-t.r&&d<=t.r&&u.x>=l.x&&u.x<=o.x&&(e=h-Math.PI/2,s=d)}),isFinite(e)){let i=new j(t.pos.x,t.pos.y),r=new j(t.vel.x,t.vel.y);if(i.rotate(-e+Math.PI/2),r.rotate(-e+Math.PI/2),r.y>0)return;r.y*=-t.k,i.y+=t.r-s;let o=r.y*(1+t.k),l=Math.sign(r.x+t.ang*t.r)*(o*t.fc)/(t.amc*t.r),u=(r.x+t.ang*t.r)/t.r;l/u>1&&(l=u),t.ang-=l;let a=l*t.am/t.r/t.m;r.x-=a,i.rotate(e-Math.PI/2),r.rotate(e-Math.PI/2),t.pos.x=i.x,t.pos.y=i.y,t.vel.x=r.x,t.vel.y=r.y}}containsPoint(t){let e=this.sides,s=Math.max(...this.points.map(l=>j.dist(l,t)))+1,i=j.fromAngle(0);i.setMag(s);let r=new Jt(t,j.add(i,t)),o=e.filter(l=>Jt.intersect(l,r)!=null);return o.length%2==1}calculateCenterAndRadius(){this.center=this.points.reduce((t,e)=>j.add(t,e)),this.center.div(this.points.length),this.boundRadius=Math.max(this.points.map(t=>j.dist(t,this.center)))}get sides(){return this.points.map((t,e)=>new Jt(t,this.points[(e+1)%this.points.length]))}toJSObject(){let t={};return t.points=this.points.map(e=>({x:e.x,y:e.y})),t}static fromObject(t){let e=new Ct(t.points.map(s=>new j(v.x,v.y)));return e}};we.exports=Ct}),Et=z((Fs,Pe)=>{var _=U(),dt=class{constructor(t,e){this.length=t,this.springConstant=e,this.pinned=!1,this.objects=[],this.rotationLocked=!1,this.id="_"+Math.random().toString(36).substr(2,9)}pinHere(t,e){this.pinned={x:t,y:e}}unpin(){this.pinned=!1}attachObject(t){let e=this.objects;e.push(t),e.length===2&&(this.pinned=!1),e.length>=3&&(e=[e[e.length-2],e[e.length-1]])}lockRotation(){this.rotationLocked=!0}unlockRotation(){this.rotationLocked=!1}update(t){let e,s;if(this.pinned&&this.objects[0]){s=this.pinned,e=this.objects[0];let i=new _(s.x-e.pos.x,s.y-e.pos.y),r=i.length-this.length;i.setMag(1),i.mult(r*this.springConstant*t/e.m),e.vel.x+=i.x,e.vel.y+=i.y;let o=e.vel;if(o.rotate(-i.heading),this.rotationLocked){let l=new _(s.x,s.y),u=_.sub(e.pos,l),a=u.length*u.length*e.m+e.am,h=(e.am*e.ang-u.length*e.m*o.y)/a;o.y=-h*u.length,e.ang=h}o.rotate(i.heading)}else if(this.objects[0]&&this.objects[1]){e=this.objects[0],s=this.objects[1];let i=_.sub(e.pos,s.pos),r=i.length-this.length;i.setMag(1),i.mult(r*this.springConstant*t),s.vel.add(_.div(i,s.m)),e.vel.add(_.div(i,-e.m)),i=_.sub(e.pos,s.pos);let o=e.vel,l=s.vel;if(o.rotate(-i.heading),l.rotate(-i.heading),this.rotationLocked){let u=new _(e.pos.x*e.m+s.pos.x*s.m,e.pos.y*e.m+s.pos.y*s.m);u.div(e.m+s.m);let a=_.sub(e.pos,u),h=_.sub(s.pos,u),d=a.length*a.length*e.m+e.am+h.length*h.length*s.m+s.am,g=(o.y-l.y)*h.length/(a.length+h.length)+l.y,f=(e.am*e.ang+s.am*s.ang-a.length*e.m*(o.y-g)+h.length*s.m*(l.y-g))/d;o.y=-f*a.length+g,l.y=+f*h.length+g,e.ang=f,s.ang=f}o.rotate(i.heading),l.rotate(i.heading)}}toJSObject(){let t={};return t.length=this.length,t.springConstant=this.springConstant,t.pinned=this.pinned,t.rotationLocked=this.rotationLocked,t.id=this.id,t.objects=this.objects.map(e=>e.id),t.type=this.__proto__==dt.prototype?"spring":"stick",t}static fromObject(t,e){let s=new ms,i=s.createStickOrSpring(t.type,t.length,t.springConstant);return i.pinned=t.pinned,i.rotationLocked=t.rotationLocked,i.id=t.id,i.objects=t.objects.map(r=>{let o=e.filter(l=>r==l.id);return o[0]}),i}};function ms(){this.createStickOrSpring=function(n,t,e){let s;if(n=="spring")s=new dt(t,e);else if(n=="stick"){let i=ft();s=new i(t)}return s}}Pe.exports=dt}),ft=z((Os,Se)=>{var it=U(),gs=Et(),Ie=class extends gs{constructor(t){super(t,0);this.springConstant=0}update(t){let e,s;if(this.pinned&&this.objects[0]){s=this.pinned,e=this.objects[0];let i=new it(s.x-e.pos.x,s.y-e.pos.y);i.setMag(1),i.mult(-this.length),e.move(-e.pos.x+s.x+i.x,-e.pos.y+s.y+i.y);let r=e.vel;if(r.rotate(-i.heading),r.x=0,this.rotationLocked){let o=new it(s.x,s.y),l=it.sub(e.pos,o),u=l.length*l.length*e.m+e.am,a=(e.am*e.ang-l.length*e.m*r.y)/u;r.y=-a*l.length,e.ang=a}r.rotate(i.heading)}else if(this.objects[0]&&this.objects[1]){e=this.objects[0],s=this.objects[1];let i=it.sub(e.pos,s.pos),r=this.length-i.length;i.setMag(1);let o=it.mult(i,r*s.m/(e.m+s.m)),l=it.mult(i,-r*e.m/(e.m+s.m));e.move(o.x,o.y),s.move(l.x,l.y);let u=e.vel,a=s.vel;if(u.rotate(-i.heading),a.rotate(-i.heading),u.x=a.x=(e.m*u.x+s.m*a.x)/(e.m+s.m),this.rotationLocked){let h=new it(e.pos.x*e.m+s.pos.x*s.m,e.pos.y*e.m+s.pos.y*s.m);h.div(e.m+s.m);let d=it.sub(e.pos,h),g=it.sub(s.pos,h),f=d.length*d.length*e.m+e.am+g.length*g.length*s.m+s.am,m=(u.y-a.y)*g.length/(d.length+g.length)+a.y,p=(e.am*e.ang+s.am*s.ang-d.length*e.m*(u.y-m)+g.length*s.m*(a.y-m))/f;u.y=-p*d.length+m,a.y=+p*g.length+m,e.ang=p,s.ang=p}u.rotate(i.heading),a.rotate(i.heading)}}};Se.exports=Ie}),Ce=z((Ts,ke)=>{var I=U(),ps=ut(),ys=ft(),A=at(),Ft=class{constructor(t,e,s,i,r){this.points=[],i||i===0?this.fc=i:this.fc=.4,this.pressure=s,r?this.resolution=r:this.resolution=30,e=Math.abs(e),this.r=e;let o=Math.random()*1e6;for(let l=0;l<this.resolution;l++){let u=new I(t.x,t.y);u.add(I.mult(I.fromAngle(l/this.resolution*Math.PI*2),e)),this.points.push(new ps(u,new I(0,0),e*Math.sin(Math.PI/this.resolution),0,0,this.fc)),this.points[this.points.length-1].layer=o}this.sides=[];for(let l=0;l<this.resolution;l++){let u=new ys(2*e*Math.sin(Math.PI/this.resolution));u.attachObject(this.points[l]),u.attachObject(this.points[(l+1)%this.resolution]),l%2===0&&u.lockRotation(),this.sides.push(u)}}static updatePressureBasedForces(t,e){let s=[];if(s.push([]),t.points.forEach(o=>{s[0].push(new I(o.pos.x,o.pos.y))}),function(o){let l=I.angleACW(I.sub(o[1],o[0]),I.sub(o[o.length-1],o[0]));if(l>Math.PI)return!0;for(let u=1;u<o.length-1;u++)if(l=I.angleACW(I.sub(o[(u+1)%o.length],o[u]),I.sub(o[u-1],o[u])),l>Math.PI)return!0;return l=I.angleACW(I.sub(o[0],o[o.length-1]),I.sub(o[o.length-2],o[o.length-1])),l>Math.PI}(s[0])){let o=(a,h)=>{for(let d=0;d<a.length;d++)if(a[d]===h)return!0;return!1},l=function(a,h,d){for(let g=0;g<h.length;g++)if(!o(d,g)){let f=new A(new I(h[g].x,h[g].y),new I(h[(g+1)%h.length].x,h[(g+1)%h.length].y));if(A.intersect(a,f))return!0}return!1},u=!0;t:for(;u;){u=!1;for(let a=0;a<s.length;a++){let h=s[a],d=I.sub(h[1],h[0]),g=I.sub(h[h.length-1],h[0]),f=I.angleACW(d,g);if(f>Math.PI){u=!0;let m=0,p=m+2,b=new A(new I(h[m].x,h[m].y),new I(h[p%h.length].x,h[p%h.length].y)),M=new I(b.b.x-b.a.x,b.b.y-b.a.y).heading;for(;!(d.heading>g.heading?M>d.heading&&M<2*Math.PI||M>0&&M<g.heading:M>d.heading&&M<g.heading)||l(new A(new I(h[m%h.length].x,h[m%h.length].y),new I(h[p%h.length].x,h[p%h.length].y)),h,[(h.length-1)%h.length,m%h.length,(p-1)%h.length,p%h.length]);)p++,b=new A(new I(h[m].x,h[m].y),new I(h[p%h.length].x,h[p%h.length].y)),M=new I(b.b.x-b.a.x,b.b.y-b.a.y).heading;let S=[],y=[];for(let x=m;x<=p;x++)S.push(h[x%h.length]);for(let x=p;x<=m+h.length;x++)y.push(h[x%h.length]);s[a]=S,s.push(y);continue t}for(let m=1;m<h.length;m++){let p=I.sub(h[(m+1)%h.length],h[m]),b=I.sub(h[m-1],h[m]),M=I.angleACW(p,b);if(M>Math.PI){u=!0;let S=m+2,y=new A(new I(h[m].x,h[m].y),new I(h[S%h.length].x,h[S%h.length].y)),x=new I(y.b.x-y.a.x,y.b.y-y.a.y).heading;for(;!(p.heading>b.heading?x>p.heading&&x<2*Math.PI||x>0&&x<b.heading:x>p.heading&&x<b.heading)||l(y,h,[(m-1)%h.length,m%h.length,(S-1)%h.length,S%h.length]);)S++,y=new A(new I(h[m].x,h[m].y),new I(h[S%h.length].x,h[S%h.length].y)),x=new I(y.b.x-y.a.x,y.b.y-y.a.y).heading;let k=[],w=[];for(let C=m;C<=S;C++)k.push(h[C%h.length]);for(let C=S;C<=m+h.length;C++)w.push(h[C%h.length]);s[a]=k,s.push(w);continue t}}}}}for(let o=s.length-1;o>=0;o--){let l=s[o];for(;l.length>3;)s.push([l[0],l[1],l[2]]),l.splice(1,1)}let i=0;s.forEach(o=>{let l=Math.sqrt(Math.pow(o[0].x-o[1].x,2)+Math.pow(o[0].y-o[1].y,2)),u=Math.sqrt(Math.pow(o[1].x-o[2].x,2)+Math.pow(o[1].y-o[2].y,2)),a=Math.sqrt(Math.pow(o[2].x-o[0].x,2)+Math.pow(o[2].y-o[0].y,2)),h=(l+u+a)/2,d=Math.sqrt(h*(h-l)*(h-u)*(h-a));i+=d});let r=t.pressure*(t.r*t.r*Math.PI/i)-t.pressure;t.sides.forEach(o=>{let l=I.sub(o.objects[0].pos,o.objects[1].pos);l.mult(r),l.rotate(Math.PI/2),l.mult(e),o.objects[0].vel.add(I.div(l,o.objects[0].m)),o.objects[1].vel.add(I.div(l,o.objects[1].m))})}get sideSegments(){return this.points.map((t,e)=>new A(t.pos,this.points[(e+1)%this.points.length].pos))}containsPoint(t){let e=this.sideSegments,s=Math.max(...this.points.map(l=>I.dist(l.pos,t)))+1,i=I.fromAngle(0);i.setMag(s);let r=new A(t,I.add(i,t)),o=e.filter(l=>A.intersect(l,r)!=null);return o.length%2==1}toJSObject(){let t={};return t.pressure=this.pressure,t.fc=this.fc,t.r=this.r,t.resolution=this.resolution,t.points=this.points.map(e=>e.id),t.sides=this.sides.map(e=>e.id),t}static fromObject(t,e,s){let i=Object.create(Ft.prototype);return console.log(i),i.pressure=t.pressure,i.fc=t.fc,i.resolution=t.resolution,i.r=t.r,i.points=t.points.map(r=>{let o=e.filter(l=>r==l.id);return o[0]}),i.sides=t.sides.map(r=>{let o=s.filter(l=>r==l.id);return o[0]}),i}};ke.exports=Ft}),Fe=z((Ys,Ee)=>{var c=U(),N=at(),Xs=ut(),mt=class{constructor(t,e,s,i,r){this.points=t;let o=this.points,l=0,u=0,a=c.angleACW(c.sub(o[1],o[0]),c.sub(o[o.length-1],o[0]));l+=a,u+=Math.PI*2-a;for(let h=1;h<o.length-1;h++)a=c.angleACW(c.sub(o[(h+1)%o.length],o[h]),c.sub(o[h-1],o[h])),l+=a,u+=Math.PI*2-a;if(a=c.angleACW(c.sub(o[0],o[o.length-1]),c.sub(o[o.length-2],o[o.length-1])),l+=a,u+=Math.PI*2-a,u<l){let h=[];for(let d=o.length-1;d>=0;d--)h.push(o[d]);this.points=h}this.calculatePosAndMass(),this.lastPos=this.pos.copy,this.fc=.4,this.rotation=0,i?this.ang=i:this.ang=0,(r||r===0)&&(this.fc=r),s?this.k=s:this.k=.8,e!=null?this.vel=e.copy:this.vel=new c(0,0),this.id="_"+Math.random().toString(36).substr(2,9)}getAmInPoint(t){let e=this.am;return e+=c.sub(this.pos,t).sqlength*this.m,e}get copy(){let t=[];for(let s=0;s<this.points.length;s++)t.push(new c(this.points[s].x,this.points[s].y));let e=new mt(t,this.vel.copy,this.k,this.ang,this.fc);return e.rotation=this.rotation,e.lastPos=this.lastPos.copy,e.pos=this.pos.copy,e}move(t,e){this.pos.x+=t,this.pos.y+=e,this.points.forEach(s=>{s.x+=t,s.y+=e})}collideWithBall(t){let e,s,i;if(c.dist(t.pos,this.pos)>t.r+this.boundRadius)return;if(this.points.forEach((r,o)=>{let l=new c(r.x,r.y);if(l.x-=t.pos.x,l.y-=t.pos.y,l.length<=t.r){e=l.heading+Math.PI,s=l.length;let f=c.fromAngle(e);f.mult(t.r-s),this.move(f.x*-1*t.m/(this.m+t.m),f.y*-1*t.m/(this.m+t.m)),t.move(f.x*1*this.m/(this.m+t.m),f.y*1*this.m/(this.m+t.m)),i=new c(r.x,r.y);let m=c.fromAngle(e);m.mult(-30)}l=new c(r.x,r.y);let u=new c(this.points[(o+1)%this.points.length].x,this.points[(o+1)%this.points.length].y),a=new c(t.pos.x,t.pos.y),h=new c(u.x-l.x,u.y-l.y),d=h.heading;l.rotate(-d+Math.PI),u.rotate(-d+Math.PI),a.rotate(-d+Math.PI);let g=a.y-(l.y+u.y)/2;if(g>=-t.r&&g<=t.r&&a.x>=u.x&&a.x<=l.x){e=d-Math.PI/2,s=g;let f=c.fromAngle(e);f.mult(t.r-s),this.move(f.x*-1*t.m/(this.m+t.m),f.y*-1*t.m/(this.m+t.m)),t.move(f.x*1*this.m/(this.m+t.m),f.y*1*this.m/(this.m+t.m)),i=t.pos.copy,i.add(c.mult(c.fromAngle(e+Math.PI),g));let m=c.fromAngle(e);m.mult(-30)}}),e===0||e){let r=this.vel.copy,o=t.vel.copy,l=this.ang,u=t.ang,a=c.sub(i,this.pos),h=c.sub(i,t.pos),d=this.am,g=t.am,f=this.m,m=t.m,p=(this.k+t.k)/2,b=(this.fc+t.fc)/2,M=h.copy;M.setMag(-1);let S=this.velInPlace(i),y=t.velInPlace(i),x=c.sub(y,S),k=1/f+1/m;k+=c.dot(c.crossScalarFirst(c.cross(a,M)/d,a),M),k=-(1+p)*c.dot(x,M)/k;let w=c.sub(r,c.mult(M,k/f)),C=c.add(o,c.mult(M,k/m)),E=l-k*c.cross(a,M)/d,X=u,T=x.copy;T.sub(c.mult(M,c.dot(x,M))),T.setMag(1);let D=1/f+1/m;D+=c.dot(c.crossScalarFirst(c.cross(a,T)/d,a),T),D+=c.dot(c.crossScalarFirst(c.cross(h,T)/g,h),T),D=-c.dot(x,T)/D;let Y=k*b;Y>D&&(Y=D),w=c.sub(w,c.mult(T,Y/f)),C=c.add(C,c.mult(T,Y/m)),E=E-Y*c.cross(a,T)/d,X=X+Y*c.cross(h,T)/g,this.vel=w,t.vel=C,this.ang=E,t.ang=X}}calculatePosAndMass(){let t=[];if(t.push([]),this.points.forEach(r=>{t[0].push(new c(r.x,r.y))}),this.isConcave){let r=(u,a)=>{for(let h=0;h<u.length;h++)if(u[h]===a)return!0;return!1},o=function(u,a,h){for(let d=0;d<a.length;d++)if(!r(h,d)){let g=new N(new c(a[d].x,a[d].y),new c(a[(d+1)%a.length].x,a[(d+1)%a.length].y));if(N.intersect(u,g))return!0}return!1},l=!0;t:for(;l;){l=!1;for(let u=0;u<t.length;u++){let a=t[u],h=c.sub(a[1],a[0]),d=c.sub(a[a.length-1],a[0]),g=c.angleACW(h,d);if(g>Math.PI){l=!0;let f=0,m=f+2,p=new N(new c(a[f].x,a[f].y),new c(a[m%a.length].x,a[m%a.length].y)),b=new c(p.b.x-p.a.x,p.b.y-p.a.y).heading;for(;!(h.heading>d.heading?b>h.heading&&b<2*Math.PI||b>0&&b<d.heading:b>h.heading&&b<d.heading)||o(new N(new c(a[f%a.length].x,a[f%a.length].y),new c(a[m%a.length].x,a[m%a.length].y)),a,[(a.length-1)%a.length,f%a.length,(m-1)%a.length,m%a.length]);)m++,p=new N(new c(a[f].x,a[f].y),new c(a[m%a.length].x,a[m%a.length].y)),b=new c(p.b.x-p.a.x,p.b.y-p.a.y).heading;let M=[],S=[];for(let y=f;y<=m;y++)M.push(a[y%a.length]);for(let y=m;y<=f+a.length;y++)S.push(a[y%a.length]);t[u]=M,t.push(S);continue t}for(let f=1;f<a.length;f++){let m=c.sub(a[(f+1)%a.length],a[f]),p=c.sub(a[f-1],a[f]),b=c.angleACW(m,p);if(b>Math.PI){l=!0;let M=f+2,S=new N(new c(a[f].x,a[f].y),new c(a[M%a.length].x,a[M%a.length].y)),y=new c(S.b.x-S.a.x,S.b.y-S.a.y).heading;for(;!(m.heading>p.heading?y>m.heading&&y<2*Math.PI||y>0&&y<p.heading:y>m.heading&&y<p.heading)||o(S,a,[(f-1)%a.length,f%a.length,(M-1)%a.length,M%a.length]);)M++,S=new N(new c(a[f].x,a[f].y),new c(a[M%a.length].x,a[M%a.length].y)),y=new c(S.b.x-S.a.x,S.b.y-S.a.y).heading;let x=[],k=[];for(let w=f;w<=M;w++)x.push(a[w%a.length]);for(let w=M;w<=f+a.length;w++)k.push(a[w%a.length]);t[u]=x,t.push(k);continue t}}}}}for(let r=t.length-1;r>=0;r--){let o=t[r];for(;o.length>3;)t.push([o[0],o[1],o[2]]),o.splice(1,1)}let e=0,s=0,i=new c(0,0);t.forEach(r=>{let o=Math.sqrt(Math.pow(r[0].x-r[1].x,2)+Math.pow(r[0].y-r[1].y,2)),l=Math.sqrt(Math.pow(r[1].x-r[2].x,2)+Math.pow(r[1].y-r[2].y,2)),u=Math.sqrt(Math.pow(r[2].x-r[0].x,2)+Math.pow(r[2].y-r[0].y,2)),a=(o+l+u)/2,h=Math.sqrt(a*(a-o)*(a-l)*(a-u));e+=h,i.x+=h*(r[0].x+r[1].x+r[2].x)/3,i.y+=h*(r[0].y+r[1].y+r[2].y)/3}),i.div(e),this.pos=i,this.m=e;for(let r of t){let o=Math.sqrt(Math.pow(r[0].x-r[1].x,2)+Math.pow(r[0].y-r[1].y,2)),l=Math.sqrt(Math.pow(r[1].x-r[2].x,2)+Math.pow(r[1].y-r[2].y,2)),u=Math.sqrt(Math.pow(r[2].x-r[0].x,2)+Math.pow(r[2].y-r[0].y,2)),a=Math.max(o,l,u),h=(o+l+u)/2,d=Math.sqrt(h*(h-o)*(h-l)*(h-u)),g=2*d/a,f=Math.sqrt(Math.min(o,u,l)**2-g*g),m=g*a*(g*g+a*a)/24,p=Math.sqrt(g*g/36+(Math.abs(f-a/2)/3)**2);m-=p*p*d,m+=new c((r[0].x+r[1].x+r[2].x)/3,(r[0].y+r[1].y+r[2].y)/3).dist(this.pos)**2*d,s+=m}this.am=s,this.boundRadius=Math.max(...this.points.map(r=>c.dist(r,this.pos)))}rotate(t){this.points.forEach(e=>{let s=new c(e.x,e.y);s.sub(this.pos),s.rotate(t),s.add(this.pos),e.x=s.x,e.y=s.y}),this.rotation+=t}get isConcave(){let t=this.points,e=c.angleACW(c.sub(t[1],t[0]),c.sub(t[t.length-1],t[0]));if(e>Math.PI)return!0;for(let s=1;s<t.length-1;s++)if(e=c.angleACW(c.sub(t[(s+1)%t.length],t[s]),c.sub(t[s-1],t[s])),e>Math.PI)return!0;return e=c.angleACW(c.sub(t[0],t[t.length-1]),c.sub(t[t.length-2],t[t.length-1])),e>Math.PI}static collide(t,e){let s=0,i=0,r=new c(0,0),o=[],l=!1;if(t.points.forEach((w,C)=>{let E=new N(new c(w.x,w.y),new c(t.points[(C+1)%t.points.length].x,t.points[(C+1)%t.points.length].y));e.points.forEach((X,T)=>{let D=new N(new c(X.x,X.y),new c(e.points[(T+1)%e.points.length].x,e.points[(T+1)%e.points.length].y)),Y=N.intersect(E,D);Y&&(s++,r.add(Y),o.push(Y),l=!0)})}),!l)return;r.div(s);for(let w=0;w<Math.floor(s/2);w++)i+=c.sub(o[2*w+1],o[2*w]).heading;i/=s/2,i+=Math.PI/2;let u=c.fromAngle(i),a=t.ang,h=t.vel.copy,d=e.ang,g=e.vel.copy,f=0,m=0,p=0,b=0;for(let w of t.points)f=Math.min(c.dot(u,c.sub(new c(w.x,w.y),r)),f),m=Math.max(c.dot(u,c.sub(new c(w.x,w.y),r)),m);for(let w of e.points)p=Math.min(c.dot(u,c.sub(new c(w.x,w.y),r)),p),b=Math.max(c.dot(u,c.sub(new c(w.x,w.y),r)),b);Math.abs(f-b)<Math.abs(p-m)?(t.move(-u.x*f,-u.y*f),e.move(-u.x*b,-u.y*b)):(t.move(-u.x*m,-u.y*m),e.move(-u.x*p,-u.y*p));let M=o,S=[],y=[],x=[],k=[];for(let w of M){let C=c.fromAngle(i),E=w,X=t.vel.copy,T=e.vel.copy,D=t.ang,Y=e.ang,H=c.sub(E,t.pos),B=c.sub(E,e.pos),K=t.am,Q=e.am,Pt=t.m,St=e.m,is=(t.k+e.k)/2,ns=(t.fc+e.fc)/2,os=t.velInPlace(E),rs=e.velInPlace(E),It=c.sub(rs,os),st=1/Pt+1/St;st+=c.dot(c.crossScalarFirst(c.cross(H,C)/K,H),C),st+=c.dot(c.crossScalarFirst(c.cross(B,C)/Q,B),C),st=-(1+is)*c.dot(It,C)/st;let Nt=c.sub(X,c.mult(C,st/Pt)),Dt=c.add(T,c.mult(C,st/St)),Wt=D-st*c.cross(H,C)/K,Ht=Y+st*c.cross(B,C)/Q,Z=It.copy;Z.sub(c.mult(C,c.dot(It,C))),Z.setMag(1);let lt=1/Pt+1/St;lt+=c.dot(c.crossScalarFirst(c.cross(H,Z)/K,H),Z),lt+=c.dot(c.crossScalarFirst(c.cross(B,Z)/Q,B),Z),lt=-c.dot(It,Z)/lt;let ht=st*ns;ht>lt&&(ht=lt),Nt=c.sub(Nt,c.mult(Z,ht/Pt)),Dt=c.add(Dt,c.mult(Z,ht/St)),Wt=Wt-ht*c.cross(H,Z)/K,Ht=Ht+ht*c.cross(B,Z)/Q,t.vel=Nt,e.vel=Dt,t.ang=Wt,e.ang=Ht,S.push(t.ang),x.push(t.vel),y.push(e.ang),k.push(e.vel),t.ang=a,t.vel=h,e.ang=d,e.vel=g}if(S.length!=x.length)return;if(S.length==0)return;if(x.length==0)return;if(y.length!=k.length)return;if(y.length==0)return;if(k.length==0)return;t.vel=x.reduce((w,C)=>c.add(w,C)),t.vel.div(x.length),t.ang=S.reduce((w,C)=>w+C),t.ang/=S.length,e.vel=k.reduce((w,C)=>c.add(w,C)),e.vel.div(k.length),e.ang=y.reduce((w,C)=>w+C),e.ang/=y.length}collideWithFixedBall(t){let e=new c(t.x,t.y),s;if(c.dist(e,this.pos)>this.boundRadius+t.r)return;for(let x of this.sides){let k,w;if(k=c.angle(c.sub(x.a,x.b),c.sub(e,x.b)),w=c.angle(c.sub(x.b,x.a),c.sub(e,x.a)),k<Math.PI/2&&w<Math.PI/2){let C=x.distFromPoint(e);if(C<=t.r){let E=c.sub(x.a,x.b);E.rotate(Math.PI/2),E.setMag(t.r*2);let X=c.mult(E,-1),T=new N(c.add(E,e),c.add(X,e));s=N.intersect(T,x),s!=null&&(E=c.sub(s,e),E.setMag(t.r-E.length),this.move(E.x,E.y))}}}if(!s||s==null){t:for(let x of this.points)if(c.dist(x,e)<t.r){let k=c.sub(x,e);k.setMag(t.r-k.length),this.move(k.x,k.y),k.setMag(t.r),s=c.add(e,k);break t}}if(!s||s==null)return;let i=c.sub(s,e);i.setMag(1);let r=s,o=this.vel.copy,l=this.ang,u=c.sub(r,this.pos),a=this.am,h=this.m,d=this.k,g=this.fc,f=c.mult(this.velInPlace(r),-1),m=1/h;m+=c.dot(c.crossScalarFirst(c.cross(u,i)/a,u),i),m=-(1+d)*c.dot(f,i)/m;let p=c.sub(o,c.mult(i,m/h)),b=l-m*c.cross(u,i)/a,M=f.copy;M.sub(c.mult(i,c.dot(f,i))),M.setMag(1);let S=1/h;S+=c.dot(c.crossScalarFirst(c.cross(u,M)/a,u),M),S=-c.dot(f,M)/S;let y=m*g;y>S&&(y=S),p=c.sub(p,c.mult(M,y/h)),b=b-y*c.cross(u,M)/a,this.vel=p,this.ang=b}collideWithWall(t){if(this.boundRadius+t.boundRadius<c.dist(this.pos,t.center))return;let e=this.sides,s=[],i=[];for(let m of e)for(let p of t.sides){let b=N.intersect(m,p);b!=null&&i.push(b)}if(i.length<2)return;let r=this.vel.copy,o=this.ang,l=[],u=[],a=c.sub(...i);a.rotate(Math.PI/2);let h=c.sub(i[0],this.pos);c.dot(a,h)>0&&a.mult(-1),a.setMag(1),c.dot(a,c.sub(this.pos,t.center))<0&&a.mult(-1),s.push(new N(...i)),s.push(new N(i[0],c.add(i[0],c.mult(a,20)))),s.push(new N(i[1],c.add(i[1],c.mult(a,20))));let d=[],g=i[0];for(let m of t.points){let p=c.sub(m,g),b=c.dot(p,a);b>0&&d.push(b)}if(d.length>0){let m=a.copy;m.mult(Math.max(...d)),this.move(m.x,m.y)}d=[];let f=c.add(...i);if(f.div(2),this.containsPoint(f))for(let m of e)d.push(m.distFromPoint(f));if(d.length>0){let m=a.copy;m.mult(Math.min(...d)),m.length<this.boundRadius/2&&this.move(m.x,m.y)}for(let m of i){let p=a;p.setMag(1);let b=m,M=this.vel.copy,S=this.ang,y=c.sub(b,this.pos),x=this.am,k=this.m,w=this.k,C=this.fc,E=c.mult(this.velInPlace(b),-1),X=1/k;X+=c.dot(c.crossScalarFirst(c.cross(y,p)/x,y),p),X=-(1+w)*c.dot(E,p)/X;let T=c.sub(M,c.mult(p,X/k)),D=S-X*c.cross(y,p)/x,Y=E.copy;Y.sub(c.mult(p,c.dot(E,p))),Y.setMag(1);let H=1/k;H+=c.dot(c.crossScalarFirst(c.cross(y,Y)/x,y),Y),H=-c.dot(E,Y)/H;let B=X*C;B>H&&(B=H),T=c.sub(T,c.mult(Y,B/k)),D=D-B*c.cross(y,Y)/x,this.vel=T,this.ang=D,l.push(this.vel),this.vel=r.copy,u.push(this.ang),this.ang=o}return u.length!=l.length||(u.length==0||l.length==0)?void 0:(this.vel=l.reduce((m,p)=>c.add(m,p)),this.vel.div(l.length),this.ang=u.reduce((m,p)=>m+p),this.ang/=u.length,(!isFinite(this.vel.x)||!isFinite(this.vel.y)||!isFinite(this.ang))&&(this.vel=r,this.ang=o),s)}containsPoint(t){let e=this.sides,s=Math.max(...this.points.map(l=>c.dist(l,t)))+1,i=c.fromAngle(0);i.setMag(s);let r=new N(t,c.add(i,t)),o=e.filter(l=>N.intersect(l,r)!=null);return o.length%2==1}get sides(){return this.points.map((t,e)=>new N(t,this.points[(e+1)%this.points.length]))}velInPlace(t){let e=c.sub(t,this.pos);return e.rotate(Math.PI/2),e.mult(this.ang),e.add(this.vel),e}effectiveMass(t,e){let s=c.sub(t,this.pos),i=c.angle(e,s),r=Math.sin(i)**2*s.length**2/this.am;return 1/(r+1/this.m)}applyDeltaVelInPoint(t,e){let s=c.sub(e,this.pos);if(s.length==0){this.vel.add(t);return}let i=c.angle(s,t),r=c.mult(s,c.dot(t,s)/s.length**2);this.vel.add(r);let o=s.copy;o.rotate(Math.PI/2),o.setMag(1);let l=Math.sign(c.dot(t,o)),u=t.length*Math.cos(i),a=1/(1/this.m+s.length**2/this.am),h=u*a/this.m;this.vel.add(c.mult(o,h*l));let d=l*u*a*s.length/this.am;console.log(i),this.ang-=d}toJSObject(){let t={};return t.points=this.points.map(e=>({x:e.x,y:e.y})),t.vel=this.vel.toJSObject(),t.k=this.k,t.ang=this.ang,t.fc=this.fc,t.pos=this.pos.toJSObject(),t.lastPos=this.lastPos.toJSObject(),t.rotation=this.rotation,t.id=this.id,t}static fromObject(t){let e=new mt(t.points.map(s=>({x:s.x,y:s.y})),c.fromObject(t.vel),t.k,t.ang,t.fc);return e.id=t.id,e.pos=c.fromObject(t.pos),e.lastPos=c.fromObject(t.lastPos),e.rotation=t.rotation,e}};Ee.exports=mt}),Gt=z((Bs,Oe)=>{var J=U(),xs=at(),Te=class extends xs{constructor(t,e){super(t,e)}get length(){return Number.POSITIVE_INFINITY}distFromPoint(t){let e=J.sub(this.a,this.b);e.setMag(1),e.rotate(Math.PI/2);let s=J.sub(t,this.a),i=Math.abs(J.dot(s,e));return i}static intersect(t,e){let s=J.sub(t.b,t.a),i=s.y/s.x,r=t.b.y-t.b.x*i,o=J.sub(e.b,e.a),l=o.y/o.x,u=e.b.y-e.b.x*l;if(i===l)return t.distFromPoint(e.a)==0?new J((t.a.x+t.b.x+e.a.x+e.b.x)/4,(t.a.y+t.b.y+e.a.y+e.b.y)/4):void 0;{let a=(u-r)/(i-l);return new J(a,i*a+r)}}static intersectWithLineSegment(t,e){let s=J.sub(t.b,t.a),i=s.y/s.x,r=t.b.y-t.b.x*i,o=J.sub(e.b,e.a),l=o.y/o.x,u=e.b.y-e.b.x*l;if(s.x===0){if(o.x===0)return t.a.x==e.a.x?new J((e.a.x+e.b.x)/2,(e.a.y+e.b.y)/2):void 0;let a=t.a.x,h=l*a+u;return Math.min(e.a.x,e.b.x)<a&&a<Math.max(e.a.x,e.b.x)&&Math.min(e.a.y,e.b.y)<h&&Math.max(e.a.y,e.b.y)>h?new J(a,h):void 0}if(o.x===0){let a=e.a.x,h=i*a+r;return Math.min(e.a.x,e.b.x)<a&&a<Math.max(e.a.x,e.b.x)&&Math.min(e.a.y,e.b.y)<h&&Math.max(e.a.y,e.b.y)>h?new J(a,h):void 0}if(i===l)return t.distFromPoint(e.a)===0?new J((e.a.x+e.b.x)/2,(e.a.y+e.b.y)/2):void 0;{let a=(u-r)/(i-l),h=i*a+r;return Math.min(e.a.x,e.b.x)<a&&a<Math.max(e.a.x,e.b.x)&&Math.min(e.a.y,e.b.y)<h&&Math.max(e.a.y,e.b.y)>h?new J(a,h):void 0}}};Oe.exports=Te}),Ye=z((js,Xe)=>{var F=U(),gt=at(),Ot=Gt(),tt=class{constructor(t){if(t.length<3)throw new Error("Not enough points in polygon (minimum required: 3)");this.points=t,this.makeAntiClockwise()}getSideVector(t){return t<0&&(t+=Math.abs(Math.floor(t))*this.points.length),F.sub(this.points[(t+1)%this.points.length],this.points[t%this.points.length])}getSideSegment(t){return t<0&&(t+=Math.abs(Math.floor(t))*this.points.length),new gt(this.points[(t+1)%this.points.length],this.points[t%this.points.length])}getSideLine(t){return t<0&&(t+=Math.abs(Math.floor(t))*this.points.length),new Ot(this.points[(t+1)%this.points.length],this.points[t%this.points.length])}get sides(){return this.points.length}makeAntiClockwise(){let t=0;for(let e=1;e<=this.sides;e++){let s=this.getSideVector(e),i=this.getSideVector(e-1);i.mult(-1),t+=F.angleACW(s,i)}if(this.sides===3)t>Math.PI*1.5&&this.reverseOrder();else if(this.sides===4)F.angleACW(this.getSideVector(1),this.getSideVector(0))>=Math.PI&&this.reverseOrder();else if(this.sides>4){let e=t-this.sides*Math.PI;e>0&&this.reverseOrder()}}reverseOrder(){this.points=this.points.reverse()}isPointInside(t){if(F.dist(t,this.centerPoint)>this.boundRadius)return!1;let e=this.centerPoint.copy;e.add(F.mult(new F(1.1,.6),this.boundRadius));let s=new gt(t,e),i=0;if([...Array(this.sides).keys()].map(r=>this.getSideSegment(r)).forEach(r=>{gt.intersect(r,s)&&i++}),i%2==0)return!1;if(i%2==1)return!0}get centerPoint(){let t=new F(0,0);return this.points.forEach(e=>{t.add(e)}),t.div(this.sides),t}get boundRadius(){let t=this.centerPoint;return Math.max(...this.points.map(e=>F.dist(e,t)))}get allSides(){return[...Array(this.sides).keys()].map(t=>this.getSideSegment(t))}static intersection(t,e){if(F.dist(t.centerPoint,e.centerPoint)>t.boundRadius+e.boundRadius)return;let s=[],i=t.allSides,r=e.allSides;if(i.forEach((d,g)=>{r.forEach((f,m)=>{let p=gt.intersect(d,f);p&&(p.isIntersectionPoint=!0,s.push({intersectionPoint:p,sideNumber1:g,sideNumber2:m}))})}),s.length===0){if(t.isPointInside(e.points[0]))return new tt(e.points.map(d=>d.copy));if(e.isPointInside(t.points[0]))return new tt(t.points.map(d=>d.copy))}let o=new tt(t.points.map(d=>d.copy));for(let d=o.points.length-1;d>=0;d--){let g=s.filter(f=>f.sideNumber1==d);g.length>1&&g.sort((f,m)=>F.dist(o.points[d],f.intersectionPoint)-F.dist(o.points[d],m.intersectionPoint)),g.length>0&&o.points.splice(d+1,0,...g.map(f=>f.intersectionPoint))}let l=new tt(e.points.map(d=>d.copy));for(let d=l.points.length-1;d>=0;d--){let g=s.filter(f=>f.sideNumber2==d);g.length>1&&g.sort((f,m)=>F.dist(l.points[d],f.intersectionPoint)-F.dist(l.points[d],m.intersectionPoint)),g.length>0&&l.points.splice(d+1,0,...g.map(f=>f.intersectionPoint))}let u={polyNum:1,pointNum:0};for(let d=0;d<o.points.length;d++)if(o.points[d].isIntersectionPoint){u.pointNum=d;break}else if(l.isPointInside(o.points[d])){u.pointNum=d;break}let a=!1,h=[];for(;!a;){let d=u.polyNum===1?o:l,g=u.polyNum===1?l:o;if(h.push(d.points[u.pointNum%d.points.length].copy),h.length>2&&h[0].x==h[h.length-1].x&&h[0].y==h[h.length-1].y){h.pop();break}if(h.length>o.points.length+l.points.length)break;d.points[u.pointNum%d.points.length].isIntersectionPoint?d.points[(u.pointNum+1)%d.points.length].isIntersectionPoint||g.isPointInside(d.points[(u.pointNum+1)%d.points.length])&&!d.points[(u.pointNum+1)%d.points.length].isIntersectionPoint?u.pointNum++:(u.pointNum=g.points.indexOf(d.points[u.pointNum%d.points.length])+1,u.polyNum=u.polyNum===1?2:1):u.pointNum++}return new tt(h)}static createCircle(t,e,s=25){let i=[...Array(s).keys()].map(r=>{let o=F.fromAngle(2*Math.PI*r/s);return o.setMag(t),o.add(e),o});return new tt(i)}static fracture(t,e=500){let s=t.map((i,r)=>{let o=[];for(let u=0;u<t.length;u++){if(r===u)continue;let a=t[u],h=F.div(F.add(i,a),2),d=F.sub(i,a);d.rotate(Math.PI/2),o.push(new Ot(h,F.add(d,h)))}o=o.filter((u,a)=>{let h=new gt(u.a,i);for(let d=0;d<o.length;d++){if(a===d)continue;let g=Ot.intersectWithLineSegment(o[d],h);if(g)return!1}return!0}),o=o.sort((u,a)=>F.sub(u.a,u.b).heading-F.sub(a.a,a.b).heading);let l=o.map((u,a)=>{let h=[];for(let g=0;g<o.length;g++){if(a===g)continue;let f=Ot.intersect(u,o[g]);f&&h.push(f)}let d=F.sub(u.a,u.b);return h=h.filter(g=>{let f=F.sub(g,i);d.setMag(1);let m=F.dot(f,d);return m>0}),h.length===0&&h.push(F.add(F.mult(d,e*1.2),u.a)),h=h.sort((g,f)=>F.dist(g,i)-F.dist(f,i)),h[0]});return l});return s.filter(i=>i.length>=3).map(i=>new tt(i))}};Xe.exports=tt}),je=z((Ls,Be)=>{Be.exports={name:"ballphysics",version:"1.6.0",description:"2D rigid body physics engine to-be",main:"./src/physics.js",scripts:{test:"jest --verbose ./tests",lint:"eslint . --ext .ts,.js",watch:'nodemon --ignore "dest/*.*" -e js,ts,css,html --exec npm run build',build:"esbuild editor/src/index.js --bundle --minify --sourcemap --target=chrome58,firefox57,safari11,edge16 --outfile=dest/main.js && cp editor/static/index.html dest/index.html"},repository:{type:"git",url:"git+https://github.com/AkosSeres/BallPhysics.git"},keywords:["physics","2d","rigid","balls"],author:"Akos Seres",license:"LGPL-2.1",bugs:{url:"https://github.com/AkosSeres/BallPhysics/issues"},homepage:"https://github.com/AkosSeres/BallPhysics#readme",devDependencies:{"@typescript-eslint/eslint-plugin":"^4.11.0","@typescript-eslint/parser":"^4.11.0",esbuild:"^0.8.26",eslint:"^6.0.1","eslint-config-google":"^0.9.1",jest:"^26.4.2",nodemon:"^2.0.6",typescript:"^4.1.3"},dependencies:{}}}),ot=z((qs,Le)=>{var O=U(),Vt=ut(),pt=Me(),bs=at(),qe=ft(),nt=Et(),Tt=Ce(),yt=Fe(),vs=Gt(),ws=Ye(),W=class{constructor(){this.balls=[],this.bodies=[],this.fixedBalls=[],this.softBalls=[],this.walls=[],this.bounds=[],this.springs=[],this.airFriction=1,this.gravity=new O(0,0),this.debugData=[]}update(t,e){this.debugData=[];let s=e?this.copy:new W;e&&(s.bodies.reverse(),s.balls.reverse(),s.update(t,!1));for(let i=0;i<this.balls.length;i++)this.balls[i].lastPos=this.balls[i].pos.copy,this.balls[i].pos.add(O.mult(this.balls[i].vel,t)),this.balls[i].rotation+=this.balls[i].ang*t,this.balls[i].rotation%=Math.PI*2;for(let i=0;i<this.bodies.length;i++)this.bodies[i].lastPos=this.bodies[i].pos.copy,this.bodies[i].move(this.bodies[i].vel.x*t,this.bodies[i].vel.y*t),this.bodies[i].rotate(this.bodies[i].ang*t);for(let i=0;i<3;i++)for(let r of this.springs)r.update(t/3/2);for(let i=0;i<this.balls.length;i++){this.gravity&&this.balls[i].vel.add(new O(this.gravity.x*t,this.gravity.y*t));for(let r=i+1;r<this.balls.length;r++)(this.balls[i].layer!=this.balls[r].layer||!this.balls[i].layer&&!this.balls[r].layer)&&Vt.collide(this.balls[i],this.balls[r]);for(let r of this.walls)r.collideWithBall(this.balls[i]);for(let r of this.fixedBalls){let o=this.balls[i],l,u=0,a=new O(r.x,r.y);a.x-=o.pos.x,a.y-=o.pos.y,a.mult(-1),a.length<=o.r+r.r&&(l=a.heading,u=a.length);t:if(isFinite(l)){let h=o.pos.copy,d=o.vel.copy;if(h.rotate(-l+Math.PI/2),d.rotate(-l+Math.PI/2),d.y>0)break t;d.y*=-o.k,h.y+=o.r+r.r-u;let g=d.y*(1+o.k),f=Math.sign(d.x+o.ang*o.r)*(g*o.fc)/(o.amc*o.r),m=(d.x+o.ang*o.r)/o.r;f/m>1&&(f=m),o.ang-=f;let p=f*o.am/o.r/o.m;d.x-=p,h.rotate(l-Math.PI/2),d.rotate(l-Math.PI/2),o.pos.x=h.x,o.pos.y=h.y,o.vel.x=d.x,o.vel.y=d.y}}for(let r of this.bounds)r.collideWithBall(this.balls[i])}for(let i=0;i<this.bodies.length;i++){for(let r of this.balls)(r.layer!=this.bodies[i].layer||!r.layer&&!this.bodies[i].layer)&&this.bodies[i].collideWithBall(r);for(let r=i+1;r<this.bodies.length;r++)(this.bodies[i].layer!=this.bodies[r].layer||!this.bodies[r].layer&&!this.bodies[i].layer)&&yt.collide(this.bodies[i],this.bodies[r]);for(let r of this.bodies)for(let o of this.fixedBalls)r.collideWithFixedBall(o);for(let r of this.bodies)for(let o of this.walls){let l=r.collideWithWall(o);l&&this.debugData.push(...l)}for(let r of this.bodies)for(let o of this.bounds){let l=r.collideWithWall(o);l&&this.debugData.push(...l)}this.gravity&&this.bodies[i].vel.add(new O(this.gravity.x*t,this.gravity.y*t))}this.softBalls.forEach(i=>{Tt.updatePressureBasedForces(i,t)});for(let i=0;i<3;i++)for(let r of this.springs)r.update(t/3/2);this.balls.forEach(i=>{i.vel.mult(Math.pow(this.airFriction,t)),i.ang*=Math.pow(this.airFriction,t)}),this.bodies.forEach(i=>{i.vel.mult(Math.pow(this.airFriction,t)),i.ang*=Math.pow(this.airFriction,t)}),e&&(s.bodies.reverse(),s.balls.reverse(),this.balls.forEach((i,r)=>{i.move((s.balls[r].pos.x-i.pos.x)*.5,(s.balls[r].pos.y-i.pos.y)*.5),i.vel.add(new O((s.balls[r].vel.x-i.vel.x)*.5,(s.balls[r].vel.y-i.vel.y)*.5)),i.rotation=(i.rotation+s.balls[r].rotation)/2,i.ang=(i.ang+s.balls[r].ang)/2}),this.bodies.forEach((i,r)=>{let o=s.bodies[r];i.move((o.pos.x-i.pos.x)*.5,(o.pos.y-i.pos.y)*.5),i.vel.add(new O((o.vel.x-i.vel.x)*.5,(o.vel.y-i.vel.y)*.5)),i.rotate((o.rotation-i.rotation)/2),i.ang=(i.ang+o.ang)/2}))}get copy(){let t=new W;return t.balls=this.getCopyOfBalls(),t.bodies=this.getCopyOfBodies(),t.fixedBalls=this.fixedBalls,t.walls=this.walls,t.bounds=this.bounds,t.gravity=this.gravity,this.springs.forEach(e=>{let s=e.constructor==nt?nt:qe,i=new s(e.length,e.springConstant);i.rotationLocked=e.rotationLocked,i.pinned=e.pinned,e.objects.forEach(r=>{let o=this.balls.indexOf(r);o!=-1?i.attachObject(t.balls[o]):(o=this.bodies.indexOf(r),o!=-1&&i.attachObject(t.bodies[o]))}),t.springs.push(i)}),t}setAirFriction(t){if(!isFinite(t))return;this.airFriction=t,this.airFriction<0&&(this.airFriction=0),this.airFriction>1&&(this.airFriction=1)}setGravity(t){this.gravity=t.copy}addBall(t){if(typeof addBodyNotBall!="undefined"&&isFinite(addBodyNotBall)&&addBodyNotBall>2){let e=(s,i,r)=>{let o=[];for(let l=0;l<r;l++){let u=O.fromAngle(l/r*2*Math.PI);u.mult(i),u.add(s),o.push(u)}return o};this.bodies.push(new yt(e(t.pos,t.r,addBodyNotBall),t.vel,t.k,t.ang,t.fc))}else this.balls.push(t)}addBody(t){this.bodies.push(t)}addSoftBall(t){this.balls.push(...t.points),this.springs.push(...t.sides),this.softBalls.push(t)}addSoftSquare(t,e,s,i,r=24,o=1){let l=new Tt(t,Math.sqrt(e*e/Math.PI),o,s,r);l.sides.forEach(h=>{h.length=.96*4*e/l.resolution}),l.points.forEach(h=>{h.vel=i.copy}),this.balls.push(...l.points),this.springs.push(...l.sides);let u=e*e*200*o,a=new nt(Math.sqrt(l.r*l.r*Math.PI),u/2);a.attachObject(l.points[0]),a.attachObject(l.points[l.resolution/2]),this.springs.push(a),a=new nt(Math.sqrt(l.r*l.r*Math.PI),u/2),a.attachObject(l.points[l.resolution/4]),a.attachObject(l.points[3*l.resolution/4]),this.springs.push(a),a=new nt(Math.sqrt(2*l.r*l.r*Math.PI),u),a.attachObject(l.points[l.resolution/8]),a.attachObject(l.points[5*l.resolution/8]),this.springs.push(a),a=new nt(Math.sqrt(2*l.r*l.r*Math.PI),u),a.attachObject(l.points[3*l.resolution/8]),a.attachObject(l.points[7*l.resolution/8]),this.springs.push(a)}addRectWall(t,e,s,i){let r=[];r.push(new O(t-s/2,e-i/2)),r.push(new O(t+s/2,e-i/2)),r.push(new O(t+s/2,e+i/2)),r.push(new O(t-s/2,e+i/2)),this.walls.push(new pt(r))}addRectBody(t,e,s,i,r,o){let l=[];l.push(new O(t-s/2,e-i/2)),l.push(new O(t+s/2,e-i/2)),l.push(new O(t+s/2,e+i/2)),l.push(new O(t-s/2,e+i/2)),this.bodies.push(new yt(l,new O(0,0),o,0,r))}addWall(t){this.walls.push(t)}addFixedBall(t,e,s){this.fixedBalls.push({x:t,y:e,r:s})}addSpring(t){this.springs.push(t)}setBounds(t,e,s,i){this.bounds=[];let r=(o,l,u,a)=>{let h=[];return h.push(new O(o-u/2,l-a/2)),h.push(new O(o+u/2,l-a/2)),h.push(new O(o+u/2,l+a/2)),h.push(new O(o-u/2,l+a/2)),new pt(h)};this.bounds.push(r(t-s,e,2*s,4*i)),this.bounds.push(r(t+2*s,e,2*s,4*i)),this.bounds.push(r(t,e-i,4*s,i*2)),this.bounds.push(r(t,e+2*i,4*s,2*i))}getObjectAtCoordinates(t,e){let s=!1,i=new O(t,e);return this.balls.forEach(r=>{r.containsPoint(i)&&(s=r)}),this.bodies.forEach(r=>{r.containsPoint(i)&&(s=r)}),this.walls.forEach(r=>{r.containsPoint(i)&&(s=r)}),this.fixedBalls.forEach(r=>{O.dist(new O(r.x,r.y),new O(t,e))<=r.r&&(s=r)}),this.softBalls.forEach(r=>{r.containsPoint(i)&&(s=r)}),s}getCopyOfBalls(){let t=[];return this.balls.forEach(e=>{t.push(e.copy)}),t}getCopyOfBodies(){let t=[];return this.bodies.forEach(e=>{t.push(e.copy)}),t}removeObjFromSystem(t){let e=this.balls.indexOf(t);if(e!=-1){let s=!1;if(this.softBalls.forEach(i=>{i.points.includes(this.balls[e])&&(this.removeObjFromSystem(i),s=!0)}),s)return;this.springs.forEach(i=>{i.objects.includes(this.balls[e])&&this.removeObjFromSystem(i)}),this.balls.splice(e,1);return}if(e=this.bodies.indexOf(t),e!=-1){this.bodies.splice(e,1);return}if(e=this.walls.indexOf(t),e!=-1){this.walls.splice(e,1);return}if(e=this.fixedBalls.indexOf(t),e!=-1){this.fixedBalls.splice(e,1);return}if(e=this.springs.indexOf(t),e!=-1){this.springs.splice(e,1);let s=!1;return this.softBalls.forEach(i=>{i.points.includes(this.springs[e])&&(this.removeObjFromSystem(i),s=!0)}),s,void 0}if(e=this.softBalls.indexOf(t),e!=-1){let s=this.softBalls[e];this.softBalls.splice(e,1),s.points.forEach(i=>{this.removeObjFromSystem(i)});return}}getItemDataFromId(){let t={},e=o=>o.id===id,s=this.balls.filter(e);if(s.length>=1)return t.type="ball",t.num=this.balls.indexOf(s[0]),t;let i=this.bodies.filter(e);if(i.length>=1)return t.type="body",t.num=this.bodies.indexOf(i[0]),t;let r=this.springs.filter(e);if(r.length>=1)return t.type="spring",t.num=this.springs.indexOf(r[0]),t}toJSObject(){let t={};return t.balls=this.balls.map(e=>e.toJSObject()),t.bounds=this.bounds.map(e=>e.toJSObject()),t.walls=this.walls.map(e=>e.toJSObject()),t.bodies=this.bodies.map(e=>e.toJSObject()),t.springs=this.springs.map(e=>e.toJSObject()),t.softBalls=this.softBalls.map(e=>e.toJSObject()),t.fixedBalls=this.fixedBalls,t.airFriction=this.airFriction,t.gravity=this.gravity.toJSObject(),t.version=je().version,t}static fromObject(t){let e=new W;return e.balls=t.balls.map(s=>Vt.fromObject(s)),e.bounds=t.bounds.map(s=>pt.fromObject(s)),e.walls=t.walls.map(s=>pt.fromObject(s)),e.bodies=t.bodies.map(s=>yt.fromObject(s)),e.springs=t.springs.map(s=>nt.fromObject(s,e.balls)),e.softBalls=t.softBalls.map(s=>Tt.fromObject(s,e.balls,e.springs)),e.fixedBalls=t.fixedBalls,e.airFriction=t.airFriction,e.gravity=O.fromObject(t.gravity),e}toJSON(){return JSON.stringify(this.toJSObject())}static fromJSON(t){return W.fromObject(JSON.parse(t))}};W.Ball=Vt;W.Body=yt;W.Vec2=O;W.Wall=pt;W.LineSegment=bs;W.Spring=nt;W.Stick=qe;W.SoftBall=Tt;W.Line=vs;W.Polygon=ws;Le.exports=W}),fe=$(ot()),me=$(ut()),et=$(U()),ts=$(Et()),ge=$(ft()),Re=$(ot());function Ne(n){this.startingState=n.getPhysics().toJSObject(),this.inStartingState=!0,document.getElementById("pause").onclick=()=>{n.getTimeMultiplier()!==0?n.setTimeMultiplier(0):(n.setTimeMultiplier(1),this.inStartingState==!0&&(this.startingState=n.getPhysics().toJSObject()),this.inStartingState=!1)},document.getElementById("revert").onclick=()=>{n.setTimeMultiplier(0),n.setPhysics(Re.default.fromObject(this.startingState)),this.inStartingState=!0},document.getElementById("clear all").onclick=()=>{this.inStartingState=!0;let t=n.getPhysics();t.balls=[],t.walls=[],t.softBalls=[],t.springs=[],t.bodies=[]},document.getElementById("set start").onclick=()=>{this.startingState=n.getPhysics().toJSObject(),this.inStartingState=!0,n.setTimeMultiplier(0)}}var de={};ds(de,{BallCreatorMode:()=>De,DeleteMode:()=>We,ElasticBallCreatorMode:()=>He,MoveMode:()=>Ve,RectangleBodyMode:()=>Ue,RectangleMode:()=>ze,SoftSquareCreatorMode:()=>Ke,SpringCreatorMode:()=>Ze,StickCreatorMode:()=>_e,WallDrawerMode:()=>Ae});var Yt=$(ot());function R(n){let t=document.createElement("div"),e=document.createElement("h3");return e.innerText=n,e.classList.add("modetitlemargin"),t.appendChild(e),t.classList.add("mode-title"),t.classList.add("bg-blue"),t}function q(n,t,e,s,i,r=1){let o=document.createElement("p");o.innerText=n;let l=document.createElement("input");l.type="range",l.min=t.toString(),l.max=e.toString(),l.step=r.toString(),l.value=s.toString(),l.classList.add("slider"),l.classList.add("fix-width"),l.onchange=i;let u=document.createElement("div");return u.appendChild(o),u.appendChild(l),u}function Xt(n,t,e){let s=n+Math.random().toString(),i=document.createElement("label");i.innerText=n,i.htmlFor=s,i.classList.add("checkbox-label");let r=document.createElement("input");r.type="checkbox",r.name=s,r.value=t.toString(),r.classList.add("ch-box"),r.onchange=e;let o=document.createElement("div");return o.appendChild(r),o.appendChild(i),o}var Bt=35,zt=.5,Ut=1.5,Kt=document.createElement("div"),De={name:"Ball creator",description:"",element:Kt,drawFunc:function(n,t){let e=n.cnv.getContext("2d");e.strokeStyle="black",e.beginPath(),e.arc(n.mouseX,n.mouseY,Bt,0,2*Math.PI),e.stroke(),n.lastX!=0&&n.lastY!=0&&(e.beginPath(),e.moveTo(n.mouseX,n.mouseY),e.lineTo(n.lastX,n.lastY),e.stroke())},startInteractionFunc:function(n){},endInteractionFunc:function(n){if(n.lastX!=0&&n.lastY!=0){let t=new Yt.default.Ball(new Yt.default.Vec2(n.lastX,n.lastY),new Yt.default.Vec2(n.lastX-n.mouseX,n.lastY-n.mouseY),Bt,zt,0,Ut);isFinite(t.pos.x)&&isFinite(t.pos.y)&&isFinite(t.vel.x)&&isFinite(t.vel.y)||(t.vel.x=0,t.vel.y=0),n.physics.addBall(t)}},keyGotUpFunc:function(n){},keyGotDownFunc:function(n){}};[R(De.name),q("Size",5,120,Bt,n=>{Bt=n.target.valueAsNumber}),q("Bounciness",0,1,zt,n=>{zt=n.target.valueAsNumber},.02),q("Coefficient of friction",0,2,Ut,n=>{Ut=n.target.valueAsNumber},.1)].forEach(Kt.appendChild.bind(Kt));var Qt=document.createElement("div"),We={name:"Delete",description:"",element:Qt,drawFunc:function(n,t){},startInteractionFunc:function(n){n.choosed&&n.physics.removeObjFromSystem(n.choosed)},endInteractionFunc:function(n){},keyGotUpFunc:function(n){},keyGotDownFunc:function(n){}};[R(We.name)].forEach(Qt.appendChild.bind(Qt));var xt=$(ot()),bt=35,Ms=.5,jt=1.5,Zt=24,$t=1e6,_t=document.createElement("div"),He={name:"Elastic ball creator",description:"",element:_t,drawFunc:function(n,t){let e=n.cnv.getContext("2d");e.strokeStyle="black",e.beginPath(),e.arc(n.mouseX,n.mouseY,bt,0,2*Math.PI),e.stroke(),n.lastX!=0&&n.lastY!=0&&(e.beginPath(),e.moveTo(n.mouseX,n.mouseY),e.lineTo(n.lastX,n.lastY),e.stroke())},startInteractionFunc:function(n){},endInteractionFunc:function(n){if(n.lastX!=0&&n.lastY!=0){let t=new xt.default.Ball(new xt.default.Vec2(n.lastX,n.lastY),new xt.default.Vec2(n.lastX-n.mouseX,n.lastY-n.mouseY),bt,Ms,0,jt);if(isFinite(t.pos.x)&&isFinite(t.pos.y)&&isFinite(t.vel.x)&&isFinite(t.vel.y)){let e=new xt.default.SoftBall(t.pos,bt,$t,jt,Zt);e.points.forEach(s=>{s.vel=t.vel.copy}),n.physics.addSoftBall(e)}}},keyGotUpFunc:function(n){},keyGotDownFunc:function(n){}};[R(He.name),q("Size",5,60,bt,n=>{bt=n.target.valueAsNumber}),q("Pressure",5e5,3e6,$t,n=>{$t=n.target.valueAsNumber},4e3),q("Coefficient of friction",0,2,jt,n=>{jt=n.target.valueAsNumber},.1),q("Resolution",6,24,Zt,n=>{Zt=n.target.valueAsNumber},1)].forEach(_t.appendChild.bind(_t));var Je=0,Ge=0,At=document.createElement("div"),Ve={name:"Move",description:"",element:At,drawFunc:function(n,t){n.choosed&&!n.choosed.pinPoint&&(n.choosed.move(n.mouseX-n.choosed.pos.x,n.mouseY-n.choosed.pos.y),t===0?(n.choosed.vel.x=0,n.choosed.vel.y=0):(n.choosed.vel.x=(n.mouseX-Je)/t,n.choosed.vel.y=(n.mouseY-Ge)/t),n.choosed.ang=0),Je=n.mouseX,Ge=n.mouseY},startInteractionFunc:function(n){},endInteractionFunc:function(n){},keyGotUpFunc:function(n){},keyGotDownFunc:function(n){}};[R(Ve.name)].forEach(At.appendChild.bind(At));var te=document.createElement("div"),ze={name:"Rectangle wall",description:"",element:te,drawFunc:function(n,t){if(n.lastX!=0&&n.lastY!=0){let e=n.cnv.getContext("2d");e.strokeStyle="black",e.strokeRect(n.mouseX,n.mouseY,n.lastX-n.mouseX,n.lastY-n.mouseY)}},startInteractionFunc:function(n){},endInteractionFunc:function(n){n.lastX!=0&&n.lastY!=0&&n.physics.addRectWall(n.lastX/2+n.mouseX/2,n.lastY/2+n.mouseY/2,2*Math.abs(n.lastX/2-n.mouseX/2),2*Math.abs(n.lastY/2-n.mouseY/2))},keyGotUpFunc:function(n){},keyGotDownFunc:function(n){}};[R(ze.name)].forEach(te.appendChild.bind(te));var ee=.2,se=.5,ie=document.createElement("div"),Ue={name:"Rectangle body (experimental)",description:"",element:ie,drawFunc:function(n,t){let e=n.cnv.getContext("2d");n.lastX!=0&&n.lastY!=0&&(e.strokeStyle="black",e.strokeRect(n.mouseX,n.mouseY,n.lastX-n.mouseX,n.lastY-n.mouseY))},startInteractionFunc:function(n){},endInteractionFunc:function(n){n.lastX!=0&&n.lastY!=0&&n.physics.addRectBody(n.lastX/2+n.mouseX/2,n.lastY/2+n.mouseY/2,2*Math.abs(n.lastX/2-n.mouseX/2),2*Math.abs(n.lastY/2-n.mouseY/2),se,ee)},keyGotUpFunc:function(n){},keyGotDownFunc:function(n){}};[R(Ue.name),q("Bounciness",.07,.3,ee,n=>{ee=n.target.valueAsNumber},.02),q("Coefficient of friction",0,.6,se,n=>{se=n.target.valueAsNumber},.1)].forEach(ie.appendChild.bind(ie));var Lt=$(ot()),G=35,Ps=.5,qt=1.5,ne=24,oe=1,re=document.createElement("div"),Ke={name:"Soft square creator",description:"",element:re,drawFunc:function(n,t){let e=n.cnv.getContext("2d");e.strokeStyle="black",e.beginPath(),e.moveTo(n.mouseX-G,n.mouseY-G),e.lineTo(n.mouseX+G,n.mouseY-G),e.lineTo(n.mouseX+G,n.mouseY+G),e.lineTo(n.mouseX-G,n.mouseY+G),e.lineTo(n.mouseX-G,n.mouseY-G),e.stroke(),n.lastX!=0&&n.lastY!=0&&(e.beginPath(),e.moveTo(n.mouseX,n.mouseY),e.lineTo(n.lastX,n.lastY),e.stroke())},startInteractionFunc:function(n){},endInteractionFunc:function(n){if(n.lastX!=0&&n.lastY!=0){let t=new Lt.default.Ball(new Lt.default.Vec2(n.lastX,n.lastY),new Lt.default.Vec2(n.lastX-n.mouseX,n.lastY-n.mouseY),G,Ps,0,qt);isFinite(t.pos.x)&&isFinite(t.pos.y)&&isFinite(t.vel.x)&&isFinite(t.vel.y)&&n.physics.addSoftSquare(t.pos,G*2,qt,t.vel,ne,oe)}},keyGotUpFunc:function(n){},keyGotDownFunc:function(n){}};[R(Ke.name),q("Size",5,100,G,n=>{G=n.target.valueAsNumber}),q("Pressure",.4,7,oe,n=>{oe=n.target.valueAsNumber},.1),q("Coefficient of friction",0,2,qt,n=>{qt=n.target.valueAsNumber},.1),q("Resolution",16,48,ne,n=>{ne=n.target.valueAsNumber},8)].forEach(re.appendChild.bind(re));var Qe=$(ot()),ae=!1,vt=5e3,le=document.createElement("div"),Ze={name:"Spring creator",description:"",element:le,drawFunc:function(n,t){let e=n.cnv.getContext("2d");n.lastX!=0&&n.lastY!=0&&(e.strokeStyle="black",e.beginPath(),e.moveTo(n.mouseX,n.mouseY),e.lineTo(n.lastX,n.lastY),e.stroke())},startInteractionFunc:function(n){},endInteractionFunc:function(n){if(n.lastX!=0&&n.lastY!=0){t:{let t=n.physics.getObjectAtCoordinates(n.mouseX,n.mouseY),e,s=Qe.default.Spring;if(t||(t={x:n.mouseX,y:n.mouseY,pinPoint:!0}),n.choosed==t||n.choosed==null&&t==null)break t;if(n.choosed.pinPoint&&t.pinPoint)break t;n.choosed.pinPoint?(e=new s(Math.sqrt(Math.pow(n.choosed.x-t.pos.x,2)+Math.pow(n.choosed.y-t.pos.y,2)),vt),e.attachObject(t),e.pinHere(n.choosed.x,n.choosed.y)):t.pinPoint?(e=new s(Math.sqrt(Math.pow(n.choosed.pos.x-t.x,2)+Math.pow(n.choosed.pos.y-t.y,2)),vt),e.attachObject(n.choosed),e.pinHere(t.x,t.y)):(e=new s(Math.sqrt(Math.pow(n.choosed.pos.x-t.pos.x,2)+Math.pow(n.choosed.pos.y-t.pos.y,2)),vt),e.attachObject(n.choosed),e.attachObject(t)),n.physics.addSpring(e),ae&&e.lockRotation()}}},keyGotUpFunc:function(n){},keyGotDownFunc:function(n){}};[R(Ze.name),Xt("Rotation locked",ae,n=>{ae=n.target.checked}),q("Spring stiffness",1e3,5e4,vt,n=>{vt=n.target.valueAsNumber},50)].forEach(le.appendChild.bind(le));var $e=$(ot()),he=!1,ce=document.createElement("div"),_e={name:"Stick creator",description:"",element:ce,drawFunc:function(n,t){let e=n.cnv.getContext("2d");n.lastX!=0&&n.lastY!=0&&(e.strokeStyle="black",e.beginPath(),e.moveTo(n.mouseX,n.mouseY),e.lineTo(n.lastX,n.lastY),e.stroke())},startInteractionFunc:function(n){},endInteractionFunc:function(n){if(n.lastX!=0&&n.lastY!=0){t:{let t=n.physics.getObjectAtCoordinates(n.mouseX,n.mouseY),e,s=$e.default.Stick;if(t||(t={x:n.mouseX,y:n.mouseY,pinPoint:!0}),n.choosed==t||n.choosed==null&&t==null)break t;if("pinPoint"in(n==null?void 0:n.choosed)&&"pinPoint"in t)break t;"pinPoint"in(n==null?void 0:n.choosed)?(e=new s(Math.sqrt(Math.pow(n.choosed.x-t.pos.x,2)+Math.pow(n.choosed.y-t.pos.y,2))),e.attachObject(t),e.pinHere(n.choosed.x,n.choosed.y)):t.pinPoint?(e=new s(Math.sqrt(Math.pow(n.choosed.pos.x-t.x,2)+Math.pow(n.choosed.pos.y-t.y,2))),e.attachObject(n.choosed),e.pinHere(t.x,t.y)):(e=new s(Math.sqrt(Math.pow(n.choosed.pos.x-t.pos.x,2)+Math.pow(n.choosed.pos.y-t.pos.y,2))),e.attachObject(n.choosed),e.attachObject(t)),n.physics.addSpring(e),he&&e.lockRotation()}}},keyGotUpFunc:function(n){},keyGotDownFunc:function(n){}};[R(_e.name),Xt("Rotation locked",he,n=>{he=n.target.checked})].forEach(ce.appendChild.bind(ce));var Rt=20,ue=document.createElement("div"),Ae={name:"Wall drawer",description:"",element:ue,drawFunc:function(n,t){let e=n.cnv.getContext("2d");e.strokeStyle="black",e.beginPath(),e.arc(n.mouseX,n.mouseY,Rt,0,2*Math.PI),e.stroke(),n.lastX!=0&&n.lastY!=0&&n.physics.addFixedBall(n.mouseX,n.mouseY,Rt)},startInteractionFunc:function(n){},endInteractionFunc:function(n){},keyGotUpFunc:function(n){},keyGotDownFunc:function(n){}};[R(Ae.name),q("Size",5,70,Rt,n=>{Rt=n.target.valueAsNumber})].forEach(ue.appendChild.bind(ue));var wt=["BallCreatorMode","RectangleMode","WallDrawerMode","StickCreatorMode","SpringCreatorMode","MoveMode","ElasticBallCreatorMode","SoftSquareCreatorMode","DeleteMode","RectangleBodyMode"],Mt=wt.map(n=>de[n]),rt={white:"#faf3dd",green:"#02c39a",pink:"#e58c8a",blue:"#77b6ea",black:"#363732"},es=class{constructor(){this.resizeCanvas=()=>{let t=this.canvasHolder.getBoundingClientRect();this.cnv.width=t.width,this.cnv.height=window.innerHeight-t.top;let e=window.devicePixelRatio||1,s=t;this.cnv.width=s.width*e,this.cnv.height=s.height*e,this.cnv.style.width=s.width+"px",this.cnv.style.height=s.height+"px",this.scaling=1/e,this.physics.setBounds(0,0,this.cnv.width,this.cnv.height);let i=this.cnv.getContext("2d");i.scale(e,e),i.lineWidth=e,this.defaultSize=(this.cnv.width+this.cnv.height)/80};this.drawFunction=()=>{isFinite(this.lastFrameTime)||(this.lastFrameTime=performance.now());let t=performance.now()-this.lastFrameTime;isFinite(t)||(t=0),t/=1e3;let e=this.cnv.getContext("2d");e.fillStyle=rt.black,e.fillRect(0,0,this.cnv.width,this.cnv.height),e.save(),e.translate(this.viewOffsetX,this.viewOffsetY),e.scale(this.scaling,this.scaling),Mt[this.mode].drawFunc(this,t*this.timeMultiplier),this.physicsDraw(),e.restore(),this.physics.balls[0]&&(this.right&&(this.physics.balls[0].ang-=Math.PI*100*t),this.left&&(this.physics.balls[0].ang+=Math.PI*100*t)),t*=this.timeMultiplier,this.physics.update(t/5,!1),this.physics.update(t/5,!1),this.physics.update(t/5,!1),this.physics.update(t/5,!1),this.physics.update(t/5,!1),this.lastFrameTime=performance.now(),requestAnimationFrame(this.drawFunction)};this.startInteraction=(t,e)=>{this.mouseX=t/this.scaling-this.viewOffsetX/this.scaling,this.mouseY=e/this.scaling-this.viewOffsetY/this.scaling,this.choosed=this.physics.getObjectAtCoordinates(this.mouseX,this.mouseY),this.choosed||(this.choosed={x:this.mouseX,y:this.mouseY,pinPoint:!0}),this.lastX=this.mouseX,this.lastY=this.mouseY,Mt[this.mode].startInteractionFunc(this)};this.endInteraction=(t,e)=>{if(this.mouseX=t/this.scaling-this.viewOffsetX/this.scaling,this.mouseY=e/this.scaling-this.viewOffsetY/this.scaling,Mt[this.mode].endInteractionFunc(this),this.lastX===0&&this.lastY===0)return;this.lastX=0,this.lastY=0,this.choosed=!1};this.keyGotDown=t=>{let e=t.key;e==="s"&&this.spawnNewtonsCradle(this.cnv.width/2,this.cnv.height/2,.5,this.physics),e==="a"&&(this.scaling+=.01),e==="d"&&(this.scaling-=.01),e==="j"&&(this.viewOffsetX-=10),e==="l"&&(this.viewOffsetX+=10),e==="k"&&(this.viewOffsetY-=10),e==="i"&&(this.viewOffsetY+=10),e==="ArrowRight"&&(this.right=!0),e==="ArrowLeft"&&(this.left=!0)};this.keyGotUp=t=>{let e=t.key;e==="ArrowRight"&&(this.right=!1),e==="ArrowLeft"&&(this.left=!1)};this.startTouch=t=>{t.preventDefault();let e=this.canvasHolder.getBoundingClientRect();return this.startInteraction(t.changedTouches[0].clientX-e.left,t.changedTouches[0].clientY-e.top),!1};this.endTouch=t=>{t.preventDefault();let e=this.canvasHolder.getBoundingClientRect();return this.endInteraction(t.changedTouches[0].clientX-e.left,t.changedTouches[0].clientY-e.top),!1};this.moveTouch=t=>{t.preventDefault();let e=this.canvasHolder.getBoundingClientRect();return this.mouseX=t.changedTouches[0].clientX-e.left,this.mouseY=t.changedTouches[0].clientY-e.top,this.mouseX=this.mouseX/this.scaling-this.viewOffsetX/this.scaling,this.mouseY=this.mouseY/this.scaling-this.viewOffsetY/this.scaling,!1};this.startMouse=t=>(this.startInteraction(t.offsetX,t.offsetY),!1);this.endMouse=t=>(this.endInteraction(t.offsetX,t.offsetY),!1);this.handleMouseMovement=t=>{this.mouseX=t.offsetX,this.mouseY=t.offsetY,this.mouseX=this.mouseX/this.scaling-this.viewOffsetX/this.scaling,this.mouseY=this.mouseY/this.scaling-this.viewOffsetY/this.scaling};this.physicsDraw=()=>{let t=this.cnv.getContext("2d");t.fillStyle=rt.green,t.strokeStyle="black";for(let s=0;s<this.physics.balls.length;s++){let i=this.physics.balls[s];t.beginPath(),t.arc(i.pos.x,i.pos.y,i.r,0,2*Math.PI),t.stroke(),t.fill(),t.beginPath(),t.moveTo(i.pos.x,i.pos.y),t.lineTo(i.pos.x+i.r*Math.cos(i.rotation),i.pos.y+i.r*Math.sin(i.rotation)),t.stroke()}this.physics.bodies.forEach(s=>{t.beginPath(),t.moveTo(s.points[s.points.length-1].x,s.points[s.points.length-1].y),s.points.forEach(i=>{t.lineTo(i.x,i.y)}),t.stroke(),t.fill(),t.beginPath(),t.arc(s.pos.x,s.pos.y,1.5,0,Math.PI*2),t.stroke()});let e=s=>{t.beginPath(),t.moveTo(s.points[s.points.length-1].x,s.points[s.points.length-1].y),s.points.forEach(i=>{t.lineTo(i.x,i.y)}),t.fill()};t.fillStyle="white",this.physics.walls.forEach(e),this.physics.bounds.forEach(e),this.physics.fixedBalls.forEach(s=>{t.beginPath(),t.arc(s.x,s.y,s.r,0,Math.PI*2),t.fill()}),t.save(),t.lineWidth=2,this.physics.springs.forEach(s=>{if(s instanceof ts.default&&!(s instanceof ge.default)){let i,r,o,l;s.pinned?(i=s.pinned.x,r=s.pinned.y,o=s.objects[0].pos.x,l=s.objects[0].pos.y):(i=s.objects[0].pos.x,r=s.objects[0].pos.y,o=s.objects[1].pos.x,l=s.objects[1].pos.y);let u=new et.default(o-i,l-r),a=u.copy;u.rotate(Math.PI/2),u.setMag(5);let h=new et.default(i,r),d=Math.floor(s.length/10);for(let g=1;g<=d;g++)t.strokeStyle=rt.blue,t.fillStyle=rt.blue,g===d&&(u=new et.default(0,0)),t.beginPath(),t.moveTo(h.x,h.y),t.lineTo(i+g/d*a.x+u.x,r+g/d*a.y+u.y),t.stroke(),h=new et.default(i+g/d*a.x+u.x,r+g/d*a.y+u.y),u.mult(-1)}else t.strokeStyle=rt.blue,t.fillStyle=rt.blue,t.beginPath(),t.moveTo(s.objects[0].pos.x,s.objects[0].pos.y),t.lineTo(s.pinned?s.pinned.x:s.objects[1].pos.x,s.pinned?s.pinned.y:s.objects[1].pos.y),t.stroke();s.objects.forEach(i=>{t.strokeStyle="black",t.fillStyle=rt.blue,t.beginPath(),t.arc(i.pos.x,i.pos.y,2.5,0,Math.PI*2),t.fill(),t.stroke()}),s.pinned&&(t.strokeStyle="black",t.fillStyle=rt.blue,t.beginPath(),t.arc(s.pinned.x,s.pinned.y,3,0,Math.PI*2),t.fill(),t.stroke())}),t.restore();for(let s of this.physics.debugData)t.strokeStyle="red",t.beginPath(),t.moveTo(s.a.x,s.a.y),t.lineTo(s.b.x,s.b.y),t.stroke()};this.spawnNewtonsCradle=(t,e,s,i)=>{let r=[],o=25,l=250,u=8;r.push(new me.default(new et.default(t,e),new et.default(0,0),s*o,1,0,0));let a=1;for(let h=0;h<u-1;h++)r.push(new me.default(new et.default(t+a*s*o*1.01*2,e),new et.default(0,0),s*25,1,0,0)),a*=-1,a>0&&(a+=1),h===u-2&&(r[r.length-1].vel.x=-Math.sign(a)*s*o*8);r.forEach(h=>{i.addBall(h);let d=new ge.default(l);d.attachObject(h),d.pinHere(h.pos.x,h.pos.y-l),i.addSpring(d),d.lockRotation()})};this.modeButtonClicked=t=>{let e=t.target.id.replace("-btn",""),s=wt.indexOf(e);this.switchToMode(s)};this.switchToMode=t=>{let e=document.getElementById(wt[this.mode]+"-btn");e.classList.remove("bg-pink-darker"),this.sidebar.innerHTML="";let s=document.getElementById(wt[t]+"-btn");s.classList.add("bg-pink-darker"),this.mode=t,this.sidebar.appendChild(Mt[this.mode].element)};this.setupModes=()=>{let t=document.getElementById("button-holder");wt.forEach((e,s)=>{let i=document.createElement("div");i.classList.add("big-button"),i.classList.add("fix-width"),i.id=e+"-btn",i.textContent=Mt[s].name,i.onclick=this.modeButtonClicked,t.appendChild(i)}),this.switchToMode(this.mode)};this.setTimeMultiplier=t=>{isFinite(t)&&(this.timeMultiplier=t)};this.getTimeMultiplier=()=>this.timeMultiplier;this.setPhysics=t=>{t instanceof fe.default&&(this.physics=t)};this.getPhysics=()=>this.physics;this.physics=new fe.default,this.mouseX=0,this.mouseY=0,this.mouseDown=0,this.defaultSize=30,this.k=.5,this.fc=2,this.springConstant=2e3,this.scaling=1,this.viewOffsetX=0,this.viewOffsetY=0,this.mode=0,this.lastX=0,this.lastY=0,this.timeMultiplier=1,this.lastFrameTime=performance.now(),this.choosed=!1,this.left=!1,this.right=!1,window.onload=()=>{this.cnv=document.getElementById("defaulCanvas0"),this.canvasHolder=document.getElementById("canvas-holder"),this.sidebar=document.getElementById("sidebar"),this.physics.setBounds(0,0,this.cnv.width,this.cnv.height),this.physics.setGravity(new et.default(0,1e3)),this.physics.setAirFriction(.9),this.cnv.addEventListener("touchstart",this.startTouch,!1),this.cnv.addEventListener("touchend",this.endTouch,!1),this.cnv.addEventListener("touchmove",this.moveTouch,!1),this.cnv.addEventListener("mousedown",this.startMouse,!1),this.cnv.addEventListener("mouseup",this.endMouse,!1),this.cnv.addEventListener("mousemove",this.handleMouseMovement,!1),document.addEventListener("keydown",this.keyGotDown,!1),document.addEventListener("keyup",this.keyGotUp,!1),window.addEventListener("resize",this.resizeCanvas,!1),this.cnv.addEventListener("mousedown",()=>{this.mouseDown=1},!1),this.cnv.addEventListener("mouseup",()=>{this.mouseDown=0},!1),this.resizeCanvas(),this.setupModes(),Ne(this),requestAnimationFrame(this.drawFunction)}}},ss=es;window.editorApp=new ss;})();
//# sourceMappingURL=main.js.map

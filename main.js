(()=>{var Ne=Object.create,Bt=Object.defineProperty,Xe=Object.getPrototypeOf,Ye=Object.prototype.hasOwnProperty,Je=Object.getOwnPropertyNames,Ve=Object.getOwnPropertyDescriptor,He=p=>Bt(p,"__esModule",{value:!0}),W=(p,t)=>()=>(t||(t={exports:{}},p(t.exports,t)),t.exports),Ge=(p,t,e)=>{if(He(p),t&&typeof t=="object"||typeof t=="function")for(let i of Je(t))!Ye.call(p,i)&&i!=="default"&&Bt(p,i,{get:()=>t[i],enumerable:!(e=Ve(t,i))||e.enumerable});return p},Wt=p=>p&&p.__esModule?p:Ge(Bt(p!=null?Ne(Xe(p)):{},"default",{value:p,enumerable:!0}),p),U=W((Ss,Dt)=>{var N=class{constructor(t,e){this.x=t,this.y=e}get copy(){return new N(this.x,this.y)}get length(){return Math.sqrt(this.x*this.x+this.y*this.y)}get sqlength(){return this.x*this.x+this.y*this.y}get heading(){if(this.x===0&&this.y===0)return 0;if(this.x===0)return this.y>0?Math.PI/2:1.5*Math.PI;if(this.y===0)return this.x>0?0:Math.PI;let t=N.normalized(this);return this.x>0&&this.y>0?Math.asin(t.y):this.x<0&&this.y>0?Math.asin(-t.x)+Math.PI/2:this.x<0&&this.y<0?Math.asin(-t.y)+Math.PI:this.x>0&&this.y<0?Math.asin(t.x)+1.5*Math.PI:0}add(t){this.x+=t.x,this.y+=t.y}sub(t){this.x-=t.x,this.y-=t.y}mult(t){this.x*=t,this.y*=t}div(t){this.x/=t,this.y/=t}lerp(t,e){this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e}dist(t){return new N(this.x-t.x,this.y-t.y).length}setMag(t){if(this.length===0)return;this.mult(t/this.length)}rotate(t){let e=this.heading,i=N.fromAngle(t+e);i.mult(this.length),this.x=i.x,this.y=i.y}static add(t,e){return new N(t.x+e.x,t.y+e.y)}static sub(t,e){return new N(t.x-e.x,t.y-e.y)}static mult(t,e){return new N(t.x*e,t.y*e)}static div(t,e){return new N(t.x/e,t.y/e)}static fromAngle(t){return new N(Math.cos(t),Math.sin(t))}static lerp(t,e,i){return N.add(t,N.mult(N.sub(e,t),i))}static dist(t,e){return N.sub(t,e).length}static dot(t,e){return t.x*e.x+t.y*e.y}static cross(t,e){return t.x*e.y-t.y*e.x}static crossScalarFirst(t,e){return new N(-e.y*t,e.x*t)}static crossScalarSecond(t,e){return new N(t.y*e,-t.x*e)}static angle(t,e){return Math.acos(Math.min(Math.max(N.dot(t,e)/Math.sqrt(t.sqlength*e.sqlength),1),-1))}static angleACW(t,e){let i=t.heading,s=e.heading,n=s-i;return n<0?2*Math.PI+n:n}static normalized(t){let e=t.length;return e===0?t:new N(t.x/e,t.y/e)}toJSObject(){let t={};return t.x=this.x,t.y=this.y,t}static fromObject(t){return new N(t.x,t.y)}};Dt.exports=N}),xt=W((Is,Nt)=>{var j=U(),at=class{constructor(t,e,i,s,n,o){this.pos=t.copy,this.lastPos=this.pos.copy,this.r=i,this.fc=.4,this.amc=2/5,this.rotation=0,n?this.ang=n:this.ang=0,(o||o===0)&&(this.fc=o),s?this.k=s:this.k=.8,e!=null?this.vel=e.copy:this.vel=new j(0,0),this.id="_"+Math.random().toString(36).substr(2,9)}get m(){return this.r*this.r*Math.PI}get am(){return this.amc*this.r*this.r*this.m}getAmInPoint(t){let e=this.am;return e+=j.sub(this.pos,t).sqlength*this.m,e}get copy(){let t=new at(this.pos.copy,this.vel.copy,this.r,this.k,this.ang,this.fc);return t.lastPos=this.lastPos.copy,t.rotation=this.rotation,t}move(t,e){this.pos.x+=t,this.pos.y+=e}rotate(t){this.rotation+=t}collided(t){return this.pos.dist(t.pos)<this.r+t.r}static collide(t,e){if(!t.collided(e))return;let i=j.dist(t.pos,e.pos),s=t.m,n=e.m,o=t.pos.copy,r=e.pos.copy,h=t.r+e.r-i,l=j.sub(t.pos,e.pos);if(l.setMag(1),l.mult(h*n/(s+n)),o.add(l),l.setMag(1),l.mult(-h*s/(s+n)),r.add(l),t.pos=o,e.pos=r,j.dot(l,j.sub(t.vel,e.vel))<0)return;l.setMag(1);let a=j.add(t.pos,j.mult(l,t.r)),u=t.vel.copy,x=e.vel.copy,f=t.ang,g=e.ang,w=j.sub(a,t.pos),S=j.sub(a,e.pos),I=t.am,O=e.am,P=(t.k+e.k)/2,y=(t.fc+e.fc)/2,d=l.copy,M=t.velInPlace(a),m=e.velInPlace(a),b=j.sub(m,M),B=1/s+1/n;B=-(1+P)*j.dot(b,d)/B;let F=j.sub(u,j.mult(d,B/s)),L=j.add(x,j.mult(d,B/n)),q=f-B*j.cross(w,d)/I,E=g,A=b.copy;A.sub(j.mult(d,j.dot(b,d))),A.setMag(1);let J=1/s+1/n;J+=j.dot(j.crossScalarFirst(j.cross(w,A)/I,w),A),J+=j.dot(j.crossScalarFirst(j.cross(S,A)/O,S),A),J=-.5*j.dot(b,A)/J;let X=B*y;X>J&&(X=J),F=j.sub(F,j.mult(A,X/s)),L=j.add(L,j.mult(A,X/n)),q=q-X*j.cross(w,A)/I,E=E+X*j.cross(S,A)/O,t.vel=F,e.vel=L,t.ang=q,e.ang=E}containsPoint(t){return j.dist(this.pos,t)<=this.r}velInPlace(t){let e=j.sub(t,this.pos);return e.rotate(Math.PI/2),e.mult(this.ang),e.add(this.vel),e}effectiveMass(t,e){let i=j.sub(t,this.pos);if(i.length===0)return this.m;let s=j.angle(e,i),n=Math.sin(s)**2*i.length**2/this.am;return isNaN(s)&&console.log(e,i,s),1/(n+1/this.m)}applyDeltaVelInPoint(t,e){let i=j.sub(e,this.pos);if(i.length===0){this.vel.add(t);return}let s=j.angle(i,t),n=j.mult(i,j.dot(t,i)/i.length**2);this.vel.add(n);let o=i.copy;o.rotate(Math.PI/2),o.setMag(1);let r=Math.sign(j.dot(t,o)),h=t.length*Math.cos(s),l=1/(1/this.m+i.length**2/this.am),a=h*l/this.m;this.vel.add(j.mult(o,a*r));let u=r*h*l*i.length/this.am;this.ang-=u}toJSObject(){let t={};return t.pos=this.pos.toJSObject(),t.lastPos=this.lastPos.toJSObject(),t.r=this.r,t.fc=this.fc,t.amc=this.amc,t.rotation=this.rotation,t.ang=this.ang,t.fc=this.fc,t.k=this.k,t.vel=this.vel.toJSObject(),t.id=this.id,this.layer!=null&&(t.layer=this.layer),t}static fromObject(t){let e=new at(j.fromObject(t.pos),j.fromObject(t.vel),t.r,t.k,t.ang,t.fc);return e.lastPos=j.fromObject(t.lastPos),e.amc=t.amc,e.rotation=t.rotation,e.vel=j.fromObject(t.vel),e.id=t.id,t.layer!=null&&(e.layer=t.layer),e}};Nt.exports=at}),ot=W((Os,Xt)=>{var G=U(),Yt=class{constructor(t,e){this.a=t,this.b=e}get length(){return G.dist(this.a,this.b)}distFromPoint(t){let e=G.sub(this.a,this.b),i=G.sub(t,this.b),s=G.sub(t,this.a),n=i.length,o=s.length,r=e.length;if(r===0)return n;let h=G.angle(i,s),l=G.angle(i,e),a=Math.PI-h-l,u=Math.sin(a)*o*r/2,x=2*u/r;return a>Math.PI/2?o:l>Math.PI/2?n:x}static intersect(t,e){let i=G.sub(t.b,t.a),s=i.y/i.x,n=t.b.y-t.b.x*s,o=G.sub(e.b,e.a),r=o.y/o.x,h=e.b.y-e.b.x*r;if(i.x===0&&o.x!==0){if(t.a.x>=e.a.x&&t.a.x<=e.b.x||t.a.x<=e.a.x&&t.a.x>=e.b.x){let f=r*t.a.x+h;if(f>t.a.y&&f<t.b.y||f<t.a.y&&f>t.b.y)return new G(t.a.x,f)}return}if(o.x===0&&i.x!==0){if(e.a.x>=t.a.x&&e.a.x<=t.b.x||e.a.x<=t.a.x&&e.a.x>=t.b.x){let f=s*e.a.x+n;if(f>e.a.y&&f<e.b.y||f<e.a.y&&f>e.b.y)return new G(e.a.x,f)}return}if(i.x===0&&o.x===0){if(t.a.x===e.a.x){let f;t.a.y<t.b.y?f=[t.a.y,t.b.y]:f=[t.b.y,t.a.y];let g;e.a.y<e.b.y?g=[e.a.y,e.b.y]:g=[e.b.y,e.a.y];let w=[f[0]>g[0]?f[0]:g[0],f[1]<g[1]?f[1]:g[1]];if(w[0]<=w[1])return new G(t.a.x,(w[0]+w[1])/2)}return}let l;t.a.x<t.b.x?l=[t.a.x,t.b.x]:l=[t.b.x,t.a.x];let a;e.a.x<e.b.x?a=[e.a.x,e.b.x]:a=[e.b.x,e.a.x];let u=[l[0]>a[0]?l[0]:a[0],l[1]<a[1]?l[1]:a[1]];if(s===r&&n===h&&u[0]<=u[1])return new G((u[0]+u[1])/2,(u[0]+u[1])/2*s+n);let x=(h-n)/(s-r);return x>=u[0]&&x<=u[1]?new G(x,x*s+n):void 0}};Xt.exports=Yt}),Vt=W((js,Jt)=>{var D=U(),Ft=ot(),wt=class{constructor(t){this.points=t;let e=this.points,i=0,s=0,n=D.angleACW(D.sub(e[1],e[0]),D.sub(e[e.length-1],e[0]));this.calculateCenterAndRadius(),i+=n,s+=Math.PI*2-n;for(let o=1;o<e.length-1;o++)n=D.angleACW(D.sub(e[(o+1)%e.length],e[o]),D.sub(e[o-1],e[o])),i+=n,s+=Math.PI*2-n;if(n=D.angleACW(D.sub(e[0],e[e.length-1]),D.sub(e[e.length-2],e[e.length-1])),i+=n,s+=Math.PI*2-n,s>i)return;{let o=[];for(let r=e.length-1;r>=0;r--)o.push(e[r]);this.points=o}}collideWithBall(t){let e,i;if(this.points.forEach((s,n)=>{let o=new D(s.x,s.y);o.x-=t.pos.x,o.y-=t.pos.y,o.mult(-1),o.length<=t.r&&(e=o.heading,i=o.length),o=new D(s.x,s.y);let r=new D(this.points[(n+1)%this.points.length].x,this.points[(n+1)%this.points.length].y),h=new D(t.pos.x,t.pos.y),l=new D(r.x-o.x,r.y-o.y),a=l.heading;o.rotate(-a+Math.PI),r.rotate(-a+Math.PI),h.rotate(-a+Math.PI);let u=h.y-(o.y+r.y)/2;u>=-t.r&&u<=t.r&&h.x>=r.x&&h.x<=o.x&&(e=a-Math.PI/2,i=u)}),isFinite(e)){let s=new D(t.pos.x,t.pos.y),n=new D(t.vel.x,t.vel.y);if(s.rotate(-e+Math.PI/2),n.rotate(-e+Math.PI/2),n.y>0)return;n.y*=-t.k,s.y+=t.r-i;let o=n.y*(1+t.k),r=Math.sign(n.x+t.ang*t.r)*(o*t.fc)/(t.amc*t.r),h=(n.x+t.ang*t.r)/t.r;r/h>1&&(r=h),t.ang-=r;let l=r*t.am/t.r/t.m;n.x-=l,s.rotate(e-Math.PI/2),n.rotate(e-Math.PI/2),t.pos.x=s.x,t.pos.y=s.y,t.vel.x=n.x,t.vel.y=n.y}}containsPoint(t){let e=this.sides,i=Math.max(...this.points.map(r=>D.dist(r,t)))+1,s=D.fromAngle(0);s.setMag(i);let n=new Ft(t,D.add(s,t)),o=e.filter(r=>Ft.intersect(r,n)!=null);return o.length%2==1}calculateCenterAndRadius(){this.center=this.points.reduce((t,e)=>D.add(t,e)),this.center.div(this.points.length),this.boundRadius=Math.max(this.points.map(t=>D.dist(t,this.center)))}get sides(){return this.points.map((t,e)=>new Ft(t,this.points[(e+1)%this.points.length]))}toJSObject(){let t={};return t.points=this.points.map(e=>({x:e.x,y:e.y})),t}static fromObject(t){let e=new wt(t.points.map(i=>new D(v.x,v.y)));return e}};Jt.exports=wt}),At=W((Cs,Ht)=>{var Q=U(),ct=class{constructor(t,e){this.length=t,this.springConstant=e,this.pinned=!1,this.objects=[],this.rotationLocked=!1,this.id="_"+Math.random().toString(36).substr(2,9)}pinHere(t,e){this.pinned={x:t,y:e}}unpin(){this.pinned=!1}attachObject(t){let e=this.objects;e.push(t),e.length===2&&(this.pinned=!1),e.length>=3&&(e=[e[e.length-2],e[e.length-1]])}lockRotation(){this.rotationLocked=!0}unlockRotation(){this.rotationLocked=!1}update(t){let e,i;if(this.pinned&&this.objects[0]){i=this.pinned,e=this.objects[0];let s=new Q(i.x-e.pos.x,i.y-e.pos.y),n=s.length-this.length;s.setMag(1),s.mult(n*this.springConstant*t/e.m),e.vel.x+=s.x,e.vel.y+=s.y;let o=e.vel;if(o.rotate(-s.heading),this.rotationLocked){let r=new Q(i.x,i.y),h=Q.sub(e.pos,r),l=h.length*h.length*e.m+e.am,a=(e.am*e.ang-h.length*e.m*o.y)/l;o.y=-a*h.length,e.ang=a}o.rotate(s.heading)}else if(this.objects[0]&&this.objects[1]){e=this.objects[0],i=this.objects[1];let s=Q.sub(e.pos,i.pos),n=s.length-this.length;s.setMag(1),s.mult(n*this.springConstant*t),i.vel.add(Q.div(s,i.m)),e.vel.add(Q.div(s,-e.m)),s=Q.sub(e.pos,i.pos);let o=e.vel,r=i.vel;if(o.rotate(-s.heading),r.rotate(-s.heading),this.rotationLocked){let h=new Q(e.pos.x*e.m+i.pos.x*i.m,e.pos.y*e.m+i.pos.y*i.m);h.div(e.m+i.m);let l=Q.sub(e.pos,h),a=Q.sub(i.pos,h),u=l.length*l.length*e.m+e.am+a.length*a.length*i.m+i.am,x=(o.y-r.y)*a.length/(l.length+a.length)+r.y,f=(e.am*e.ang+i.am*i.ang-l.length*e.m*(o.y-x)+a.length*i.m*(r.y-x))/u;o.y=-f*l.length+x,r.y=+f*a.length+x,e.ang=f,i.ang=f}o.rotate(s.heading),r.rotate(s.heading)}}toJSObject(){let t={};return t.length=this.length,t.springConstant=this.springConstant,t.pinned=this.pinned,t.rotationLocked=this.rotationLocked,t.id=this.id,t.objects=this.objects.map(e=>e.id),t.type=this.__proto__==ct.prototype?"spring":"stick",t}static fromObject(t,e){let i=new ze,s=i.createStickOrSpring(t.type,t.length,t.springConstant);return s.pinned=t.pinned,s.rotationLocked=t.rotationLocked,s.id=t.id,s.objects=t.objects.map(n=>{let o=e.filter(r=>n==r.id);return o[0]}),s}};function ze(){this.createStickOrSpring=function(p,t,e){let i;if(p=="spring")i=new ct(t,e);else if(p=="stick"){let s=vt();i=new s(t)}return i}}Ht.exports=ct}),vt=W((qs,Gt)=>{var tt=U(),Ue=At(),zt=class extends Ue{constructor(t){super(t,0);this.springConstant=0}update(t){let e,i;if(this.pinned&&this.objects[0]){i=this.pinned,e=this.objects[0];let s=new tt(i.x-e.pos.x,i.y-e.pos.y);s.setMag(1),s.mult(-this.length),e.move(-e.pos.x+i.x+s.x,-e.pos.y+i.y+s.y);let n=e.vel;if(n.rotate(-s.heading),n.x=0,this.rotationLocked){let o=new tt(i.x,i.y),r=tt.sub(e.pos,o),h=r.length*r.length*e.m+e.am,l=(e.am*e.ang-r.length*e.m*n.y)/h;n.y=-l*r.length,e.ang=l}n.rotate(s.heading)}else if(this.objects[0]&&this.objects[1]){e=this.objects[0],i=this.objects[1];let s=tt.sub(e.pos,i.pos),n=this.length-s.length;s.setMag(1);let o=tt.mult(s,n*i.m/(e.m+i.m)),r=tt.mult(s,-n*e.m/(e.m+i.m));e.move(o.x,o.y),i.move(r.x,r.y);let h=e.vel,l=i.vel;if(h.rotate(-s.heading),l.rotate(-s.heading),h.x=l.x=(e.m*h.x+i.m*l.x)/(e.m+i.m),this.rotationLocked){let a=new tt(e.pos.x*e.m+i.pos.x*i.m,e.pos.y*e.m+i.pos.y*i.m);a.div(e.m+i.m);let u=tt.sub(e.pos,a),x=tt.sub(i.pos,a),f=u.length*u.length*e.m+e.am+x.length*x.length*i.m+i.am,g=(h.y-l.y)*x.length/(u.length+x.length)+l.y,w=(e.am*e.ang+i.am*i.ang-u.length*e.m*(h.y-g)+x.length*i.m*(l.y-g))/f;h.y=-w*u.length+g,l.y=+w*x.length+g,e.ang=w,i.ang=w}h.rotate(s.heading),l.rotate(s.heading)}}};Gt.exports=zt}),Kt=W((Bs,Ut)=>{var C=U(),Ke=xt(),Qe=vt(),Z=ot(),bt=class{constructor(t,e,i,s,n){this.points=[],s||s===0?this.fc=s:this.fc=.4,this.pressure=i,n?this.resolution=n:this.resolution=30,e=Math.abs(e),this.r=e;let o=Math.random()*1e6;for(let r=0;r<this.resolution;r++){let h=new C(t.x,t.y);h.add(C.mult(C.fromAngle(r/this.resolution*Math.PI*2),e)),this.points.push(new Ke(h,new C(0,0),e*Math.sin(Math.PI/this.resolution),0,0,this.fc)),this.points[this.points.length-1].layer=o}this.sides=[];for(let r=0;r<this.resolution;r++){let h=new Qe(2*e*Math.sin(Math.PI/this.resolution));h.attachObject(this.points[r]),h.attachObject(this.points[(r+1)%this.resolution]),r%2===0&&h.lockRotation(),this.sides.push(h)}}static updatePressureBasedForces(t,e){let i=[];if(i.push([]),t.points.forEach(o=>{i[0].push(new C(o.pos.x,o.pos.y))}),function(o){let r=C.angleACW(C.sub(o[1],o[0]),C.sub(o[o.length-1],o[0]));if(r>Math.PI)return!0;for(let h=1;h<o.length-1;h++)if(r=C.angleACW(C.sub(o[(h+1)%o.length],o[h]),C.sub(o[h-1],o[h])),r>Math.PI)return!0;return r=C.angleACW(C.sub(o[0],o[o.length-1]),C.sub(o[o.length-2],o[o.length-1])),r>Math.PI}(i[0])){let o=(l,a)=>{for(let u=0;u<l.length;u++)if(l[u]===a)return!0;return!1},r=function(l,a,u){for(let x=0;x<a.length;x++)if(!o(u,x)){let f=new Z(new C(a[x].x,a[x].y),new C(a[(x+1)%a.length].x,a[(x+1)%a.length].y));if(Z.intersect(l,f))return!0}return!1},h=!0;t:for(;h;){h=!1;for(let l=0;l<i.length;l++){let a=i[l],u=C.sub(a[1],a[0]),x=C.sub(a[a.length-1],a[0]),f=C.angleACW(u,x);if(f>Math.PI){h=!0;let g=0,w=g+2,S=new Z(new C(a[g].x,a[g].y),new C(a[w%a.length].x,a[w%a.length].y)),I=new C(S.b.x-S.a.x,S.b.y-S.a.y).heading;for(;!(u.heading>x.heading?I>u.heading&&I<2*Math.PI||I>0&&I<x.heading:I>u.heading&&I<x.heading)||r(new Z(new C(a[g%a.length].x,a[g%a.length].y),new C(a[w%a.length].x,a[w%a.length].y)),a,[(a.length-1)%a.length,g%a.length,(w-1)%a.length,w%a.length]);)w++,S=new Z(new C(a[g].x,a[g].y),new C(a[w%a.length].x,a[w%a.length].y)),I=new C(S.b.x-S.a.x,S.b.y-S.a.y).heading;let O=[],P=[];for(let y=g;y<=w;y++)O.push(a[y%a.length]);for(let y=w;y<=g+a.length;y++)P.push(a[y%a.length]);i[l]=O,i.push(P);continue t}for(let g=1;g<a.length;g++){let w=C.sub(a[(g+1)%a.length],a[g]),S=C.sub(a[g-1],a[g]),I=C.angleACW(w,S);if(I>Math.PI){h=!0;let O=g+2,P=new Z(new C(a[g].x,a[g].y),new C(a[O%a.length].x,a[O%a.length].y)),y=new C(P.b.x-P.a.x,P.b.y-P.a.y).heading;for(;!(w.heading>S.heading?y>w.heading&&y<2*Math.PI||y>0&&y<S.heading:y>w.heading&&y<S.heading)||r(P,a,[(g-1)%a.length,g%a.length,(O-1)%a.length,O%a.length]);)O++,P=new Z(new C(a[g].x,a[g].y),new C(a[O%a.length].x,a[O%a.length].y)),y=new C(P.b.x-P.a.x,P.b.y-P.a.y).heading;let d=[],M=[];for(let m=g;m<=O;m++)d.push(a[m%a.length]);for(let m=O;m<=g+a.length;m++)M.push(a[m%a.length]);i[l]=d,i.push(M);continue t}}}}}for(let o=i.length-1;o>=0;o--){let r=i[o];for(;r.length>3;)i.push([r[0],r[1],r[2]]),r.splice(1,1)}let s=0;i.forEach(o=>{let r=Math.sqrt(Math.pow(o[0].x-o[1].x,2)+Math.pow(o[0].y-o[1].y,2)),h=Math.sqrt(Math.pow(o[1].x-o[2].x,2)+Math.pow(o[1].y-o[2].y,2)),l=Math.sqrt(Math.pow(o[2].x-o[0].x,2)+Math.pow(o[2].y-o[0].y,2)),a=(r+h+l)/2,u=Math.sqrt(a*(a-r)*(a-h)*(a-l));s+=u});let n=t.pressure*(t.r*t.r*Math.PI/s)-t.pressure;t.sides.forEach(o=>{let r=C.sub(o.objects[0].pos,o.objects[1].pos);r.mult(n),r.rotate(Math.PI/2),r.mult(e),o.objects[0].vel.add(C.div(r,o.objects[0].m)),o.objects[1].vel.add(C.div(r,o.objects[1].m))})}get sideSegments(){return this.points.map((t,e)=>new Z(t.pos,this.points[(e+1)%this.points.length].pos))}containsPoint(t){let e=this.sideSegments,i=Math.max(...this.points.map(r=>C.dist(r.pos,t)))+1,s=C.fromAngle(0);s.setMag(i);let n=new Z(t,C.add(s,t)),o=e.filter(r=>Z.intersect(r,n)!=null);return o.length%2==1}toJSObject(){let t={};return t.pressure=this.pressure,t.fc=this.fc,t.r=this.r,t.resolution=this.resolution,t.points=this.points.map(e=>e.id),t.sides=this.sides.map(e=>e.id),t}static fromObject(t,e,i){let s=Object.create(bt.prototype);return console.log(s),s.pressure=t.pressure,s.fc=t.fc,s.resolution=t.resolution,s.r=t.r,s.points=t.points.map(n=>{let o=e.filter(r=>n==r.id);return o[0]}),s.sides=t.sides.map(n=>{let o=i.filter(r=>n==r.id);return o[0]}),s}};Ut.exports=bt}),Zt=W((As,Qt)=>{var c=U(),Y=ot(),Fs=xt(),ut=class{constructor(t,e,i,s,n){this.points=t;let o=this.points,r=0,h=0,l=c.angleACW(c.sub(o[1],o[0]),c.sub(o[o.length-1],o[0]));r+=l,h+=Math.PI*2-l;for(let a=1;a<o.length-1;a++)l=c.angleACW(c.sub(o[(a+1)%o.length],o[a]),c.sub(o[a-1],o[a])),r+=l,h+=Math.PI*2-l;if(l=c.angleACW(c.sub(o[0],o[o.length-1]),c.sub(o[o.length-2],o[o.length-1])),r+=l,h+=Math.PI*2-l,h<r){let a=[];for(let u=o.length-1;u>=0;u--)a.push(o[u]);this.points=a}this.calculatePosAndMass(),this.lastPos=this.pos.copy,this.fc=.4,this.rotation=0,s?this.ang=s:this.ang=0,(n||n===0)&&(this.fc=n),i?this.k=i:this.k=.8,e!=null?this.vel=e.copy:this.vel=new c(0,0),this.id="_"+Math.random().toString(36).substr(2,9)}getAmInPoint(t){let e=this.am;return e+=c.sub(this.pos,t).sqlength*this.m,e}get copy(){let t=[];for(let i=0;i<this.points.length;i++)t.push(new c(this.points[i].x,this.points[i].y));let e=new ut(t,this.vel.copy,this.k,this.ang,this.fc);return e.rotation=this.rotation,e.lastPos=this.lastPos.copy,e.pos=this.pos.copy,e}move(t,e){this.pos.x+=t,this.pos.y+=e,this.points.forEach(i=>{i.x+=t,i.y+=e})}collideWithBall(t){let e,i,s;if(c.dist(t.pos,this.pos)>t.r+this.boundRadius)return;if(this.points.forEach((n,o)=>{let r=new c(n.x,n.y);if(r.x-=t.pos.x,r.y-=t.pos.y,r.length<=t.r){e=r.heading+Math.PI,i=r.length;let f=c.fromAngle(e);f.mult(t.r-i),this.move(f.x*-1*t.m/(this.m+t.m),f.y*-1*t.m/(this.m+t.m)),t.move(f.x*1*this.m/(this.m+t.m),f.y*1*this.m/(this.m+t.m)),s=new c(n.x,n.y);let g=c.fromAngle(e);g.mult(-30)}r=new c(n.x,n.y);let h=new c(this.points[(o+1)%this.points.length].x,this.points[(o+1)%this.points.length].y),l=new c(t.pos.x,t.pos.y),a=new c(h.x-r.x,h.y-r.y),u=a.heading;r.rotate(-u+Math.PI),h.rotate(-u+Math.PI),l.rotate(-u+Math.PI);let x=l.y-(r.y+h.y)/2;if(x>=-t.r&&x<=t.r&&l.x>=h.x&&l.x<=r.x){e=u-Math.PI/2,i=x;let f=c.fromAngle(e);f.mult(t.r-i),this.move(f.x*-1*t.m/(this.m+t.m),f.y*-1*t.m/(this.m+t.m)),t.move(f.x*1*this.m/(this.m+t.m),f.y*1*this.m/(this.m+t.m)),s=t.pos.copy,s.add(c.mult(c.fromAngle(e+Math.PI),x));let g=c.fromAngle(e);g.mult(-30)}}),e===0||e){let n=this.vel.copy,o=t.vel.copy,r=this.ang,h=t.ang,l=c.sub(s,this.pos),a=c.sub(s,t.pos),u=this.am,x=t.am,f=this.m,g=t.m,w=(this.k+t.k)/2,S=(this.fc+t.fc)/2,I=a.copy;I.setMag(-1);let O=this.velInPlace(s),P=t.velInPlace(s),y=c.sub(P,O),d=1/f+1/g;d+=c.dot(c.crossScalarFirst(c.cross(l,I)/u,l),I),d=-(1+w)*c.dot(y,I)/d;let M=c.sub(n,c.mult(I,d/f)),m=c.add(o,c.mult(I,d/g)),b=r-d*c.cross(l,I)/u,B=h,F=y.copy;F.sub(c.mult(I,c.dot(y,I))),F.setMag(1);let L=1/f+1/g;L+=c.dot(c.crossScalarFirst(c.cross(l,F)/u,l),F),L+=c.dot(c.crossScalarFirst(c.cross(a,F)/x,a),F),L=-c.dot(y,F)/L;let q=d*S;q>L&&(q=L),M=c.sub(M,c.mult(F,q/f)),m=c.add(m,c.mult(F,q/g)),b=b-q*c.cross(l,F)/u,B=B+q*c.cross(a,F)/x,this.vel=M,t.vel=m,this.ang=b,t.ang=B}}calculatePosAndMass(){let t=[];if(t.push([]),this.points.forEach(n=>{t[0].push(new c(n.x,n.y))}),this.isConcave){let n=(h,l)=>{for(let a=0;a<h.length;a++)if(h[a]===l)return!0;return!1},o=function(h,l,a){for(let u=0;u<l.length;u++)if(!n(a,u)){let x=new Y(new c(l[u].x,l[u].y),new c(l[(u+1)%l.length].x,l[(u+1)%l.length].y));if(Y.intersect(h,x))return!0}return!1},r=!0;t:for(;r;){r=!1;for(let h=0;h<t.length;h++){let l=t[h],a=c.sub(l[1],l[0]),u=c.sub(l[l.length-1],l[0]),x=c.angleACW(a,u);if(x>Math.PI){r=!0;let f=0,g=f+2,w=new Y(new c(l[f].x,l[f].y),new c(l[g%l.length].x,l[g%l.length].y)),S=new c(w.b.x-w.a.x,w.b.y-w.a.y).heading;for(;!(a.heading>u.heading?S>a.heading&&S<2*Math.PI||S>0&&S<u.heading:S>a.heading&&S<u.heading)||o(new Y(new c(l[f%l.length].x,l[f%l.length].y),new c(l[g%l.length].x,l[g%l.length].y)),l,[(l.length-1)%l.length,f%l.length,(g-1)%l.length,g%l.length]);)g++,w=new Y(new c(l[f].x,l[f].y),new c(l[g%l.length].x,l[g%l.length].y)),S=new c(w.b.x-w.a.x,w.b.y-w.a.y).heading;let I=[],O=[];for(let P=f;P<=g;P++)I.push(l[P%l.length]);for(let P=g;P<=f+l.length;P++)O.push(l[P%l.length]);t[h]=I,t.push(O);continue t}for(let f=1;f<l.length;f++){let g=c.sub(l[(f+1)%l.length],l[f]),w=c.sub(l[f-1],l[f]),S=c.angleACW(g,w);if(S>Math.PI){r=!0;let I=f+2,O=new Y(new c(l[f].x,l[f].y),new c(l[I%l.length].x,l[I%l.length].y)),P=new c(O.b.x-O.a.x,O.b.y-O.a.y).heading;for(;!(g.heading>w.heading?P>g.heading&&P<2*Math.PI||P>0&&P<w.heading:P>g.heading&&P<w.heading)||o(O,l,[(f-1)%l.length,f%l.length,(I-1)%l.length,I%l.length]);)I++,O=new Y(new c(l[f].x,l[f].y),new c(l[I%l.length].x,l[I%l.length].y)),P=new c(O.b.x-O.a.x,O.b.y-O.a.y).heading;let y=[],d=[];for(let M=f;M<=I;M++)y.push(l[M%l.length]);for(let M=I;M<=f+l.length;M++)d.push(l[M%l.length]);t[h]=y,t.push(d);continue t}}}}}for(let n=t.length-1;n>=0;n--){let o=t[n];for(;o.length>3;)t.push([o[0],o[1],o[2]]),o.splice(1,1)}let e=0,i=0,s=new c(0,0);t.forEach(n=>{let o=Math.sqrt(Math.pow(n[0].x-n[1].x,2)+Math.pow(n[0].y-n[1].y,2)),r=Math.sqrt(Math.pow(n[1].x-n[2].x,2)+Math.pow(n[1].y-n[2].y,2)),h=Math.sqrt(Math.pow(n[2].x-n[0].x,2)+Math.pow(n[2].y-n[0].y,2)),l=(o+r+h)/2,a=Math.sqrt(l*(l-o)*(l-r)*(l-h));e+=a,s.x+=a*(n[0].x+n[1].x+n[2].x)/3,s.y+=a*(n[0].y+n[1].y+n[2].y)/3}),s.div(e),this.pos=s,this.m=e;for(let n of t){let o=Math.sqrt(Math.pow(n[0].x-n[1].x,2)+Math.pow(n[0].y-n[1].y,2)),r=Math.sqrt(Math.pow(n[1].x-n[2].x,2)+Math.pow(n[1].y-n[2].y,2)),h=Math.sqrt(Math.pow(n[2].x-n[0].x,2)+Math.pow(n[2].y-n[0].y,2)),l=Math.max(o,r,h),a=(o+r+h)/2,u=Math.sqrt(a*(a-o)*(a-r)*(a-h)),x=2*u/l,f=Math.sqrt(Math.min(o,h,r)**2-x*x),g=x*l*(x*x+l*l)/24,w=Math.sqrt(x*x/36+(Math.abs(f-l/2)/3)**2);g-=w*w*u,g+=new c((n[0].x+n[1].x+n[2].x)/3,(n[0].y+n[1].y+n[2].y)/3).dist(this.pos)**2*u,i+=g}this.am=i,this.boundRadius=Math.max(...this.points.map(n=>c.dist(n,this.pos)))}rotate(t){this.points.forEach(e=>{let i=new c(e.x,e.y);i.sub(this.pos),i.rotate(t),i.add(this.pos),e.x=i.x,e.y=i.y}),this.rotation+=t}get isConcave(){let t=this.points,e=c.angleACW(c.sub(t[1],t[0]),c.sub(t[t.length-1],t[0]));if(e>Math.PI)return!0;for(let i=1;i<t.length-1;i++)if(e=c.angleACW(c.sub(t[(i+1)%t.length],t[i]),c.sub(t[i-1],t[i])),e>Math.PI)return!0;return e=c.angleACW(c.sub(t[0],t[t.length-1]),c.sub(t[t.length-2],t[t.length-1])),e>Math.PI}static collide(t,e){let i=0,s=0,n=new c(0,0),o=[],r=!1;if(t.points.forEach((M,m)=>{let b=new Y(new c(M.x,M.y),new c(t.points[(m+1)%t.points.length].x,t.points[(m+1)%t.points.length].y));e.points.forEach((B,F)=>{let L=new Y(new c(B.x,B.y),new c(e.points[(F+1)%e.points.length].x,e.points[(F+1)%e.points.length].y)),q=Y.intersect(b,L);q&&(i++,n.add(q),o.push(q),r=!0)})}),!r)return;n.div(i);for(let M=0;M<Math.floor(i/2);M++)s+=c.sub(o[2*M+1],o[2*M]).heading;s/=i/2,s+=Math.PI/2;let h=c.fromAngle(s),l=t.ang,a=t.vel.copy,u=e.ang,x=e.vel.copy,f=0,g=0,w=0,S=0;for(let M of t.points)f=Math.min(c.dot(h,c.sub(new c(M.x,M.y),n)),f),g=Math.max(c.dot(h,c.sub(new c(M.x,M.y),n)),g);for(let M of e.points)w=Math.min(c.dot(h,c.sub(new c(M.x,M.y),n)),w),S=Math.max(c.dot(h,c.sub(new c(M.x,M.y),n)),S);Math.abs(f-S)<Math.abs(w-g)?(t.move(-h.x*f,-h.y*f),e.move(-h.x*S,-h.y*S)):(t.move(-h.x*g,-h.y*g),e.move(-h.x*w,-h.y*w));let I=o,O=[],P=[],y=[],d=[];for(let M of I){let m=c.fromAngle(s),b=M,B=t.vel.copy,F=e.vel.copy,L=t.ang,q=e.ang,E=c.sub(b,t.pos),A=c.sub(b,e.pos),J=t.am,X=e.am,gt=t.m,yt=e.m,Re=(t.k+e.k)/2,Le=(t.fc+e.fc)/2,We=t.velInPlace(b),De=e.velInPlace(b),mt=c.sub(De,We),_=1/gt+1/yt;_+=c.dot(c.crossScalarFirst(c.cross(E,m)/J,E),m),_+=c.dot(c.crossScalarFirst(c.cross(A,m)/X,A),m),_=-(1+Re)*c.dot(mt,m)/_;let Ot=c.sub(B,c.mult(m,_/gt)),jt=c.add(F,c.mult(m,_/yt)),Ct=L-_*c.cross(E,m)/J,qt=q+_*c.cross(A,m)/X,z=mt.copy;z.sub(c.mult(m,c.dot(mt,m))),z.setMag(1);let rt=1/gt+1/yt;rt+=c.dot(c.crossScalarFirst(c.cross(E,z)/J,E),z),rt+=c.dot(c.crossScalarFirst(c.cross(A,z)/X,A),z),rt=-c.dot(mt,z)/rt;let lt=_*Le;lt>rt&&(lt=rt),Ot=c.sub(Ot,c.mult(z,lt/gt)),jt=c.add(jt,c.mult(z,lt/yt)),Ct=Ct-lt*c.cross(E,z)/J,qt=qt+lt*c.cross(A,z)/X,t.vel=Ot,e.vel=jt,t.ang=Ct,e.ang=qt,O.push(t.ang),y.push(t.vel),P.push(e.ang),d.push(e.vel),t.ang=l,t.vel=a,e.ang=u,e.vel=x}if(O.length!=y.length)return;if(O.length==0)return;if(y.length==0)return;if(P.length!=d.length)return;if(P.length==0)return;if(d.length==0)return;t.vel=y.reduce((M,m)=>c.add(M,m)),t.vel.div(y.length),t.ang=O.reduce((M,m)=>M+m),t.ang/=O.length,e.vel=d.reduce((M,m)=>c.add(M,m)),e.vel.div(d.length),e.ang=P.reduce((M,m)=>M+m),e.ang/=P.length}collideWithFixedBall(t){let e=new c(t.x,t.y),i;if(c.dist(e,this.pos)>this.boundRadius+t.r)return;for(let y of this.sides){let d,M;if(d=c.angle(c.sub(y.a,y.b),c.sub(e,y.b)),M=c.angle(c.sub(y.b,y.a),c.sub(e,y.a)),d<Math.PI/2&&M<Math.PI/2){let m=y.distFromPoint(e);if(m<=t.r){let b=c.sub(y.a,y.b);b.rotate(Math.PI/2),b.setMag(t.r*2);let B=c.mult(b,-1),F=new Y(c.add(b,e),c.add(B,e));i=Y.intersect(F,y),i!=null&&(b=c.sub(i,e),b.setMag(t.r-b.length),this.move(b.x,b.y))}}}if(!i||i==null){t:for(let y of this.points)if(c.dist(y,e)<t.r){let d=c.sub(y,e);d.setMag(t.r-d.length),this.move(d.x,d.y),d.setMag(t.r),i=c.add(e,d);break t}}if(!i||i==null)return;let s=c.sub(i,e);s.setMag(1);let n=i,o=this.vel.copy,r=this.ang,h=c.sub(n,this.pos),l=this.am,a=this.m,u=this.k,x=this.fc,f=c.mult(this.velInPlace(n),-1),g=1/a;g+=c.dot(c.crossScalarFirst(c.cross(h,s)/l,h),s),g=-(1+u)*c.dot(f,s)/g;let w=c.sub(o,c.mult(s,g/a)),S=r-g*c.cross(h,s)/l,I=f.copy;I.sub(c.mult(s,c.dot(f,s))),I.setMag(1);let O=1/a;O+=c.dot(c.crossScalarFirst(c.cross(h,I)/l,h),I),O=-c.dot(f,I)/O;let P=g*x;P>O&&(P=O),w=c.sub(w,c.mult(I,P/a)),S=S-P*c.cross(h,I)/l,this.vel=w,this.ang=S}collideWithWall(t){if(this.boundRadius+t.boundRadius<c.dist(this.pos,t.center))return;let e=this.sides,i=[],s=[];for(let g of e)for(let w of t.sides){let S=Y.intersect(g,w);S!=null&&s.push(S)}if(s.length<2)return;let n=this.vel.copy,o=this.ang,r=[],h=[],l=c.sub(...s);l.rotate(Math.PI/2);let a=c.sub(s[0],this.pos);c.dot(l,a)>0&&l.mult(-1),l.setMag(1),c.dot(l,c.sub(this.pos,t.center))<0&&l.mult(-1),i.push(new Y(...s)),i.push(new Y(s[0],c.add(s[0],c.mult(l,20)))),i.push(new Y(s[1],c.add(s[1],c.mult(l,20))));let u=[],x=s[0];for(let g of t.points){let w=c.sub(g,x),S=c.dot(w,l);S>0&&u.push(S)}if(u.length>0){let g=l.copy;g.mult(Math.max(...u)),this.move(g.x,g.y)}u=[];let f=c.add(...s);if(f.div(2),this.containsPoint(f))for(let g of e)u.push(g.distFromPoint(f));if(u.length>0){let g=l.copy;g.mult(Math.min(...u)),g.length<this.boundRadius/2&&this.move(g.x,g.y)}for(let g of s){let w=l;w.setMag(1);let S=g,I=this.vel.copy,O=this.ang,P=c.sub(S,this.pos),y=this.am,d=this.m,M=this.k,m=this.fc,b=c.mult(this.velInPlace(S),-1),B=1/d;B+=c.dot(c.crossScalarFirst(c.cross(P,w)/y,P),w),B=-(1+M)*c.dot(b,w)/B;let F=c.sub(I,c.mult(w,B/d)),L=O-B*c.cross(P,w)/y,q=b.copy;q.sub(c.mult(w,c.dot(b,w))),q.setMag(1);let E=1/d;E+=c.dot(c.crossScalarFirst(c.cross(P,q)/y,P),q),E=-c.dot(b,q)/E;let A=B*m;A>E&&(A=E),F=c.sub(F,c.mult(q,A/d)),L=L-A*c.cross(P,q)/y,this.vel=F,this.ang=L,r.push(this.vel),this.vel=n.copy,h.push(this.ang),this.ang=o}return h.length!=r.length||(h.length==0||r.length==0)?void 0:(this.vel=r.reduce((g,w)=>c.add(g,w)),this.vel.div(r.length),this.ang=h.reduce((g,w)=>g+w),this.ang/=h.length,(!isFinite(this.vel.x)||!isFinite(this.vel.y)||!isFinite(this.ang))&&(this.vel=n,this.ang=o),i)}containsPoint(t){let e=this.sides,i=Math.max(...this.points.map(r=>c.dist(r,t)))+1,s=c.fromAngle(0);s.setMag(i);let n=new Y(t,c.add(s,t)),o=e.filter(r=>Y.intersect(r,n)!=null);return o.length%2==1}get sides(){return this.points.map((t,e)=>new Y(t,this.points[(e+1)%this.points.length]))}velInPlace(t){let e=c.sub(t,this.pos);return e.rotate(Math.PI/2),e.mult(this.ang),e.add(this.vel),e}effectiveMass(t,e){let i=c.sub(t,this.pos),s=c.angle(e,i),n=Math.sin(s)**2*i.length**2/this.am;return 1/(n+1/this.m)}applyDeltaVelInPoint(t,e){let i=c.sub(e,this.pos);if(i.length==0){this.vel.add(t);return}let s=c.angle(i,t),n=c.mult(i,c.dot(t,i)/i.length**2);this.vel.add(n);let o=i.copy;o.rotate(Math.PI/2),o.setMag(1);let r=Math.sign(c.dot(t,o)),h=t.length*Math.cos(s),l=1/(1/this.m+i.length**2/this.am),a=h*l/this.m;this.vel.add(c.mult(o,a*r));let u=r*h*l*i.length/this.am;console.log(s),this.ang-=u}toJSObject(){let t={};return t.points=this.points.map(e=>({x:e.x,y:e.y})),t.vel=this.vel.toJSObject(),t.k=this.k,t.ang=this.ang,t.fc=this.fc,t.pos=this.pos.toJSObject(),t.lastPos=this.lastPos.toJSObject(),t.rotation=this.rotation,t.id=this.id,t}static fromObject(t){let e=new ut(t.points.map(i=>({x:i.x,y:i.y})),c.fromObject(t.vel),t.k,t.ang,t.fc);return e.id=t.id,e.pos=c.fromObject(t.pos),e.lastPos=c.fromObject(t.lastPos),e.rotation=t.rotation,e}};Qt.exports=ut}),Et=W((Es,$t)=>{var H=U(),Ze=ot(),_t=class extends Ze{constructor(t,e){super(t,e)}get length(){return Number.POSITIVE_INFINITY}distFromPoint(t){let e=H.sub(this.a,this.b);e.setMag(1),e.rotate(Math.PI/2);let i=H.sub(t,this.a),s=Math.abs(H.dot(i,e));return s}static intersect(t,e){let i=H.sub(t.b,t.a),s=i.y/i.x,n=t.b.y-t.b.x*s,o=H.sub(e.b,e.a),r=o.y/o.x,h=e.b.y-e.b.x*r;if(s===r)return t.distFromPoint(e.a)==0?new H((t.a.x+t.b.x+e.a.x+e.b.x)/4,(t.a.y+t.b.y+e.a.y+e.b.y)/4):void 0;{let l=(h-n)/(s-r);return new H(l,s*l+n)}}static intersectWithLineSegment(t,e){let i=H.sub(t.b,t.a),s=i.y/i.x,n=t.b.y-t.b.x*s,o=H.sub(e.b,e.a),r=o.y/o.x,h=e.b.y-e.b.x*r;if(i.x===0){if(o.x===0)return t.a.x==e.a.x?new H((e.a.x+e.b.x)/2,(e.a.y+e.b.y)/2):void 0;let l=t.a.x,a=r*l+h;return Math.min(e.a.x,e.b.x)<l&&l<Math.max(e.a.x,e.b.x)&&Math.min(e.a.y,e.b.y)<a&&Math.max(e.a.y,e.b.y)>a?new H(l,a):void 0}if(o.x===0){let l=e.a.x,a=s*l+n;return Math.min(e.a.x,e.b.x)<l&&l<Math.max(e.a.x,e.b.x)&&Math.min(e.a.y,e.b.y)<a&&Math.max(e.a.y,e.b.y)>a?new H(l,a):void 0}if(s===r)return t.distFromPoint(e.a)===0?new H((e.a.x+e.b.x)/2,(e.a.y+e.b.y)/2):void 0;{let l=(h-n)/(s-r),a=s*l+n;return Math.min(e.a.x,e.b.x)<l&&l<Math.max(e.a.x,e.b.x)&&Math.min(e.a.y,e.b.y)<a&&Math.max(e.a.y,e.b.y)>a?new H(l,a):void 0}}};$t.exports=_t}),ee=W((Ts,te)=>{var T=U(),dt=ot(),Mt=Et(),$=class{constructor(t){if(t.length<3)throw new Error("Not enough points in polygon (minimum required: 3)");this.points=t,this.makeAntiClockwise()}getSideVector(t){return t<0&&(t+=Math.abs(Math.floor(t))*this.points.length),T.sub(this.points[(t+1)%this.points.length],this.points[t%this.points.length])}getSideSegment(t){return t<0&&(t+=Math.abs(Math.floor(t))*this.points.length),new dt(this.points[(t+1)%this.points.length],this.points[t%this.points.length])}getSideLine(t){return t<0&&(t+=Math.abs(Math.floor(t))*this.points.length),new Mt(this.points[(t+1)%this.points.length],this.points[t%this.points.length])}get sides(){return this.points.length}makeAntiClockwise(){let t=0;for(let e=1;e<=this.sides;e++){let i=this.getSideVector(e),s=this.getSideVector(e-1);s.mult(-1),t+=T.angleACW(i,s)}if(this.sides===3)t>Math.PI*1.5&&this.reverseOrder();else if(this.sides===4)T.angleACW(this.getSideVector(1),this.getSideVector(0))>=Math.PI&&this.reverseOrder();else if(this.sides>4){let e=t-this.sides*Math.PI;e>0&&this.reverseOrder()}}reverseOrder(){this.points=this.points.reverse()}isPointInside(t){if(T.dist(t,this.centerPoint)>this.boundRadius)return!1;let e=this.centerPoint.copy;e.add(T.mult(new T(1.1,.6),this.boundRadius));let i=new dt(t,e),s=0;if([...Array(this.sides).keys()].map(n=>this.getSideSegment(n)).forEach(n=>{dt.intersect(n,i)&&s++}),s%2==0)return!1;if(s%2==1)return!0}get centerPoint(){let t=new T(0,0);return this.points.forEach(e=>{t.add(e)}),t.div(this.sides),t}get boundRadius(){let t=this.centerPoint;return Math.max(...this.points.map(e=>T.dist(e,t)))}get allSides(){return[...Array(this.sides).keys()].map(t=>this.getSideSegment(t))}static intersection(t,e){if(T.dist(t.centerPoint,e.centerPoint)>t.boundRadius+e.boundRadius)return;let i=[],s=t.allSides,n=e.allSides;if(s.forEach((u,x)=>{n.forEach((f,g)=>{let w=dt.intersect(u,f);w&&(w.isIntersectionPoint=!0,i.push({intersectionPoint:w,sideNumber1:x,sideNumber2:g}))})}),i.length===0){if(t.isPointInside(e.points[0]))return new $(e.points.map(u=>u.copy));if(e.isPointInside(t.points[0]))return new $(t.points.map(u=>u.copy))}let o=new $(t.points.map(u=>u.copy));for(let u=o.points.length-1;u>=0;u--){let x=i.filter(f=>f.sideNumber1==u);x.length>1&&x.sort((f,g)=>T.dist(o.points[u],f.intersectionPoint)-T.dist(o.points[u],g.intersectionPoint)),x.length>0&&o.points.splice(u+1,0,...x.map(f=>f.intersectionPoint))}let r=new $(e.points.map(u=>u.copy));for(let u=r.points.length-1;u>=0;u--){let x=i.filter(f=>f.sideNumber2==u);x.length>1&&x.sort((f,g)=>T.dist(r.points[u],f.intersectionPoint)-T.dist(r.points[u],g.intersectionPoint)),x.length>0&&r.points.splice(u+1,0,...x.map(f=>f.intersectionPoint))}let h={polyNum:1,pointNum:0};for(let u=0;u<o.points.length;u++)if(o.points[u].isIntersectionPoint){h.pointNum=u;break}else if(r.isPointInside(o.points[u])){h.pointNum=u;break}let l=!1,a=[];for(;!l;){let u=h.polyNum===1?o:r,x=h.polyNum===1?r:o;if(a.push(u.points[h.pointNum%u.points.length].copy),a.length>2&&a[0].x==a[a.length-1].x&&a[0].y==a[a.length-1].y){a.pop();break}if(a.length>o.points.length+r.points.length)break;u.points[h.pointNum%u.points.length].isIntersectionPoint?u.points[(h.pointNum+1)%u.points.length].isIntersectionPoint||x.isPointInside(u.points[(h.pointNum+1)%u.points.length])&&!u.points[(h.pointNum+1)%u.points.length].isIntersectionPoint?h.pointNum++:(h.pointNum=x.points.indexOf(u.points[h.pointNum%u.points.length])+1,h.polyNum=h.polyNum===1?2:1):h.pointNum++}return new $(a)}static createCircle(t,e,i=25){let s=[...Array(i).keys()].map(n=>{let o=T.fromAngle(2*Math.PI*n/i);return o.setMag(t),o.add(e),o});return new $(s)}static fracture(t,e=500){let i=t.map((s,n)=>{let o=[];for(let h=0;h<t.length;h++){if(n===h)continue;let l=t[h],a=T.div(T.add(s,l),2),u=T.sub(s,l);u.rotate(Math.PI/2),o.push(new Mt(a,T.add(u,a)))}o=o.filter((h,l)=>{let a=new dt(h.a,s);for(let u=0;u<o.length;u++){if(l===u)continue;let x=Mt.intersectWithLineSegment(o[u],a);if(x)return!1}return!0}),o=o.sort((h,l)=>T.sub(h.a,h.b).heading-T.sub(l.a,l.b).heading);let r=o.map((h,l)=>{let a=[];for(let x=0;x<o.length;x++){if(l===x)continue;let f=Mt.intersect(h,o[x]);f&&a.push(f)}let u=T.sub(h.a,h.b);return a=a.filter(x=>{let f=T.sub(x,s);u.setMag(1);let g=T.dot(f,u);return g>0}),a.length===0&&a.push(T.add(T.mult(u,e*1.2),h.a)),a=a.sort((x,f)=>T.dist(x,s)-T.dist(f,s)),a[0]});return r});return i.filter(s=>s.length>=3).map(s=>new $(s))}};te.exports=$}),ie=W((Rs,se)=>{se.exports={name:"ballphysics",version:"1.6.0",description:"2D rigid body physics engine to-be",main:"./src/physics.js",scripts:{test:"jest --verbose ./tests",watch:'nodemon --ignore "dest/*.*" -e js,css,html --exec npm run build',build:"esbuild editor/src/index.js --bundle --minify --sourcemap --target=chrome58,firefox57,safari11,edge16 --outfile=dest/main.js && cp editor/static/index.html dest/index.html"},repository:{type:"git",url:"git+https://github.com/AkosSeres/BallPhysics.git"},keywords:["physics","2d","rigid","balls"],author:"Akos Seres",license:"LGPL-2.1",bugs:{url:"https://github.com/AkosSeres/BallPhysics/issues"},homepage:"https://github.com/AkosSeres/BallPhysics#readme",devDependencies:{esbuild:"^0.8.26",eslint:"^6.0.1","eslint-config-google":"^0.9.1",jest:"^26.4.2",nodemon:"^2.0.6"},dependencies:{}}}),it=W((Ls,ne)=>{var R=U(),Tt=xt(),pt=Vt(),$e=ot(),oe=vt(),st=At(),Pt=Kt(),ft=Zt(),_e=Et(),ts=ee(),V=class{constructor(){this.balls=[],this.bodies=[],this.fixedBalls=[],this.softBalls=[],this.walls=[],this.bounds=[],this.springs=[],this.airFriction=1,this.gravity=new R(0,0),this.debugData=[]}update(t,e){this.debugData=[];let i=e?this.copy:new V;e&&(i.bodies.reverse(),i.balls.reverse(),i.update(t,!1));for(let s=0;s<this.balls.length;s++)this.balls[s].lastPos=this.balls[s].pos.copy,this.balls[s].pos.add(R.mult(this.balls[s].vel,t)),this.balls[s].rotation+=this.balls[s].ang*t,this.balls[s].rotation%=Math.PI*2;for(let s=0;s<this.bodies.length;s++)this.bodies[s].lastPos=this.bodies[s].pos.copy,this.bodies[s].move(this.bodies[s].vel.x*t,this.bodies[s].vel.y*t),this.bodies[s].rotate(this.bodies[s].ang*t);for(let s=0;s<3;s++)for(let n of this.springs)n.update(t/3/2);for(let s=0;s<this.balls.length;s++){this.gravity&&this.balls[s].vel.add(new R(this.gravity.x*t,this.gravity.y*t));for(let n=s+1;n<this.balls.length;n++)(this.balls[s].layer!=this.balls[n].layer||!this.balls[s].layer&&!this.balls[n].layer)&&Tt.collide(this.balls[s],this.balls[n]);for(let n of this.walls)n.collideWithBall(this.balls[s]);for(let n of this.fixedBalls){let o=this.balls[s],r,h=0,l=new R(n.x,n.y);l.x-=o.pos.x,l.y-=o.pos.y,l.mult(-1),l.length<=o.r+n.r&&(r=l.heading,h=l.length);t:if(isFinite(r)){let a=o.pos.copy,u=o.vel.copy;if(a.rotate(-r+Math.PI/2),u.rotate(-r+Math.PI/2),u.y>0)break t;u.y*=-o.k,a.y+=o.r+n.r-h;let x=u.y*(1+o.k),f=Math.sign(u.x+o.ang*o.r)*(x*o.fc)/(o.amc*o.r),g=(u.x+o.ang*o.r)/o.r;f/g>1&&(f=g),o.ang-=f;let w=f*o.am/o.r/o.m;u.x-=w,a.rotate(r-Math.PI/2),u.rotate(r-Math.PI/2),o.pos.x=a.x,o.pos.y=a.y,o.vel.x=u.x,o.vel.y=u.y}}for(let n of this.bounds)n.collideWithBall(this.balls[s])}for(let s=0;s<this.bodies.length;s++){for(let n of this.balls)(n.layer!=this.bodies[s].layer||!n.layer&&!this.bodies[s].layer)&&this.bodies[s].collideWithBall(n);for(let n=s+1;n<this.bodies.length;n++)(this.bodies[s].layer!=this.bodies[n].layer||!this.bodies[n].layer&&!this.bodies[s].layer)&&ft.collide(this.bodies[s],this.bodies[n]);for(let n of this.bodies)for(let o of this.fixedBalls)n.collideWithFixedBall(o);for(let n of this.bodies)for(let o of this.walls){let r=n.collideWithWall(o);r&&this.debugData.push(...r)}for(let n of this.bodies)for(let o of this.bounds){let r=n.collideWithWall(o);r&&this.debugData.push(...r)}this.gravity&&this.bodies[s].vel.add(new R(this.gravity.x*t,this.gravity.y*t))}this.softBalls.forEach(s=>{Pt.updatePressureBasedForces(s,t)});for(let s=0;s<3;s++)for(let n of this.springs)n.update(t/3/2);this.balls.forEach(s=>{s.vel.mult(Math.pow(this.airFriction,t)),s.ang*=Math.pow(this.airFriction,t)}),this.bodies.forEach(s=>{s.vel.mult(Math.pow(this.airFriction,t)),s.ang*=Math.pow(this.airFriction,t)}),e&&(i.bodies.reverse(),i.balls.reverse(),this.balls.forEach((s,n)=>{s.move((i.balls[n].pos.x-s.pos.x)*.5,(i.balls[n].pos.y-s.pos.y)*.5),s.vel.add(new R((i.balls[n].vel.x-s.vel.x)*.5,(i.balls[n].vel.y-s.vel.y)*.5)),s.rotation=(s.rotation+i.balls[n].rotation)/2,s.ang=(s.ang+i.balls[n].ang)/2}),this.bodies.forEach((s,n)=>{let o=i.bodies[n];s.move((o.pos.x-s.pos.x)*.5,(o.pos.y-s.pos.y)*.5),s.vel.add(new R((o.vel.x-s.vel.x)*.5,(o.vel.y-s.vel.y)*.5)),s.rotate((o.rotation-s.rotation)/2),s.ang=(s.ang+o.ang)/2}))}get copy(){let t=new V;return t.balls=this.getCopyOfBalls(),t.bodies=this.getCopyOfBodies(),t.fixedBalls=this.fixedBalls,t.walls=this.walls,t.bounds=this.bounds,t.gravity=this.gravity,this.springs.forEach(e=>{let i=e.constructor==st?st:oe,s=new i(e.length,e.springConstant);s.rotationLocked=e.rotationLocked,s.pinned=e.pinned,e.objects.forEach(n=>{let o=this.balls.indexOf(n);o!=-1?s.attachObject(t.balls[o]):(o=this.bodies.indexOf(n),o!=-1&&s.attachObject(t.bodies[o]))}),t.springs.push(s)}),t}setAirFriction(t){if(!isFinite(t))return;this.airFriction=t,this.airFriction<0&&(this.airFriction=0),this.airFriction>1&&(this.airFriction=1)}setGravity(t){this.gravity=t.copy}addBall(t){if(typeof addBodyNotBall!="undefined"&&isFinite(addBodyNotBall)&&addBodyNotBall>2){let e=(i,s,n)=>{let o=[];for(let r=0;r<n;r++){let h=R.fromAngle(r/n*2*Math.PI);h.mult(s),h.add(i),o.push(h)}return o};this.bodies.push(new ft(e(t.pos,t.r,addBodyNotBall),t.vel,t.k,t.ang,t.fc))}else this.balls.push(t)}addBody(t){this.bodies.push(t)}addSoftBall(t){this.balls.push(...t.points),this.springs.push(...t.sides),this.softBalls.push(t)}addSoftSquare(t,e,i,s){let n=new Pt(t,Math.sqrt(e*e/Math.PI),1,i,24);n.sides.forEach(h=>{h.length=.96*4*e/n.resolution}),n.points.forEach(h=>{h.vel=s.copy}),this.balls.push(...n.points),this.springs.push(...n.sides);let o=e*e*200,r=new st(Math.sqrt(n.r*n.r*Math.PI),o/2);r.attachObject(n.points[0]),r.attachObject(n.points[n.resolution/2]),this.springs.push(r),r=new st(Math.sqrt(n.r*n.r*Math.PI),o/2),r.attachObject(n.points[n.resolution/4]),r.attachObject(n.points[3*n.resolution/4]),this.springs.push(r),r=new st(Math.sqrt(2*n.r*n.r*Math.PI),o),r.attachObject(n.points[n.resolution/8]),r.attachObject(n.points[5*n.resolution/8]),this.springs.push(r),r=new st(Math.sqrt(2*n.r*n.r*Math.PI),o),r.attachObject(n.points[3*n.resolution/8]),r.attachObject(n.points[7*n.resolution/8]),this.springs.push(r)}addRectWall(t,e,i,s){let n=[];n.push(new R(t-i/2,e-s/2)),n.push(new R(t+i/2,e-s/2)),n.push(new R(t+i/2,e+s/2)),n.push(new R(t-i/2,e+s/2)),this.walls.push(new pt(n))}addRectBody(t,e,i,s,n,o){let r=[];r.push(new R(t-i/2,e-s/2)),r.push(new R(t+i/2,e-s/2)),r.push(new R(t+i/2,e+s/2)),r.push(new R(t-i/2,e+s/2)),this.bodies.push(new ft(r,new R(0,0),o,0,n))}addWall(t){this.walls.push(t)}addFixedBall(t,e,i){this.fixedBalls.push({x:t,y:e,r:i})}addSpring(t){this.springs.push(t)}setBounds(t,e,i,s){this.bounds=[];let n=(o,r,h,l)=>{let a=[];return a.push(new R(o-h/2,r-l/2)),a.push(new R(o+h/2,r-l/2)),a.push(new R(o+h/2,r+l/2)),a.push(new R(o-h/2,r+l/2)),new pt(a)};this.bounds.push(n(t-i,e,2*i,4*s)),this.bounds.push(n(t+2*i,e,2*i,4*s)),this.bounds.push(n(t,e-s,4*i,s*2)),this.bounds.push(n(t,e+2*s,4*i,2*s))}getObjectAtCoordinates(t,e){let i,s=new R(t,e);return this.balls.forEach(n=>{n.containsPoint(s)&&(i=n)}),this.bodies.forEach(n=>{n.containsPoint(s)&&(i=n)}),this.walls.forEach(n=>{n.containsPoint(s)&&(i=n)}),this.fixedBalls.forEach(n=>{R.dist(new R(n.x,n.y),new R(t,e))<=n.r&&(i=n)}),this.softBalls.forEach(n=>{n.containsPoint(s)&&(i=n)}),i}getCopyOfBalls(){let t=[];return this.balls.forEach(e=>{t.push(e.copy)}),t}getCopyOfBodies(){let t=[];return this.bodies.forEach(e=>{t.push(e.copy)}),t}removeObjFromSystem(t){let e=this.balls.indexOf(t);if(e!=-1){let i=!1;if(this.softBalls.forEach(s=>{s.points.includes(this.balls[e])&&(this.removeObjFromSystem(s),i=!0)}),i)return;this.springs.forEach(s=>{s.objects.includes(this.balls[e])&&this.removeObjFromSystem(s)}),this.balls.splice(e,1);return}if(e=this.bodies.indexOf(t),e!=-1){this.bodies.splice(e,1);return}if(e=this.walls.indexOf(t),e!=-1){this.walls.splice(e,1);return}if(e=this.fixedBalls.indexOf(t),e!=-1){this.fixedBalls.splice(e,1);return}if(e=this.springs.indexOf(t),e!=-1){this.springs.splice(e,1);let i=!1;return this.softBalls.forEach(s=>{s.points.includes(this.springs[e])&&(this.removeObjFromSystem(s),i=!0)}),i,void 0}if(e=this.softBalls.indexOf(t),e!=-1){let i=this.softBalls[e];this.softBalls.splice(e,1),i.points.forEach(s=>{this.removeObjFromSystem(s)});return}}getItemDataFromId(){let t={},e=o=>o.id===id,i=this.balls.filter(e);if(i.length>=1)return t.type="ball",t.num=this.balls.indexOf(i[0]),t;let s=this.bodies.filter(e);if(s.length>=1)return t.type="body",t.num=this.bodies.indexOf(s[0]),t;let n=this.springs.filter(e);if(n.length>=1)return t.type="spring",t.num=this.springs.indexOf(n[0]),t}toJSObject(){let t={};return t.balls=this.balls.map(e=>e.toJSObject()),t.bounds=this.bounds.map(e=>e.toJSObject()),t.walls=this.walls.map(e=>e.toJSObject()),t.bodies=this.bodies.map(e=>e.toJSObject()),t.springs=this.springs.map(e=>e.toJSObject()),t.softBalls=this.softBalls.map(e=>e.toJSObject()),t.fixedBalls=this.fixedBalls,t.airFriction=this.airFriction,t.gravity=this.gravity.toJSObject(),t.version=ie().version,t}static fromObject(t){let e=new V;return e.balls=t.balls.map(i=>Tt.fromObject(i)),e.bounds=t.bounds.map(i=>pt.fromObject(i)),e.walls=t.walls.map(i=>pt.fromObject(i)),e.bodies=t.bodies.map(i=>ft.fromObject(i)),e.springs=t.springs.map(i=>st.fromObject(i,e.balls)),e.softBalls=t.softBalls.map(i=>Pt.fromObject(i,e.balls,e.springs)),e.fixedBalls=t.fixedBalls,e.airFriction=t.airFriction,e.gravity=R.fromObject(t.gravity),e}toJSON(){return JSON.stringify(this.toJSObject())}static fromJSON(t){return V.fromObject(JSON.parse(t))}};V.Ball=Tt;V.Body=ft;V.Vec2=R;V.Wall=pt;V.LineSegment=$e;V.Spring=st;V.Stick=oe;V.SoftBall=Pt;V.Line=_e;V.Polygon=ts;ne.exports=V}),K=W((Ns,he)=>{var ae=class{constructor(t,e,i,s,n,o,r){this.name=t,this.description=e,this.drawFunc=i,this.startInteractionFunc=s,this.endInteractionFunc=n,this.keyGotUpFunc=o,this.keyGotDownFunc=r}};he.exports=ae}),ue=W((Xs,ce)=>{var es=K(),Rt=it(),ss=new es("Ball creator","",function(p,t,e,i,s,n,o,r,h,l){p.strokeStyle="black",p.beginPath(),p.arc(t,e,n,0,2*Math.PI),p.stroke(),i!=0&&s!=0&&(p.beginPath(),p.moveTo(t,e),p.lineTo(i,s),p.stroke())},function(p,t,e,i,s){},function(p,t,e,i,s,n,o){if(n!=0&&o!=0){let r=new Rt.Ball(new Rt.Vec2(n,o),new Rt.Vec2(n-i,o-s),defaultSize,k,0,fc);isFinite(r.pos.x)&&isFinite(r.pos.y)&&isFinite(r.vel.x)&&isFinite(r.vel.y)||(r.vel.x=0,r.vel.y=0),p.addBall(r)}},function(){},function(){});ce.exports=ss}),pe=W((Ys,de)=>{var is=K(),ns=new is("Rectangle wall","",function(p,t,e,i,s,n,o,r,h,l){i!=0&&s!=0&&(p.strokeStyle="black",p.strokeRect(t,e,i-t,s-e))},function(p,t,e,i,s){},function(p,t,e,i,s,n,o){n!=0&&o!=0&&p.addRectWall(n/2+i/2,o/2+s/2,2*Math.abs(n/2-i/2),2*Math.abs(o/2-s/2))},function(){},function(){});de.exports=ns}),ge=W((Js,fe)=>{var os=K(),rs=new os("Wall drawer","",function(p,t,e,i,s,n,o,r,h,l,a){p.strokeStyle="black",p.beginPath(),p.arc(t,e,n,0,2*Math.PI),p.stroke(),i!=0&&s!=0&&r.addFixedBall(t/a.scaling-a.viewOffsetX/a.scaling,e/a.scaling-a.viewOffsetY/a.scaling,n/a.scaling)},function(p,t,e,i,s){},function(p,t,e,i,s,n,o){},function(){},function(){});fe.exports=rs}),me=W((Vs,ye)=>{var ls=K(),hs=it(),as=new ls("Stick creator","",function(p,t,e,i,s,n,o,r,h,l){i!=0&&s!=0&&(p.strokeStyle="black",p.beginPath(),p.moveTo(t,e),p.lineTo(i,s),p.stroke())},function(p,t,e,i,s,n){},function(p,t,e,i,s,n,o,r){if(n!=0&&o!=0){t:{let h=p.getObjectAtCoordinates(i,s),l,a=hs.Stick;if(h||(h={x:i,y:s,pinPoint:!0}),r==h||r==null&&h==null)break t;if(r.pinPoint&&h.pinPoint)break t;r.pinPoint?(l=new a(Math.sqrt(Math.pow(r.x-h.pos.x,2)+Math.pow(r.y-h.pos.y,2)),springConstant),l.attachObject(h),l.pinHere(r.x,r.y)):h.pinPoint?(l=new a(Math.sqrt(Math.pow(r.pos.x-h.x,2)+Math.pow(r.pos.y-h.y,2)),springConstant),l.attachObject(r),l.pinHere(h.x,h.y)):(l=new a(Math.sqrt(Math.pow(r.pos.x-h.pos.x,2)+Math.pow(r.pos.y-h.pos.y,2)),springConstant),l.attachObject(r),l.attachObject(h)),p.addSpring(l),lockRotation&&l.lockRotation()}}},function(){},function(){});ye.exports=as}),we=W((Hs,xe)=>{var cs=K(),us=it(),ds=new cs("Spring creator","",function(p,t,e,i,s,n,o,r,h,l){i!=0&&s!=0&&(p.strokeStyle="black",p.beginPath(),p.moveTo(t,e),p.lineTo(i,s),p.stroke())},function(p,t,e,i,s,n){},function(p,t,e,i,s,n,o,r){if(n!=0&&o!=0){t:{let h=p.getObjectAtCoordinates(i,s),l,a=us.Spring;if(h||(h={x:i,y:s,pinPoint:!0}),r==h||r==null&&h==null)break t;if(r.pinPoint&&h.pinPoint)break t;r.pinPoint?(l=new a(Math.sqrt(Math.pow(r.x-h.pos.x,2)+Math.pow(r.y-h.pos.y,2)),springConstant),l.attachObject(h),l.pinHere(r.x,r.y)):h.pinPoint?(l=new a(Math.sqrt(Math.pow(r.pos.x-h.x,2)+Math.pow(r.pos.y-h.y,2)),springConstant),l.attachObject(r),l.pinHere(h.x,h.y)):(l=new a(Math.sqrt(Math.pow(r.pos.x-h.pos.x,2)+Math.pow(r.pos.y-h.pos.y,2)),springConstant),l.attachObject(r),l.attachObject(h)),p.addSpring(l),lockRotation&&l.lockRotation()}}},function(){},function(){});xe.exports=ds}),ke=W((Gs,ve)=>{var ps=K(),be=0,Me=0,Pe=(p,t,e)=>({x:p/e.scaling-e.viewOffsetX/e.scaling,y:t/e.scaling-e.viewOffsetY/e.scaling}),fs=new ps("Move","",function(p,t,e,i,s,n,o,r,h,l,a){let u=Pe(t,e,a),x=Pe(be,Me,a);h&&!h.pinPoint&&(h.move(u.x-h.pos.x,u.y-h.pos.y),l===0?(h.vel.x=0,h.vel.y=0):(h.vel.x=(u.x-x.x)/l,h.vel.y=(u.y-x.y)/l),h.ang=0),be=t,Me=e},function(p,t,e,i,s){},function(p,t,e,i,s,n,o){},function(){},function(){});ve.exports=fs}),Ie=W((zs,Se)=>{var gs=K(),kt=it(),ys=new gs("Elastic ball creator","",function(p,t,e,i,s,n,o,r,h,l){p.strokeStyle="black",p.beginPath(),p.arc(t,e,n,0,2*Math.PI),p.stroke(),i!=0&&s!=0&&(p.beginPath(),p.moveTo(t,e),p.lineTo(i,s),p.stroke())},function(p,t,e,i,s){},function(p,t,e,i,s,n,o){if(n!=0&&o!=0){let r=new kt.Ball(new kt.Vec2(n,o),new kt.Vec2(n-i,o-s),defaultSize,k,0,fc);if(isFinite(r.pos.x)&&isFinite(r.pos.y)&&isFinite(r.vel.x)&&isFinite(r.vel.y)){let h=new kt.SoftBall(r.pos,defaultSize,1e6,fc,24);h.points.forEach(l=>{l.vel=r.vel.copy}),p.addSoftBall(h)}}},function(){},function(){});Se.exports=ys}),je=W((Us,Oe)=>{var ms=K(),Lt=it(),xs=new ms("Soft square creator","",function(p,t,e,i,s,n,o,r,h,l){p.strokeStyle="black",p.beginPath(),p.moveTo(t-n,e-n),p.lineTo(t+n,e-n),p.lineTo(t+n,e+n),p.lineTo(t-n,e+n),p.lineTo(t-n,e-n),p.stroke(),i!=0&&s!=0&&(p.beginPath(),p.moveTo(t,e),p.lineTo(i,s),p.stroke())},function(p,t,e,i,s){},function(p,t,e,i,s,n,o){if(n!=0&&o!=0){let r=new Lt.Ball(new Lt.Vec2(n,o),new Lt.Vec2(n-i,o-s),defaultSize,k,0,fc);isFinite(r.pos.x)&&isFinite(r.pos.y)&&isFinite(r.vel.x)&&isFinite(r.vel.y)&&p.addSoftSquare(r.pos,defaultSize*2,fc,r.vel)}},function(){},function(){});Oe.exports=xs}),qe=W((Ks,Ce)=>{var ws=K(),vs=new ws("Delete","",function(p,t,e,i,s,n,o,r,h,l){},function(p,t,e,i,s,n){n&&p.removeObjFromSystem(n)},function(p,t,e,i,s,n,o){},function(){},function(){});Ce.exports=vs}),Fe=W((Qs,Be)=>{var bs=K(),Ms=new bs("Rectangle body (experimental)","",function(p,t,e,i,s,n,o,r,h,l){i!=0&&s!=0&&(p.strokeStyle="black",p.strokeRect(t,e,i-t,s-e))},function(p,t,e,i,s){},function(p,t,e,i,s,n,o,r,h,l){n!=0&&o!=0&&p.addRectBody(n/2+i/2,o/2+s/2,2*Math.abs(n/2-i/2),2*Math.abs(o/2-s/2),.18,.1)},function(){},function(){});Be.exports=Ms}),ht=Wt(it()),re=Wt(it());function le(p){this.startingState=p.getPhysics().toJSObject(),this.inStartingState=!0,document.getElementById("pause").onclick=()=>{p.getTimeMultiplier()!==0?p.setTimeMultiplier(0):(p.setTimeMultiplier(1),this.inStartingState==!0&&(this.startingState=p.getPhysics().toJSObject()),this.inStartingState=!1)},document.getElementById("revert").onclick=()=>{p.setTimeMultiplier(0),p.setPhysics(re.default.fromObject(this.startingState)),this.inStartingState=!0},document.getElementById("clear all").onclick=()=>{this.inStartingState=!0;let t=p.getPhysics();t.balls=[],t.walls=[],t.softBalls=[],t.springs=[],t.bodies=[]},document.getElementById("set start").onclick=()=>{this.startingState=p.getPhysics().toJSObject(),this.inStartingState=!0,p.setTimeMultiplier(0)}}var Ae=ht.default,Ee=ht.default.Ball,et=ht.default.Vec2,Ps=ht.default.Spring,Te=ht.default.Stick,St=["ballcreator","rectangle","walldrawer","stickcreator","springcreator","movemode","elasticballcreator","softsquarecreator","deletemode","rectanglebodycreator"],It=[ue(),pe(),ge(),me(),we(),ke(),Ie(),je(),qe(),Fe()],nt={white:"#faf3dd",green:"#02c39a",pink:"#e58c8a",blue:"#77b6ea",black:"#363732"};window.editorApp=new function(){this.physics=new Ae,this.mouseX=0,this.mouseY=0,this.mouseDown=0,this.defaultSize=30,window.defaultSize=30,this.k=.5,window.k=.5,this.fc=2,window.fc=2,this.springConstant=2e3,window.springConstant=2e3,this.scaling=1,this.viewOffsetX=0,this.viewOffsetY=0,this.mode=0,this.lastX=0,this.lastY=0,this.timeMultiplier=1,this.lastFrameTime=performance.now(),window.lockRotation=!1,this.choosed=!1,this.mx=0,this.my=0,this.left=!1,this.right=!1,window.onload=()=>{this.cnv=document.getElementById("defaulCanvas0"),this.canvasHolder=document.getElementById("canvas-holder"),this.physics.setBounds(0,0,this.cnv.width,this.cnv.height),this.physics.setGravity(new et(0,1e3)),this.physics.setAirFriction(.9),this.cnv.addEventListener("touchstart",n,!1),this.cnv.addEventListener("touchend",o,!1),this.cnv.addEventListener("touchmove",r,!1),this.cnv.addEventListener("mousedown",h,!1),this.cnv.addEventListener("mouseup",l,!1),this.cnv.addEventListener("mousemove",a,!1),document.addEventListener("keydown",i,!1),document.addEventListener("keyup",s,!1),window.addEventListener("resize",t,!1),this.cnv.addEventListener("mousedown",()=>{this.mouseDown=1},!1),this.cnv.addEventListener("mouseup",()=>{this.mouseDown=0},!1),t(),g(),le(new P),requestAnimationFrame(this.drawFunction)};let t=()=>{canvasRect=this.canvasHolder.getBoundingClientRect(),this.cnv.width=canvasRect.width,this.cnv.height=window.innerHeight-canvasRect.top;var y=window.devicePixelRatio||1,d=this.cnv.getBoundingClientRect();this.cnv.width=d.width*y,this.cnv.height=d.height*y,this.cnv.style.width=d.width+"px",this.cnv.style.height=d.height+"px",this.scaling=1/y,this.physics.setBounds(0,0,this.cnv.width,this.cnv.height);let M=this.cnv.getContext("2d");M.scale(y,y),M.lineWidth=y,this.defaultSize=(this.cnv.width+this.cnv.height)/80,window.defaultSize=(this.cnv.width+this.cnv.height)/80};this.drawFunction=()=>{isFinite(this.lastFrameTime)||(this.lastFrameTime=performance.now());let y=performance.now()-this.lastFrameTime;isFinite(y)||(y=0),y/=1e3,this.mouseX=isFinite(this.mouseX)?this.mouseX:this.mx,this.mouseY=isFinite(this.mouseY)?this.mouseY:this.my,this.mouseX&&isFinite(this.mouseX)&&(this.mx=this.mouseX),this.mouseY&&isFinite(this.mouseY)&&(this.my=this.mouseY);let d=this.cnv.getContext("2d");d.fillStyle=nt.black,d.fillRect(0,0,this.cnv.width,this.cnv.height),It[this.mode].drawFunc(d,this.mouseX,this.mouseY,this.lastX,this.lastY,this.defaultSize*this.scaling,this.mouseDown,this.physics,this.choosed,y*this.timeMultiplier,{scaling:this.scaling,viewOffsetX:this.viewOffsetX,viewOffsetY:this.viewOffsetY}),d.strokeStyle="black",u(this.cnv),this.physics.balls[0]&&(this.right&&(this.physics.balls[0].ang-=Math.PI*100*y),this.left&&(this.physics.balls[0].ang+=Math.PI*100*y)),y*=this.timeMultiplier,this.physics.update(y/5,!1),this.physics.update(y/5,!1),this.physics.update(y/5,!1),this.physics.update(y/5,!1),this.physics.update(y/5,!1),pmouseX=this.mouseX,pmouseY=this.mouseY,this.lastFrameTime=performance.now(),requestAnimationFrame(this.drawFunction)},startInteraction=(y,d)=>{this.mouseX=y,this.mouseY=d,this.choosed=this.physics.getObjectAtCoordinates(this.mouseX/this.scaling-this.viewOffsetX/this.scaling,this.mouseY/this.scaling-this.viewOffsetY/this.scaling),this.choosed||(this.choosed={x:this.mouseX/this.scaling-this.viewOffsetX/this.scaling,y:this.mouseY/this.scaling-this.viewOffsetY/this.scaling,pinPoint:!0}),this.lastX=this.mouseX,this.lastY=this.mouseY,It[this.mode].startInteractionFunc(this.physics,y/this.scaling-this.viewOffsetX/this.scaling,d/this.scaling-this.viewOffsetY/this.scaling,this.mouseX/this.scaling-this.viewOffsetX/this.scaling,this.mouseY/this.scaling-this.viewOffsetY/this.scaling,this.choosed)};let e=(y,d)=>{if(this.mouseX=y,this.mouseY=d,It[this.mode].endInteractionFunc(this.physics,y/this.scaling-this.viewOffsetX/this.scaling,d/this.scaling-this.viewOffsetY/this.scaling,this.mouseX/this.scaling-this.viewOffsetX/this.scaling,this.mouseY/this.scaling-this.viewOffsetY/this.scaling,this.lastX/this.scaling-this.viewOffsetX/this.scaling,this.lastY/this.scaling-this.viewOffsetY/this.scaling,this.choosed,this.fc,this.k),this.lastX===0&&this.lastY===0)return;this.lastX=0,this.lastY=0,this.choosed=!1},i=y=>{keyCode=y.key,keyCode==="s"&&x(this.cnv.width/2,this.cnv.height/2,.5,this.physics),keyCode==="a"&&(this.scaling+=.01),keyCode==="d"&&(this.scaling-=.01),keyCode==="j"&&(this.viewOffsetX-=10),keyCode==="l"&&(this.viewOffsetX+=10),keyCode==="k"&&(this.viewOffsetY-=10),keyCode==="i"&&(this.viewOffsetY+=10),keyCode==="ArrowRight"&&(this.right=!0),keyCode==="ArrowLeft"&&(this.left=!0)},s=y=>{keyCode=y.key,keyCode==="ArrowRight"&&(this.right=!1),keyCode==="ArrowLeft"&&(this.left=!1)},n=y=>{y.preventDefault();let d=this.canvasHolder.getBoundingClientRect();return startInteraction(y.changedTouches[0].clientX-d.left,y.changedTouches[0].clientY-d.top),!1},o=y=>{y.preventDefault();let d=this.canvasHolder.getBoundingClientRect();return e(y.changedTouches[0].clientX-d.left,y.changedTouches[0].clientY-d.top),!1},r=y=>{y.preventDefault();let d=this.canvasHolder.getBoundingClientRect();return this.mouseX=y.changedTouches[0].clientX-d.left,this.mouseY=y.changedTouches[0].clientY-d.top,!1},h=y=>(startInteraction(y.layerX,y.layerY),!1),l=y=>(e(y.layerX,y.layerY),!1),a=y=>{this.mouseX=y.layerX,this.mouseY=y.layerY},u=y=>{let d=this.cnv.getContext("2d");d.save(),d.translate(this.viewOffsetX,this.viewOffsetY),d.scale(this.scaling,this.scaling),d.fillStyle=nt.green,d.strokeStyle="black";for(let m=0;m<this.physics.balls.length;m++){let b=this.physics.balls[m];d.beginPath(),d.arc(b.pos.x,b.pos.y,b.r,0,2*Math.PI),d.stroke(),d.fill(),d.beginPath(),d.moveTo(b.pos.x,b.pos.y),d.lineTo(b.pos.x+b.r*Math.cos(b.rotation),b.pos.y+b.r*Math.sin(b.rotation)),d.stroke()}this.physics.bodies.forEach(m=>{d.beginPath(),d.moveTo(m.points[m.points.length-1].x,m.points[m.points.length-1].y),m.points.forEach(b=>{d.lineTo(b.x,b.y)}),d.stroke(),d.fill(),d.beginPath(),d.arc(m.pos.x,m.pos.y,1.5,0,Math.PI*2),d.stroke()});let M=m=>{d.beginPath(),d.moveTo(m.points[m.points.length-1].x,m.points[m.points.length-1].y),m.points.forEach(b=>{d.lineTo(b.x,b.y)}),d.fill()};d.fillStyle="white",this.physics.walls.forEach(M),this.physics.bounds.forEach(M),this.physics.fixedBalls.forEach(m=>{d.beginPath(),d.arc(m.x,m.y,m.r,0,Math.PI*2),d.fill()}),d.save(),d.lineWidth=2,this.physics.springs.forEach(m=>{if(m instanceof Ps&&!(m instanceof Te)){let b,B,F,L;m.pinned?(b=m.pinned.x,B=m.pinned.y,F=m.objects[0].pos.x,L=m.objects[0].pos.y):(b=m.objects[0].pos.x,B=m.objects[0].pos.y,F=m.objects[1].pos.x,L=m.objects[1].pos.y);let q=new et(F-b,L-B),E=q.copy;q.rotate(Math.PI/2),q.setMag(5);let A=new et(b,B),J=Math.floor(m.length/10);for(let X=1;X<=J;X++)d.strokeStyle=nt.blue,d.fillStyle=nt.blue,X===J&&(q=new et(0,0)),d.beginPath(),d.moveTo(A.x,A.y),d.lineTo(b+X/J*E.x+q.x,B+X/J*E.y+q.y),d.stroke(),A=new et(b+X/J*E.x+q.x,B+X/J*E.y+q.y),q.mult(-1)}else d.strokeStyle=nt.blue,d.fillStyle=nt.blue,d.beginPath(),d.moveTo(m.objects[0].pos.x,m.objects[0].pos.y),d.lineTo(m.pinned?m.pinned.x:m.objects[1].pos.x,m.pinned?m.pinned.y:m.objects[1].pos.y),d.stroke();m.objects.forEach(b=>{d.strokeStyle="black",d.fillStyle=nt.blue,d.beginPath(),d.arc(b.pos.x,b.pos.y,2.5,0,Math.PI*2),d.fill(),d.stroke()}),m.pinned&&(d.strokeStyle="black",d.fillStyle=nt.blue,d.beginPath(),d.arc(m.pinned.x,m.pinned.y,3,0,Math.PI*2),d.fill(),d.stroke())}),d.restore();for(segment of this.physics.debugData)d.strokeStyle="red",d.beginPath(),d.moveTo(segment.a.x,segment.a.y),d.lineTo(segment.b.x,segment.b.y),d.stroke();d.restore()},x=(y,d,M,m)=>{let b=[],B=25,F=250,L=8;b.push(new Ee(new et(y,d),new et(0,0),M*B,1,0,0));let q=1;for(let E=0;E<L-1;E++)b.push(new Ee(new et(y+q*M*B*1.01*2,d),new et(0,0),M*25,1,0,0)),q*=-1,q>0&&(q+=1),E===L-2&&(b[b.length-1].vel.x=-Math.sign(q)*M*B*8);b.forEach(E=>{m.addBall(E);let A=new Te(F);A.attachObject(E),A.pinHere(E.pos.x,E.pos.y-F),m.addSpring(A),A.lockRotation()})},f=y=>{let d=y.target.id.replace("-btn",""),M=St.indexOf(d),m=document.getElementById(St[this.mode]+"-btn");m.classList.remove("bg-pink-darker"),y.target.classList.add("bg-pink-darker"),this.mode=M},g=()=>{let y=document.getElementById("button-holder");St.forEach(function(M,m){let b=document.createElement("div");b.classList.add("big-button"),b.classList.add("fix-width"),b.id=M+"-btn",b.textContent=It[m].name,b.onclick=f,y.appendChild(b)});let d=document.getElementById(St[this.mode]+"-btn");d.classList.add("bg-pink-darker")},w=y=>{isFinite(y)&&(this.timeMultiplier=y)},S=()=>this.timeMultiplier,I=y=>{y instanceof Ae&&(this.physics=y)},O=()=>this.physics,P=function(){this.setTimeMultiplier=w,this.getTimeMultiplier=S,this.getPhysics=O,this.setPhysics=I};return this};})();
//# sourceMappingURL=main.js.map

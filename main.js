(()=>{var P=class{constructor(t,e){this.x=t,this.y=e}get copy(){return new P(this.x,this.y)}setCoordinates(t,e){this.x=t,this.y=e}get length(){return Math.sqrt(this.x*this.x+this.y*this.y)}get sqlength(){return this.x*this.x+this.y*this.y}get heading(){if(this.x===0&&this.y===0)return 0;if(this.x===0)return this.y>0?Math.PI/2:1.5*Math.PI;if(this.y===0)return this.x>0?0:Math.PI;let t=P.normalized(this);return this.x>0&&this.y>0?Math.asin(t.y):this.x<0&&this.y>0?Math.asin(-t.x)+Math.PI/2:this.x<0&&this.y<0?Math.asin(-t.y)+Math.PI:this.x>0&&this.y<0?Math.asin(t.x)+1.5*Math.PI:0}add(t){this.x+=t.x,this.y+=t.y}sub(t){this.x-=t.x,this.y-=t.y}mult(t){this.x*=t,this.y*=t}div(t){this.x/=t,this.y/=t}lerp(t,e){this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e}dist(t){return new P(this.x-t.x,this.y-t.y).length}pNorm(t){return t<1&&(t=1),(Math.abs(this.x**t)+Math.abs(this.y**t))**(1/t)}setMag(t){if(this.length===0)return;this.mult(t/this.length)}normalize(){if(this.length===0)return;this.div(this.length)}rotate(t){let e=Math.cos(t),s=Math.sin(t);this.setCoordinates(this.x*e-this.y*s,this.x*s+this.y*e)}static rotateArr(t,e){let s=Math.cos(e),o=Math.sin(e);t.forEach(a=>{a.setCoordinates(a.x*s-a.y*o,a.x*o+a.y*s)})}rotate90(){let{x:t}=this;this.x=-this.y,this.y=t}rotate270(){let{x:t}=this;this.x=this.y,this.y=-t}static add(t,e){return new P(t.x+e.x,t.y+e.y)}static sub(t,e){return new P(t.x-e.x,t.y-e.y)}static mult(t,e){return new P(t.x*e,t.y*e)}static div(t,e){return new P(t.x/e,t.y/e)}static fromAngle(t){return new P(Math.cos(t),Math.sin(t))}static fromAnglePNorm(t,e){let s=new P(Math.cos(t),Math.sin(t));return s.div(s.pNorm(e)),s}static lerp(t,e,s){return P.add(t,P.mult(P.sub(e,t),s))}static dist(t,e){return P.sub(t,e).length}static dot(t,e){return t.x*e.x+t.y*e.y}static cross(t,e){return t.x*e.y-t.y*e.x}static crossScalarFirst(t,e){return new P(-e.y*t,e.x*t)}static crossScalarSecond(t,e){return new P(t.y*e,-t.x*e)}static angle(t,e){return Math.acos(Math.min(Math.max(P.dot(t,e)/Math.sqrt(t.sqlength*e.sqlength),1),-1))}static angleACW(t,e){let s=t.heading,o=e.heading,a=o-s;return a<0?2*Math.PI+a:a}static normalized(t){let e=t.length;return e===0?t:new P(t.x/e,t.y/e)}toJSObject(){return{x:this.x,y:this.y}}static fromObject(t){return new P(t.x,t.y)}},i=P;function U(n,t,e,s){let o=s,a=e,r=n,h=t,u=r.vel,l=h.vel,c=r.ang,m=h.ang,d=i.sub(a,r.pos),g=i.sub(a,h.pos),f=r.am,p=h.am,y=r.m,b=h.m,I=(r.k+h.k)/2,k=(r.fc+h.fc)/2,x=r.velInPlace(a),lt=h.velInPlace(a),C=i.sub(lt,x),S=1/y+1/b;S+=i.dot(i.crossScalarFirst(i.cross(d,o)/f,d),o),S+=i.dot(i.crossScalarFirst(i.cross(g,o)/p,g),o),S=-((1+I)*i.dot(C,o))/S;let ut=i.sub(u,i.mult(o,S/y)),dt=i.add(l,i.mult(o,S/b)),Rt=c-S*i.cross(d,o)/f,Wt=m+S*i.cross(g,o)/p,X=C.copy;X.sub(i.mult(o,i.dot(C,o))),X.setMag(1);let D=1/y+1/b;D+=i.dot(i.crossScalarFirst(i.cross(d,X)/f,d),X),D+=i.dot(i.crossScalarFirst(i.cross(g,X)/p,g),X),D=-i.dot(C,X)/D;let q=S*k;q>D&&(q=D),ut=i.sub(ut,i.mult(X,q/y)),dt=i.add(dt,i.mult(X,q/b)),Rt-=q*i.cross(d,X)/f,Wt+=q*i.cross(g,X)/p,r.vel=ut,h.vel=dt,r.ang=Rt,h.ang=Wt}function N(n,t,e){let s=t,o=e,a=n,r=i.sub(s,a.pos),{am:h,m:u}=a,l=i.mult(a.velInPlace(s),-1),c=1/u;c+=i.dot(i.crossScalarFirst(i.cross(r,o)/h,r),o),c=-((1+a.k)*i.dot(l,o))/c;let m=i.sub(a.vel,i.mult(o,c/u)),d=a.ang-c*i.cross(r,o)/h,g=l.copy;g.sub(i.mult(o,i.dot(l,o))),g.setMag(1);let f=1/u;f+=i.dot(i.crossScalarFirst(i.cross(r,g)/h,r),g),f=-i.dot(l,g)/f;let p=c*a.fc;p>f&&(p=f),m=i.sub(m,i.mult(g,p/u)),d-=p*i.cross(r,g)/h,a.vel=m,a.ang=d}function j(n,t){this.min=n,this.max=t}j.prototype.size=function(){return this.max-this.min};function Y(n){return new j(Math.min(...n),Math.max(...n))}function V(n,t){return new j(Math.max(n.min,t.min),Math.min(n.max,t.max))}function Ht(n,t,e,s){let o=[...e,...s],a=d=>Y(n.map(g=>i.dot(g,d))),r=d=>Y(t.map(g=>i.dot(g,d))),h=[];if(o.some(d=>{let g=a(d),f=r(d),p=V(g,f);return h.push(p),p.max<p.min}))return!1;let u=h.map(d=>d.size()),l=u[0],c=0;for(let d=1;d<u.length;d+=1)l>u[d]&&(l=u[d],c=d);let m=o[c];return{normal:m,overlap:l,index:c}}var $=class{constructor(t,e,s,o,a,r){this.pos=t.copy,this.lastPos=this.pos.copy,this.r=s,this.fc=.4,this.amc=2/5,this.density=1,this.rotation=0,a?this.ang=a:this.ang=0,(r||r===0)&&(this.fc=r),o?this.k=o:this.k=.8,e!==void 0?this.vel=e.copy:this.vel=new i(0,0),this.id=`_${Math.random().toString(36).substr(2,9)}`,this.layer=void 0}get m(){return this.density*this.r*this.r*Math.PI}get am(){return this.amc*this.r*this.r*this.m}getAmInPoint(t){let e=this.am;return e+=i.sub(this.pos,t).sqlength*this.m,e}get copy(){let t=new $(this.pos.copy,this.vel.copy,this.r,this.k,this.ang,this.fc);return t.lastPos=this.lastPos.copy,t.rotation=this.rotation,t}move(t,e){this.pos.x+=t,this.pos.y+=e}rotate(t){this.rotation+=t}collided(t){return this.pos.dist(t.pos)<this.r+t.r}static collide(t,e){if(!t.collided(e))return;let s=i.dist(t.pos,e.pos),o=t.m,a=e.m,r=t.pos.copy,h=e.pos.copy,u=t,l=e,c=t.r+e.r-s,m=i.sub(t.pos,e.pos);if(m.setMag(1),m.mult(c*a/(o+a)),r.add(m),m.setMag(1),m.mult(-c*o/(o+a)),h.add(m),u.pos=r,l.pos=h,i.dot(m,i.sub(t.vel,e.vel))<0)return;m.setMag(1);let d=i.add(t.pos,i.mult(m,t.r));return U(t,e,d,m),{cp:d,n:m}}containsPoint(t){return i.dist(this.pos,t)<=this.r}velInPlace(t){let e=i.sub(t,this.pos);return e.rotate(Math.PI/2),e.mult(this.ang),e.add(this.vel),e}effectiveMass(t,e){let s=i.sub(t,this.pos);if(s.length===0)return this.m;let o=i.angle(e,s),a=Math.sin(o)**2*s.length**2/this.am;return 1/(a+1/this.m)}applyDeltaVelInPoint(t,e){let s=i.sub(e,this.pos);if(s.length===0){this.vel.add(t);return}let o=i.angle(s,t),a=i.mult(s,i.dot(t,s)/s.length**2);this.vel.add(a);let r=s.copy;r.rotate(Math.PI/2),r.setMag(1);let h=Math.sign(i.dot(t,r)),u=t.length*Math.cos(o),l=1/(1/this.m+s.length**2/this.am),c=u*l/this.m;this.vel.add(i.mult(r,c*h));let m=h*u*l*s.length/this.am;this.ang-=m}toJSObject(){let t={};return t.pos=this.pos.toJSObject(),t.lastPos=this.lastPos.toJSObject(),t.r=this.r,t.fc=this.fc,t.amc=this.amc,t.rotation=this.rotation,t.ang=this.ang,t.fc=this.fc,t.k=this.k,t.vel=this.vel.toJSObject(),t.id=this.id,typeof this.layer!="undefined"&&(t.layer=this.layer),t}static fromObject(t){let e=new $(i.fromObject(t.pos),i.fromObject(t.vel),t.r,t.k,t.ang,t.fc);return e.lastPos=i.fromObject(t.lastPos),e.amc=t.amc,e.rotation=t.rotation,e.vel=i.fromObject(t.vel),e.id=t.id,typeof t.layer!="undefined"&&(e.layer=t.layer),e}},O=$,Dt=class{constructor(t,e){this.a=t,this.b=e}get length(){return i.dist(this.a,this.b)}distFromPoint(t){let e=i.sub(this.a,this.b),s=i.sub(t,this.b),o=i.sub(t,this.a),a=s.length,r=o.length,h=e.length;if(h===0)return a;let u=i.angle(s,o),l=i.angle(s,e),c=Math.PI-u-l,m=Math.sin(c)*r*h/2,d=2*m/h;return c>Math.PI/2?r:l>Math.PI/2?a:d}static intersect(t,e){let s=i.sub(t.b,t.a),o=s.y/s.x,a=t.b.y-t.b.x*o,r=i.sub(e.b,e.a),h=r.y/r.x,u=e.b.y-e.b.x*h;if(s.x===0&&r.x!==0){if(t.a.x>=e.a.x&&t.a.x<=e.b.x||t.a.x<=e.a.x&&t.a.x>=e.b.x){let g=h*t.a.x+u;if(g>t.a.y&&g<t.b.y||g<t.a.y&&g>t.b.y)return new i(t.a.x,g)}return!1}if(r.x===0&&s.x!==0){if(e.a.x>=t.a.x&&e.a.x<=t.b.x||e.a.x<=t.a.x&&e.a.x>=t.b.x){let g=o*e.a.x+a;if(g>e.a.y&&g<e.b.y||g<e.a.y&&g>e.b.y)return new i(e.a.x,g)}return!1}if(s.x===0&&r.x===0){if(t.a.x===e.a.x){let g;t.a.y<t.b.y?g=[t.a.y,t.b.y]:g=[t.b.y,t.a.y];let f;e.a.y<e.b.y?f=[e.a.y,e.b.y]:f=[e.b.y,e.a.y];let p=[g[0]>f[0]?g[0]:f[0],g[1]<f[1]?g[1]:f[1]];if(p[0]<=p[1])return new i(t.a.x,(p[0]+p[1])/2)}return!1}let l;t.a.x<t.b.x?l=[t.a.x,t.b.x]:l=[t.b.x,t.a.x];let c;e.a.x<e.b.x?c=[e.a.x,e.b.x]:c=[e.b.x,e.a.x];let m=[l[0]>c[0]?l[0]:c[0],l[1]<c[1]?l[1]:c[1]];if(o===h&&a===u&&m[0]<=m[1])return new i((m[0]+m[1])/2,(m[0]+m[1])/2*o+a);let d=(u-a)/(o-h);return d>=m[0]&&d<=m[1]?new i(d,d*o+a):!1}},M=Dt,we=15,A=class{constructor(t){this.points=t;let e=this.points,s=0,o=0,a=i.angleACW(i.sub(e[1],e[0]),i.sub(e[e.length-1],e[0]));this.points.length>0?[this.center]=[this.points[0]]:this.center=new i(0,0),this.boundRadius=1,this.calculateCenterAndRadius(),this.boundsX=new j(0,0),this.boundsY=new j(0,0),this.calculateBoundingBox(),this.axes=[],this.calculateAxes(),s+=a,o+=Math.PI*2-a;for(let h=1;h<e.length-1;h+=1)a=i.angleACW(i.sub(e[(h+1)%e.length],e[h]),i.sub(e[h-1],e[h])),s+=a,o+=Math.PI*2-a;if(a=i.angleACW(i.sub(e[0],e[e.length-1]),i.sub(e[e.length-2],e[e.length-1])),s+=a,o+=Math.PI*2-a,o>s)return;let r=[];for(let h=e.length-1;h>=0;h-=1)r.push(e[h]);this.points=r}calculateBoundingBox(){this.boundsX=Y(this.points.map(t=>t.x)),this.boundsY=Y(this.points.map(t=>t.y))}calculateAxes(){let t=Math.cos(Math.PI/we);this.axes=this.normals.map(e=>new i(e.x,Math.abs(e.y)));for(let e=this.axes.length-2;e>=0;e-=1)for(let s=this.axes.length-1;s>e;s-=1){let o=this.axes[s],a=this.axes[e];if(i.dot(o,a)>t){let r=i.add(o,a);r.normalize(),this.axes.splice(s,1),this.axes[e]=r}}}collideWithBall(t){let e,s,o=t,a=this.points.some((r,h)=>{let u=i.sub(o.pos,r);u.sqlength<=t.r*t.r&&(e=r,s=u);let l=this.points[(h+1)%this.points.length].copy,c=new i(l.x-r.x,l.y-r.y),m=c.sqlength;c.setMag(1);let d=c.copy;d.rotate270();let g=i.dot(u,c),f=i.dot(u,d);return f>=-t.r&&f<t.r&&g>=0&&g*g<=m?(e=i.add(r,i.mult(c,g)),s=d,!0):!1});if(typeof s!="undefined"&&(a||s.setMag(1),typeof e!="undefined"))return s.mult(-1),o.pos=i.add(e,i.mult(s,-t.r)),N(o,e,s),{cp:e,n:s}}get normals(){return this.sides.map(t=>{let e=i.sub(t.b,t.a);return e.setMag(1),e.rotate270(),e})}containsPoint(t){let{sides:e}=this,s=Math.max(...this.points.map(h=>i.dist(h,t)))+1,o=i.fromAngle(0);o.setMag(s);let a=new M(t,i.add(o,t)),r=e.filter(h=>M.intersect(h,a)!==void 0);return r.length%2===1}calculateCenterAndRadius(){this.center=this.points.reduce((t,e)=>i.add(t,e)),this.center.div(this.points.length),this.boundRadius=Math.max(...this.points.map(t=>i.dist(t,this.center)))}get sides(){return this.points.map((t,e)=>new M(t,this.points[(e+1)%this.points.length]))}toJSObject(){let t={};return t.points=this.points.map(e=>({x:e.x,y:e.y})),t}static fromObject(t){let e=new A(t.points.map(s=>new i(s.x,s.y)));return e}},G=A,Ce=15,K=class{constructor(t,e,s,o,a){this.points=t,this.pos=new i(t[0].x,t[0].y);let r=this.points,h=0,u=0,l=i.angleACW(i.sub(r[1],r[0]),i.sub(r[r.length-1],r[0]));h+=l,u+=Math.PI*2-l;for(let c=1;c<r.length-1;c+=1)l=i.angleACW(i.sub(r[(c+1)%r.length],r[c]),i.sub(r[c-1],r[c])),h+=l,u+=Math.PI*2-l;if(l=i.angleACW(i.sub(r[0],r[r.length-1]),i.sub(r[r.length-2],r[r.length-1])),h+=l,u+=Math.PI*2-l,u<h){let c=[];for(let m=r.length-1;m>=0;m-=1)c.push(r[m]);this.points=c}this.m=1,this.am=1,this.boundRadius=1,this.boundsX=new j(0,0),this.boundsY=new j(0,0),this.defaultAxes=[],this.axes=[],this.recalculateBoundingBox(),this.calculatePosAndMass(),this.calculateAxes(),this.lastPos=this.pos.copy,this.fc=.4,this.rotation=0,o?this.ang=o:this.ang=0,(a||a===0)&&(this.fc=a),s?this.k=s:this.k=.8,e!==void 0?this.vel=e.copy:this.vel=new i(0,0),this.id=`_${Math.random().toString(36).substr(2,9)}`}calculateAxes(){let t=Math.cos(Math.PI/Ce);this.defaultAxes=this.normals.map(e=>new i(e.x,Math.abs(e.y)));for(let e=this.defaultAxes.length-2;e>=0;e-=1)for(let s=this.defaultAxes.length-1;s>e;s-=1){let o=this.defaultAxes[s],a=this.defaultAxes[e];if(i.dot(o,a)>t){let r=i.add(o,a);r.normalize(),this.defaultAxes.splice(s,1),this.defaultAxes[e]=r}}this.axes=this.defaultAxes.map(e=>e.copy)}getAmInPoint(t){let e=this.am;return e+=i.sub(this.pos,t).sqlength*this.m,e}get copy(){let t=this.points.map(s=>new i(s.x,s.y)),e=new K(t,this.vel.copy,this.k,this.ang,this.fc);return e.rotation=this.rotation,e.lastPos=this.lastPos.copy,e.pos=this.pos.copy,e}move(t,e){this.pos.x+=t,this.pos.y+=e,this.points.forEach(s=>{let o=s;o.x+=t,o.y+=e}),this.boundsX.min+=t,this.boundsX.max+=t,this.boundsY.min+=e,this.boundsY.max+=e}recalculateBoundingBox(){this.boundsX=Y(this.points.map(t=>t.x)),this.boundsY=Y(this.points.map(t=>t.y))}collideWithBall(t){let e,s,o;if(i.dist(t.pos,this.pos)>t.r+this.boundRadius)return;if(this.points.forEach((a,r)=>{let h=new i(a.x,a.y);if(h.x-=t.pos.x,h.y-=t.pos.y,h.length<=t.r){e=h.heading+Math.PI,s=h.length;let g=i.fromAngle(e);g.mult(t.r-s),this.move(g.x*-1*t.m/(this.m+t.m),g.y*-1*t.m/(this.m+t.m)),t.move(g.x*1*this.m/(this.m+t.m),g.y*1*this.m/(this.m+t.m)),o=new i(a.x,a.y)}h=new i(a.x,a.y);let u=new i(this.points[(r+1)%this.points.length].x,this.points[(r+1)%this.points.length].y),l=new i(t.pos.x,t.pos.y),c=new i(u.x-h.x,u.y-h.y),m=c.heading;h.rotate(-m+Math.PI),u.rotate(-m+Math.PI),l.rotate(-m+Math.PI);let d=l.y-(h.y+u.y)/2;if(d>=-t.r&&d<=t.r&&l.x>=u.x&&l.x<=h.x){e=m-Math.PI/2,s=d;let g=i.fromAngle(e);g.mult(t.r-s),this.move(g.x*-1*t.m/(this.m+t.m),g.y*-1*t.m/(this.m+t.m)),t.move(g.x*1*this.m/(this.m+t.m),g.y*1*this.m/(this.m+t.m)),o=t.pos.copy,o.add(i.mult(i.fromAngle(e+Math.PI),d));let f=i.fromAngle(e);f.mult(-30)}}),Number.isFinite(e)&&o){let a=i.sub(o,t.pos);return a.setMag(-1),U(this,t,o,a),{cp:o,n:a}}}calculatePosAndMass(){let t=[];if(t.push([]),this.points.forEach(a=>{t[0].push(new i(a.x,a.y))}),this.isConcave){let a=(l,c)=>{for(let m=0;m<l.length;m+=1)if(l[m]===c)return!0;return!1},r=(l,c,m)=>{for(let d=0;d<c.length;d+=1)if(!a(m,d)){let g=new M(new i(c[d].x,c[d].y),new i(c[(d+1)%c.length].x,c[(d+1)%c.length].y));if(M.intersect(l,g))return!0}return!1},h=!0,u=()=>{h=!1;for(let l=0;l<t.length;l+=1){let c=t[l],m=i.sub(c[1],c[0]),d=i.sub(c[c.length-1],c[0]),g=i.angleACW(m,d);if(g>Math.PI){h=!0;let f=0,p=f+2,y=new M(new i(c[f].x,c[f].y),new i(c[p%c.length].x,c[p%c.length].y)),b=new i(y.b.x-y.a.x,y.b.y-y.a.y).heading;for(;!(m.heading>d.heading?b>m.heading&&b<2*Math.PI||b>0&&b<d.heading:b>m.heading&&b<d.heading)||r(new M(new i(c[f%c.length].x,c[f%c.length].y),new i(c[p%c.length].x,c[p%c.length].y)),c,[(c.length-1)%c.length,f%c.length,(p-1)%c.length,p%c.length]);)p+=1,y=new M(new i(c[f].x,c[f].y),new i(c[p%c.length].x,c[p%c.length].y)),b=new i(y.b.x-y.a.x,y.b.y-y.a.y).heading;let I=[],k=[];for(let x=f;x<=p;x+=1)I.push(c[x%c.length]);for(let x=p;x<=f+c.length;x+=1)k.push(c[x%c.length]);t[l]=I,t.push(k);return}for(let f=1;f<c.length;f+=1)if(m=i.sub(c[(f+1)%c.length],c[f]),d=i.sub(c[f-1],c[f]),g=i.angleACW(m,d),g>Math.PI){h=!0;let p=f+2,y=new M(new i(c[f].x,c[f].y),new i(c[p%c.length].x,c[p%c.length].y)),b=new i(y.b.x-y.a.x,y.b.y-y.a.y).heading;for(;!(m.heading>d.heading?b>m.heading&&b<2*Math.PI||b>0&&b<d.heading:b>m.heading&&b<d.heading)||r(y,c,[(f-1)%c.length,f%c.length,(p-1)%c.length,p%c.length]);)p+=1,y=new M(new i(c[f].x,c[f].y),new i(c[p%c.length].x,c[p%c.length].y)),b=new i(y.b.x-y.a.x,y.b.y-y.a.y).heading;let I=[],k=[];for(let x=f;x<=p;x+=1)I.push(c[x%c.length]);for(let x=p;x<=f+c.length;x+=1)k.push(c[x%c.length]);t[l]=I,t.push(k);return}}};for(;h;)u()}for(let a=t.length-1;a>=0;a-=1){let r=t[a];for(;r.length>3;)t.push([r[0],r[1],r[2]]),r.splice(1,1)}let e=0,s=0,o=new i(0,0);t.forEach(a=>{let r=Math.sqrt((a[0].x-a[1].x)**2+(a[0].y-a[1].y)**2),h=Math.sqrt((a[1].x-a[2].x)**2+(a[1].y-a[2].y)**2),u=Math.sqrt((a[2].x-a[0].x)**2+(a[2].y-a[0].y)**2),l=(r+h+u)/2,c=Math.sqrt(l*(l-r)*(l-h)*(l-u));e+=c,o.x+=c*(a[0].x+a[1].x+a[2].x)/3,o.y+=c*(a[0].y+a[1].y+a[2].y)/3}),o.div(e),this.pos=o,this.m=e,t.forEach(a=>{let r=Math.sqrt((a[0].x-a[1].x)**2+(a[0].y-a[1].y)**2),h=Math.sqrt((a[1].x-a[2].x)**2+(a[1].y-a[2].y)**2),u=Math.sqrt((a[2].x-a[0].x)**2+(a[2].y-a[0].y)**2),l=Math.max(r,h,u),c=(r+h+u)/2,m=Math.sqrt(c*(c-r)*(c-h)*(c-u)),d=2*m/l,g=Math.sqrt(Math.min(r,u,h)**2-d*d),f=d*l*(d*d+l*l)/24,p=Math.sqrt(d*d/36+(Math.abs(g-l/2)/3)**2);f-=p*p*m,f+=new i((a[0].x+a[1].x+a[2].x)/3,(a[0].y+a[1].y+a[2].y)/3).dist(this.pos)**2*m,s+=f}),this.am=s,this.boundRadius=Math.max(...this.points.map(a=>i.dist(a,this.pos)))}rotate(t){this.points.forEach(e=>{let s=e;s.sub(this.pos),s.rotate(t),s.add(this.pos)}),this.rotation+=t,this.recalculateBoundingBox(),i.rotateArr(this.axes,t)}get isConcave(){let t=this.points,e=i.angleACW(i.sub(t[1],t[0]),i.sub(t[t.length-1],t[0]));if(e>Math.PI)return!0;for(let s=1;s<t.length-1;s+=1)if(e=i.angleACW(i.sub(t[(s+1)%t.length],t[s]),i.sub(t[s-1],t[s])),e>Math.PI)return!0;return e=i.angleACW(i.sub(t[0],t[t.length-1]),i.sub(t[t.length-2],t[t.length-1])),e>Math.PI}static collide(t,e){let s=t,o=e,a=[...s.axes,...o.axes],r=a.map(C=>Y(s.points.map(S=>i.dot(S,C)))),h=a.map(C=>Y(o.points.map(S=>i.dot(S,C)))),u=a.map((C,S)=>V(r[S],h[S])),l=u.map(C=>C.max-C.min);if(l.some(C=>C<0))return;let c=Number.MAX_VALUE,m=0;l.forEach((C,S)=>{C<c&&(c=C,m=S)});let d,g,f=a[m];i.dot(i.sub(s.pos,o.pos),f)>0&&f.mult(-1);let p=i.mult(f,-(c*s.m)/(s.m+o.m)),y=i.mult(f,c*o.m/(s.m+o.m));m<s.axes.length?(d=o,g=s):(d=s,g=o),s.move(p.x,p.y),o.move(y.x,y.y);let b=i.sub(d.pos,g.pos),I;if(i.dot(b,f)>=0)I=d.points.map(C=>i.dot(C,f));else{let C=i.mult(f,-1);I=d.points.map(S=>i.dot(S,C))}let k=d.points[I.indexOf(Math.min(...I))],x=s.velInPlace(k),lt=o.velInPlace(k);return i.dot(x,f)<i.dot(lt,f)?void 0:(f.mult(1),U(s,o,k,f),{n:f,cp:k})}get normals(){return this.sides.map(t=>{let e=i.sub(t.b,t.a);return e.setMag(1),e.rotate270(),e})}collideWithFixedBall(t){let e,s,o=t,a=this.points.some((r,h)=>{let u=i.sub(o,r);u.sqlength<=o.r*o.r&&(e=r,s=u);let l=this.points[(h+1)%this.points.length].copy,c=new i(l.x-r.x,l.y-r.y),m=c.sqlength;c.setMag(1);let d=c.copy;d.rotate270();let g=i.dot(u,c),f=i.dot(u,d);return f>=-o.r&&f<o.r&&g>=0&&g*g<=m?(e=i.add(r,i.mult(c,g)),s=d,!0):!1});if(typeof s!="undefined"&&(a||s.setMag(1),typeof e!="undefined")){let r=i.sub(e,o).length-o.r,h=i.mult(s,r);return this.move(h.x,h.y),N(this,e,s),{cp:e,n:s}}}collideWithWall(t){let e=V(this.boundsX,t.boundsX),s=V(this.boundsY,t.boundsY);if(e.size()<=0||s.size()<=0)return;let o=Ht(this.points,t.points,this.axes,t.axes);if(typeof o!="boolean"){let{normal:a,overlap:r,index:h}=o;i.dot(i.sub(this.pos,t.center),a)<0&&a.mult(-1);let u=i.mult(a,r),l,c;h<this.axes.length?(l=t,c=i.sub(l.center,this.pos)):(l=this,c=i.sub(this.pos,t.center)),this.move(u.x,u.y);let m;if(i.dot(c,a)>=0)m=l.points.map(f=>i.dot(f,a));else{let f=i.mult(a,-1);m=l.points.map(p=>i.dot(p,f))}let d=l.points[m.indexOf(Math.min(...m))],g=this.velInPlace(d);return i.dot(g,a)>0?void 0:(N(this,d,a),{n:a,cp:d})}}containsPoint(t){let{sides:e}=this,s=Math.max(...this.points.map(h=>i.dist(h,t)))+1,o=new i(s,0),a=new M(t,i.add(o,t)),r=e.filter(h=>M.intersect(h,a)instanceof Object);return r.length%2===1}get sides(){return this.points.map((t,e)=>new M(t,this.points[(e+1)%this.points.length]))}velInPlace(t){let e=i.sub(t,this.pos);return e.rotate(Math.PI/2),e.mult(this.ang),e.add(this.vel),e}effectiveMass(t,e){let s=i.sub(t,this.pos),o=i.angle(e,s),a=Math.sin(o)**2*s.length**2/this.am;return 1/(a+1/this.m)}applyDeltaVelInPoint(t,e){let s=i.sub(e,this.pos);if(s.length===0){this.vel.add(t);return}let o=i.angle(s,t),a=i.mult(s,i.dot(t,s)/s.length**2);this.vel.add(a);let r=s.copy;r.rotate(Math.PI/2),r.setMag(1);let h=Math.sign(i.dot(t,r)),u=t.length*Math.cos(o),l=1/(1/this.m+s.length**2/this.am),c=u*l/this.m;this.vel.add(i.mult(r,c*h));let m=h*u*l*s.length/this.am;this.ang-=m}toJSObject(){let t={};return t.points=this.points.map(e=>({x:e.x,y:e.y})),t.vel=this.vel.toJSObject(),t.k=this.k,t.ang=this.ang,t.fc=this.fc,t.pos=this.pos.toJSObject(),t.lastPos=this.lastPos.toJSObject(),t.rotation=this.rotation,t.id=this.id,t}static fromObject(t){let e=new K(t.points.map(s=>new i(s.x,s.y)),i.fromObject(t.vel),t.k,t.ang,t.fc);return e.id=t.id,e.pos=i.fromObject(t.pos),e.lastPos=i.fromObject(t.lastPos),e.rotation=t.rotation,e}},L=K,qt=class{constructor(t,e){this.length=t,this.springConstant=e,this.pinned=!1,this.objects=[],this.rotationLocked=!1,this.id=`_${Math.random().toString(36).substr(2,9)}`}pinHere(t,e){this.pinned={x:t,y:e}}unpin(){this.pinned=!1}attachObject(t){let e=this.objects;e.push(t),e.length===2&&(this.pinned=!1),e.length>=3&&(e=[e[e.length-2],e[e.length-1]])}lockRotation(){this.rotationLocked=!0}unlockRotation(){this.rotationLocked=!1}update(t){let e,s;if(this.pinned instanceof Object&&this.objects[0]){[s,e]=[this.pinned,this.objects[0]];let o=new i(s.x-e.pos.x,s.y-e.pos.y),a=o.length-this.length;o.setMag(1),o.mult(a*this.springConstant*t/e.m),e.vel.x+=o.x,e.vel.y+=o.y;let r=e.vel;if(r.rotate(-o.heading),this.rotationLocked){let h=new i(s.x,s.y),u=i.sub(e.pos,h),l=u.length,c=l*l*e.m+e.am,m=(e.am*e.ang-l*e.m*r.y)/c;r.y=-m*l,e.ang=m}r.rotate(o.heading)}else if(this.objects[0]&&this.objects[1]){[e,s]=[this.objects[0],this.objects[1]];let o=i.sub(e.pos,s.pos),a=o.length-this.length;o.setMag(1),o.mult(a*this.springConstant*t),s.vel.add(i.div(o,s.m)),e.vel.add(i.div(o,-e.m)),o=i.sub(e.pos,s.pos);let r=e.vel,h=s.vel;if(r.rotate(-o.heading),h.rotate(-o.heading),this.rotationLocked){let u=new i(e.pos.x*e.m+s.pos.x*s.m,e.pos.y*e.m+s.pos.y*s.m);u.div(e.m+s.m);let l=i.sub(e.pos,u),c=i.sub(s.pos,u),m=l.length,d=c.length,g=m*m*e.m+e.am+d*d*s.m+s.am,f=(r.y-h.y)*d/(m+d)+h.y,p=(e.am*e.ang+s.am*s.ang+m*e.m*(r.y-f)-d*s.m*(h.y-f))/g;r.y=p*m+f,h.y=-p*d+f,e.ang=p,s.ang=p}r.rotate(o.heading),h.rotate(o.heading)}}},E=qt,Gt=class extends E{constructor(t){super(t,0);this.springConstant=0}update(){let t,e;if(this.pinned instanceof Object&&"x"in this.pinned&&this.objects[0]){[e,t]=[this.pinned,this.objects[0]];let s=new i(e.x-t.pos.x,e.y-t.pos.y);s.setMag(1),s.mult(-this.length),t.move(-t.pos.x+e.x+s.x,-t.pos.y+e.y+s.y);let o=t.vel;if(o.rotate(-s.heading),o.x=0,this.rotationLocked){let a=new i(e.x,e.y),r=i.sub(t.pos,a),h=r.length,u=h*h*t.m+t.am,l=(t.am*t.ang+h*t.m*o.y)/u;o.y=l*h,t.ang=l}o.rotate(s.heading)}else if(this.objects[0]&&this.objects[1]){[t,e]=[this.objects[0],this.objects[1]];let s=i.sub(t.pos,e.pos),o=this.length-s.length;s.setMag(1);let a=i.mult(s,o*e.m/(t.m+e.m)),r=i.mult(s,-o*t.m/(t.m+e.m));t.move(a.x,a.y),e.move(r.x,r.y);let h=t.vel,u=e.vel;if(h.rotate(-s.heading),u.rotate(-s.heading),h.x=(t.m*h.x+e.m*u.x)/(t.m+e.m),u.x=h.x,this.rotationLocked){let l=new i(t.pos.x*t.m+e.pos.x*e.m,t.pos.y*t.m+e.pos.y*e.m);l.div(t.m+e.m);let c=i.sub(t.pos,l),m=i.sub(e.pos,l),d=c.length,g=m.length,f=d*d*t.m+t.am+g*g*e.m+e.am,p=(h.y-u.y)*g/(d+g)+u.y,y=(t.am*t.ang+e.am*e.ang+d*t.m*(h.y-p)-g*e.m*(u.y-p))/f;h.y=y*d+p,u.y=-y*g+p,t.ang=y,e.ang=y}h.rotate(s.heading),u.rotate(s.heading)}}},F=Gt,tt=class{constructor(t,e,s,o,a){this.points=[],o||o===0?this.fc=o:this.fc=.4,this.pressure=s,a?this.resolution=a:this.resolution=30,this.r=Math.abs(e);let r=Math.random()*1e6;for(let h=0;h<this.resolution;h+=1){let u=new i(t.x,t.y);u.add(i.mult(i.fromAngle(h/this.resolution*Math.PI*2),this.r)),this.points.push(new O(u,new i(0,0),this.r*Math.sin(Math.PI/this.resolution),0,0,this.fc)),this.points[this.points.length-1].layer=r}this.sides=[];for(let h=0;h<this.resolution;h+=1){let u=new F(2*this.r*Math.sin(Math.PI/this.resolution));u.attachObject(this.points[h]),u.attachObject(this.points[(h+1)%this.resolution]),h%2===0&&u.lockRotation(),this.sides.push(u)}}static updatePressureBasedForces(t,e){let s=[];if(s.push([]),t.points.forEach(r=>{s[0].push(new i(r.pos.x,r.pos.y))}),(r=>{let h=i.angleACW(i.sub(r[1],r[0]),i.sub(r[r.length-1],r[0]));if(h>Math.PI)return!0;for(let u=1;u<r.length-1;u+=1)if(h=i.angleACW(i.sub(r[(u+1)%r.length],r[u]),i.sub(r[u-1],r[u])),h>Math.PI)return!0;return h=i.angleACW(i.sub(r[0],r[r.length-1]),i.sub(r[r.length-2],r[r.length-1])),h>Math.PI})(s[0])){let r=(l,c)=>{for(let m=0;m<l.length;m+=1)if(l[m]===c)return!0;return!1},h=(l,c,m)=>{for(let d=0;d<c.length;d+=1)if(!r(m,d)){let g=new M(new i(c[d].x,c[d].y),new i(c[(d+1)%c.length].x,c[(d+1)%c.length].y));if(M.intersect(l,g))return!0}return!1},u=!0;t:for(;u;){u=!1;for(let l=0;l<s.length;l+=1){let c=s[l],m=i.sub(c[1],c[0]),d=i.sub(c[c.length-1],c[0]),g=i.angleACW(m,d);if(g>Math.PI){u=!0;let f=0,p=f+2,y=new M(new i(c[f].x,c[f].y),new i(c[p%c.length].x,c[p%c.length].y)),b=new i(y.b.x-y.a.x,y.b.y-y.a.y).heading;for(;!(m.heading>d.heading?b>m.heading&&b<2*Math.PI||b>0&&b<d.heading:b>m.heading&&b<d.heading)||h(new M(new i(c[f%c.length].x,c[f%c.length].y),new i(c[p%c.length].x,c[p%c.length].y)),c,[(c.length-1)%c.length,f%c.length,(p-1)%c.length,p%c.length]);)p+=1,y=new M(new i(c[f].x,c[f].y),new i(c[p%c.length].x,c[p%c.length].y)),b=new i(y.b.x-y.a.x,y.b.y-y.a.y).heading;let I=[],k=[];for(let x=f;x<=p;x+=1)I.push(c[x%c.length]);for(let x=p;x<=f+c.length;x+=1)k.push(c[x%c.length]);s[l]=I,s.push(k);continue t}for(let f=1;f<c.length;f+=1)if(m=i.sub(c[(f+1)%c.length],c[f]),d=i.sub(c[f-1],c[f]),g=i.angleACW(m,d),g>Math.PI){u=!0;let p=f+2,y=new M(new i(c[f].x,c[f].y),new i(c[p%c.length].x,c[p%c.length].y)),b=new i(y.b.x-y.a.x,y.b.y-y.a.y).heading;for(;!(m.heading>d.heading?b>m.heading&&b<2*Math.PI||b>0&&b<d.heading:b>m.heading&&b<d.heading)||h(y,c,[(f-1)%c.length,f%c.length,(p-1)%c.length,p%c.length]);)p+=1,y=new M(new i(c[f].x,c[f].y),new i(c[p%c.length].x,c[p%c.length].y)),b=new i(y.b.x-y.a.x,y.b.y-y.a.y).heading;let I=[],k=[];for(let x=f;x<=p;x+=1)I.push(c[x%c.length]);for(let x=p;x<=f+c.length;x+=1)k.push(c[x%c.length]);s[l]=I,s.push(k);continue t}}}}for(let r=s.length-1;r>=0;r-=1){let h=s[r];for(;h.length>3;)s.push([h[0],h[1],h[2]]),h.splice(1,1)}let o=0;s.forEach(r=>{let h=Math.sqrt((r[0].x-r[1].x)**2+(r[0].y-r[1].y)**2),u=Math.sqrt((r[1].x-r[2].x)**2+(r[1].y-r[2].y)**2),l=Math.sqrt((r[2].x-r[0].x)**2+(r[2].y-r[0].y)**2),c=(h+u+l)/2,m=Math.sqrt(c*(c-h)*(c-u)*(c-l));o+=m});let a=t.pressure*(t.r*t.r*Math.PI/o)-t.pressure;t.sides.forEach(r=>{let h=i.sub(r.objects[0].pos,r.objects[1].pos);h.mult(a),h.rotate(Math.PI/2),h.mult(e),r.objects[0].vel.add(i.div(h,r.objects[0].m)),r.objects[1].vel.add(i.div(h,r.objects[1].m))})}get sideSegments(){return this.points.map((t,e)=>new M(t.pos,this.points[(e+1)%this.points.length].pos))}containsPoint(t){let e=this.sideSegments,s=Math.max(...this.points.map(h=>i.dist(h.pos,t)))+1,o=i.fromAngle(0);o.setMag(s);let a=new M(t,i.add(o,t)),r=e.filter(h=>M.intersect(h,a)!==void 0);return r.length%2===1}toJSObject(){let t={};return t.pressure=this.pressure,t.fc=this.fc,t.r=this.r,t.resolution=this.resolution,t.points=this.points.map(e=>e.id),t.sides=this.sides.map(e=>e.id),t}static fromObject(t,e,s){let o=Object.create(tt.prototype);return o.pressure=t.pressure,o.fc=t.fc,o.resolution=t.resolution,o.r=t.r,o.points=t.points.map(a=>{let r=e.filter(h=>a===h.id);return r[0]}),o.sides=t.sides.map(a=>{let r=s.filter(h=>a===h.id);return r[0]}),o}},R=tt;function Se(n,t,e){return n==="spring"?new E(t,e):n==="stick"?new F(t):new E(0,0)}function Jt(n,t){let e=Se(n.type,n.length,n.springConstant);return e.pinned=n.pinned,e.rotationLocked=n.rotationLocked,e.id=n.id,e.objects=n.objects.map(s=>{let o=t.filter(a=>s===a.id);return o[0]}),e}function zt(n){let t={};return t.length=n.length,t.springConstant=n.springConstant,t.pinned=n.pinned,t.rotationLocked=n.rotationLocked,t.id=n.id,t.objects=n.objects.map(e=>e.id),n instanceof E&&(t.type="spring"),n instanceof F&&(t.type="stick"),t}var W=class{constructor(){this.balls=[],this.bodies=[],this.fixedBalls=[],this.softBalls=[],this.walls=[],this.bounds=[],this.springs=[],this.airFriction=1,this.gravity=new i(0,0),this.addBodyNotBall=!1,this.collisionData=[]}update(t,e){this.collisionData=[];let s=e?this.copy:new W;e&&(s.bodies.reverse(),s.balls.reverse(),s.update(t,!1));for(let o=0;o<this.balls.length;o+=1)this.balls[o].lastPos=this.balls[o].pos.copy,this.balls[o].pos.add(i.mult(this.balls[o].vel,t)),this.balls[o].rotation+=this.balls[o].ang*t,this.balls[o].rotation%=Math.PI*2;for(let o=0;o<this.bodies.length;o+=1)this.bodies[o].lastPos=this.bodies[o].pos.copy,this.bodies[o].move(this.bodies[o].vel.x*t,this.bodies[o].vel.y*t),this.bodies[o].rotate(this.bodies[o].ang*t);for(let o=0;o<3;o+=1)this.springs.forEach(a=>{a.update(t/3/2)});for(let o=0;o<this.balls.length;o+=1){this.gravity&&this.balls[o].vel.add(new i(this.gravity.x*t,this.gravity.y*t));for(let a=o+1;a<this.balls.length;a+=1)if(this.balls[o].layer!==this.balls[a].layer||!this.balls[o].layer&&!this.balls[a].layer){let r=O.collide(this.balls[o],this.balls[a]);r&&this.collisionData.push(r)}this.walls.forEach(a=>{let r=a.collideWithBall(this.balls[o]);r&&this.collisionData.push(r)}),this.fixedBalls.forEach(a=>{let r=this.balls[o],h=i.sub(r.pos,a);if(h.sqlength<=(r.r+a.r)**2){let u=h;u.setMag(1),r.pos=i.add(a,i.mult(u,r.r+a.r)),u.mult(-1),N(r,a,u),this.collisionData.push({cp:i.fromObject(a),n:u})}}),this.bounds.forEach(a=>{let r=a.collideWithBall(this.balls[o]);r&&this.collisionData.push(r)})}for(let o=0;o<this.bodies.length;o+=1){this.balls.forEach(a=>{let r=this.bodies[o].collideWithBall(a);r&&this.collisionData.push(r)});for(let a=o+1;a<this.bodies.length;a+=1){let r=L.collide(this.bodies[o],this.bodies[a]);r&&this.collisionData.push(r)}this.bodies.forEach(a=>{this.fixedBalls.forEach(r=>{let h=a.collideWithFixedBall(r);h&&this.collisionData.push(h)})}),this.bodies.forEach(a=>{this.walls.forEach(r=>{let h=a.collideWithWall(r);h&&this.collisionData.push(h)})}),this.bodies.forEach(a=>{this.bounds.forEach(r=>{let h=a.collideWithWall(r);h&&this.collisionData.push(h)})}),this.gravity&&this.bodies[o].vel.add(new i(this.gravity.x*t,this.gravity.y*t))}this.softBalls.forEach(o=>{R.updatePressureBasedForces(o,t)});for(let o=0;o<3;o+=1)this.springs.forEach(a=>{a.update(t/3/2)});this.balls.forEach(o=>{let a=o;a.vel.mult(this.airFriction**t),a.ang*=this.airFriction**t}),this.bodies.forEach(o=>{let a=o;a.vel.mult(this.airFriction**t),a.ang*=this.airFriction**t}),e&&(s.bodies.reverse(),s.balls.reverse(),this.balls.forEach((o,a)=>{o.move((s.balls[a].pos.x-o.pos.x)*.5,(s.balls[a].pos.y-o.pos.y)*.5),o.vel.add(new i((s.balls[a].vel.x-o.vel.x)*.5,(s.balls[a].vel.y-o.vel.y)*.5));let r=o;r.rotation=(o.rotation+s.balls[a].rotation)/2,r.ang=(o.ang+s.balls[a].ang)/2}),this.bodies.forEach((o,a)=>{let r=s.bodies[a];o.move((r.pos.x-o.pos.x)*.5,(r.pos.y-o.pos.y)*.5),o.vel.add(new i((r.vel.x-o.vel.x)*.5,(r.vel.y-o.vel.y)*.5)),o.rotate((r.rotation-o.rotation)/2);let h=o;h.ang=(o.ang+r.ang)/2}))}get copy(){let t=new W;return t.balls=this.getCopyOfBalls(),t.bodies=this.getCopyOfBodies(),t.fixedBalls=this.fixedBalls,t.walls=this.walls,t.bounds=this.bounds,t.gravity=this.gravity,this.springs.forEach(e=>{let s=e instanceof E?E:F,o=new s(e.length,e.springConstant);o.rotationLocked=e.rotationLocked,o.pinned=e.pinned,e.objects.forEach(a=>{let r=-1;a instanceof O&&(r=this.balls.indexOf(a)),r!==-1?o.attachObject(t.balls[r]):(r=-1,a instanceof L&&(r=this.bodies.indexOf(a)),r!==-1&&o.attachObject(t.bodies[r]))}),t.springs.push(o)}),t}setAirFriction(t){if(!Number.isFinite(t))return;this.airFriction=t,this.airFriction<0&&(this.airFriction=0),this.airFriction>1&&(this.airFriction=1)}setGravity(t){this.gravity=t.copy}addBall(t){if(this.addBodyNotBall){let e=(s,o,a)=>{let r=[];for(let h=0;h<a;h+=1){let u=i.fromAngle(h/a*2*Math.PI);u.mult(o),u.add(s),r.push(u)}return r};this.bodies.push(new L(e(t.pos,t.r,24),t.vel,t.k,t.ang,t.fc))}else this.balls.push(t)}addBody(t){this.bodies.push(t)}addSoftBall(t){this.balls.push(...t.points),this.springs.push(...t.sides),this.softBalls.push(t)}addSoftSquare(t,e,s,o,a=24,r=1){let h=new R(t,Math.sqrt(e*e/Math.PI),r,s,a);h.sides.forEach(c=>{let m=c;m.length=.96*4*e/h.resolution}),h.points.forEach(c=>{let m=c;m.vel=o.copy}),this.balls.push(...h.points),this.springs.push(...h.sides);let u=e*e*200*r,l=new E(Math.sqrt(h.r*h.r*Math.PI),u/2);l.attachObject(h.points[0]),l.attachObject(h.points[h.resolution/2]),this.springs.push(l),l=new E(Math.sqrt(h.r*h.r*Math.PI),u/2),l.attachObject(h.points[h.resolution/4]),l.attachObject(h.points[3*h.resolution/4]),this.springs.push(l),l=new E(Math.sqrt(2*h.r*h.r*Math.PI),u),l.attachObject(h.points[h.resolution/8]),l.attachObject(h.points[5*h.resolution/8]),this.springs.push(l),l=new E(Math.sqrt(2*h.r*h.r*Math.PI),u),l.attachObject(h.points[3*h.resolution/8]),l.attachObject(h.points[7*h.resolution/8]),this.springs.push(l)}addRectWall(t,e,s,o){let a=[];a.push(new i(t-s/2,e-o/2)),a.push(new i(t+s/2,e-o/2)),a.push(new i(t+s/2,e+o/2)),a.push(new i(t-s/2,e+o/2)),this.walls.push(new G(a))}addRectBody(t,e,s,o,a,r){let h=[];h.push(new i(t-s/2,e-o/2)),h.push(new i(t+s/2,e-o/2)),h.push(new i(t+s/2,e+o/2)),h.push(new i(t-s/2,e+o/2)),this.bodies.push(new L(h,new i(0,0),r,0,a))}addWall(t){this.walls.push(t)}addFixedBall(t,e,s){this.fixedBalls.push({x:t,y:e,r:s})}addSpring(t){this.springs.push(t)}setBounds(t,e,s,o){this.bounds=[];let a=(r,h,u,l)=>{let c=[];return c.push(new i(r-u/2,h-l/2)),c.push(new i(r+u/2,h-l/2)),c.push(new i(r+u/2,h+l/2)),c.push(new i(r-u/2,h+l/2)),new G(c)};this.bounds.push(a(t-s,e,2*s,4*o)),this.bounds.push(a(t+2*s,e,2*s,4*o)),this.bounds.push(a(t,e-o,4*s,o*2)),this.bounds.push(a(t,e+2*o,4*s,2*o))}getObjectAtCoordinates(t,e){let s={x:t,y:e,pinPoint:!0},o=new i(t,e);return this.balls.some(a=>a.containsPoint(o)?(s=a,!0):!1)||(this.bodies.some(a=>a.containsPoint(o)?(s=a,!0):!1)||(this.walls.some(a=>a.containsPoint(o)?(s=a,!0):!1)||(this.fixedBalls.forEach(a=>{i.dist(new i(a.x,a.y),new i(t,e))<=a.r&&(s=a)}),this.softBalls.forEach(a=>{a.containsPoint(o)&&(s=a)})))),s}getCopyOfBalls(){return this.balls.map(t=>t.copy)}getCopyOfBodies(){return this.bodies.map(t=>t.copy)}removeObjFromSystem(t){let e=-1;if(t instanceof O&&(e=this.balls.indexOf(t)),e!==-1){let s=!1;if(this.softBalls.forEach(o=>{o.points.includes(this.balls[e])&&(this.removeObjFromSystem(o),s=!0)}),s)return;this.springs.forEach(o=>{o.objects.includes(this.balls[e])&&this.removeObjFromSystem(o)}),this.balls.splice(e,1);return}if(t instanceof L&&(e=this.bodies.indexOf(t)),e!==-1){this.bodies.splice(e,1);return}if(t instanceof G&&(e=this.walls.indexOf(t)),e!==-1){this.walls.splice(e,1);return}if(t instanceof Object&&"r"in t&&"x"in t&&(e=this.fixedBalls.indexOf(t)),e!==-1){this.fixedBalls.splice(e,1);return}if((t instanceof F||t instanceof E)&&(e=this.springs.indexOf(t)),e!==-1){this.springs.splice(e,1);let s=this.springs[e];this.softBalls.forEach(o=>{s instanceof F&&o.sides.includes(s)&&this.removeObjFromSystem(o)});return}if(t instanceof R&&(e=this.softBalls.indexOf(t)),e!==-1){let s=this.softBalls[e];this.softBalls.splice(e,1),s.points.forEach(o=>{this.removeObjFromSystem(o)})}}getItemDataFromId(t){let e=r=>r.id===t,s=this.balls.filter(e);if(s.length>=1)return{type:"ball",num:this.balls.indexOf(s[0])};let o=this.bodies.filter(e);if(o.length>=1)return{type:"body",num:this.bodies.indexOf(o[0])};let a=this.springs.filter(e);return a.length>=1?{type:"spring",num:this.springs.indexOf(a[0])}:{type:"",num:-1}}toJSObject(){let t={};return t.balls=this.balls.map(e=>e.toJSObject()),t.bounds=this.bounds.map(e=>e.toJSObject()),t.walls=this.walls.map(e=>e.toJSObject()),t.bodies=this.bodies.map(e=>e.toJSObject()),t.springs=this.springs.map(e=>zt(e)),t.softBalls=this.softBalls.map(e=>e.toJSObject()),t.fixedBalls=this.fixedBalls,t.airFriction=this.airFriction,t.gravity=this.gravity.toJSObject(),t}static fromObject(t){let e=new W;return e.balls=t.balls.map(s=>O.fromObject(s)),e.bounds=t.bounds.map(s=>G.fromObject(s)),e.walls=t.walls.map(s=>G.fromObject(s)),e.bodies=t.bodies.map(s=>L.fromObject(s)),e.springs=t.springs.map(s=>Jt(s,e.balls)),e.softBalls=t.softBalls.map(s=>R.fromObject(s,e.balls,e.springs)),e.fixedBalls=t.fixedBalls,e.airFriction=t.airFriction,e.gravity=i.fromObject(t.gravity),e}toJSON(){return JSON.stringify(this.toJSObject())}static fromJSON(t){return W.fromObject(JSON.parse(t))}},Q=W,et,J;function mt(n){et=n.getPhysics().toJSObject(),J=!0;let t=document.getElementById("pause");t&&(t.onclick=()=>{n.getTimeMultiplier()!==0?n.setTimeMultiplier(0):(n.setTimeMultiplier(1),J===!0&&(et=n.getPhysics().toJSObject()),J=!1)});let e=document.getElementById("revert");e&&(e.onclick=()=>{n.setTimeMultiplier(0),n.setPhysics(Q.fromObject(et)),J=!0});let s=document.getElementById("clear all");s&&(s.onclick=()=>{J=!0;let a=n.getPhysics();a.balls=[],a.walls=[],a.softBalls=[],a.springs=[],a.bodies=[]});let o=document.getElementById("set start");o&&(o.onclick=()=>{et=n.getPhysics().toJSObject(),J=!0,n.setTimeMultiplier(0)})}function w(n){let t=document.createElement("div"),e=document.createElement("h3");return e.innerText=n,e.classList.add("modetitlemargin"),t.appendChild(e),t.classList.add("mode-title"),t.classList.add("bg-blue"),t}function v(n,t,e,s,o,a=1){let r=document.createElement("p");r.innerText=n;let h=document.createElement("input");h.type="range",h.min=t.toString(),h.max=e.toString(),h.step=a.toString(),h.value=s.toString(),h.classList.add("slider"),h.classList.add("fix-width"),h.onchange=o;let u=document.createElement("div");return u.appendChild(r),u.appendChild(h),u}function z(n,t,e){let s=n+Math.random().toString(),o=document.createElement("label");o.innerText=n,o.htmlFor=s,o.classList.add("checkbox-label");let a=document.createElement("input");a.type="checkbox",a.name=s,a.value=t.toString(),a.classList.add("ch-box"),a.onchange=e;let r=document.createElement("div");return r.appendChild(a),r.appendChild(o),r}var st=35,ft=.5,gt=1.5,pt=document.createElement("div"),Ut={name:"Ball creator",description:"",element:pt,drawFunc(n,t){let e=n.cnv.getContext("2d");e.strokeStyle="black",e.beginPath(),e.arc(n.mouseX,n.mouseY,st,0,2*Math.PI),e.stroke(),n.lastX!==0&&n.lastY!==0&&(e.beginPath(),e.moveTo(n.mouseX,n.mouseY),e.lineTo(n.lastX,n.lastY),e.stroke())},startInteractionFunc(n){},endInteractionFunc(n){if(n.lastX!==0&&n.lastY!==0){let t=new O(new i(n.lastX,n.lastY),new i(n.lastX-n.mouseX,n.lastY-n.mouseY),st,ft,0,gt);Number.isFinite(t.pos.x)&&Number.isFinite(t.pos.y)&&Number.isFinite(t.vel.x)&&Number.isFinite(t.vel.y)||(t.vel.x=0,t.vel.y=0),n.physics.addBall(t)}},keyGotUpFunc(n){},keyGotDownFunc(n){}};[w(Ut.name),v("Size",5,120,st,n=>{st=n.target.valueAsNumber}),v("Bounciness",0,1,ft,n=>{ft=n.target.valueAsNumber},.02),v("Coefficient of friction",0,2,gt,n=>{gt=n.target.valueAsNumber},.1)].forEach(pt.appendChild.bind(pt));var Vt=Ut,yt=document.createElement("div"),$t={name:"Delete",description:"",element:yt,drawFunc(n,t){},startInteractionFunc(n){n.choosed&&n.physics.removeObjFromSystem(n.choosed)},endInteractionFunc(n){},keyGotUpFunc(n){},keyGotDownFunc(n){}};[w($t.name)].forEach(yt.appendChild.bind(yt));var Kt=$t,Z=35,Ie=.5,nt=1.5,bt=24,xt=1e6,vt=document.createElement("div"),Qt={name:"Elastic ball creator",description:"",element:vt,drawFunc(n,t){let e=n.cnv.getContext("2d");e.strokeStyle="black",e.beginPath(),e.arc(n.mouseX,n.mouseY,Z,0,2*Math.PI),e.stroke(),n.lastX!==0&&n.lastY!==0&&(e.beginPath(),e.moveTo(n.mouseX,n.mouseY),e.lineTo(n.lastX,n.lastY),e.stroke())},startInteractionFunc(n){},endInteractionFunc(n){if(n.lastX!==0&&n.lastY!==0){let t=new O(new i(n.lastX,n.lastY),new i(n.lastX-n.mouseX,n.lastY-n.mouseY),Z,Ie,0,nt);if(Number.isFinite(t.pos.x)&&Number.isFinite(t.pos.y)&&Number.isFinite(t.vel.x)&&Number.isFinite(t.vel.y)){let e=new R(t.pos,Z,xt,nt,bt);e.points.forEach(s=>{let o=s;o.vel=t.vel.copy}),n.physics.addSoftBall(e)}}},keyGotUpFunc(n){},keyGotDownFunc(n){}};[w(Qt.name),v("Size",5,60,Z,n=>{Z=n.target.valueAsNumber}),v("Pressure",5e5,3e6,xt,n=>{xt=n.target.valueAsNumber},4e3),v("Coefficient of friction",0,2,nt,n=>{nt=n.target.valueAsNumber},.1),v("Resolution",6,24,bt,n=>{bt=n.target.valueAsNumber},1)].forEach(vt.appendChild.bind(vt));var Zt=Qt,_t=0,At=0,Mt=document.createElement("div"),te={name:"Move",description:"",element:Mt,drawFunc(n,t){let{choosed:e}=n;e instanceof Object&&"move"in e&&(e.move(n.mouseX-e.pos.x,n.mouseY-e.pos.y),t===0?(e.vel.x=0,e.vel.y=0):(e.vel.x=(n.mouseX-_t)/t,e.vel.y=(n.mouseY-At)/t),e.ang=0),_t=n.mouseX,At=n.mouseY},startInteractionFunc(n){},endInteractionFunc(n){},keyGotUpFunc(n){},keyGotDownFunc(n){}};[w(te.name)].forEach(Mt.appendChild.bind(Mt));var ee=te,wt=document.createElement("div"),se={name:"Rectangle wall",description:"",element:wt,drawFunc(n,t){if(n.lastX!==0&&n.lastY!==0){let e=n.cnv.getContext("2d");e.strokeStyle="black",e.strokeRect(n.mouseX,n.mouseY,n.lastX-n.mouseX,n.lastY-n.mouseY)}},startInteractionFunc(n){},endInteractionFunc(n){n.lastX!==0&&n.lastY!==0&&n.physics.addRectWall(n.lastX/2+n.mouseX/2,n.lastY/2+n.mouseY/2,2*Math.abs(n.lastX/2-n.mouseX/2),2*Math.abs(n.lastY/2-n.mouseY/2))},keyGotUpFunc(n){},keyGotDownFunc(n){}};[w(se.name)].forEach(wt.appendChild.bind(wt));var ne=se,Ct=.2,Pt=.5,St=document.createElement("div"),ie={name:"Rectangle body",description:"",element:St,drawFunc(n,t){let e=n.cnv.getContext("2d");n.lastX!==0&&n.lastY!==0&&(e.strokeStyle="black",e.strokeRect(n.mouseX,n.mouseY,n.lastX-n.mouseX,n.lastY-n.mouseY))},startInteractionFunc(n){},endInteractionFunc(n){if(n.lastX!==0&&n.lastY!==0){let t=Math.abs(n.mouseX-n.lastX),e=Math.abs(n.mouseY-n.lastY);if(t/e>50||e/t>50||e===0||t===0)return;n.physics.addRectBody(n.lastX/2+n.mouseX/2,n.lastY/2+n.mouseY/2,2*Math.abs(n.lastX/2-n.mouseX/2),2*Math.abs(n.lastY/2-n.mouseY/2),Pt,Ct)}},keyGotUpFunc(n){},keyGotDownFunc(n){}};[w(ie.name),v("Bounciness",.07,.3,Ct,n=>{Ct=n.target.valueAsNumber},.02),v("Coefficient of friction",0,.6,Pt,n=>{Pt=n.target.valueAsNumber},.1)].forEach(St.appendChild.bind(St));var oe=ie,it=35,It=.2,kt=.5,ot=4,at=24,Et=document.createElement("div");function ae(n=24,t=4){return[...new Array(n).keys()].map(e=>i.fromAnglePNorm(Math.PI*2*e/n,t))}var re={name:"Squircle creator",description:"",element:Et,drawFunc(n,t){let e=n.cnv.getContext("2d");e.strokeStyle="black";let s=ae(at,ot);s.forEach(o=>o.mult(it)),e.beginPath(),e.moveTo(n.mouseX+s[0].x,n.mouseY+s[0].y);for(let o=1;o<s.length;o+=1)e.lineTo(n.mouseX+s[o].x,n.mouseY+s[o].y);e.closePath(),e.stroke(),n.mouseDown&&(e.beginPath(),e.moveTo(n.mouseX,n.mouseY),e.lineTo(n.lastX,n.lastY),e.stroke())},startInteractionFunc(n){},endInteractionFunc(n){let t=ae(at,ot),e=new i(n.mouseX,n.mouseY);if(t.forEach(s=>{s.mult(it),s.add(e)}),n.lastX!==0&&n.lastY!==0){let s=new L(t,new i(n.lastX-n.mouseX,n.lastY-n.mouseY),It,0,kt);n.physics.addBody(s)}}};[w(re.name),v("Size",5,120,it,n=>{it=n.target.valueAsNumber}),v("Roundness",2,7,9-ot,n=>{ot=9-n.target.valueAsNumber},1),v("Resolution",12,36,at,n=>{at=n.target.valueAsNumber},1),v("Bounciness",.07,.3,It,n=>{It=n.target.valueAsNumber},.02),v("Coefficient of friction",0,.6,kt,n=>{kt=n.target.valueAsNumber},.1)].forEach(Et.appendChild.bind(Et));var ce=re,T=35,ke=.5,rt=1.5,Ot=24,Ft=1,Tt=document.createElement("div"),he={name:"Soft square creator",description:"",element:Tt,drawFunc(n,t){let e=n.cnv.getContext("2d");e.strokeStyle="black",e.beginPath(),e.moveTo(n.mouseX-T,n.mouseY-T),e.lineTo(n.mouseX+T,n.mouseY-T),e.lineTo(n.mouseX+T,n.mouseY+T),e.lineTo(n.mouseX-T,n.mouseY+T),e.lineTo(n.mouseX-T,n.mouseY-T),e.stroke(),n.lastX!==0&&n.lastY!==0&&(e.beginPath(),e.moveTo(n.mouseX,n.mouseY),e.lineTo(n.lastX,n.lastY),e.stroke())},startInteractionFunc(n){},endInteractionFunc(n){if(n.lastX!==0&&n.lastY!==0){let t=new O(new i(n.lastX,n.lastY),new i(n.lastX-n.mouseX,n.lastY-n.mouseY),T,ke,0,rt);Number.isFinite(t.pos.x)&&Number.isFinite(t.pos.y)&&Number.isFinite(t.vel.x)&&Number.isFinite(t.vel.y)&&n.physics.addSoftSquare(t.pos,T*2,rt,t.vel,Ot,Ft)}},keyGotUpFunc(n){},keyGotDownFunc(n){}};[w(he.name),v("Size",5,100,T,n=>{T=n.target.valueAsNumber}),v("Pressure",.4,7,Ft,n=>{Ft=n.target.valueAsNumber},.1),v("Coefficient of friction",0,2,rt,n=>{rt=n.target.valueAsNumber},.1),v("Resolution",16,48,Ot,n=>{Ot=n.target.valueAsNumber},8)].forEach(Tt.appendChild.bind(Tt));var le=he,Xt=!1,_=1e4,Yt=document.createElement("div"),ue={name:"Spring creator",description:"",element:Yt,drawFunc(n,t){let e=n.cnv.getContext("2d");n.lastX!==0&&n.lastY!==0&&(e.strokeStyle="black",e.beginPath(),e.moveTo(n.mouseX,n.mouseY),e.lineTo(n.lastX,n.lastY),e.stroke())},startInteractionFunc(n){},endInteractionFunc(n){if(n.lastX!==0&&n.lastY!==0){let t=n.physics.getObjectAtCoordinates(n.mouseX,n.mouseY),e,s=E;if(t||(t={x:n.mouseX,y:n.mouseY,pinPoint:!0}),n.choosed===t||n.choosed===void 0&&t===void 0)return;if(n.choosed instanceof Object&&t instanceof Object&&"pinPoint"in n.choosed&&"pinPoint"in t)return;if(n.choosed instanceof Object&&t instanceof Object&&"pinPoint"in n.choosed&&"pos"in t?(e=new s(Math.sqrt((n.choosed.x-t.pos.x)**2+(n.choosed.y-t.pos.y)**2),_),e.attachObject(t),e.pinHere(n.choosed.x,n.choosed.y)):t instanceof Object&&n.choosed instanceof Object&&"pos"in n.choosed&&"pinPoint"in t?(e=new s(Math.sqrt((n.choosed.pos.x-t.x)**2+(n.choosed.pos.y-t.y)**2),_),e.attachObject(n.choosed),e.pinHere(t.x,t.y)):n.choosed instanceof Object&&t instanceof Object&&"pos"in n.choosed&&"pos"in t&&(e=new s(Math.sqrt((n.choosed.pos.x-t.pos.x)**2+(n.choosed.pos.y-t.pos.y)**2),_),e.attachObject(n.choosed),e.attachObject(t)),typeof e=="undefined")return;n.physics.addSpring(e),Xt&&e.lockRotation()}},keyGotUpFunc(n){},keyGotDownFunc(n){}};[w(ue.name),z("Rotation locked",Xt,n=>{Xt=n.target.checked}),v("Spring stiffness",2e3,1e5,_,n=>{_=n.target.valueAsNumber},50)].forEach(Yt.appendChild.bind(Yt));var de=ue,Bt=!1,jt=document.createElement("div"),me={name:"Stick creator",description:"",element:jt,drawFunc(n,t){let e=n.cnv.getContext("2d");n.lastX!==0&&n.lastY!==0&&(e.strokeStyle="black",e.beginPath(),e.moveTo(n.mouseX,n.mouseY),e.lineTo(n.lastX,n.lastY),e.stroke())},startInteractionFunc(n){},endInteractionFunc(n){if(n.lastX!==0&&n.lastY!==0){let t=n.physics.getObjectAtCoordinates(n.mouseX,n.mouseY),e,s=F;if(t||(t={x:n.mouseX,y:n.mouseY,pinPoint:!0}),n.choosed===t||n.choosed===void 0&&t===void 0)return;if("pinPoint"in n.choosed&&"pinPoint"in t)return;if("pinPoint"in n.choosed&&"pos"in t?(e=new s(Math.sqrt((n.choosed.x-t.pos.x)**2+(n.choosed.y-t.pos.y)**2)),e.attachObject(t),e.pinHere(n.choosed.x,n.choosed.y)):"pinPoint"in t&&"pos"in n.choosed?(e=new s(Math.sqrt((n.choosed.pos.x-t.x)**2+(n.choosed.pos.y-t.y)**2)),e.attachObject(n.choosed),e.pinHere(t.x,t.y)):"pos"in n.choosed&&"pos"in t&&(e=new s(Math.sqrt((n.choosed.pos.x-t.pos.x)**2+(n.choosed.pos.y-t.pos.y)**2)),e.attachObject(n.choosed),e.attachObject(t)),typeof e=="undefined")return;n.physics.addSpring(e),Bt&&e.lockRotation()}},keyGotUpFunc(n){},keyGotDownFunc(n){}};[w(me.name),z("Rotation locked",Bt,n=>{Bt=n.target.checked})].forEach(jt.appendChild.bind(jt));var fe=me,ct=20,Lt=document.createElement("div"),ge={name:"Wall drawer",description:"",element:Lt,drawFunc(n,t){let e=n.cnv.getContext("2d");e.strokeStyle="black",e.beginPath(),e.arc(n.mouseX,n.mouseY,ct,0,2*Math.PI),e.stroke(),n.lastX!==0&&n.lastY!==0&&n.physics.addFixedBall(n.mouseX,n.mouseY,ct)},startInteractionFunc(n){},endInteractionFunc(n){},keyGotUpFunc(n){},keyGotDownFunc(n){}};[w(ge.name),v("Size",5,70,ct,n=>{ct=n.target.valueAsNumber})].forEach(Lt.appendChild.bind(Lt));var pe=ge,Nt=document.createElement("div"),ye={name:"World settings",description:"",element:Nt,init(n){let t=n;[w(ye.name),v("Gravity",0,5e3,t.physics.gravity.y,e=>{t.physics.gravity.y=e.target.valueAsNumber},100),v("Gravity in the X direction",-5e3,5e3,t.physics.gravity.x,e=>{t.physics.gravity.x=e.target.valueAsNumber},1e3),v("Air friction",0,.99,1-t.physics.airFriction,e=>{let s=e.target.valueAsNumber;t.physics.setAirFriction(1-s)},.01),z("Show collision data",t.drawCollisions,e=>{t.drawCollisions=e.target.checked})].forEach(Nt.appendChild.bind(Nt))}},be=ye,xe=[Vt,ne,pe,fe,de,ee,Zt,le,Kt,oe,be,ce];var H=xe,ht=H.map(n=>n.name),B={white:"#faf3dd",green:"#02c39a",pink:"#e58c8a",blue:"#77b6ea",black:"#363732"},ve=class{constructor(){this.resizeCanvas=()=>{let t=this.canvasHolder.getBoundingClientRect();this.cnv.width=t.width,this.cnv.height=window.innerHeight-t.top;let e=window.devicePixelRatio||1,s=t;this.cnv.width=s.width*e,this.cnv.height=s.height*e,this.cnv.style.width=`${s.width}px`,this.cnv.style.height=`${s.height}px`,this.scaling=1/e,this.physics.setBounds(0,0,this.cnv.width,this.cnv.height);let o=this.cnv.getContext("2d");o&&(o.scale(e,e),o.lineWidth=e),this.defaultSize=(this.cnv.width+this.cnv.height)/80};this.drawFunction=()=>{var s,o;Number.isFinite(this.lastFrameTime)||(this.lastFrameTime=performance.now());let t=performance.now()-this.lastFrameTime;Number.isFinite(t)||(t=0),t/=1e3;let e=this.cnv.getContext("2d");e.fillStyle=B.black,e.fillRect(0,0,this.cnv.width,this.cnv.height),e.save(),e.translate(this.viewOffsetX,this.viewOffsetY),e.scale(this.scaling,this.scaling),(o=(s=H[this.mode]).drawFunc)==null||o.call(s,this,t*this.timeMultiplier),this.physicsDraw(),e.restore(),this.physics.balls[0]&&(this.left&&(this.physics.balls[0].ang-=Math.PI*100*t),this.right&&(this.physics.balls[0].ang+=Math.PI*100*t)),t*=this.timeMultiplier,this.physics.update(t/5,!1),this.physics.update(t/5,!1),this.physics.update(t/5,!1),this.physics.update(t/5,!1),this.physics.update(t/5,!1),this.lastFrameTime=performance.now(),requestAnimationFrame(this.drawFunction)};this.startInteraction=(t,e)=>{var s,o;this.mouseX=t/this.scaling-this.viewOffsetX/this.scaling,this.mouseY=e/this.scaling-this.viewOffsetY/this.scaling,this.choosed=this.physics.getObjectAtCoordinates(this.mouseX,this.mouseY),this.choosed||(this.choosed={x:this.mouseX,y:this.mouseY,pinPoint:!0}),this.lastX=this.mouseX,this.lastY=this.mouseY,(o=(s=H[this.mode]).startInteractionFunc)==null||o.call(s,this)};this.endInteraction=(t,e)=>{var s,o;if(this.mouseX=t/this.scaling-this.viewOffsetX/this.scaling,this.mouseY=e/this.scaling-this.viewOffsetY/this.scaling,(o=(s=H[this.mode]).endInteractionFunc)==null||o.call(s,this),this.lastX===0&&this.lastY===0)return;this.lastX=0,this.lastY=0,this.choosed=!1};this.keyGotDown=t=>{let e=t.key;e==="s"&&this.spawnNewtonsCradle(this.cnv.width/2,this.cnv.height/2,.5,this.physics),e==="a"&&(this.scaling+=.01),e==="d"&&(this.scaling-=.01),e==="j"&&(this.viewOffsetX-=10),e==="l"&&(this.viewOffsetX+=10),e==="k"&&(this.viewOffsetY-=10),e==="i"&&(this.viewOffsetY+=10),e==="ArrowRight"&&(this.right=!0),e==="ArrowLeft"&&(this.left=!0)};this.keyGotUp=t=>{let e=t.key;e==="ArrowRight"&&(this.right=!1),e==="ArrowLeft"&&(this.left=!1)};this.startTouch=t=>{t.preventDefault();let e=this.canvasHolder.getBoundingClientRect();return this.startInteraction(t.changedTouches[0].clientX-e.left,t.changedTouches[0].clientY-e.top),!1};this.endTouch=t=>{t.preventDefault();let e=this.canvasHolder.getBoundingClientRect();return this.endInteraction(t.changedTouches[0].clientX-e.left,t.changedTouches[0].clientY-e.top),!1};this.moveTouch=t=>{t.preventDefault();let e=this.canvasHolder.getBoundingClientRect();return this.mouseX=t.changedTouches[0].clientX-e.left,this.mouseY=t.changedTouches[0].clientY-e.top,this.mouseX=this.mouseX/this.scaling-this.viewOffsetX/this.scaling,this.mouseY=this.mouseY/this.scaling-this.viewOffsetY/this.scaling,!1};this.startMouse=t=>(this.startInteraction(t.offsetX,t.offsetY),!1);this.endMouse=t=>(this.endInteraction(t.offsetX,t.offsetY),!1);this.handleMouseMovement=t=>{this.mouseX=t.offsetX,this.mouseY=t.offsetY,this.mouseX=this.mouseX/this.scaling-this.viewOffsetX/this.scaling,this.mouseY=this.mouseY/this.scaling-this.viewOffsetY/this.scaling};this.physicsDraw=()=>{let t=this.cnv.getContext("2d");if(t){t.fillStyle=B.green,t.strokeStyle="black";for(let s=0;s<this.physics.balls.length;s+=1){let o=this.physics.balls[s];t.beginPath(),t.arc(o.pos.x,o.pos.y,o.r,0,2*Math.PI),t.stroke(),t.fill(),t.beginPath(),t.moveTo(o.pos.x,o.pos.y),t.lineTo(o.pos.x+o.r*Math.cos(o.rotation),o.pos.y+o.r*Math.sin(o.rotation)),t.stroke()}this.physics.bodies.forEach(s=>{t.beginPath(),t.moveTo(s.points[s.points.length-1].x,s.points[s.points.length-1].y),s.points.forEach(o=>{t.lineTo(o.x,o.y)}),t.stroke(),t.fill(),t.beginPath(),t.arc(s.pos.x,s.pos.y,1.5,0,Math.PI*2),t.stroke()});let e=s=>{t.beginPath(),t.moveTo(s.points[s.points.length-1].x,s.points[s.points.length-1].y),s.points.forEach(o=>{t.lineTo(o.x,o.y)}),t.fill()};t.fillStyle="white",this.physics.walls.forEach(e),this.physics.bounds.forEach(e),this.physics.fixedBalls.forEach(s=>{t.beginPath(),t.arc(s.x,s.y,s.r,0,Math.PI*2),t.fill()}),t.save(),t.lineWidth=2,this.physics.springs.forEach(s=>{if(s instanceof E&&!(s instanceof F)){let o,a,r,h;s.pinned&&typeof s.pinned=="object"?(o=s.pinned.x,a=s.pinned.y,r=s.objects[0].pos.x,h=s.objects[0].pos.y):(o=s.objects[0].pos.x,a=s.objects[0].pos.y,r=s.objects[1].pos.x,h=s.objects[1].pos.y);let u=new i(r-o,h-a),l=u.copy;u.rotate(Math.PI/2),u.setMag(5);let c=new i(o,a),m=Math.floor(s.length/10);for(let d=1;d<=m;d+=1)t.strokeStyle=B.blue,t.fillStyle=B.blue,d===m&&(u=new i(0,0)),t.beginPath(),t.moveTo(c.x,c.y),t.lineTo(o+d/m*l.x+u.x,a+d/m*l.y+u.y),t.stroke(),c=new i(o+d/m*l.x+u.x,a+d/m*l.y+u.y),u.mult(-1)}else t.strokeStyle=B.blue,t.fillStyle=B.blue,t.beginPath(),t.moveTo(s.objects[0].pos.x,s.objects[0].pos.y),t.lineTo(typeof s.pinned=="object"?s.pinned.x:s.objects[1].pos.x,typeof s.pinned=="object"?s.pinned.y:s.objects[1].pos.y),t.stroke();s.objects.forEach(o=>{t.strokeStyle="black",t.fillStyle=B.blue,t.beginPath(),t.arc(o.pos.x,o.pos.y,2.5,0,Math.PI*2),t.fill(),t.stroke()}),typeof s.pinned=="object"&&(t.strokeStyle="black",t.fillStyle=B.blue,t.beginPath(),t.arc(s.pinned.x,s.pinned.y,3,0,Math.PI*2),t.fill(),t.stroke())}),t.restore(),t.fillStyle=B.pink,t.strokeStyle=B.pink,t.lineWidth=4,this.drawCollisions&&this.physics.collisionData.forEach(s=>{t.beginPath(),t.moveTo(s.cp.x,s.cp.y),t.lineTo(s.cp.x+s.n.x*30,s.cp.y+s.n.y*30),t.stroke(),t.beginPath(),t.arc(s.cp.x,s.cp.y,4,0,Math.PI*2),t.fill()})}};this.spawnNewtonsCradle=(t,e,s,o)=>{let a=[],r=25,h=250,u=8;a.push(new O(new i(t,e),new i(0,0),s*r,1,0,0));let l=1;for(let c=0;c<u-1;c+=1)a.push(new O(new i(t+l*s*r*1.01*2,e),new i(0,0),s*25,1,0,0)),l*=-1,l>0&&(l+=1),c===u-2&&(a[a.length-1].vel.x=-Math.sign(l)*s*r*8);a.forEach(c=>{o.addBall(c);let m=new F(h);m.attachObject(c),m.pinHere(c.pos.x,c.pos.y-h),o.addSpring(m),m.lockRotation()})};this.modeButtonClicked=t=>{let e=t.target.id.replace("-btn",""),s=ht.indexOf(e);this.switchToMode(s)};this.switchToMode=t=>{let e=document.getElementById(`${ht[this.mode]}-btn`);e&&e.classList.remove("bg-pink-darker"),this.sidebar.innerHTML="";let s=document.getElementById(`${ht[t]}-btn`);s&&s.classList.add("bg-pink-darker"),this.mode=t,this.sidebar.appendChild(H[this.mode].element)};this.setupModes=()=>{let t=document.getElementById("button-holder");ht.forEach((e,s)=>{var a,r;let o=document.createElement("div");o.classList.add("big-button"),o.classList.add("fix-width"),o.id=`${e}-btn`,o.textContent=H[s].name,(r=(a=H[s]).init)==null||r.call(a,this),o.onclick=this.modeButtonClicked,t&&t.appendChild(o)}),this.switchToMode(this.mode)};this.setTimeMultiplier=t=>{Number.isFinite(t)&&(this.timeMultiplier=t)};this.getTimeMultiplier=()=>this.timeMultiplier;this.setPhysics=t=>{t instanceof Q&&(this.physics=t)};this.getPhysics=()=>this.physics;this.physics=new Q,this.mouseX=0,this.mouseY=0,this.mouseDown=!1,this.defaultSize=30,this.k=.5,this.fc=2,this.springConstant=2e3,this.scaling=1,this.viewOffsetX=0,this.viewOffsetY=0,this.mode=0,this.lastX=0,this.lastY=0,this.timeMultiplier=1,this.lastFrameTime=performance.now(),this.choosed=!1,this.drawCollisions=!1,this.left=!1,this.right=!1,this.cnv=document.getElementById("defaulCanvas0"),this.canvasHolder=document.getElementById("canvas-holder"),this.sidebar=document.getElementById("sidebar"),this.physics.setBounds(0,0,this.cnv.width,this.cnv.height),this.physics.setGravity(new i(0,1e3)),this.physics.setAirFriction(.9),this.cnv.addEventListener("touchstart",this.startTouch,!1),this.cnv.addEventListener("touchend",this.endTouch,!1),this.cnv.addEventListener("touchmove",this.moveTouch,!1),this.cnv.addEventListener("mousedown",this.startMouse,!1),this.cnv.addEventListener("mouseup",this.endMouse,!1),this.cnv.addEventListener("mousemove",this.handleMouseMovement,!1),document.addEventListener("keydown",this.keyGotDown,!1),document.addEventListener("keyup",this.keyGotUp,!1),window.addEventListener("resize",this.resizeCanvas,!1),this.cnv.addEventListener("mousedown",()=>{this.mouseDown=!0},!1),this.cnv.addEventListener("mouseup",()=>{this.mouseDown=!1},!1),this.resizeCanvas(),this.setupModes(),mt(this),requestAnimationFrame(this.drawFunction)}},Me=ve;window.onload=()=>{window.editorApp=new Me};})();
//# sourceMappingURL=main.js.map

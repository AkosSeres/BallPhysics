(()=>{var T=(d,t)=>()=>(t||(t={exports:{}},d(t.exports,t)),t.exports),_=T((Qi,Kt)=>{var D=class{constructor(t,e){this.x=t,this.y=e}get copy(){return new D(this.x,this.y)}get length(){return Math.sqrt(this.x*this.x+this.y*this.y)}get sqlength(){return this.x*this.x+this.y*this.y}get heading(){if(this.x===0&&this.y===0)return 0;if(this.x===0)return this.y>0?Math.PI/2:1.5*Math.PI;if(this.y===0)return this.x>0?0:Math.PI;let t=D.normalized(this);return this.x>0&&this.y>0?Math.asin(t.y):this.x<0&&this.y>0?Math.asin(-t.x)+Math.PI/2:this.x<0&&this.y<0?Math.asin(-t.y)+Math.PI:this.x>0&&this.y<0?Math.asin(t.x)+1.5*Math.PI:0}add(t){this.x+=t.x,this.y+=t.y}sub(t){this.x-=t.x,this.y-=t.y}mult(t){this.x*=t,this.y*=t}div(t){this.x/=t,this.y/=t}lerp(t,e){this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e}dist(t){return new D(this.x-t.x,this.y-t.y).length}setMag(t){if(this.length===0)return;this.mult(t/this.length)}rotate(t){let e=this.heading,s=D.fromAngle(t+e);s.mult(this.length),this.x=s.x,this.y=s.y}static add(t,e){return new D(t.x+e.x,t.y+e.y)}static sub(t,e){return new D(t.x-e.x,t.y-e.y)}static mult(t,e){return new D(t.x*e,t.y*e)}static div(t,e){return new D(t.x/e,t.y/e)}static fromAngle(t){return new D(Math.cos(t),Math.sin(t))}static lerp(t,e,s){return D.add(t,D.mult(D.sub(e,t),s))}static dist(t,e){return D.sub(t,e).length}static dot(t,e){return t.x*e.x+t.y*e.y}static cross(t,e){return t.x*e.y-t.y*e.x}static crossScalarFirst(t,e){return new D(-e.y*t,e.x*t)}static crossScalarSecond(t,e){return new D(t.y*e,-t.x*e)}static angle(t,e){return Math.acos(Math.min(Math.max(D.dot(t,e)/Math.sqrt(t.sqlength*e.sqlength),1),-1))}static angleACW(t,e){let s=t.heading,i=e.heading,n=i-s;return n<0?2*Math.PI+n:n}static normalized(t){let e=t.length;return e===0?t:new D(t.x/e,t.y/e)}toJSObject(){let t={};return t.x=this.x,t.y=this.y,t}static fromObject(t){return new D(t.x,t.y)}};Kt.exports=D}),Ot=T((Zi,Qt)=>{var I=_(),yt=class{constructor(t,e,s,i,n,o){this.pos=t.copy,this.lastPos=this.pos.copy,this.r=s,this.fc=.4,this.amc=2/5,this.rotation=0,n?this.ang=n:this.ang=0,(o||o===0)&&(this.fc=o),i?this.k=i:this.k=.8,e!=null?this.vel=e.copy:this.vel=new I(0,0),this.id="_"+Math.random().toString(36).substr(2,9)}get m(){return this.r*this.r*Math.PI}get am(){return this.amc*this.r*this.r*this.m}getAmInPoint(t){let e=this.am;return e+=I.sub(this.pos,t).sqlength*this.m,e}get copy(){let t=new yt(this.pos.copy,this.vel.copy,this.r,this.k,this.ang,this.fc);return t.lastPos=this.lastPos.copy,t.rotation=this.rotation,t}move(t,e){this.pos.x+=t,this.pos.y+=e}rotate(t){this.rotation+=t}collided(t){return this.pos.dist(t.pos)<this.r+t.r}static collide(t,e){if(!t.collided(e))return;let s=I.dist(t.pos,e.pos),i=t.m,n=e.m,o=t.pos.copy,r=e.pos.copy,a=t.r+e.r-s,l=I.sub(t.pos,e.pos);if(l.setMag(1),l.mult(a*n/(i+n)),o.add(l),l.setMag(1),l.mult(-a*i/(i+n)),r.add(l),t.pos=o,e.pos=r,I.dot(l,I.sub(t.vel,e.vel))<0)return;l.setMag(1);let h=I.add(t.pos,I.mult(l,t.r)),u=t.vel.copy,g=e.vel.copy,f=t.ang,p=e.ang,y=I.sub(h,t.pos),m=I.sub(h,e.pos),b=t.am,M=e.am,x=(t.k+e.k)/2,P=(t.fc+e.fc)/2,j=l.copy,w=t.velInPlace(h),S=e.velInPlace(h),A=I.sub(S,w),R=1/i+1/n;R=-(1+x)*I.dot(A,j)/R;let q=I.sub(u,I.mult(j,R/i)),H=I.add(g,I.mult(j,R/n)),N=f-R*I.cross(y,j)/b,V=p,J=A.copy;J.sub(I.mult(j,I.dot(A,j))),J.setMag(1);let Q=1/i+1/n;Q+=I.dot(I.crossScalarFirst(I.cross(y,J)/b,y),J),Q+=I.dot(I.crossScalarFirst(I.cross(m,J)/M,m),J),Q=-.5*I.dot(A,J)/Q;let Z=R*P;Z>Q&&(Z=Q),q=I.sub(q,I.mult(J,Z/i)),H=I.add(H,I.mult(J,Z/n)),N=N-Z*I.cross(y,J)/b,V=V+Z*I.cross(m,J)/M,t.vel=q,e.vel=H,t.ang=N,e.ang=V}containsPoint(t){return I.dist(this.pos,t)<=this.r}velInPlace(t){let e=I.sub(t,this.pos);return e.rotate(Math.PI/2),e.mult(this.ang),e.add(this.vel),e}effectiveMass(t,e){let s=I.sub(t,this.pos);if(s.length===0)return this.m;let i=I.angle(e,s),n=Math.sin(i)**2*s.length**2/this.am;return isNaN(i)&&console.log(e,s,i),1/(n+1/this.m)}applyDeltaVelInPoint(t,e){let s=I.sub(e,this.pos);if(s.length===0){this.vel.add(t);return}let i=I.angle(s,t),n=I.mult(s,I.dot(t,s)/s.length**2);this.vel.add(n);let o=s.copy;o.rotate(Math.PI/2),o.setMag(1);let r=Math.sign(I.dot(t,o)),a=t.length*Math.cos(i),l=1/(1/this.m+s.length**2/this.am),h=a*l/this.m;this.vel.add(I.mult(o,h*r));let u=r*a*l*s.length/this.am;this.ang-=u}toJSObject(){let t={};return t.pos=this.pos.toJSObject(),t.lastPos=this.lastPos.toJSObject(),t.r=this.r,t.fc=this.fc,t.amc=this.amc,t.rotation=this.rotation,t.ang=this.ang,t.fc=this.fc,t.k=this.k,t.vel=this.vel.toJSObject(),t.id=this.id,this.layer!=null&&(t.layer=this.layer),t}static fromObject(t){let e=new yt(I.fromObject(t.pos),I.fromObject(t.vel),t.r,t.k,t.ang,t.fc);return e.lastPos=I.fromObject(t.lastPos),e.amc=t.amc,e.rotation=t.rotation,e.vel=I.fromObject(t.vel),e.id=t.id,t.layer!=null&&(e.layer=t.layer),e}};Qt.exports=yt}),ct=T(($i,Zt)=>{var K=_(),$t=class{constructor(t,e){this.a=t,this.b=e}get length(){return K.dist(this.a,this.b)}distFromPoint(t){let e=K.sub(this.a,this.b),s=K.sub(t,this.b),i=K.sub(t,this.a),n=s.length,o=i.length,r=e.length;if(r===0)return n;let a=K.angle(s,i),l=K.angle(s,e),h=Math.PI-a-l,u=Math.sin(h)*o*r/2,g=2*u/r;return h>Math.PI/2?o:l>Math.PI/2?n:g}static intersect(t,e){let s=K.sub(t.b,t.a),i=s.y/s.x,n=t.b.y-t.b.x*i,o=K.sub(e.b,e.a),r=o.y/o.x,a=e.b.y-e.b.x*r;if(s.x===0&&o.x!==0){if(t.a.x>=e.a.x&&t.a.x<=e.b.x||t.a.x<=e.a.x&&t.a.x>=e.b.x){let f=r*t.a.x+a;if(f>t.a.y&&f<t.b.y||f<t.a.y&&f>t.b.y)return new K(t.a.x,f)}return}if(o.x===0&&s.x!==0){if(e.a.x>=t.a.x&&e.a.x<=t.b.x||e.a.x<=t.a.x&&e.a.x>=t.b.x){let f=i*e.a.x+n;if(f>e.a.y&&f<e.b.y||f<e.a.y&&f>e.b.y)return new K(e.a.x,f)}return}if(s.x===0&&o.x===0){if(t.a.x===e.a.x){let f;t.a.y<t.b.y?f=[t.a.y,t.b.y]:f=[t.b.y,t.a.y];let p;e.a.y<e.b.y?p=[e.a.y,e.b.y]:p=[e.b.y,e.a.y];let y=[f[0]>p[0]?f[0]:p[0],f[1]<p[1]?f[1]:p[1]];if(y[0]<=y[1])return new K(t.a.x,(y[0]+y[1])/2)}return}let l;t.a.x<t.b.x?l=[t.a.x,t.b.x]:l=[t.b.x,t.a.x];let h;e.a.x<e.b.x?h=[e.a.x,e.b.x]:h=[e.b.x,e.a.x];let u=[l[0]>h[0]?l[0]:h[0],l[1]<h[1]?l[1]:h[1]];if(i===r&&n===a&&u[0]<=u[1])return new K((u[0]+u[1])/2,(u[0]+u[1])/2*i+n);let g=(a-n)/(i-r);return g>=u[0]&&g<=u[1]?new K(g,g*i+n):void 0}};Zt.exports=$t}),te=T((_i,_t)=>{var W=_(),Nt=ct(),jt=class{constructor(t){this.points=t;let e=this.points,s=0,i=0,n=W.angleACW(W.sub(e[1],e[0]),W.sub(e[e.length-1],e[0]));this.calculateCenterAndRadius(),s+=n,i+=Math.PI*2-n;for(let o=1;o<e.length-1;o++)n=W.angleACW(W.sub(e[(o+1)%e.length],e[o]),W.sub(e[o-1],e[o])),s+=n,i+=Math.PI*2-n;if(n=W.angleACW(W.sub(e[0],e[e.length-1]),W.sub(e[e.length-2],e[e.length-1])),s+=n,i+=Math.PI*2-n,i>s)return;{let o=[];for(let r=e.length-1;r>=0;r--)o.push(e[r]);this.points=o}}collideWithBall(t){let e,s;if(this.points.forEach((i,n)=>{let o=new W(i.x,i.y);o.x-=t.pos.x,o.y-=t.pos.y,o.mult(-1),o.length<=t.r&&(e=o.heading,s=o.length),o=new W(i.x,i.y);let r=new W(this.points[(n+1)%this.points.length].x,this.points[(n+1)%this.points.length].y),a=new W(t.pos.x,t.pos.y),l=new W(r.x-o.x,r.y-o.y),h=l.heading;o.rotate(-h+Math.PI),r.rotate(-h+Math.PI),a.rotate(-h+Math.PI);let u=a.y-(o.y+r.y)/2;u>=-t.r&&u<=t.r&&a.x>=r.x&&a.x<=o.x&&(e=h-Math.PI/2,s=u)}),isFinite(e)){let i=new W(t.pos.x,t.pos.y),n=new W(t.vel.x,t.vel.y);if(i.rotate(-e+Math.PI/2),n.rotate(-e+Math.PI/2),n.y>0)return;n.y*=-t.k,i.y+=t.r-s;let o=n.y*(1+t.k),r=Math.sign(n.x+t.ang*t.r)*(o*t.fc)/(t.amc*t.r),a=(n.x+t.ang*t.r)/t.r;r/a>1&&(r=a),t.ang-=r;let l=r*t.am/t.r/t.m;n.x-=l,i.rotate(e-Math.PI/2),n.rotate(e-Math.PI/2),t.pos.x=i.x,t.pos.y=i.y,t.vel.x=n.x,t.vel.y=n.y}}containsPoint(t){let e=this.sides,s=Math.max(...this.points.map(r=>W.dist(r,t)))+1,i=W.fromAngle(0);i.setMag(s);let n=new Nt(t,W.add(i,t)),o=e.filter(r=>Nt.intersect(r,n)!=null);return o.length%2==1}calculateCenterAndRadius(){this.center=this.points.reduce((t,e)=>W.add(t,e)),this.center.div(this.points.length),this.boundRadius=Math.max(this.points.map(t=>W.dist(t,this.center)))}get sides(){return this.points.map((t,e)=>new Nt(t,this.points[(e+1)%this.points.length]))}toJSObject(){let t={};return t.points=this.points.map(e=>({x:e.x,y:e.y})),t}static fromObject(t){let e=new jt(t.points.map(s=>new W(v.x,v.y)));return e}};_t.exports=jt}),Vt=T((ts,ee)=>{var et=_(),wt=class{constructor(t,e){this.length=t,this.springConstant=e,this.pinned=!1,this.objects=[],this.rotationLocked=!1,this.id="_"+Math.random().toString(36).substr(2,9)}pinHere(t,e){this.pinned={x:t,y:e}}unpin(){this.pinned=!1}attachObject(t){let e=this.objects;e.push(t),e.length===2&&(this.pinned=!1),e.length>=3&&(e=[e[e.length-2],e[e.length-1]])}lockRotation(){this.rotationLocked=!0}unlockRotation(){this.rotationLocked=!1}update(t){let e,s;if(this.pinned&&this.objects[0]){s=this.pinned,e=this.objects[0];let i=new et(s.x-e.pos.x,s.y-e.pos.y),n=i.length-this.length;i.setMag(1),i.mult(n*this.springConstant*t/e.m),e.vel.x+=i.x,e.vel.y+=i.y;let o=e.vel;if(o.rotate(-i.heading),this.rotationLocked){let r=new et(s.x,s.y),a=et.sub(e.pos,r),l=a.length*a.length*e.m+e.am,h=(e.am*e.ang-a.length*e.m*o.y)/l;o.y=-h*a.length,e.ang=h}o.rotate(i.heading)}else if(this.objects[0]&&this.objects[1]){e=this.objects[0],s=this.objects[1];let i=et.sub(e.pos,s.pos),n=i.length-this.length;i.setMag(1),i.mult(n*this.springConstant*t),s.vel.add(et.div(i,s.m)),e.vel.add(et.div(i,-e.m)),i=et.sub(e.pos,s.pos);let o=e.vel,r=s.vel;if(o.rotate(-i.heading),r.rotate(-i.heading),this.rotationLocked){let a=new et(e.pos.x*e.m+s.pos.x*s.m,e.pos.y*e.m+s.pos.y*s.m);a.div(e.m+s.m);let l=et.sub(e.pos,a),h=et.sub(s.pos,a),u=l.length*l.length*e.m+e.am+h.length*h.length*s.m+s.am,g=(o.y-r.y)*h.length/(l.length+h.length)+r.y,f=(e.am*e.ang+s.am*s.ang-l.length*e.m*(o.y-g)+h.length*s.m*(r.y-g))/u;o.y=-f*l.length+g,r.y=+f*h.length+g,e.ang=f,s.ang=f}o.rotate(i.heading),r.rotate(i.heading)}}toJSObject(){let t={};return t.length=this.length,t.springConstant=this.springConstant,t.pinned=this.pinned,t.rotationLocked=this.rotationLocked,t.id=this.id,t.objects=this.objects.map(e=>e.id),t.type=this.__proto__==wt.prototype?"spring":"stick",t}static fromObject(t,e){let s=new ei,i=s.createStickOrSpring(t.type,t.length,t.springConstant);return i.pinned=t.pinned,i.rotationLocked=t.rotationLocked,i.id=t.id,i.objects=t.objects.map(n=>{let o=e.filter(r=>n==r.id);return o[0]}),i}};function ei(){this.createStickOrSpring=function(d,t,e){let s;if(d=="spring")s=new wt(t,e);else if(d=="stick"){let i=qt();s=new i(t)}return s}}ee.exports=wt}),qt=T((es,ie)=>{var ot=_(),ii=Vt(),se=class extends ii{constructor(t){super(t,0);this.springConstant=0}update(t){let e,s;if(this.pinned&&this.objects[0]){s=this.pinned,e=this.objects[0];let i=new ot(s.x-e.pos.x,s.y-e.pos.y);i.setMag(1),i.mult(-this.length),e.move(-e.pos.x+s.x+i.x,-e.pos.y+s.y+i.y);let n=e.vel;if(n.rotate(-i.heading),n.x=0,this.rotationLocked){let o=new ot(s.x,s.y),r=ot.sub(e.pos,o),a=r.length*r.length*e.m+e.am,l=(e.am*e.ang-r.length*e.m*n.y)/a;n.y=-l*r.length,e.ang=l}n.rotate(i.heading)}else if(this.objects[0]&&this.objects[1]){e=this.objects[0],s=this.objects[1];let i=ot.sub(e.pos,s.pos),n=this.length-i.length;i.setMag(1);let o=ot.mult(i,n*s.m/(e.m+s.m)),r=ot.mult(i,-n*e.m/(e.m+s.m));e.move(o.x,o.y),s.move(r.x,r.y);let a=e.vel,l=s.vel;if(a.rotate(-i.heading),l.rotate(-i.heading),a.x=l.x=(e.m*a.x+s.m*l.x)/(e.m+s.m),this.rotationLocked){let h=new ot(e.pos.x*e.m+s.pos.x*s.m,e.pos.y*e.m+s.pos.y*s.m);h.div(e.m+s.m);let u=ot.sub(e.pos,h),g=ot.sub(s.pos,h),f=u.length*u.length*e.m+e.am+g.length*g.length*s.m+s.am,p=(a.y-l.y)*g.length/(u.length+g.length)+l.y,y=(e.am*e.ang+s.am*s.ang-u.length*e.m*(a.y-p)+g.length*s.m*(l.y-p))/f;a.y=-y*u.length+p,l.y=+y*g.length+p,e.ang=y,s.ang=y}a.rotate(i.heading),l.rotate(i.heading)}}};ie.exports=se}),oe=T((is,ne)=>{var O=_(),si=Ot(),ni=qt(),it=ct(),Ct=class{constructor(t,e,s,i,n){this.points=[],i||i===0?this.fc=i:this.fc=.4,this.pressure=s,n?this.resolution=n:this.resolution=30,e=Math.abs(e),this.r=e;let o=Math.random()*1e6;for(let r=0;r<this.resolution;r++){let a=new O(t.x,t.y);a.add(O.mult(O.fromAngle(r/this.resolution*Math.PI*2),e)),this.points.push(new si(a,new O(0,0),e*Math.sin(Math.PI/this.resolution),0,0,this.fc)),this.points[this.points.length-1].layer=o}this.sides=[];for(let r=0;r<this.resolution;r++){let a=new ni(2*e*Math.sin(Math.PI/this.resolution));a.attachObject(this.points[r]),a.attachObject(this.points[(r+1)%this.resolution]),r%2===0&&a.lockRotation(),this.sides.push(a)}}static updatePressureBasedForces(t,e){let s=[];if(s.push([]),t.points.forEach(o=>{s[0].push(new O(o.pos.x,o.pos.y))}),function(o){let r=O.angleACW(O.sub(o[1],o[0]),O.sub(o[o.length-1],o[0]));if(r>Math.PI)return!0;for(let a=1;a<o.length-1;a++)if(r=O.angleACW(O.sub(o[(a+1)%o.length],o[a]),O.sub(o[a-1],o[a])),r>Math.PI)return!0;return r=O.angleACW(O.sub(o[0],o[o.length-1]),O.sub(o[o.length-2],o[o.length-1])),r>Math.PI}(s[0])){let o=(l,h)=>{for(let u=0;u<l.length;u++)if(l[u]===h)return!0;return!1},r=function(l,h,u){for(let g=0;g<h.length;g++)if(!o(u,g)){let f=new it(new O(h[g].x,h[g].y),new O(h[(g+1)%h.length].x,h[(g+1)%h.length].y));if(it.intersect(l,f))return!0}return!1},a=!0;t:for(;a;){a=!1;for(let l=0;l<s.length;l++){let h=s[l],u=O.sub(h[1],h[0]),g=O.sub(h[h.length-1],h[0]),f=O.angleACW(u,g);if(f>Math.PI){a=!0;let p=0,y=p+2,m=new it(new O(h[p].x,h[p].y),new O(h[y%h.length].x,h[y%h.length].y)),b=new O(m.b.x-m.a.x,m.b.y-m.a.y).heading;for(;!(u.heading>g.heading?b>u.heading&&b<2*Math.PI||b>0&&b<g.heading:b>u.heading&&b<g.heading)||r(new it(new O(h[p%h.length].x,h[p%h.length].y),new O(h[y%h.length].x,h[y%h.length].y)),h,[(h.length-1)%h.length,p%h.length,(y-1)%h.length,y%h.length]);)y++,m=new it(new O(h[p].x,h[p].y),new O(h[y%h.length].x,h[y%h.length].y)),b=new O(m.b.x-m.a.x,m.b.y-m.a.y).heading;let M=[],x=[];for(let P=p;P<=y;P++)M.push(h[P%h.length]);for(let P=y;P<=p+h.length;P++)x.push(h[P%h.length]);s[l]=M,s.push(x);continue t}for(let p=1;p<h.length;p++){let y=O.sub(h[(p+1)%h.length],h[p]),m=O.sub(h[p-1],h[p]),b=O.angleACW(y,m);if(b>Math.PI){a=!0;let M=p+2,x=new it(new O(h[p].x,h[p].y),new O(h[M%h.length].x,h[M%h.length].y)),P=new O(x.b.x-x.a.x,x.b.y-x.a.y).heading;for(;!(y.heading>m.heading?P>y.heading&&P<2*Math.PI||P>0&&P<m.heading:P>y.heading&&P<m.heading)||r(x,h,[(p-1)%h.length,p%h.length,(M-1)%h.length,M%h.length]);)M++,x=new it(new O(h[p].x,h[p].y),new O(h[M%h.length].x,h[M%h.length].y)),P=new O(x.b.x-x.a.x,x.b.y-x.a.y).heading;let j=[],w=[];for(let S=p;S<=M;S++)j.push(h[S%h.length]);for(let S=M;S<=p+h.length;S++)w.push(h[S%h.length]);s[l]=j,s.push(w);continue t}}}}}for(let o=s.length-1;o>=0;o--){let r=s[o];for(;r.length>3;)s.push([r[0],r[1],r[2]]),r.splice(1,1)}let i=0;s.forEach(o=>{let r=Math.sqrt(Math.pow(o[0].x-o[1].x,2)+Math.pow(o[0].y-o[1].y,2)),a=Math.sqrt(Math.pow(o[1].x-o[2].x,2)+Math.pow(o[1].y-o[2].y,2)),l=Math.sqrt(Math.pow(o[2].x-o[0].x,2)+Math.pow(o[2].y-o[0].y,2)),h=(r+a+l)/2,u=Math.sqrt(h*(h-r)*(h-a)*(h-l));i+=u});let n=t.pressure*(t.r*t.r*Math.PI/i)-t.pressure;t.sides.forEach(o=>{let r=O.sub(o.objects[0].pos,o.objects[1].pos);r.mult(n),r.rotate(Math.PI/2),r.mult(e),o.objects[0].vel.add(O.div(r,o.objects[0].m)),o.objects[1].vel.add(O.div(r,o.objects[1].m))})}get sideSegments(){return this.points.map((t,e)=>new it(t.pos,this.points[(e+1)%this.points.length].pos))}containsPoint(t){let e=this.sideSegments,s=Math.max(...this.points.map(r=>O.dist(r.pos,t)))+1,i=O.fromAngle(0);i.setMag(s);let n=new it(t,O.add(i,t)),o=e.filter(r=>it.intersect(r,n)!=null);return o.length%2==1}toJSObject(){let t={};return t.pressure=this.pressure,t.fc=this.fc,t.r=this.r,t.resolution=this.resolution,t.points=this.points.map(e=>e.id),t.sides=this.sides.map(e=>e.id),t}static fromObject(t,e,s){let i=Object.create(Ct.prototype);return console.log(i),i.pressure=t.pressure,i.fc=t.fc,i.resolution=t.resolution,i.r=t.r,i.points=t.points.map(n=>{let o=e.filter(r=>n==r.id);return o[0]}),i.sides=t.sides.map(n=>{let o=s.filter(r=>n==r.id);return o[0]}),i}};ne.exports=Ct}),re=T((ns,le)=>{var c=_(),L=ct(),ss=Ot(),mt=class{constructor(t,e,s,i,n){this.points=t;let o=this.points,r=0,a=0,l=c.angleACW(c.sub(o[1],o[0]),c.sub(o[o.length-1],o[0]));r+=l,a+=Math.PI*2-l;for(let h=1;h<o.length-1;h++)l=c.angleACW(c.sub(o[(h+1)%o.length],o[h]),c.sub(o[h-1],o[h])),r+=l,a+=Math.PI*2-l;if(l=c.angleACW(c.sub(o[0],o[o.length-1]),c.sub(o[o.length-2],o[o.length-1])),r+=l,a+=Math.PI*2-l,a<r){let h=[];for(let u=o.length-1;u>=0;u--)h.push(o[u]);this.points=h}this.calculatePosAndMass(),this.lastPos=this.pos.copy,this.fc=.4,this.rotation=0,i?this.ang=i:this.ang=0,(n||n===0)&&(this.fc=n),s?this.k=s:this.k=.8,e!=null?this.vel=e.copy:this.vel=new c(0,0),this.id="_"+Math.random().toString(36).substr(2,9)}getAmInPoint(t){let e=this.am;return e+=c.sub(this.pos,t).sqlength*this.m,e}get copy(){let t=[];for(let s=0;s<this.points.length;s++)t.push(new c(this.points[s].x,this.points[s].y));let e=new mt(t,this.vel.copy,this.k,this.ang,this.fc);return e.rotation=this.rotation,e.lastPos=this.lastPos.copy,e.pos=this.pos.copy,e}move(t,e){this.pos.x+=t,this.pos.y+=e,this.points.forEach(s=>{s.x+=t,s.y+=e})}collideWithBall(t){let e,s,i;if(c.dist(t.pos,this.pos)>t.r+this.boundRadius)return;if(this.points.forEach((n,o)=>{let r=new c(n.x,n.y);if(r.x-=t.pos.x,r.y-=t.pos.y,r.length<=t.r){e=r.heading+Math.PI,s=r.length;let f=c.fromAngle(e);f.mult(t.r-s),this.move(f.x*-1*t.m/(this.m+t.m),f.y*-1*t.m/(this.m+t.m)),t.move(f.x*1*this.m/(this.m+t.m),f.y*1*this.m/(this.m+t.m)),i=new c(n.x,n.y);let p=c.fromAngle(e);p.mult(-30)}r=new c(n.x,n.y);let a=new c(this.points[(o+1)%this.points.length].x,this.points[(o+1)%this.points.length].y),l=new c(t.pos.x,t.pos.y),h=new c(a.x-r.x,a.y-r.y),u=h.heading;r.rotate(-u+Math.PI),a.rotate(-u+Math.PI),l.rotate(-u+Math.PI);let g=l.y-(r.y+a.y)/2;if(g>=-t.r&&g<=t.r&&l.x>=a.x&&l.x<=r.x){e=u-Math.PI/2,s=g;let f=c.fromAngle(e);f.mult(t.r-s),this.move(f.x*-1*t.m/(this.m+t.m),f.y*-1*t.m/(this.m+t.m)),t.move(f.x*1*this.m/(this.m+t.m),f.y*1*this.m/(this.m+t.m)),i=t.pos.copy,i.add(c.mult(c.fromAngle(e+Math.PI),g));let p=c.fromAngle(e);p.mult(-30)}}),e===0||e){let n=this.vel.copy,o=t.vel.copy,r=this.ang,a=t.ang,l=c.sub(i,this.pos),h=c.sub(i,t.pos),u=this.am,g=t.am,f=this.m,p=t.m,y=(this.k+t.k)/2,m=(this.fc+t.fc)/2,b=h.copy;b.setMag(-1);let M=this.velInPlace(i),x=t.velInPlace(i),P=c.sub(x,M),j=1/f+1/p;j+=c.dot(c.crossScalarFirst(c.cross(l,b)/u,l),b),j=-(1+y)*c.dot(P,b)/j;let w=c.sub(n,c.mult(b,j/f)),S=c.add(o,c.mult(b,j/p)),A=r-j*c.cross(l,b)/u,R=a,q=P.copy;q.sub(c.mult(b,c.dot(P,b))),q.setMag(1);let H=1/f+1/p;H+=c.dot(c.crossScalarFirst(c.cross(l,q)/u,l),q),H+=c.dot(c.crossScalarFirst(c.cross(h,q)/g,h),q),H=-c.dot(P,q)/H;let N=j*m;N>H&&(N=H),w=c.sub(w,c.mult(q,N/f)),S=c.add(S,c.mult(q,N/p)),A=A-N*c.cross(l,q)/u,R=R+N*c.cross(h,q)/g,this.vel=w,t.vel=S,this.ang=A,t.ang=R}}calculatePosAndMass(){let t=[];if(t.push([]),this.points.forEach(n=>{t[0].push(new c(n.x,n.y))}),this.isConcave){let n=(a,l)=>{for(let h=0;h<a.length;h++)if(a[h]===l)return!0;return!1},o=function(a,l,h){for(let u=0;u<l.length;u++)if(!n(h,u)){let g=new L(new c(l[u].x,l[u].y),new c(l[(u+1)%l.length].x,l[(u+1)%l.length].y));if(L.intersect(a,g))return!0}return!1},r=!0;t:for(;r;){r=!1;for(let a=0;a<t.length;a++){let l=t[a],h=c.sub(l[1],l[0]),u=c.sub(l[l.length-1],l[0]),g=c.angleACW(h,u);if(g>Math.PI){r=!0;let f=0,p=f+2,y=new L(new c(l[f].x,l[f].y),new c(l[p%l.length].x,l[p%l.length].y)),m=new c(y.b.x-y.a.x,y.b.y-y.a.y).heading;for(;!(h.heading>u.heading?m>h.heading&&m<2*Math.PI||m>0&&m<u.heading:m>h.heading&&m<u.heading)||o(new L(new c(l[f%l.length].x,l[f%l.length].y),new c(l[p%l.length].x,l[p%l.length].y)),l,[(l.length-1)%l.length,f%l.length,(p-1)%l.length,p%l.length]);)p++,y=new L(new c(l[f].x,l[f].y),new c(l[p%l.length].x,l[p%l.length].y)),m=new c(y.b.x-y.a.x,y.b.y-y.a.y).heading;let b=[],M=[];for(let x=f;x<=p;x++)b.push(l[x%l.length]);for(let x=p;x<=f+l.length;x++)M.push(l[x%l.length]);t[a]=b,t.push(M);continue t}for(let f=1;f<l.length;f++){let p=c.sub(l[(f+1)%l.length],l[f]),y=c.sub(l[f-1],l[f]),m=c.angleACW(p,y);if(m>Math.PI){r=!0;let b=f+2,M=new L(new c(l[f].x,l[f].y),new c(l[b%l.length].x,l[b%l.length].y)),x=new c(M.b.x-M.a.x,M.b.y-M.a.y).heading;for(;!(p.heading>y.heading?x>p.heading&&x<2*Math.PI||x>0&&x<y.heading:x>p.heading&&x<y.heading)||o(M,l,[(f-1)%l.length,f%l.length,(b-1)%l.length,b%l.length]);)b++,M=new L(new c(l[f].x,l[f].y),new c(l[b%l.length].x,l[b%l.length].y)),x=new c(M.b.x-M.a.x,M.b.y-M.a.y).heading;let P=[],j=[];for(let w=f;w<=b;w++)P.push(l[w%l.length]);for(let w=b;w<=f+l.length;w++)j.push(l[w%l.length]);t[a]=P,t.push(j);continue t}}}}}for(let n=t.length-1;n>=0;n--){let o=t[n];for(;o.length>3;)t.push([o[0],o[1],o[2]]),o.splice(1,1)}let e=0,s=0,i=new c(0,0);t.forEach(n=>{let o=Math.sqrt(Math.pow(n[0].x-n[1].x,2)+Math.pow(n[0].y-n[1].y,2)),r=Math.sqrt(Math.pow(n[1].x-n[2].x,2)+Math.pow(n[1].y-n[2].y,2)),a=Math.sqrt(Math.pow(n[2].x-n[0].x,2)+Math.pow(n[2].y-n[0].y,2)),l=(o+r+a)/2,h=Math.sqrt(l*(l-o)*(l-r)*(l-a));e+=h,i.x+=h*(n[0].x+n[1].x+n[2].x)/3,i.y+=h*(n[0].y+n[1].y+n[2].y)/3}),i.div(e),this.pos=i,this.m=e;for(let n of t){let o=Math.sqrt(Math.pow(n[0].x-n[1].x,2)+Math.pow(n[0].y-n[1].y,2)),r=Math.sqrt(Math.pow(n[1].x-n[2].x,2)+Math.pow(n[1].y-n[2].y,2)),a=Math.sqrt(Math.pow(n[2].x-n[0].x,2)+Math.pow(n[2].y-n[0].y,2)),l=Math.max(o,r,a),h=(o+r+a)/2,u=Math.sqrt(h*(h-o)*(h-r)*(h-a)),g=2*u/l,f=Math.sqrt(Math.min(o,a,r)**2-g*g),p=g*l*(g*g+l*l)/24,y=Math.sqrt(g*g/36+(Math.abs(f-l/2)/3)**2);p-=y*y*u,p+=new c((n[0].x+n[1].x+n[2].x)/3,(n[0].y+n[1].y+n[2].y)/3).dist(this.pos)**2*u,s+=p}this.am=s,this.boundRadius=Math.max(...this.points.map(n=>c.dist(n,this.pos)))}rotate(t){this.points.forEach(e=>{let s=new c(e.x,e.y);s.sub(this.pos),s.rotate(t),s.add(this.pos),e.x=s.x,e.y=s.y}),this.rotation+=t}get isConcave(){let t=this.points,e=c.angleACW(c.sub(t[1],t[0]),c.sub(t[t.length-1],t[0]));if(e>Math.PI)return!0;for(let s=1;s<t.length-1;s++)if(e=c.angleACW(c.sub(t[(s+1)%t.length],t[s]),c.sub(t[s-1],t[s])),e>Math.PI)return!0;return e=c.angleACW(c.sub(t[0],t[t.length-1]),c.sub(t[t.length-2],t[t.length-1])),e>Math.PI}static collide(t,e){let s=0,i=0,n=new c(0,0),o=[],r=!1;if(t.points.forEach((w,S)=>{let A=new L(new c(w.x,w.y),new c(t.points[(S+1)%t.points.length].x,t.points[(S+1)%t.points.length].y));e.points.forEach((R,q)=>{let H=new L(new c(R.x,R.y),new c(e.points[(q+1)%e.points.length].x,e.points[(q+1)%e.points.length].y)),N=L.intersect(A,H);N&&(s++,n.add(N),o.push(N),r=!0)})}),!r)return;n.div(s);for(let w=0;w<Math.floor(s/2);w++)i+=c.sub(o[2*w+1],o[2*w]).heading;i/=s/2,i+=Math.PI/2;let a=c.fromAngle(i),l=t.ang,h=t.vel.copy,u=e.ang,g=e.vel.copy,f=0,p=0,y=0,m=0;for(let w of t.points)f=Math.min(c.dot(a,c.sub(new c(w.x,w.y),n)),f),p=Math.max(c.dot(a,c.sub(new c(w.x,w.y),n)),p);for(let w of e.points)y=Math.min(c.dot(a,c.sub(new c(w.x,w.y),n)),y),m=Math.max(c.dot(a,c.sub(new c(w.x,w.y),n)),m);Math.abs(f-m)<Math.abs(y-p)?(t.move(-a.x*f,-a.y*f),e.move(-a.x*m,-a.y*m)):(t.move(-a.x*p,-a.y*p),e.move(-a.x*y,-a.y*y));let b=o,M=[],x=[],P=[],j=[];for(let w of b){let S=c.fromAngle(i),A=w,R=t.vel.copy,q=e.vel.copy,H=t.ang,N=e.ang,V=c.sub(A,t.pos),J=c.sub(A,e.pos),Q=t.am,Z=e.am,St=t.m,kt=e.m,Ze=(t.k+e.k)/2,$e=(t.fc+e.fc)/2,_e=t.velInPlace(A),ti=e.velInPlace(A),It=c.sub(ti,_e),nt=1/St+1/kt;nt+=c.dot(c.crossScalarFirst(c.cross(V,S)/Q,V),S),nt+=c.dot(c.crossScalarFirst(c.cross(J,S)/Z,J),S),nt=-(1+Ze)*c.dot(It,S)/nt;let Wt=c.sub(R,c.mult(S,nt/St)),Dt=c.add(q,c.mult(S,nt/kt)),Rt=H-nt*c.cross(V,S)/Q,Lt=N+nt*c.cross(J,S)/Z,$=It.copy;$.sub(c.mult(S,c.dot(It,S))),$.setMag(1);let dt=1/St+1/kt;dt+=c.dot(c.crossScalarFirst(c.cross(V,$)/Q,V),$),dt+=c.dot(c.crossScalarFirst(c.cross(J,$)/Z,J),$),dt=-c.dot(It,$)/dt;let ft=nt*$e;ft>dt&&(ft=dt),Wt=c.sub(Wt,c.mult($,ft/St)),Dt=c.add(Dt,c.mult($,ft/kt)),Rt=Rt-ft*c.cross(V,$)/Q,Lt=Lt+ft*c.cross(J,$)/Z,t.vel=Wt,e.vel=Dt,t.ang=Rt,e.ang=Lt,M.push(t.ang),P.push(t.vel),x.push(e.ang),j.push(e.vel),t.ang=l,t.vel=h,e.ang=u,e.vel=g}if(M.length!=P.length)return;if(M.length==0)return;if(P.length==0)return;if(x.length!=j.length)return;if(x.length==0)return;if(j.length==0)return;t.vel=P.reduce((w,S)=>c.add(w,S)),t.vel.div(P.length),t.ang=M.reduce((w,S)=>w+S),t.ang/=M.length,e.vel=j.reduce((w,S)=>c.add(w,S)),e.vel.div(j.length),e.ang=x.reduce((w,S)=>w+S),e.ang/=x.length}collideWithFixedBall(t){let e=new c(t.x,t.y),s;if(c.dist(e,this.pos)>this.boundRadius+t.r)return;for(let P of this.sides){let j,w;if(j=c.angle(c.sub(P.a,P.b),c.sub(e,P.b)),w=c.angle(c.sub(P.b,P.a),c.sub(e,P.a)),j<Math.PI/2&&w<Math.PI/2){let S=P.distFromPoint(e);if(S<=t.r){let A=c.sub(P.a,P.b);A.rotate(Math.PI/2),A.setMag(t.r*2);let R=c.mult(A,-1),q=new L(c.add(A,e),c.add(R,e));s=L.intersect(q,P),s!=null&&(A=c.sub(s,e),A.setMag(t.r-A.length),this.move(A.x,A.y))}}}if(!s||s==null){t:for(let P of this.points)if(c.dist(P,e)<t.r){let j=c.sub(P,e);j.setMag(t.r-j.length),this.move(j.x,j.y),j.setMag(t.r),s=c.add(e,j);break t}}if(!s||s==null)return;let i=this.vel,n=this.pos,o=c.sub(s,e);o.setMag(1);let r=c.sub(n,s),a=c.angleACW(o,r),l=i.copy,h=r.copy;h.mult(-1*this.ang),h.rotate(Math.PI/2),l.add(h);let u=c.dot(o,l);if(u>=0)return;u*=1+this.k;let g=c.mult(c.normalized(o),-1*u),f=g.copy;g.mult(Math.cos(a)),this.vel.add(g),f=f.length/r.length,f*=Math.sin(a),this.ang+=f;let p=this.m*Math.abs(Math.cos(a))+this.am/r.length/r.length*Math.abs(Math.sin(a)),y=this.m*Math.abs(Math.sin(a))+this.am/r.length/r.length*Math.abs(Math.cos(a));g=c.mult(c.normalized(o),-1*u);let m=o.copy;if(m.rotate(Math.PI/2),m.mult(Math.sign(c.dot(m,l))),m.length==0)return;let b=c.dot(l,m),M=c.mult(g,p),x=c.div(M,y);y==0&&(x=0),x.mult(this.fc),x=c.mult(m,x.length),x.length>b&&x.setMag(b),a=c.angleACW(m,r),g=x,f=g.copy,g.mult(Math.cos(a)),this.vel.add(g),f=f.length/r.length,f*=Math.sin(a),this.ang-=f}collideWithWall(t){if(this.boundRadius+t.boundRadius<c.dist(this.pos,t.center))return;let e=this.sides,s=[],i=[];for(let p of e)for(let y of t.sides){let m=L.intersect(p,y);m!=null&&i.push(m)}if(i.length<2)return;let n=this.vel.copy,o=this.ang,r=[],a=[],l=c.sub(...i);l.rotate(Math.PI/2);let h=c.sub(i[0],this.pos);c.dot(l,h)>0&&l.mult(-1),l.setMag(1),c.dot(l,c.sub(this.pos,t.center))<0&&l.mult(-1),s.push(new L(...i)),s.push(new L(i[0],c.add(i[0],c.mult(l,20)))),s.push(new L(i[1],c.add(i[1],c.mult(l,20))));let u=[],g=i[0];for(let p of t.points){let y=c.sub(p,g),m=c.dot(y,l);m>0&&u.push(m)}if(u.length>0){let p=l.copy;p.mult(Math.max(...u)),this.move(p.x,p.y)}u=[];let f=c.add(...i);if(f.div(2),this.containsPoint(f))for(let p of e)u.push(p.distFromPoint(f));if(u.length>0){let p=l.copy;p.mult(Math.min(...u)),p.length<this.boundRadius/2&&this.move(p.x,p.y)}for(let p of i){let y=this.vel,m=this.pos,b=c.sub(m,p),M=c.angleACW(l,b),x=y.copy,P=b.copy;P.mult(-1*this.ang),P.rotate(Math.PI/2),x.add(P);let j=c.dot(l,x);if(j>=0)return;j*=1+this.k;let w=c.mult(c.normalized(l),-1*j),S=w.copy;w.mult(Math.cos(M)),this.vel.add(w),S=S.length/b.length,S*=Math.sin(M),this.ang+=S;let A=this.m*Math.abs(Math.cos(M))+this.am/b.length/b.length*Math.abs(Math.sin(M)),R=this.m*Math.abs(Math.sin(M))+this.am/b.length/b.length*Math.abs(Math.cos(M));w=c.mult(c.normalized(l),-1*j);let q=l.copy;if(q.rotate(Math.PI/2),q.mult(Math.sign(c.dot(q,x))),q.length==0)return;let H=c.dot(x,q),N=c.mult(w,A),V=c.div(N,R);R==0&&(V=0),V.mult(this.fc),V=c.mult(q,V.length),V.length>H&&V.setMag(H),M=c.angleACW(q,b),w=V,S=w.copy,w.mult(Math.cos(M)),this.vel.add(w),S=S.length/b.length,S*=Math.sin(M),this.ang-=S,r.push(this.vel),this.vel=n.copy,a.push(this.ang),this.ang=o}return a.length!=r.length||(a.length==0||r.length==0)?void 0:(this.vel=r.reduce((p,y)=>c.add(p,y)),this.vel.div(r.length),this.ang=a.reduce((p,y)=>p+y),this.ang/=a.length,(!isFinite(this.vel.x)||!isFinite(this.vel.y)||!isFinite(this.ang))&&(this.vel=n,this.ang=o),s)}containsPoint(t){let e=this.sides,s=Math.max(...this.points.map(r=>c.dist(r,t)))+1,i=c.fromAngle(0);i.setMag(s);let n=new L(t,c.add(i,t)),o=e.filter(r=>L.intersect(r,n)!=null);return o.length%2==1}get sides(){return this.points.map((t,e)=>new L(t,this.points[(e+1)%this.points.length]))}velInPlace(t){let e=c.sub(t,this.pos);return e.rotate(Math.PI/2),e.mult(this.ang),e.add(this.vel),e}effectiveMass(t,e){let s=c.sub(t,this.pos),i=c.angle(e,s),n=Math.sin(i)**2*s.length**2/this.am;return 1/(n+1/this.m)}applyDeltaVelInPoint(t,e){let s=c.sub(e,this.pos);if(s.length==0){this.vel.add(t);return}let i=c.angle(s,t),n=c.mult(s,c.dot(t,s)/s.length**2);this.vel.add(n);let o=s.copy;o.rotate(Math.PI/2),o.setMag(1);let r=Math.sign(c.dot(t,o)),a=t.length*Math.cos(i),l=1/(1/this.m+s.length**2/this.am),h=a*l/this.m;this.vel.add(c.mult(o,h*r));let u=r*a*l*s.length/this.am;console.log(i),this.ang-=u}toJSObject(){let t={};return t.points=this.points.map(e=>({x:e.x,y:e.y})),t.vel=this.vel.toJSObject(),t.k=this.k,t.ang=this.ang,t.fc=this.fc,t.pos=this.pos.toJSObject(),t.lastPos=this.lastPos.toJSObject(),t.rotation=this.rotation,t.id=this.id,t}static fromObject(t){let e=new mt(t.points.map(s=>({x:s.x,y:s.y})),c.fromObject(t.vel),t.k,t.ang,t.fc);return e.id=t.id,e.pos=c.fromObject(t.pos),e.lastPos=c.fromObject(t.lastPos),e.rotation=t.rotation,e}};le.exports=mt}),Jt=T((os,ae)=>{var U=_(),oi=ct(),he=class extends oi{constructor(t,e){super(t,e)}get length(){return Number.POSITIVE_INFINITY}distFromPoint(t){let e=U.sub(this.a,this.b);e.setMag(1),e.rotate(Math.PI/2);let s=U.sub(t,this.a),i=Math.abs(U.dot(s,e));return i}static intersect(t,e){let s=U.sub(t.b,t.a),i=s.y/s.x,n=t.b.y-t.b.x*i,o=U.sub(e.b,e.a),r=o.y/o.x,a=e.b.y-e.b.x*r;if(i===r)return t.distFromPoint(e.a)==0?new U((t.a.x+t.b.x+e.a.x+e.b.x)/4,(t.a.y+t.b.y+e.a.y+e.b.y)/4):void 0;{let l=(a-n)/(i-r);return new U(l,i*l+n)}}static intersectWithLineSegment(t,e){let s=U.sub(t.b,t.a),i=s.y/s.x,n=t.b.y-t.b.x*i,o=U.sub(e.b,e.a),r=o.y/o.x,a=e.b.y-e.b.x*r;if(s.x===0){if(o.x===0)return t.a.x==e.a.x?new U((e.a.x+e.b.x)/2,(e.a.y+e.b.y)/2):void 0;let l=t.a.x,h=r*l+a;return Math.min(e.a.x,e.b.x)<l&&l<Math.max(e.a.x,e.b.x)&&Math.min(e.a.y,e.b.y)<h&&Math.max(e.a.y,e.b.y)>h?new U(l,h):void 0}if(o.x===0){let l=e.a.x,h=i*l+n;return Math.min(e.a.x,e.b.x)<l&&l<Math.max(e.a.x,e.b.x)&&Math.min(e.a.y,e.b.y)<h&&Math.max(e.a.y,e.b.y)>h?new U(l,h):void 0}if(i===r)return t.distFromPoint(e.a)===0?new U((e.a.x+e.b.x)/2,(e.a.y+e.b.y)/2):void 0;{let l=(a-n)/(i-r),h=i*l+n;return Math.min(e.a.x,e.b.x)<l&&l<Math.max(e.a.x,e.b.x)&&Math.min(e.a.y,e.b.y)<h&&Math.max(e.a.y,e.b.y)>h?new U(l,h):void 0}}};ae.exports=he}),ue=T((ls,ce)=>{var F=_(),xt=ct(),At=Jt(),st=class{constructor(t){if(t.length<3)throw new Error("Not enough points in polygon (minimum required: 3)");this.points=t,this.makeAntiClockwise()}getSideVector(t){return t<0&&(t+=Math.abs(Math.floor(t))*this.points.length),F.sub(this.points[(t+1)%this.points.length],this.points[t%this.points.length])}getSideSegment(t){return t<0&&(t+=Math.abs(Math.floor(t))*this.points.length),new xt(this.points[(t+1)%this.points.length],this.points[t%this.points.length])}getSideLine(t){return t<0&&(t+=Math.abs(Math.floor(t))*this.points.length),new At(this.points[(t+1)%this.points.length],this.points[t%this.points.length])}get sides(){return this.points.length}makeAntiClockwise(){let t=0;for(let e=1;e<=this.sides;e++){let s=this.getSideVector(e),i=this.getSideVector(e-1);i.mult(-1),t+=F.angleACW(s,i)}if(this.sides===3)t>Math.PI*1.5&&this.reverseOrder();else if(this.sides===4)F.angleACW(this.getSideVector(1),this.getSideVector(0))>=Math.PI&&this.reverseOrder();else if(this.sides>4){let e=t-this.sides*Math.PI;e>0&&this.reverseOrder()}}reverseOrder(){this.points=this.points.reverse()}isPointInside(t){if(F.dist(t,this.centerPoint)>this.boundRadius)return!1;let e=this.centerPoint.copy;e.add(F.mult(new F(1.1,.6),this.boundRadius));let s=new xt(t,e),i=0;if([...Array(this.sides).keys()].map(n=>this.getSideSegment(n)).forEach(n=>{xt.intersect(n,s)&&i++}),i%2==0)return!1;if(i%2==1)return!0}get centerPoint(){let t=new F(0,0);return this.points.forEach(e=>{t.add(e)}),t.div(this.sides),t}get boundRadius(){let t=this.centerPoint;return Math.max(...this.points.map(e=>F.dist(e,t)))}get allSides(){return[...Array(this.sides).keys()].map(t=>this.getSideSegment(t))}static intersection(t,e){if(F.dist(t.centerPoint,e.centerPoint)>t.boundRadius+e.boundRadius)return;let s=[],i=t.allSides,n=e.allSides;if(i.forEach((u,g)=>{n.forEach((f,p)=>{let y=xt.intersect(u,f);y&&(y.isIntersectionPoint=!0,s.push({intersectionPoint:y,sideNumber1:g,sideNumber2:p}))})}),s.length===0){if(t.isPointInside(e.points[0]))return new st(e.points.map(u=>u.copy));if(e.isPointInside(t.points[0]))return new st(t.points.map(u=>u.copy))}let o=new st(t.points.map(u=>u.copy));for(let u=o.points.length-1;u>=0;u--){let g=s.filter(f=>f.sideNumber1==u);g.length>1&&g.sort((f,p)=>F.dist(o.points[u],f.intersectionPoint)-F.dist(o.points[u],p.intersectionPoint)),g.length>0&&o.points.splice(u+1,0,...g.map(f=>f.intersectionPoint))}let r=new st(e.points.map(u=>u.copy));for(let u=r.points.length-1;u>=0;u--){let g=s.filter(f=>f.sideNumber2==u);g.length>1&&g.sort((f,p)=>F.dist(r.points[u],f.intersectionPoint)-F.dist(r.points[u],p.intersectionPoint)),g.length>0&&r.points.splice(u+1,0,...g.map(f=>f.intersectionPoint))}let a={polyNum:1,pointNum:0};for(let u=0;u<o.points.length;u++)if(o.points[u].isIntersectionPoint){a.pointNum=u;break}else if(r.isPointInside(o.points[u])){a.pointNum=u;break}let l=!1,h=[];for(;!l;){let u=a.polyNum===1?o:r,g=a.polyNum===1?r:o;if(h.push(u.points[a.pointNum%u.points.length].copy),h.length>2&&h[0].x==h[h.length-1].x&&h[0].y==h[h.length-1].y){h.pop();break}if(h.length>o.points.length+r.points.length)break;u.points[a.pointNum%u.points.length].isIntersectionPoint?u.points[(a.pointNum+1)%u.points.length].isIntersectionPoint||g.isPointInside(u.points[(a.pointNum+1)%u.points.length])&&!u.points[(a.pointNum+1)%u.points.length].isIntersectionPoint?a.pointNum++:(a.pointNum=g.points.indexOf(u.points[a.pointNum%u.points.length])+1,a.polyNum=a.polyNum===1?2:1):a.pointNum++}return new st(h)}static createCircle(t,e,s=25){let i=[...Array(s).keys()].map(n=>{let o=F.fromAngle(2*Math.PI*n/s);return o.setMag(t),o.add(e),o});return new st(i)}static fracture(t,e=500){let s=t.map((i,n)=>{let o=[];for(let a=0;a<t.length;a++){if(n===a)continue;let l=t[a],h=F.div(F.add(i,l),2),u=F.sub(i,l);u.rotate(Math.PI/2),o.push(new At(h,F.add(u,h)))}o=o.filter((a,l)=>{let h=new xt(a.a,i);for(let u=0;u<o.length;u++){if(l===u)continue;let g=At.intersectWithLineSegment(o[u],h);if(g)return!1}return!0}),o=o.sort((a,l)=>F.sub(a.a,a.b).heading-F.sub(l.a,l.b).heading);let r=o.map((a,l)=>{let h=[];for(let g=0;g<o.length;g++){if(l===g)continue;let f=At.intersect(a,o[g]);f&&h.push(f)}let u=F.sub(a.a,a.b);return h=h.filter(g=>{let f=F.sub(g,i);u.setMag(1);let p=F.dot(f,u);return p>0}),h.length===0&&h.push(F.add(F.mult(u,e*1.2),a.a)),h=h.sort((g,f)=>F.dist(g,i)-F.dist(f,i)),h[0]});return r});return s.filter(i=>i.length>=3).map(i=>new st(i))}};ce.exports=st}),fe=T((rs,de)=>{de.exports={name:"ballphysics",version:"1.6.0",description:"2D rigid body physics engine to-be",main:"./src/physics.js",scripts:{test:"jest --verbose ./tests",build:"esbuild editor/src/index.js --bundle --minify --sourcemap --target=chrome58,firefox57,safari11,edge16 --outfile=dest/main.js && cp editor/static/index.html dest/index.html"},repository:{type:"git",url:"git+https://github.com/AkosSeres/BallPhysics.git"},keywords:["physics","2d","rigid","balls"],author:"Akos Seres",license:"LGPL-2.1",bugs:{url:"https://github.com/AkosSeres/BallPhysics/issues"},homepage:"https://github.com/AkosSeres/BallPhysics#readme",devDependencies:{esbuild:"^0.8.26",eslint:"^6.0.1","eslint-config-google":"^0.9.1",jest:"^26.4.2"},dependencies:{}}}),at=T((as,pe)=>{var B=_(),Xt=Ot(),bt=te(),li=ct(),ge=qt(),rt=Vt(),Ft=oe(),vt=re(),ri=Jt(),ai=ue(),z=class{constructor(){this.balls=[],this.bodies=[],this.fixedBalls=[],this.softBalls=[],this.walls=[],this.bounds=[],this.springs=[],this.airFriction=1,this.gravity=new B(0,0),this.debugData=[]}update(t,e){this.debugData=[];let s=e?this.copy:new z;e&&(s.bodies.reverse(),s.balls.reverse(),s.update(t,!1));for(let i=0;i<this.balls.length;i++)this.balls[i].lastPos=this.balls[i].pos.copy,this.balls[i].pos.add(B.mult(this.balls[i].vel,t)),this.balls[i].rotation+=this.balls[i].ang*t,this.balls[i].rotation%=Math.PI*2;for(let i=0;i<this.bodies.length;i++)this.bodies[i].lastPos=this.bodies[i].pos.copy,this.bodies[i].move(this.bodies[i].vel.x*t,this.bodies[i].vel.y*t),this.bodies[i].rotate(this.bodies[i].ang*t);for(let i=0;i<3;i++)for(let n of this.springs)n.update(t/3/2);for(let i=0;i<this.balls.length;i++){this.gravity&&this.balls[i].vel.add(new B(this.gravity.x*t,this.gravity.y*t));for(let n=i+1;n<this.balls.length;n++)(this.balls[i].layer!=this.balls[n].layer||!this.balls[i].layer&&!this.balls[n].layer)&&Xt.collide(this.balls[i],this.balls[n]);for(let n of this.walls)n.collideWithBall(this.balls[i]);for(let n of this.fixedBalls){let o=this.balls[i],r,a=0,l=new B(n.x,n.y);l.x-=o.pos.x,l.y-=o.pos.y,l.mult(-1),l.length<=o.r+n.r&&(r=l.heading,a=l.length);t:if(isFinite(r)){let h=o.pos.copy,u=o.vel.copy;if(h.rotate(-r+Math.PI/2),u.rotate(-r+Math.PI/2),u.y>0)break t;u.y*=-o.k,h.y+=o.r+n.r-a;let g=u.y*(1+o.k),f=Math.sign(u.x+o.ang*o.r)*(g*o.fc)/(o.amc*o.r),p=(u.x+o.ang*o.r)/o.r;f/p>1&&(f=p),o.ang-=f;let y=f*o.am/o.r/o.m;u.x-=y,h.rotate(r-Math.PI/2),u.rotate(r-Math.PI/2),o.pos.x=h.x,o.pos.y=h.y,o.vel.x=u.x,o.vel.y=u.y}}for(let n of this.bounds)n.collideWithBall(this.balls[i])}for(let i=0;i<this.bodies.length;i++){for(let n of this.balls)(n.layer!=this.bodies[i].layer||!n.layer&&!this.bodies[i].layer)&&this.bodies[i].collideWithBall(n);for(let n=i+1;n<this.bodies.length;n++)(this.bodies[i].layer!=this.bodies[n].layer||!this.bodies[n].layer&&!this.bodies[i].layer)&&vt.collide(this.bodies[i],this.bodies[n]);for(let n of this.bodies)for(let o of this.fixedBalls)n.collideWithFixedBall(o);for(let n of this.bodies)for(let o of this.walls){let r=n.collideWithWall(o);r&&this.debugData.push(...r)}for(let n of this.bodies)for(let o of this.bounds){let r=n.collideWithWall(o);r&&this.debugData.push(...r)}this.gravity&&this.bodies[i].vel.add(new B(this.gravity.x*t,this.gravity.y*t))}this.softBalls.forEach(i=>{Ft.updatePressureBasedForces(i,t)});for(let i=0;i<3;i++)for(let n of this.springs)n.update(t/3/2);this.balls.forEach(i=>{i.vel.mult(Math.pow(this.airFriction,t)),i.ang*=Math.pow(this.airFriction,t)}),this.bodies.forEach(i=>{i.vel.mult(Math.pow(this.airFriction,t)),i.ang*=Math.pow(this.airFriction,t)}),e&&(s.bodies.reverse(),s.balls.reverse(),this.balls.forEach((i,n)=>{i.move((s.balls[n].pos.x-i.pos.x)*.5,(s.balls[n].pos.y-i.pos.y)*.5),i.vel.add(new B((s.balls[n].vel.x-i.vel.x)*.5,(s.balls[n].vel.y-i.vel.y)*.5)),i.rotation=(i.rotation+s.balls[n].rotation)/2,i.ang=(i.ang+s.balls[n].ang)/2}),this.bodies.forEach((i,n)=>{let o=s.bodies[n];i.move((o.pos.x-i.pos.x)*.5,(o.pos.y-i.pos.y)*.5),i.vel.add(new B((o.vel.x-i.vel.x)*.5,(o.vel.y-i.vel.y)*.5)),i.rotate((o.rotation-i.rotation)/2),i.ang=(i.ang+o.ang)/2}))}get copy(){let t=new z;return t.balls=this.getCopyOfBalls(),t.bodies=this.getCopyOfBodies(),t.fixedBalls=this.fixedBalls,t.walls=this.walls,t.bounds=this.bounds,t.gravity=this.gravity,this.springs.forEach(e=>{let s=e.constructor==rt?rt:ge,i=new s(e.length,e.springConstant);i.rotationLocked=e.rotationLocked,i.pinned=e.pinned,e.objects.forEach(n=>{let o=this.balls.indexOf(n);o!=-1?i.attachObject(t.balls[o]):(o=this.bodies.indexOf(n),o!=-1&&i.attachObject(t.bodies[o]))}),t.springs.push(i)}),t}setAirFriction(t){if(!isFinite(t))return;this.airFriction=t,this.airFriction<0&&(this.airFriction=0),this.airFriction>1&&(this.airFriction=1)}setGravity(t){this.gravity=t.copy}addBall(t){if(typeof addBodyNotBall!="undefined"&&isFinite(addBodyNotBall)&&addBodyNotBall>2){let e=(s,i,n)=>{let o=[];for(let r=0;r<n;r++){let a=B.fromAngle(r/n*2*Math.PI);a.mult(i),a.add(s),o.push(a)}return o};this.bodies.push(new vt(e(t.pos,t.r,addBodyNotBall),t.vel,t.k,t.ang,t.fc))}else this.balls.push(t)}addBody(t){this.bodies.push(t)}addSoftBall(t){this.balls.push(...t.points),this.springs.push(...t.sides),this.softBalls.push(t)}addSoftSquare(t,e,s,i){let n=new Ft(t,Math.sqrt(e*e/Math.PI),1,s,24);n.sides.forEach(a=>{a.length=.96*4*e/n.resolution}),n.points.forEach(a=>{a.vel=i.copy}),this.balls.push(...n.points),this.springs.push(...n.sides);let o=e*e*200,r=new rt(Math.sqrt(n.r*n.r*Math.PI),o/2);r.attachObject(n.points[0]),r.attachObject(n.points[n.resolution/2]),this.springs.push(r),r=new rt(Math.sqrt(n.r*n.r*Math.PI),o/2),r.attachObject(n.points[n.resolution/4]),r.attachObject(n.points[3*n.resolution/4]),this.springs.push(r),r=new rt(Math.sqrt(2*n.r*n.r*Math.PI),o),r.attachObject(n.points[n.resolution/8]),r.attachObject(n.points[5*n.resolution/8]),this.springs.push(r),r=new rt(Math.sqrt(2*n.r*n.r*Math.PI),o),r.attachObject(n.points[3*n.resolution/8]),r.attachObject(n.points[7*n.resolution/8]),this.springs.push(r)}addRectWall(t,e,s,i){let n=[];n.push(new B(t-s/2,e-i/2)),n.push(new B(t+s/2,e-i/2)),n.push(new B(t+s/2,e+i/2)),n.push(new B(t-s/2,e+i/2)),this.walls.push(new bt(n))}addRectBody(t,e,s,i,n,o){let r=[];r.push(new B(t-s/2,e-i/2)),r.push(new B(t+s/2,e-i/2)),r.push(new B(t+s/2,e+i/2)),r.push(new B(t-s/2,e+i/2)),this.bodies.push(new vt(r,new B(0,0),o,0,n))}addWall(t){this.walls.push(t)}addFixedBall(t,e,s){this.fixedBalls.push({x:t,y:e,r:s})}addSpring(t){this.springs.push(t)}setBounds(t,e,s,i){this.bounds=[];let n=(o,r,a,l)=>{let h=[];return h.push(new B(o-a/2,r-l/2)),h.push(new B(o+a/2,r-l/2)),h.push(new B(o+a/2,r+l/2)),h.push(new B(o-a/2,r+l/2)),new bt(h)};this.bounds.push(n(t-s,e,2*s,4*i)),this.bounds.push(n(t+2*s,e,2*s,4*i)),this.bounds.push(n(t,e-i,4*s,i*2)),this.bounds.push(n(t,e+2*i,4*s,2*i))}getObjectAtCoordinates(t,e){let s,i=new B(t,e);return this.balls.forEach(n=>{n.containsPoint(i)&&(s=n)}),this.bodies.forEach(n=>{n.containsPoint(i)&&(s=n)}),this.walls.forEach(n=>{n.containsPoint(i)&&(s=n)}),this.fixedBalls.forEach(n=>{B.dist(new B(n.x,n.y),new B(t,e))<=n.r&&(s=n)}),this.softBalls.forEach(n=>{n.containsPoint(i)&&(s=n)}),s}getCopyOfBalls(){let t=[];return this.balls.forEach(e=>{t.push(e.copy)}),t}getCopyOfBodies(){let t=[];return this.bodies.forEach(e=>{t.push(e.copy)}),t}removeObjFromSystem(t){let e=this.balls.indexOf(t);if(e!=-1){let s=!1;if(this.softBalls.forEach(i=>{i.points.includes(this.balls[e])&&(this.removeObjFromSystem(i),s=!0)}),s)return;this.springs.forEach(i=>{i.objects.includes(this.balls[e])&&this.removeObjFromSystem(i)}),this.balls.splice(e,1);return}if(e=this.bodies.indexOf(t),e!=-1){this.bodies.splice(e,1);return}if(e=this.walls.indexOf(t),e!=-1){this.walls.splice(e,1);return}if(e=this.fixedBalls.indexOf(t),e!=-1){this.fixedBalls.splice(e,1);return}if(e=this.springs.indexOf(t),e!=-1){this.springs.splice(e,1);let s=!1;return this.softBalls.forEach(i=>{i.points.includes(this.springs[e])&&(this.removeObjFromSystem(i),s=!0)}),s,void 0}if(e=this.softBalls.indexOf(t),e!=-1){let s=this.softBalls[e];this.softBalls.splice(e,1),s.points.forEach(i=>{this.removeObjFromSystem(i)});return}}getItemDataFromId(){let t={},e=o=>o.id===id,s=this.balls.filter(e);if(s.length>=1)return t.type="ball",t.num=this.balls.indexOf(s[0]),t;let i=this.bodies.filter(e);if(i.length>=1)return t.type="body",t.num=this.bodies.indexOf(i[0]),t;let n=this.springs.filter(e);if(n.length>=1)return t.type="spring",t.num=this.springs.indexOf(n[0]),t}toJSObject(){let t={};return t.balls=this.balls.map(e=>e.toJSObject()),t.bounds=this.bounds.map(e=>e.toJSObject()),t.walls=this.walls.map(e=>e.toJSObject()),t.bodies=this.bodies.map(e=>e.toJSObject()),t.springs=this.springs.map(e=>e.toJSObject()),t.softBalls=this.softBalls.map(e=>e.toJSObject()),t.fixedBalls=this.fixedBalls,t.airFriction=this.airFriction,t.gravity=this.gravity.toJSObject(),t.version=fe().version,t}static fromObject(t){let e=new z;return e.balls=t.balls.map(s=>Xt.fromObject(s)),e.bounds=t.bounds.map(s=>bt.fromObject(s)),e.walls=t.walls.map(s=>bt.fromObject(s)),e.bodies=t.bodies.map(s=>vt.fromObject(s)),e.springs=t.springs.map(s=>rt.fromObject(s,e.balls)),e.softBalls=t.softBalls.map(s=>Ft.fromObject(s,e.balls,e.springs)),e.fixedBalls=t.fixedBalls,e.airFriction=t.airFriction,e.gravity=B.fromObject(t.gravity),e}toJSON(){return JSON.stringify(this.toJSObject())}static fromJSON(t){return z.fromObject(JSON.parse(t))}};z.Ball=Xt;z.Body=vt;z.Vec2=B;z.Wall=bt;z.LineSegment=li;z.Spring=rt;z.Stick=ge;z.SoftBall=Ft;z.Line=ri;z.Polygon=ai;pe.exports=z}),we=T((hs,ye)=>{var hi=at();ye.exports=function(d){this.startingState=d.getPhysics().toJSObject(),this.inStartingState=!0,document.getElementById("pause").onclick=()=>{d.getTimeMultiplier()!==0?d.setTimeMultiplier(0):(d.setTimeMultiplier(1),this.inStartingState==!0&&(this.startingState=d.getPhysics().toJSObject()),this.inStartingState=!1)},document.getElementById("revert").onclick=()=>{d.setTimeMultiplier(0),d.setPhysics(hi.fromObject(this.startingState)),this.inStartingState=!0},document.getElementById("clear all").onclick=()=>{this.inStartingState=!0;let t=d.getPhysics();t.balls=[],t.walls=[],t.softBalls=[],t.springs=[],t.bodies=[]},document.getElementById("set start").onclick=()=>{this.startingState=d.getPhysics().toJSObject(),this.inStartingState=!0,d.setTimeMultiplier(0)}}}),tt=T((cs,me)=>{var xe=class{constructor(t,e,s,i,n,o,r){this.name=t,this.description=e,this.drawFunc=s,this.startInteractionFunc=i,this.endInteractionFunc=n,this.keyGotUpFunc=o,this.keyGotDownFunc=r}};me.exports=xe}),ve=T((us,be)=>{var ci=tt(),Yt=at(),ui=new ci("Ball creator","",function(d,t,e,s,i,n,o,r,a,l){d.strokeStyle="black",d.beginPath(),d.arc(t,e,n,0,2*Math.PI),d.stroke(),s!=0&&i!=0&&(d.beginPath(),d.moveTo(t,e),d.lineTo(s,i),d.stroke())},function(d,t,e,s,i){},function(d,t,e,s,i,n,o){if(n!=0&&o!=0){let r=new Yt.Ball(new Yt.Vec2(n,o),new Yt.Vec2(n-s,o-i),defaultSize,k,0,fc);isFinite(r.pos.x)&&isFinite(r.pos.y)&&isFinite(r.vel.x)&&isFinite(r.vel.y)||(r.vel.x=0,r.vel.y=0),d.addBall(r)}},function(){},function(){});be.exports=ui}),Pe=T((ds,Me)=>{var di=tt(),fi=new di("Rectangle wall","",function(d,t,e,s,i,n,o,r,a,l){s!=0&&i!=0&&(d.strokeStyle="black",d.strokeRect(t,e,s-t,i-e))},function(d,t,e,s,i){},function(d,t,e,s,i,n,o){n!=0&&o!=0&&d.addRectWall(n/2+s/2,o/2+i/2,2*Math.abs(n/2-s/2),2*Math.abs(o/2-i/2))},function(){},function(){});Me.exports=fi}),ke=T((fs,Se)=>{var pi=tt(),gi=new pi("Wall drawer","",function(d,t,e,s,i,n,o,r,a,l,h){d.strokeStyle="black",d.beginPath(),d.arc(t,e,n,0,2*Math.PI),d.stroke(),s!=0&&i!=0&&r.addFixedBall(t/h.scaling-h.viewOffsetX/h.scaling,e/h.scaling-h.viewOffsetY/h.scaling,n)},function(d,t,e,s,i){},function(d,t,e,s,i,n,o){},function(){},function(){});Se.exports=gi}),Oe=T((ps,Ie)=>{var yi=tt(),wi=at(),mi=new yi("Stick creator","",function(d,t,e,s,i,n,o,r,a,l){s!=0&&i!=0&&(d.strokeStyle="black",d.beginPath(),d.moveTo(t,e),d.lineTo(s,i),d.stroke())},function(d,t,e,s,i,n){},function(d,t,e,s,i,n,o,r){if(n!=0&&o!=0){t:{let a=d.getObjectAtCoordinates(s,i),l,h=wi.Stick;if(a||(a={x:s,y:i,pinPoint:!0}),r==a||r==null&&a==null)break t;if(r.pinPoint&&a.pinPoint)break t;r.pinPoint?(l=new h(Math.sqrt(Math.pow(r.x-a.pos.x,2)+Math.pow(r.y-a.pos.y,2)),springConstant),l.attachObject(a),l.pinHere(r.x,r.y)):a.pinPoint?(l=new h(Math.sqrt(Math.pow(r.pos.x-a.x,2)+Math.pow(r.pos.y-a.y,2)),springConstant),l.attachObject(r),l.pinHere(a.x,a.y)):(l=new h(Math.sqrt(Math.pow(r.pos.x-a.pos.x,2)+Math.pow(r.pos.y-a.pos.y,2)),springConstant),l.attachObject(r),l.attachObject(a)),d.addSpring(l),lockRotation&&l.lockRotation()}}},function(){},function(){});Ie.exports=mi}),qe=T((gs,je)=>{var xi=tt(),bi=at(),vi=new xi("Spring creator","",function(d,t,e,s,i,n,o,r,a,l){s!=0&&i!=0&&(d.strokeStyle="black",d.beginPath(),d.moveTo(t,e),d.lineTo(s,i),d.stroke())},function(d,t,e,s,i,n){},function(d,t,e,s,i,n,o,r){if(n!=0&&o!=0){t:{let a=d.getObjectAtCoordinates(s,i),l,h=bi.Spring;if(a||(a={x:s,y:i,pinPoint:!0}),r==a||r==null&&a==null)break t;if(r.pinPoint&&a.pinPoint)break t;r.pinPoint?(l=new h(Math.sqrt(Math.pow(r.x-a.pos.x,2)+Math.pow(r.y-a.pos.y,2)),springConstant),l.attachObject(a),l.pinHere(r.x,r.y)):a.pinPoint?(l=new h(Math.sqrt(Math.pow(r.pos.x-a.x,2)+Math.pow(r.pos.y-a.y,2)),springConstant),l.attachObject(r),l.pinHere(a.x,a.y)):(l=new h(Math.sqrt(Math.pow(r.pos.x-a.pos.x,2)+Math.pow(r.pos.y-a.pos.y,2)),springConstant),l.attachObject(r),l.attachObject(a)),d.addSpring(l),lockRotation&&l.lockRotation()}}},function(){},function(){});je.exports=vi}),Ee=T((ys,Ce)=>{var Mi=tt(),Ae=0,Fe=0,Be=(d,t,e)=>({x:d/e.scaling-e.viewOffsetX/e.scaling,y:t/e.scaling-e.viewOffsetY/e.scaling}),Pi=new Mi("Move","",function(d,t,e,s,i,n,o,r,a,l,h){let u=Be(t,e,h),g=Be(Ae,Fe,h);a&&!a.pinPoint&&(a.move(u.x-a.pos.x,u.y-a.pos.y),l===0?(a.vel.x=0,a.vel.y=0):(a.vel.x=(u.x-g.x)/l,a.vel.y=(u.y-g.y)/l),a.ang=0),Ae=t,Fe=e},function(d,t,e,s,i){},function(d,t,e,s,i,n,o){},function(){},function(){});Ce.exports=Pi}),We=T((ws,Te)=>{var Si=tt(),Bt=at(),ki=new Si("Elastic ball creator","",function(d,t,e,s,i,n,o,r,a,l){d.strokeStyle="black",d.beginPath(),d.arc(t,e,n,0,2*Math.PI),d.stroke(),s!=0&&i!=0&&(d.beginPath(),d.moveTo(t,e),d.lineTo(s,i),d.stroke())},function(d,t,e,s,i){},function(d,t,e,s,i,n,o){if(n!=0&&o!=0){let r=new Bt.Ball(new Bt.Vec2(n,o),new Bt.Vec2(n-s,o-i),defaultSize,k,0,fc);if(isFinite(r.pos.x)&&isFinite(r.pos.y)&&isFinite(r.vel.x)&&isFinite(r.vel.y)){let a=new Bt.SoftBall(r.pos,defaultSize,1e6,fc,24);a.points.forEach(l=>{l.vel=r.vel.copy}),d.addSoftBall(a)}}},function(){},function(){});Te.exports=ki}),Re=T((ms,De)=>{var Ii=tt(),Ht=at(),Oi=new Ii("Soft square creator","",function(d,t,e,s,i,n,o,r,a,l){d.strokeStyle="black",d.beginPath(),d.moveTo(t-n,e-n),d.lineTo(t+n,e-n),d.lineTo(t+n,e+n),d.lineTo(t-n,e+n),d.lineTo(t-n,e-n),d.stroke(),s!=0&&i!=0&&(d.beginPath(),d.moveTo(t,e),d.lineTo(s,i),d.stroke())},function(d,t,e,s,i){},function(d,t,e,s,i,n,o){if(n!=0&&o!=0){let r=new Ht.Ball(new Ht.Vec2(n,o),new Ht.Vec2(n-s,o-i),defaultSize,k,0,fc);isFinite(r.pos.x)&&isFinite(r.pos.y)&&isFinite(r.vel.x)&&isFinite(r.vel.y)&&d.addSoftSquare(r.pos,defaultSize*2,fc,r.vel)}},function(){},function(){});De.exports=Oi}),Ne=T((xs,Le)=>{var ji=tt(),qi=new ji("Delete","",function(d,t,e,s,i,n,o,r,a,l){},function(d,t,e,s,i,n){n&&d.removeObjFromSystem(n)},function(d,t,e,s,i,n,o){},function(){},function(){});Le.exports=qi}),Je=T((bs,Ve)=>{var Ci=tt(),Ai=new Ci("Rectangle body (experimental)","",function(d,t,e,s,i,n,o,r,a,l){s!=0&&i!=0&&(d.strokeStyle="black",d.strokeRect(t,e,s-t,i-e))},function(d,t,e,s,i){},function(d,t,e,s,i,n,o,r,a,l){n!=0&&o!=0&&d.addRectBody(n/2+s/2,o/2+i/2,2*Math.abs(n/2-s/2),2*Math.abs(o/2-i/2),.18,.1)},function(){},function(){});Ve.exports=Ai}),Mt=at(),Xe=Mt,Ye=Mt.Ball,lt=Mt.Vec2,Fi=Mt.Spring,He=Mt.Stick,Bi=we(),C,E,X=0,Y=0,zt=0;window.defaultSize;window.k=.5;window.fc=2;window.springConstant=2e3;window.scaling=1;window.viewOffsetX=0;window.viewOffsetY=0;var G=0,pt=0,gt=0,Et=1,Tt;window.lockRotation=!1;window.time=!0;var ut=!1,ze=0;my=0;var Pt=!1,ht=[ve(),Pe(),ke(),Oe(),qe(),Ee(),We(),Re(),Ne(),Je()],Gt=!1,Ut=!1;window.onload=()=>{E=document.getElementById("defaulCanvas0"),C=new Xe,C.setBounds(0,0,E.width,E.height),C.setGravity(new lt(0,1e3)),C.setAirFriction(.9),E.addEventListener("touchstart",Wi,!1),E.addEventListener("touchend",Di,!1),E.addEventListener("touchmove",Ri,!1),E.addEventListener("mousedown",Li,!1),E.addEventListener("mouseup",Ni,!1),E.addEventListener("mousemove",Vi,!1),document.addEventListener("keydown",Ei,!1),document.addEventListener("keyup",Ti,!1),window.addEventListener("resize",Ge,!1),E.addEventListener("mousedown",function(){zt=1},!1),E.addEventListener("mouseup",function(){zt=0},!1),Ge(),window.defaultSize=(E.width+E.height)/80,Bi(new Ji),requestAnimationFrame(Ue)};function Ge(){E.width=window.innerWidth,E.height=window.innerHeight,C.setBounds(0,0,E.width,E.height)}function Ue(){isFinite(Tt)||(Tt=performance.now());let d=performance.now()-Tt;isFinite(d)||(d=0),d/=1e3,X=isFinite(X)?X:ze,Y=isFinite(Y)?Y:my,X&&isFinite(X)&&(ze=X),Y&&isFinite(Y)&&(my=Y);let t=E.getContext("2d");if(t.fillStyle="rgb(51, 51, 51)",t.fillRect(0,0,E.width,E.height),t.strokeStyle="black",t.fillStyle="white",t.fillText("BallPhysics",10,10),t.fillText("Mode: "+ht[G].name,10,25),t.fillText(Math.round(X).toString()+" "+Math.round(Y).toString(),10,40),t.fillText(Math.round(pt).toString()+" "+Math.round(gt).toString(),10,55),ht[G].drawFunc(t,X,Y,pt,gt,defaultSize*window.scaling,zt,C,ut,d*Et,{scaling:window.scaling,viewOffsetX:window.viewOffsetX,viewOffsetY:window.viewOffsetY}),t.strokeStyle="black",Xi(E),!time)return;C.balls[0]&&(Ut&&(C.balls[0].ang-=Math.PI*100*d),Gt&&(C.balls[0].ang+=Math.PI*100*d)),d*=Et,C.update(d/5,Pt),C.update(d/5,Pt),C.update(d/5,Pt),C.update(d/5,Pt),C.update(d/5,Pt),pmouseX=X,pmouseY=Y,Tt=performance.now(),requestAnimationFrame(Ue)}function Ke(d,t){X=d,Y=t,ut=C.getObjectAtCoordinates(X/window.scaling-window.viewOffsetX/window.scaling,Y/window.scaling-window.viewOffsetY/window.scaling),ut||(ut={x:X/window.scaling-window.viewOffsetX/window.scaling,y:Y/window.scaling-window.viewOffsetY/window.scaling,pinPoint:!0}),pt=X,gt=Y,ht[G].startInteractionFunc(C,d/window.scaling-window.viewOffsetX/window.scaling,t/window.scaling-window.viewOffsetY/window.scaling,X/window.scaling-window.viewOffsetX/window.scaling,Y/window.scaling-window.viewOffsetY/window.scaling,ut)}function Qe(d,t){if(X=d,Y=t,ht[G].endInteractionFunc(C,d/window.scaling-window.viewOffsetX/window.scaling,t/window.scaling-window.viewOffsetY/window.scaling,X/window.scaling-window.viewOffsetX/window.scaling,Y/window.scaling-window.viewOffsetY/window.scaling,pt/window.scaling-window.viewOffsetX/window.scaling,gt/window.scaling-window.viewOffsetY/window.scaling,ut,fc,k),pt===0&&gt===0)return;pt=0,gt=0,ut=!1}function Ei(d){keyCode=d.key,keyCode==="ArrowUp"&&(G+=1,G%=ht.length),keyCode==="ArrowDown"&&(G-=1,G=G===-1?ht.length-1:G),keyCode==="s"&&Yi(E.width/2,E.height/2,.5,C),keyCode==="a"&&(window.scaling+=.01),keyCode==="d"&&(window.scaling-=.01),keyCode==="j"&&(window.viewOffsetX-=10),keyCode==="l"&&(window.viewOffsetX+=10),keyCode==="k"&&(window.viewOffsetY-=10),keyCode==="i"&&(window.viewOffsetY+=10),keyCode==="ArrowRight"&&(Ut=!0),keyCode==="ArrowLeft"&&(Gt=!0)}function Ti(d){keyCode=d.key,keyCode==="ArrowRight"&&(Ut=!1),keyCode==="ArrowLeft"&&(Gt=!1)}function Wi(d){if(d.preventDefault(),E.width-d.changedTouches[0].clientX<E.width/100){G+=1,G%=ht.length;return}if(d.changedTouches[0].clientX<E.width/100){G-=1,G=G===-1?ht.length-1:G;return}return Ke(d.changedTouches[0].clientX,d.changedTouches[0].clientY),!1}function Di(d){return d.preventDefault(),Qe(d.changedTouches[0].clientX,d.changedTouches[0].clientY),!1}function Ri(d){return d.preventDefault(),X=d.changedTouches[0].clientX,Y=d.changedTouches[0].clientY,!1}function Li(d){return Ke(d.clientX,d.clientY),!1}function Ni(d){return Qe(d.clientX,d.clientY),!1}function Vi(d){X=d.clientX,Y=d.clientY}var Xi=function(d){let t=d.getContext("2d");t.save(),t.translate(window.viewOffsetX,window.viewOffsetY),t.scale(window.scaling,window.scaling),t.fillStyle="green",t.strokeStyle="black";for(let s=0;s<C.balls.length;s++){let i=C.balls[s];t.beginPath(),t.arc(i.pos.x,i.pos.y,i.r,0,2*Math.PI),t.stroke(),t.fill(),t.beginPath(),t.moveTo(i.pos.x,i.pos.y),t.lineTo(i.pos.x+i.r*Math.cos(i.rotation),i.pos.y+i.r*Math.sin(i.rotation)),t.stroke()}C.bodies.forEach(s=>{t.beginPath(),t.moveTo(s.points[s.points.length-1].x,s.points[s.points.length-1].y),s.points.forEach(i=>{t.lineTo(i.x,i.y)}),t.stroke(),t.fill(),t.beginPath(),t.arc(s.pos.x,s.pos.y,1.5,0,Math.PI*2),t.stroke()});let e=s=>{t.beginPath(),t.moveTo(s.points[s.points.length-1].x,s.points[s.points.length-1].y),s.points.forEach(i=>{t.lineTo(i.x,i.y)}),t.fill()};t.fillStyle="white",C.walls.forEach(e),t.fillStyle="yellow",C.bounds.forEach(e),C.fixedBalls.forEach(s=>{t.beginPath(),t.arc(s.x,s.y,s.r,0,Math.PI*2),t.fill()}),t.save(),t.lineWidth=2,t.strokeStyle="#ADD8E6",t.fillStyle="#ADD8E6",C.springs.forEach(s=>{if(s instanceof Fi&&!(s instanceof He)){let i,n,o,r;s.pinned?(i=s.pinned.x,n=s.pinned.y,o=s.objects[0].pos.x,r=s.objects[0].pos.y):(i=s.objects[0].pos.x,n=s.objects[0].pos.y,o=s.objects[1].pos.x,r=s.objects[1].pos.y);let a=new lt(o-i,r-n),l=a.copy;a.rotate(Math.PI/2),a.setMag(5);let h=new lt(i,n),u=Math.floor(s.length/10);for(let g=1;g<=u;g++)g===u&&(a=new lt(0,0)),t.beginPath(),t.moveTo(h.x,h.y),t.lineTo(i+g/u*l.x+a.x,n+g/u*l.y+a.y),t.stroke(),h=new lt(i+g/u*l.x+a.x,n+g/u*l.y+a.y),a.mult(-1)}else t.beginPath(),t.moveTo(s.objects[0].pos.x,s.objects[0].pos.y),t.lineTo(s.pinned?s.pinned.x:s.objects[1].pos.x,s.pinned?s.pinned.y:s.objects[1].pos.y),t.stroke();s.objects.forEach(i=>{t.beginPath(),t.arc(i.pos.x,i.pos.y,2.5,0,Math.PI*2),t.fill(),t.stroke()}),s.pinned&&(t.beginPath(),t.arc(s.pinned.x,s.pinned.y,3,0,Math.PI*2),t.fill(),t.stroke())}),t.restore();for(segment of C.debugData)t.strokeStyle="red",t.beginPath(),t.moveTo(segment.a.x,segment.a.y),t.lineTo(segment.b.x,segment.b.y),t.stroke();t.restore()};function Yi(d,t,e,s){let i=[],n=25,o=250,r=8;i.push(new Ye(new lt(d,t),new lt(0,0),e*n,1,0,0));let a=1;for(let l=0;l<r-1;l++)i.push(new Ye(new lt(d+a*e*n*1.01*2,t),new lt(0,0),e*25,1,0,0)),a*=-1,a>0&&(a+=1),l===r-2&&(i[i.length-1].vel.x=-Math.sign(a)*e*n*8);i.forEach(l=>{s.addBall(l);let h=new He(o);h.attachObject(l),h.pinHere(l.pos.x,l.pos.y-o),s.addSpring(h),h.lockRotation()})}function Hi(d){isFinite(d)&&(Et=d)}function zi(){return Et}function Gi(d){d instanceof Xe&&(C=d)}function Ui(){return C}var Ji=function(){this.setTimeMultiplier=Hi,this.getTimeMultiplier=zi,this.getPhysics=Ui,this.setPhysics=Gi};})();
//# sourceMappingURL=main.js.map

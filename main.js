(()=>{var E=(c,t)=>()=>(t||(t={exports:{}},c(t.exports,t)),t.exports),$=E((hs,oe)=>{var N=class{constructor(t,e){this.x=t,this.y=e}get copy(){return new N(this.x,this.y)}get length(){return Math.sqrt(this.x*this.x+this.y*this.y)}get sqlength(){return this.x*this.x+this.y*this.y}get heading(){if(this.x===0&&this.y===0)return 0;if(this.x===0)return this.y>0?Math.PI/2:1.5*Math.PI;if(this.y===0)return this.x>0?0:Math.PI;let t=N.normalized(this);return this.x>0&&this.y>0?Math.asin(t.y):this.x<0&&this.y>0?Math.asin(-t.x)+Math.PI/2:this.x<0&&this.y<0?Math.asin(-t.y)+Math.PI:this.x>0&&this.y<0?Math.asin(t.x)+1.5*Math.PI:0}add(t){this.x+=t.x,this.y+=t.y}sub(t){this.x-=t.x,this.y-=t.y}mult(t){this.x*=t,this.y*=t}div(t){this.x/=t,this.y/=t}lerp(t,e){this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e}dist(t){return new N(this.x-t.x,this.y-t.y).length}setMag(t){if(this.length===0)return;this.mult(t/this.length)}rotate(t){let e=this.heading,i=N.fromAngle(t+e);i.mult(this.length),this.x=i.x,this.y=i.y}static add(t,e){return new N(t.x+e.x,t.y+e.y)}static sub(t,e){return new N(t.x-e.x,t.y-e.y)}static mult(t,e){return new N(t.x*e,t.y*e)}static div(t,e){return new N(t.x/e,t.y/e)}static fromAngle(t){return new N(Math.cos(t),Math.sin(t))}static lerp(t,e,i){return N.add(t,N.mult(N.sub(e,t),i))}static dist(t,e){return N.sub(t,e).length}static dot(t,e){return t.x*e.x+t.y*e.y}static cross(t,e){return t.x*e.y-t.y*e.x}static angle(t,e){return Math.acos(N.dot(t,e)/Math.sqrt(t.sqlength*e.sqlength))}static angleACW(t,e){let i=t.heading,s=e.heading,n=s-i;return n<0?2*Math.PI+n:n}static normalized(t){let e=t.length;return e===0?t:new N(t.x/e,t.y/e)}toJSObject(){let t={};return t.x=this.x,t.y=this.y,t}static fromObject(t){return new N(t.x,t.y)}};oe.exports=N}),Ut=E((ds,re)=>{var D=$(),It=class{constructor(t,e,i,s,n,l){this.pos=t.copy,this.lastPos=this.pos.copy,this.r=i,this.fc=.4,this.amc=2/5,this.rotation=0,n?this.ang=n:this.ang=0,(l||l===0)&&(this.fc=l),s?this.k=s:this.k=.8,e!=null?this.vel=e.copy:this.vel=new D(0,0),this.id="_"+Math.random().toString(36).substr(2,9)}get m(){return this.r*this.r*Math.PI}get am(){return this.amc*this.r*this.r*this.m}getAmInPoint(t){let e=this.am;return e+=D.sub(this.pos,t).sqlength*this.m,e}get copy(){let t=new It(this.pos.copy,this.vel.copy,this.r,this.k,this.ang,this.fc);return t.lastPos=this.lastPos.copy,t.rotation=this.rotation,t}move(t,e){this.pos.x+=t,this.pos.y+=e}rotate(t){this.rotation+=t}collided(t){return this.pos.dist(t.pos)<this.r+t.r}static collide(t,e){if(!t.collided(e))return;let i=t.pos,s=e.pos,n=t.r,l=e.r,o=(t.k+e.k)/2,h=t.m,a=e.m,d=D.dist(i,s),f=(t.fc+e.fc)/2,y=i.copy,g=s.copy,p=n+l-d,w=D.sub(i,s);if(w.setMag(1),w.mult(p*a/(h+a)),y.add(w),w.setMag(1),w.mult(-p*h/(h+a)),g.add(w),t.pos=y,e.pos=g,D.dot(w,D.sub(t.vel,e.vel))<0)return;w.setMag(1);let S=D.cross(w,t.vel),M=D.cross(w,e.vel),m=D.dot(w,t.vel),b=D.dot(w,e.vel),O=n*t.ang,q=l*e.ang,A=S-O,P=M+q,x=1/(1/h+n*n/t.am),X=1/(1/a+l*l/e.am),V=(A*x+P*X)/(x+X),U=V-A,K=V-P,C=U/n,H=K/l,Ht=(1+o)*((h*m+a*b)/(h+a))-o*m,Gt=(1+o)*((h*m+a*b)/(h+a))-o*b;t.vel=D.mult(w,Ht),e.vel=D.mult(w,Gt);let kt=Ht-m,Ot=Gt-b,at=-Math.sign(U)*(kt*f)/(t.amc*n),ht=Math.sign(K)*(Ot*f)/(e.amc*l);at/C>1&&(at=C),ht/H>1&&(ht=H),at*=t.amc/(t.amc+1),ht*=e.amc/(e.amc+1),t.ang-=at,e.ang+=ht;let Tt=S+at*n,bt=M+ht*l;w.rotate(Math.PI/2),t.vel.add(D.mult(w,Tt)),e.vel.add(D.mult(w,bt))}containsPoint(t){return D.dist(this.pos,t)<=this.r}toJSObject(){let t={};return t.pos=this.pos.toJSObject(),t.lastPos=this.lastPos.toJSObject(),t.r=this.r,t.fc=this.fc,t.amc=this.amc,t.rotation=this.rotation,t.ang=this.ang,t.fc=this.fc,t.k=this.k,t.vel=this.vel.toJSObject(),t.id=this.id,this.layer!=null&&(t.layer=this.layer),t}static fromObject(t){let e=new It(D.fromObject(t.pos),D.fromObject(t.vel),t.r,t.k,t.ang,t.fc);return e.lastPos=D.fromObject(t.lastPos),e.amc=t.amc,e.rotation=t.rotation,e.vel=D.fromObject(t.vel),e.id=t.id,t.layer!=null&&(e.layer=t.layer),e}};re.exports=It}),wt=E((us,ae)=>{var Z=$(),he=class{constructor(t,e){this.a=t,this.b=e}get length(){return Z.dist(this.a,this.b)}distFromPoint(t){let e=Z.sub(this.a,this.b),i=Z.sub(t,this.b),s=Z.sub(t,this.a),n=i.length,l=s.length,o=e.length;if(o===0)return n;let h=Z.angle(i,s),a=Z.angle(i,e),d=Math.PI-h-a,f=Math.sin(d)*l*o/2,y=2*f/o;return d>Math.PI/2?l:a>Math.PI/2?n:y}static intersect(t,e){let i=Z.sub(t.b,t.a),s=i.y/i.x,n=t.b.y-t.b.x*s,l=Z.sub(e.b,e.a),o=l.y/l.x,h=e.b.y-e.b.x*o;if(i.x===0&&l.x!==0){if(t.a.x>=e.a.x&&t.a.x<=e.b.x||t.a.x<=e.a.x&&t.a.x>=e.b.x){let g=o*t.a.x+h;if(g>t.a.y&&g<t.b.y||g<t.a.y&&g>t.b.y)return new Z(t.a.x,g)}return}if(l.x===0&&i.x!==0){if(e.a.x>=t.a.x&&e.a.x<=t.b.x||e.a.x<=t.a.x&&e.a.x>=t.b.x){let g=s*e.a.x+n;if(g>e.a.y&&g<e.b.y||g<e.a.y&&g>e.b.y)return new Z(e.a.x,g)}return}if(i.x===0&&l.x===0){if(t.a.x===e.a.x){let g;t.a.y<t.b.y?g=[t.a.y,t.b.y]:g=[t.b.y,t.a.y];let p;e.a.y<e.b.y?p=[e.a.y,e.b.y]:p=[e.b.y,e.a.y];let w=[g[0]>p[0]?g[0]:p[0],g[1]<p[1]?g[1]:p[1]];if(w[0]<=w[1])return new Z(t.a.x,(w[0]+w[1])/2)}return}let a;t.a.x<t.b.x?a=[t.a.x,t.b.x]:a=[t.b.x,t.a.x];let d;e.a.x<e.b.x?d=[e.a.x,e.b.x]:d=[e.b.x,e.a.x];let f=[a[0]>d[0]?a[0]:d[0],a[1]<d[1]?a[1]:d[1]];if(s===o&&n===h&&f[0]<=f[1])return new Z((f[0]+f[1])/2,(f[0]+f[1])/2*s+n);let y=(h-n)/(s-o);return y>=f[0]&&y<=f[1]?new Z(y,y*s+n):void 0}};ae.exports=he}),ue=E((cs,de)=>{var W=$(),Zt=wt(),Nt=class{constructor(t){this.points=t;let e=this.points,i=0,s=0,n=W.angleACW(W.sub(e[1],e[0]),W.sub(e[e.length-1],e[0]));this.calculateCenterAndRadius(),i+=n,s+=Math.PI*2-n;for(let l=1;l<e.length-1;l++)n=W.angleACW(W.sub(e[(l+1)%e.length],e[l]),W.sub(e[l-1],e[l])),i+=n,s+=Math.PI*2-n;if(n=W.angleACW(W.sub(e[0],e[e.length-1]),W.sub(e[e.length-2],e[e.length-1])),i+=n,s+=Math.PI*2-n,s>i)return;{let l=[];for(let o=e.length-1;o>=0;o--)l.push(e[o]);this.points=l}}collideWithBall(t){let e,i;if(this.points.forEach((s,n)=>{let l=new W(s.x,s.y);l.x-=t.pos.x,l.y-=t.pos.y,l.mult(-1),l.length<=t.r&&(e=l.heading,i=l.length),l=new W(s.x,s.y);let o=new W(this.points[(n+1)%this.points.length].x,this.points[(n+1)%this.points.length].y),h=new W(t.pos.x,t.pos.y),a=new W(o.x-l.x,o.y-l.y),d=a.heading;l.rotate(-d+Math.PI),o.rotate(-d+Math.PI),h.rotate(-d+Math.PI);let f=h.y-(l.y+o.y)/2;f>=-t.r&&f<=t.r&&h.x>=o.x&&h.x<=l.x&&(e=d-Math.PI/2,i=f)}),e===0||e){let s=new W(t.pos.x,t.pos.y),n=new W(t.vel.x,t.vel.y);if(s.rotate(-e+Math.PI/2),n.rotate(-e+Math.PI/2),n.y>0)return;n.y*=-t.k,s.y+=t.r-i;let l=n.y*(1+1/t.k),o=Math.sign(n.x-t.ang*t.r)*(l*t.fc)/(t.amc*t.r),h=(n.x-t.ang*t.r)/t.r;o/h>1&&(o=h),t.ang+=o;let a=o*t.am/t.r/t.m;n.x-=a,s.rotate(e-Math.PI/2),n.rotate(e-Math.PI/2),t.pos.x=s.x,t.pos.y=s.y,t.vel.x=n.x,t.vel.y=n.y}}containsPoint(t){let e=this.sides,i=Math.max(...this.points.map(o=>W.dist(o,t)))+1,s=W.fromAngle(0);s.setMag(i);let n=new Zt(t,W.add(s,t)),l=e.filter(o=>Zt.intersect(o,n)!=null);return l.length%2==1}calculateCenterAndRadius(){this.center=this.points.reduce((t,e)=>W.add(t,e)),this.center.div(this.points.length),this.boundRadius=Math.max(this.points.map(t=>W.dist(t,this.center)))}get sides(){return this.points.map((t,e)=>new Zt(t,this.points[(e+1)%this.points.length]))}toJSObject(){let t={};return t.points=this.points.map(e=>({x:e.x,y:e.y})),t}static fromObject(t){let e=new Nt(t.points.map(i=>new W(v.x,v.y)));return e}};de.exports=Nt}),Kt=E((fs,ce)=>{var st=$(),At=class{constructor(t,e){this.length=t,this.springConstant=e,this.pinned=!1,this.objects=[],this.rotationLocked=!1,this.id="_"+Math.random().toString(36).substr(2,9)}pinHere(t,e){this.pinned={x:t,y:e}}unpin(){this.pinned=!1}attachObject(t){let e=this.objects;e.push(t),e.length===2&&(this.pinned=!1),e.length>=3&&(e=[e[e.length-2],e[e.length-1]])}lockRotation(){this.rotationLocked=!0}unlockRotation(){this.rotationLocked=!1}update(t){let e,i;if(this.pinned&&this.objects[0]){i=this.pinned,e=this.objects[0];let s=new st(i.x-e.pos.x,i.y-e.pos.y),n=s.length-this.length;s.setMag(1),s.mult(n*this.springConstant*t/e.m),e.vel.x+=s.x,e.vel.y+=s.y;let l=e.vel;if(l.rotate(-s.heading),this.rotationLocked){let o=new st(i.x,i.y),h=st.sub(e.pos,o),a=h.length*h.length*e.m+e.am,d=(e.am*e.ang-h.length*e.m*l.y)/a;l.y=-d*h.length,e.ang=d}l.rotate(s.heading)}else if(this.objects[0]&&this.objects[1]){e=this.objects[0],i=this.objects[1];let s=st.sub(e.pos,i.pos),n=s.length-this.length;s.setMag(1),s.mult(n*this.springConstant*t),i.vel.add(st.div(s,i.m)),e.vel.add(st.div(s,-e.m)),s=st.sub(e.pos,i.pos);let l=e.vel,o=i.vel;if(l.rotate(-s.heading),o.rotate(-s.heading),this.rotationLocked){let h=new st(e.pos.x*e.m+i.pos.x*i.m,e.pos.y*e.m+i.pos.y*i.m);h.div(e.m+i.m);let a=st.sub(e.pos,h),d=st.sub(i.pos,h),f=a.length*a.length*e.m+e.am+d.length*d.length*i.m+i.am,y=(l.y-o.y)*d.length/(a.length+d.length)+o.y,g=(e.am*e.ang+i.am*i.ang-a.length*e.m*(l.y-y)+d.length*i.m*(o.y-y))/f;l.y=-g*a.length+y,o.y=+g*d.length+y,e.ang=g,i.ang=g}l.rotate(s.heading),o.rotate(s.heading)}}toJSObject(){let t={};return t.length=this.length,t.springConstant=this.springConstant,t.pinned=this.pinned,t.rotationLocked=this.rotationLocked,t.id=this.id,t.objects=this.objects.map(e=>e.id),t.type=this.__proto__==At.prototype?"spring":"stick",t}static fromObject(t,e){let i=new gi,s=i.createStickOrSpring(t.type,t.length,t.springConstant);return s.pinned=t.pinned,s.rotationLocked=t.rotationLocked,s.id=t.id,s.objects=t.objects.map(n=>{let l=e.filter(o=>n==o.id);return l[0]}),s}};function gi(){this.createStickOrSpring=function(c,t,e){let i;if(c=="spring")i=new At(t,e);else if(c=="stick"){let s=Dt();i=new s(t)}return i}}ce.exports=At}),Dt=E((gs,fe)=>{var ot=$(),pi=Kt(),ge=class extends pi{constructor(t){super(t,0);this.springConstant=0}update(t){let e,i;if(this.pinned&&this.objects[0]){i=this.pinned,e=this.objects[0];let s=new ot(i.x-e.pos.x,i.y-e.pos.y);s.setMag(1),s.mult(-this.length),e.move(-e.pos.x+i.x+s.x,-e.pos.y+i.y+s.y);let n=e.vel;if(n.rotate(-s.heading),n.x=0,this.rotationLocked){let l=new ot(i.x,i.y),o=ot.sub(e.pos,l),h=o.length*o.length*e.m+e.am,a=(e.am*e.ang-o.length*e.m*n.y)/h;n.y=-a*o.length,e.ang=a}n.rotate(s.heading)}else if(this.objects[0]&&this.objects[1]){e=this.objects[0],i=this.objects[1];let s=ot.sub(e.pos,i.pos),n=this.length-s.length;s.setMag(1);let l=ot.mult(s,n*i.m/(e.m+i.m)),o=ot.mult(s,-n*e.m/(e.m+i.m));e.move(l.x,l.y),i.move(o.x,o.y);let h=e.vel,a=i.vel;if(h.rotate(-s.heading),a.rotate(-s.heading),h.x=a.x=(e.m*h.x+i.m*a.x)/(e.m+i.m),this.rotationLocked){let d=new ot(e.pos.x*e.m+i.pos.x*i.m,e.pos.y*e.m+i.pos.y*i.m);d.div(e.m+i.m);let f=ot.sub(e.pos,d),y=ot.sub(i.pos,d),g=f.length*f.length*e.m+e.am+y.length*y.length*i.m+i.am,p=(h.y-a.y)*y.length/(f.length+y.length)+a.y,w=(e.am*e.ang+i.am*i.ang-f.length*e.m*(h.y-p)+y.length*i.m*(a.y-p))/g;h.y=-w*f.length+p,a.y=+w*y.length+p,e.ang=w,i.ang=w}h.rotate(s.heading),a.rotate(s.heading)}}};fe.exports=ge}),ye=E((ps,pe)=>{var I=$(),yi=Ut(),wi=Dt(),nt=wt(),Lt=class{constructor(t,e,i,s,n){this.points=[],s||s===0?this.fc=s:this.fc=.4,this.pressure=i,n?this.resolution=n:this.resolution=30,e=Math.abs(e),this.r=e;let l=Math.random()*1e6;for(let o=0;o<this.resolution;o++){let h=new I(t.x,t.y);h.add(I.mult(I.fromAngle(o/this.resolution*Math.PI*2),e)),this.points.push(new yi(h,new I(0,0),e*Math.sin(Math.PI/this.resolution),0,0,this.fc)),this.points[this.points.length-1].layer=l}this.sides=[];for(let o=0;o<this.resolution;o++){let h=new wi(2*e*Math.sin(Math.PI/this.resolution));h.attachObject(this.points[o]),h.attachObject(this.points[(o+1)%this.resolution]),o%2===0&&h.lockRotation(),this.sides.push(h)}}static updatePressureBasedForces(t,e){let i=[];if(i.push([]),t.points.forEach(l=>{i[0].push(new I(l.pos.x,l.pos.y))}),function(l){let o=I.angleACW(I.sub(l[1],l[0]),I.sub(l[l.length-1],l[0]));if(o>Math.PI)return!0;for(let h=1;h<l.length-1;h++)if(o=I.angleACW(I.sub(l[(h+1)%l.length],l[h]),I.sub(l[h-1],l[h])),o>Math.PI)return!0;return o=I.angleACW(I.sub(l[0],l[l.length-1]),I.sub(l[l.length-2],l[l.length-1])),o>Math.PI}(i[0])){let l=(a,d)=>{for(let f=0;f<a.length;f++)if(a[f]===d)return!0;return!1},o=function(a,d,f){for(let y=0;y<d.length;y++)if(!l(f,y)){let g=new nt(new I(d[y].x,d[y].y),new I(d[(y+1)%d.length].x,d[(y+1)%d.length].y));if(nt.intersect(a,g))return!0}return!1},h=!0;t:for(;h;){h=!1;for(let a=0;a<i.length;a++){let d=i[a],f=I.sub(d[1],d[0]),y=I.sub(d[d.length-1],d[0]),g=I.angleACW(f,y);if(g>Math.PI){h=!0;let p=0,w=p+2,S=new nt(new I(d[p].x,d[p].y),new I(d[w%d.length].x,d[w%d.length].y)),M=new I(S.b.x-S.a.x,S.b.y-S.a.y).heading;for(;!(f.heading>y.heading?M>f.heading&&M<2*Math.PI||M>0&&M<y.heading:M>f.heading&&M<y.heading)||o(new nt(new I(d[p%d.length].x,d[p%d.length].y),new I(d[w%d.length].x,d[w%d.length].y)),d,[(d.length-1)%d.length,p%d.length,(w-1)%d.length,w%d.length]);)w++,S=new nt(new I(d[p].x,d[p].y),new I(d[w%d.length].x,d[w%d.length].y)),M=new I(S.b.x-S.a.x,S.b.y-S.a.y).heading;let m=[],b=[];for(let O=p;O<=w;O++)m.push(d[O%d.length]);for(let O=w;O<=p+d.length;O++)b.push(d[O%d.length]);i[a]=m,i.push(b);continue t}for(let p=1;p<d.length;p++){let w=I.sub(d[(p+1)%d.length],d[p]),S=I.sub(d[p-1],d[p]),M=I.angleACW(w,S);if(M>Math.PI){h=!0;let m=p+2,b=new nt(new I(d[p].x,d[p].y),new I(d[m%d.length].x,d[m%d.length].y)),O=new I(b.b.x-b.a.x,b.b.y-b.a.y).heading;for(;!(w.heading>S.heading?O>w.heading&&O<2*Math.PI||O>0&&O<S.heading:O>w.heading&&O<S.heading)||o(b,d,[(p-1)%d.length,p%d.length,(m-1)%d.length,m%d.length]);)m++,b=new nt(new I(d[p].x,d[p].y),new I(d[m%d.length].x,d[m%d.length].y)),O=new I(b.b.x-b.a.x,b.b.y-b.a.y).heading;let q=[],A=[];for(let P=p;P<=m;P++)q.push(d[P%d.length]);for(let P=m;P<=p+d.length;P++)A.push(d[P%d.length]);i[a]=q,i.push(A);continue t}}}}}for(let l=i.length-1;l>=0;l--){let o=i[l];for(;o.length>3;)i.push([o[0],o[1],o[2]]),o.splice(1,1)}let s=0;i.forEach(l=>{let o=Math.sqrt(Math.pow(l[0].x-l[1].x,2)+Math.pow(l[0].y-l[1].y,2)),h=Math.sqrt(Math.pow(l[1].x-l[2].x,2)+Math.pow(l[1].y-l[2].y,2)),a=Math.sqrt(Math.pow(l[2].x-l[0].x,2)+Math.pow(l[2].y-l[0].y,2)),d=(o+h+a)/2,f=Math.sqrt(d*(d-o)*(d-h)*(d-a));s+=f});let n=t.pressure*(t.r*t.r*Math.PI/s)-t.pressure;t.sides.forEach(l=>{let o=I.sub(l.objects[0].pos,l.objects[1].pos);o.mult(n),o.rotate(Math.PI/2),o.mult(e),l.objects[0].vel.add(I.div(o,l.objects[0].m)),l.objects[1].vel.add(I.div(o,l.objects[1].m))})}get sideSegments(){return this.points.map((t,e)=>new nt(t.pos,this.points[(e+1)%this.points.length].pos))}containsPoint(t){let e=this.sideSegments,i=Math.max(...this.points.map(o=>I.dist(o.pos,t)))+1,s=I.fromAngle(0);s.setMag(i);let n=new nt(t,I.add(s,t)),l=e.filter(o=>nt.intersect(o,n)!=null);return l.length%2==1}toJSObject(){let t={};return t.pressure=this.pressure,t.fc=this.fc,t.r=this.r,t.resolution=this.resolution,t.points=this.points.map(e=>e.id),t.sides=this.sides.map(e=>e.id),t}static fromObject(t,e,i){let s=Object.create(Lt.prototype);return console.log(s),s.pressure=t.pressure,s.fc=t.fc,s.resolution=t.resolution,s.r=t.r,s.points=t.points.map(n=>{let l=e.filter(o=>n==o.id);return l[0]}),s.sides=t.sides.map(n=>{let l=i.filter(o=>n==o.id);return l[0]}),s}};pe.exports=Lt}),me=E((ys,we)=>{var u=$(),L=wt(),jt=class{constructor(t,e,i,s,n){this.points=t;let l=this.points,o=0,h=0,a=u.angleACW(u.sub(l[1],l[0]),u.sub(l[l.length-1],l[0]));o+=a,h+=Math.PI*2-a;for(let d=1;d<l.length-1;d++)a=u.angleACW(u.sub(l[(d+1)%l.length],l[d]),u.sub(l[d-1],l[d])),o+=a,h+=Math.PI*2-a;if(a=u.angleACW(u.sub(l[0],l[l.length-1]),u.sub(l[l.length-2],l[l.length-1])),o+=a,h+=Math.PI*2-a,h<o){let d=[];for(let f=l.length-1;f>=0;f--)d.push(l[f]);this.points=d}this.calculatePosAndMass(),this.lastPos=this.pos.copy,this.fc=.4,this.rotation=0,s?this.ang=s:this.ang=0,(n||n===0)&&(this.fc=n),i?this.k=i:this.k=.8,e!=null?this.vel=e.copy:this.vel=new u(0,0),this.id="_"+Math.random().toString(36).substr(2,9)}getAmInPoint(t){let e=this.am;return e+=u.sub(this.pos,t).sqlength*this.m,e}get copy(){let t=[];for(let i=0;i<this.points.length;i++)t.push(new u(this.points[i].x,this.points[i].y));let e=new jt(t,this.vel.copy,this.k,this.ang,this.fc);return e.rotation=this.rotation,e.lastPos=this.lastPos.copy,e.pos=this.pos.copy,e}move(t,e){this.pos.x+=t,this.pos.y+=e,this.points.forEach(i=>{i.x+=t,i.y+=e})}collideWithBall(t){let e,i,s;if(u.dist(t.pos,this.pos)>t.r+this.boundRadius)return;if(this.points.forEach((n,l)=>{let o=new u(n.x,n.y);if(o.x-=t.pos.x,o.y-=t.pos.y,o.length<=t.r){e=o.heading+Math.PI,i=o.length;let g=u.fromAngle(e);g.mult(t.r-i),this.move(g.x*-1*t.m/(this.m+t.m),g.y*-1*t.m/(this.m+t.m)),t.move(g.x*1*this.m/(this.m+t.m),g.y*1*this.m/(this.m+t.m)),s=new u(n.x,n.y);let p=u.fromAngle(e);p.mult(-30)}o=new u(n.x,n.y);let h=new u(this.points[(l+1)%this.points.length].x,this.points[(l+1)%this.points.length].y),a=new u(t.pos.x,t.pos.y),d=new u(h.x-o.x,h.y-o.y),f=d.heading;o.rotate(-f+Math.PI),h.rotate(-f+Math.PI),a.rotate(-f+Math.PI);let y=a.y-(o.y+h.y)/2;if(y>=-t.r&&y<=t.r&&a.x>=h.x&&a.x<=o.x){e=f-Math.PI/2,i=y;let g=u.fromAngle(e);g.mult(t.r-i),this.move(g.x*-1*t.m/(this.m+t.m),g.y*-1*t.m/(this.m+t.m)),t.move(g.x*1*this.m/(this.m+t.m),g.y*1*this.m/(this.m+t.m)),s=t.pos.copy,s.add(u.mult(u.fromAngle(e+Math.PI),y));let p=u.fromAngle(e);p.mult(-30)}}),e===0||e){let n=this.vel.copy,l=t.vel.copy,o=this.ang,h=t.ang,a=u.sub(s,this.pos),d=u.sub(s,t.pos),f=this.am,y=t.am,g=this.m,p=t.m,w=(this.k+t.k)/2,S=(this.fc+t.fc)/2,M=a.copy,m=d.copy;M.rotate(Math.PI/2),m.rotate(-Math.PI/2),M.mult(o),m.mult(h),M.add(n),m.add(l),M.rotate(-e),m.rotate(-e);let b=(1+w)*(g*M.x+p*m.x)/(g+p)-(w+1)*M.x,O=(1+w)*(g*M.x+p*m.x)/(g+p)-(w+1)*m.x,q=(M.y*g+m.y*p)/(g+p),A=-Math.sign(M.y)*S*b,P=-Math.sign(m.y)*S*O;Math.abs(q-M.y)>Math.abs(A)&&(A=q-M.y),Math.abs(q-m.y)>Math.abs(P)&&(P=q-m.y);let x=new u(b,A),X=new u(O,P);x.rotate(e),X.rotate(e),n.add(x),l.add(X),x.rotate(-a.heading),X.rotate(-d.heading);let V=x.y*g*a.length/(f+a.length*a.length*g),U=-(X.y*p*d.length)/(y+d.length*d.length*p);o+=V,h+=U;let K=u.fromAngle(a.heading-Math.PI/2);K.mult(a.length*V);let C=u.fromAngle(d.heading-Math.PI/2);C.mult(d.length*U),l.sub(C),n.add(K),this.vel=n,t.vel=l,this.ang=o,t.ang=h}}calculatePosAndMass(){let t=[];if(t.push([]),this.points.forEach(n=>{t[0].push(new u(n.x,n.y))}),this.isConcave){let n=(h,a)=>{for(let d=0;d<h.length;d++)if(h[d]===a)return!0;return!1},l=function(h,a,d){for(let f=0;f<a.length;f++)if(!n(d,f)){let y=new L(new u(a[f].x,a[f].y),new u(a[(f+1)%a.length].x,a[(f+1)%a.length].y));if(L.intersect(h,y))return!0}return!1},o=!0;t:for(;o;){o=!1;for(let h=0;h<t.length;h++){let a=t[h],d=u.sub(a[1],a[0]),f=u.sub(a[a.length-1],a[0]),y=u.angleACW(d,f);if(y>Math.PI){o=!0;let g=0,p=g+2,w=new L(new u(a[g].x,a[g].y),new u(a[p%a.length].x,a[p%a.length].y)),S=new u(w.b.x-w.a.x,w.b.y-w.a.y).heading;for(;!(d.heading>f.heading?S>d.heading&&S<2*Math.PI||S>0&&S<f.heading:S>d.heading&&S<f.heading)||l(new L(new u(a[g%a.length].x,a[g%a.length].y),new u(a[p%a.length].x,a[p%a.length].y)),a,[(a.length-1)%a.length,g%a.length,(p-1)%a.length,p%a.length]);)p++,w=new L(new u(a[g].x,a[g].y),new u(a[p%a.length].x,a[p%a.length].y)),S=new u(w.b.x-w.a.x,w.b.y-w.a.y).heading;let M=[],m=[];for(let b=g;b<=p;b++)M.push(a[b%a.length]);for(let b=p;b<=g+a.length;b++)m.push(a[b%a.length]);t[h]=M,t.push(m);continue t}for(let g=1;g<a.length;g++){let p=u.sub(a[(g+1)%a.length],a[g]),w=u.sub(a[g-1],a[g]),S=u.angleACW(p,w);if(S>Math.PI){o=!0;let M=g+2,m=new L(new u(a[g].x,a[g].y),new u(a[M%a.length].x,a[M%a.length].y)),b=new u(m.b.x-m.a.x,m.b.y-m.a.y).heading;for(;!(p.heading>w.heading?b>p.heading&&b<2*Math.PI||b>0&&b<w.heading:b>p.heading&&b<w.heading)||l(m,a,[(g-1)%a.length,g%a.length,(M-1)%a.length,M%a.length]);)M++,m=new L(new u(a[g].x,a[g].y),new u(a[M%a.length].x,a[M%a.length].y)),b=new u(m.b.x-m.a.x,m.b.y-m.a.y).heading;let O=[],q=[];for(let A=g;A<=M;A++)O.push(a[A%a.length]);for(let A=M;A<=g+a.length;A++)q.push(a[A%a.length]);t[h]=O,t.push(q);continue t}}}}}for(let n=t.length-1;n>=0;n--){let l=t[n];for(;l.length>3;)t.push([l[0],l[1],l[2]]),l.splice(1,1)}let e=0,i=0,s=new u(0,0);t.forEach(n=>{let l=Math.sqrt(Math.pow(n[0].x-n[1].x,2)+Math.pow(n[0].y-n[1].y,2)),o=Math.sqrt(Math.pow(n[1].x-n[2].x,2)+Math.pow(n[1].y-n[2].y,2)),h=Math.sqrt(Math.pow(n[2].x-n[0].x,2)+Math.pow(n[2].y-n[0].y,2)),a=(l+o+h)/2,d=Math.sqrt(a*(a-l)*(a-o)*(a-h));e+=d,s.x+=d*(n[0].x+n[1].x+n[2].x)/3,s.y+=d*(n[0].y+n[1].y+n[2].y)/3}),s.div(e),this.pos=s,this.m=e;for(let n of t){let l=Math.sqrt(Math.pow(n[0].x-n[1].x,2)+Math.pow(n[0].y-n[1].y,2)),o=Math.sqrt(Math.pow(n[1].x-n[2].x,2)+Math.pow(n[1].y-n[2].y,2)),h=Math.sqrt(Math.pow(n[2].x-n[0].x,2)+Math.pow(n[2].y-n[0].y,2)),a=Math.max(l,o,h),d=(l+o+h)/2,f=Math.sqrt(d*(d-l)*(d-o)*(d-h)),y=2*f/a,g=Math.sqrt(Math.min(l,h,o)**2-y*y),p=y*a*(y*y+a*a)/24,w=Math.sqrt(y*y/36+(Math.abs(g-a/2)/3)**2);p-=w*w*f,p+=new u((n[0].x+n[1].x+n[2].x)/3,(n[0].y+n[1].y+n[2].y)/3).dist(this.pos)**2*f,i+=p}this.am=i,this.boundRadius=Math.max(...this.points.map(n=>u.dist(n,this.pos)))}rotate(t){this.points.forEach(e=>{let i=new u(e.x,e.y);i.sub(this.pos),i.rotate(t),i.add(this.pos),e.x=i.x,e.y=i.y}),this.rotation+=t}get isConcave(){let t=this.points,e=u.angleACW(u.sub(t[1],t[0]),u.sub(t[t.length-1],t[0]));if(e>Math.PI)return!0;for(let i=1;i<t.length-1;i++)if(e=u.angleACW(u.sub(t[(i+1)%t.length],t[i]),u.sub(t[i-1],t[i])),e>Math.PI)return!0;return e=u.angleACW(u.sub(t[0],t[t.length-1]),u.sub(t[t.length-2],t[t.length-1])),e>Math.PI}static collide(t,e){let i=0,s=0,n=new u(0,0),l=[],o=!1;if(t.points.forEach((P,x)=>{let X=new L(new u(P.x,P.y),new u(t.points[(x+1)%t.points.length].x,t.points[(x+1)%t.points.length].y));e.points.forEach((V,U)=>{let K=new L(new u(V.x,V.y),new u(e.points[(U+1)%e.points.length].x,e.points[(U+1)%e.points.length].y)),C=L.intersect(X,K);C&&(i++,n.add(C),l.push(C),o=!0)})}),!o)return;n.div(i);for(let P=0;P<Math.floor(i/2);P++)s+=u.sub(l[2*P+1],l[2*P]).heading;s/=i/2,s+=Math.PI/2;let h=u.fromAngle(s),a=t.ang,d=t.vel.copy,f=e.ang,y=e.vel.copy,g=0,p=0,w=0,S=0;for(let P of t.points)g=Math.min(u.dot(h,u.sub(new u(P.x,P.y),n)),g),p=Math.max(u.dot(h,u.sub(new u(P.x,P.y),n)),p);for(let P of e.points)w=Math.min(u.dot(h,u.sub(new u(P.x,P.y),n)),w),S=Math.max(u.dot(h,u.sub(new u(P.x,P.y),n)),S);Math.abs(g-S)<Math.abs(w-p)?(t.move(-h.x*g,-h.y*g),e.move(-h.x*S,-h.y*S)):(t.move(-h.x*p,-h.y*p),e.move(-h.x*w,-h.y*w));let M=(t.k+e.k)/2,m=l,b=[],O=[],q=[],A=[];for(let P of m){let x=u.fromAngle(s),X=t.vel,V=e.vel,U=t.pos,K=e.pos,C=u.sub(U,P),H=u.sub(K,P),Ht=u.angleACW(x,C),Gt=u.angleACW(x,H),kt=u.angle(x,C),Ot=u.angle(x,H),at=X.copy,ht=V.copy,Tt=C.copy,bt=H.copy;Tt.mult(-1*t.ang),bt.mult(-1*e.ang),bt.rotate(Math.PI/2),bt.rotate(Math.PI/2),at.add(Tt),ht.add(bt);let et=u.dot(x,at),it=u.dot(x,ht);if(u.dot(x,C)>u.dot(x,H)){if(et>=it)return}else if(it>=et)return;let Wt=t.m*Math.abs(Math.cos(kt))+Math.abs(Math.sin(kt))*t.am/C.length/C.length,Vt=e.m*Math.abs(Math.cos(Ot))+Math.abs(Math.sin(Ot))*e.am/H.length/H.length,ft=(1+M)*((Wt*et+Vt*it)/(Wt+Vt))-M*et,gt=(1+M)*((Wt*et+Vt*it)/(Wt+Vt))-M*it,Q,_;u.dot(x,C)>u.dot(x,H)?(gt>=ft,Q=u.mult(u.normalized(x),-ft+et),_=u.mult(u.normalized(x),-gt+it)):(gt<=ft,Q=u.mult(u.normalized(x),-ft+et),_=u.mult(u.normalized(x),-gt+it)),Q=u.mult(u.normalized(x),ft-et),_=u.mult(u.normalized(x),gt-it);let vt=Q.copy,Mt=_.copy;Q.mult(Math.cos(kt)),_.mult(Math.cos(Ot)),u.dot(Q,C)<0&&Q.mult(-1),u.dot(_,H)<0&&_.mult(-1),t.vel.add(Q),e.vel.add(_),vt.sub(u.mult(x,u.dot(x,Q))),vt.div(C.length),vt.rotate(Math.PI/2),vt=u.dot(vt,C)/C.length,t.ang+=vt,Mt.sub(u.mult(x,u.dot(x,_))),Mt.div(H.length),Mt.rotate(Math.PI/2),Mt=u.dot(Mt,H)/H.length,e.ang+=Mt,b.push(t.ang),q.push(t.vel),O.push(e.ang),A.push(e.vel),t.ang=a,t.vel=d,e.ang=f,e.vel=y;break}if(b.length!=q.length)return;if(b.length==0)return;if(q.length==0)return;if(O.length!=A.length)return;if(O.length==0)return;if(A.length==0)return;t.vel=q.reduce((P,x)=>u.add(P,x)),t.vel.div(q.length),t.ang=b.reduce((P,x)=>P+x),t.ang/=b.length,e.vel=A.reduce((P,x)=>u.add(P,x)),e.vel.div(A.length),e.ang=O.reduce((P,x)=>P+x),e.ang/=O.length}collideWithFixedBall(t){let e=new u(t.x,t.y),i;if(u.dist(e,this.pos)>this.boundRadius+t.r)return;for(let O of this.sides){let q,A;if(q=u.angle(u.sub(O.a,O.b),u.sub(e,O.b)),A=u.angle(u.sub(O.b,O.a),u.sub(e,O.a)),q<Math.PI/2&&A<Math.PI/2){let P=O.distFromPoint(e);if(P<=t.r){let x=u.sub(O.a,O.b);x.rotate(Math.PI/2),x.setMag(t.r*2);let X=u.mult(x,-1),V=new L(u.add(x,e),u.add(X,e));i=L.intersect(V,O),i!=null&&(x=u.sub(i,e),x.setMag(t.r-x.length),this.move(x.x,x.y))}}}if(!i||i==null){t:for(let O of this.points)if(u.dist(O,e)<t.r){let q=u.sub(O,e);q.setMag(t.r-q.length),this.move(q.x,q.y),q.setMag(t.r),i=u.add(e,q);break t}}if(!i||i==null)return;let s=this.vel,n=this.pos,l=u.sub(i,e);l.setMag(1);let o=u.sub(n,i),h=u.angleACW(l,o),a=s.copy,d=o.copy;d.mult(-1*this.ang),d.rotate(Math.PI/2),a.add(d);let f=u.dot(l,a);if(f>=0)return;f*=1+this.k;let y=u.mult(u.normalized(l),-1*f),g=y.copy;y.mult(Math.cos(h)),this.vel.add(y),g=g.length/o.length,g*=Math.sin(h),this.ang+=g;let p=this.m*Math.abs(Math.cos(h))+this.am/o.length/o.length*Math.abs(Math.sin(h)),w=this.m*Math.abs(Math.sin(h))+this.am/o.length/o.length*Math.abs(Math.cos(h));y=u.mult(u.normalized(l),-1*f);let S=l.copy;if(S.rotate(Math.PI/2),S.mult(Math.sign(u.dot(S,a))),S.length==0)return;let M=u.dot(a,S),m=u.mult(y,p),b=u.div(m,w);w==0&&(b=0),b.mult(this.fc),b=u.mult(S,b.length),b.length>M&&b.setMag(M),h=u.angleACW(S,o),y=b,g=y.copy,y.mult(Math.cos(h)),this.vel.add(y),g=g.length/o.length,g*=Math.sin(h),this.ang-=g}collideWithWall(t){if(this.boundRadius+t.boundRadius<u.dist(this.pos,t.center))return;let e=this.sides,i=[],s=[];for(let p of e)for(let w of t.sides){let S=L.intersect(p,w);S!=null&&s.push(S)}if(s.length<2)return;let n=this.vel.copy,l=this.ang,o=[],h=[],a=u.sub(...s);a.rotate(Math.PI/2);let d=u.sub(s[0],this.pos);u.dot(a,d)>0&&a.mult(-1),a.setMag(1),u.dot(a,u.sub(this.pos,t.center))<0&&a.mult(-1),i.push(new L(...s)),i.push(new L(s[0],u.add(s[0],u.mult(a,20)))),i.push(new L(s[1],u.add(s[1],u.mult(a,20))));let f=[],y=s[0];for(let p of t.points){let w=u.sub(p,y),S=u.dot(w,a);S>0&&f.push(S)}if(f.length>0){let p=a.copy;p.mult(Math.max(...f)),this.move(p.x,p.y)}f=[];let g=u.add(...s);if(g.div(2),this.containsPoint(g))for(let p of e)f.push(p.distFromPoint(g));if(f.length>0){let p=a.copy;p.mult(Math.min(...f)),p.length<this.boundRadius/2&&this.move(p.x,p.y)}for(let p of s){let w=this.vel,S=this.pos,M=u.sub(S,p),m=u.angleACW(a,M),b=w.copy,O=M.copy;O.mult(-1*this.ang),O.rotate(Math.PI/2),b.add(O);let q=u.dot(a,b);if(q>=0)return;q*=1+this.k;let A=u.mult(u.normalized(a),-1*q),P=A.copy;A.mult(Math.cos(m)),this.vel.add(A),P=P.length/M.length,P*=Math.sin(m),this.ang+=P;let x=this.m*Math.abs(Math.cos(m))+this.am/M.length/M.length*Math.abs(Math.sin(m)),X=this.m*Math.abs(Math.sin(m))+this.am/M.length/M.length*Math.abs(Math.cos(m));A=u.mult(u.normalized(a),-1*q);let V=a.copy;if(V.rotate(Math.PI/2),V.mult(Math.sign(u.dot(V,b))),V.length==0)return;let U=u.dot(b,V),K=u.mult(A,x),C=u.div(K,X);X==0&&(C=0),C.mult(this.fc),C=u.mult(V,C.length),C.length>U&&C.setMag(U),m=u.angleACW(V,M),A=C,P=A.copy,A.mult(Math.cos(m)),this.vel.add(A),P=P.length/M.length,P*=Math.sin(m),this.ang-=P,o.push(this.vel),this.vel=n.copy,h.push(this.ang),this.ang=l}return h.length!=o.length||(h.length==0||o.length==0)?void 0:(this.vel=o.reduce((p,w)=>u.add(p,w)),this.vel.div(o.length),this.ang=h.reduce((p,w)=>p+w),this.ang/=h.length,(!isFinite(this.vel.x)||!isFinite(this.vel.y)||!isFinite(this.ang))&&(this.vel=n,this.ang=l),i)}containsPoint(t){let e=this.sides,i=Math.max(...this.points.map(o=>u.dist(o,t)))+1,s=u.fromAngle(0);s.setMag(i);let n=new L(t,u.add(s,t)),l=e.filter(o=>L.intersect(o,n)!=null);return l.length%2==1}get sides(){return this.points.map((t,e)=>new L(t,this.points[(e+1)%this.points.length]))}toJSObject(){let t={};return t.points=this.points.map(e=>({x:e.x,y:e.y})),t.vel=this.vel.toJSObject(),t.k=this.k,t.ang=this.ang,t.fc=this.fc,t.pos=this.pos.toJSObject(),t.lastPos=this.lastPos.toJSObject(),t.rotation=this.rotation,t.id=this.id,t}static fromObject(t){let e=new jt(t.points.map(i=>({x:i.x,y:i.y})),u.fromObject(t.vel),t.k,t.ang,t.fc);return e.id=t.id,e.pos=u.fromObject(t.pos),e.lastPos=u.fromObject(t.lastPos),e.rotation=t.rotation,e}};we.exports=jt}),Qt=E((ws,xe)=>{var G=$(),mi=wt(),be=class extends mi{constructor(t,e){super(t,e)}get length(){return Number.POSITIVE_INFINITY}distFromPoint(t){let e=G.sub(this.a,this.b);e.setMag(1),e.rotate(Math.PI/2);let i=G.sub(t,this.a),s=Math.abs(G.dot(i,e));return s}static intersect(t,e){let i=G.sub(t.b,t.a),s=i.y/i.x,n=t.b.y-t.b.x*s,l=G.sub(e.b,e.a),o=l.y/l.x,h=e.b.y-e.b.x*o;if(s===o)return t.distFromPoint(e.a)==0?new G((t.a.x+t.b.x+e.a.x+e.b.x)/4,(t.a.y+t.b.y+e.a.y+e.b.y)/4):void 0;{let a=(h-n)/(s-o);return new G(a,s*a+n)}}static intersectWithLineSegment(t,e){let i=G.sub(t.b,t.a),s=i.y/i.x,n=t.b.y-t.b.x*s,l=G.sub(e.b,e.a),o=l.y/l.x,h=e.b.y-e.b.x*o;if(i.x===0){if(l.x===0)return t.a.x==e.a.x?new G((e.a.x+e.b.x)/2,(e.a.y+e.b.y)/2):void 0;let a=t.a.x,d=o*a+h;return Math.min(e.a.x,e.b.x)<a&&a<Math.max(e.a.x,e.b.x)&&Math.min(e.a.y,e.b.y)<d&&Math.max(e.a.y,e.b.y)>d?new G(a,d):void 0}if(l.x===0){let a=e.a.x,d=s*a+n;return Math.min(e.a.x,e.b.x)<a&&a<Math.max(e.a.x,e.b.x)&&Math.min(e.a.y,e.b.y)<d&&Math.max(e.a.y,e.b.y)>d?new G(a,d):void 0}if(s===o)return t.distFromPoint(e.a)===0?new G((e.a.x+e.b.x)/2,(e.a.y+e.b.y)/2):void 0;{let a=(h-n)/(s-o),d=s*a+n;return Math.min(e.a.x,e.b.x)<a&&a<Math.max(e.a.x,e.b.x)&&Math.min(e.a.y,e.b.y)<d&&Math.max(e.a.y,e.b.y)>d?new G(a,d):void 0}}};xe.exports=be}),Me=E((ms,ve)=>{var F=$(),qt=wt(),Rt=Qt(),lt=class{constructor(t){if(t.length<3)throw new Error("Not enough points in polygon (minimum required: 3)");this.points=t,this.makeAntiClockwise()}getSideVector(t){return t<0&&(t+=Math.abs(Math.floor(t))*this.points.length),F.sub(this.points[(t+1)%this.points.length],this.points[t%this.points.length])}getSideSegment(t){return t<0&&(t+=Math.abs(Math.floor(t))*this.points.length),new qt(this.points[(t+1)%this.points.length],this.points[t%this.points.length])}getSideLine(t){return t<0&&(t+=Math.abs(Math.floor(t))*this.points.length),new Rt(this.points[(t+1)%this.points.length],this.points[t%this.points.length])}get sides(){return this.points.length}makeAntiClockwise(){let t=0;for(let e=1;e<=this.sides;e++){let i=this.getSideVector(e),s=this.getSideVector(e-1);s.mult(-1),t+=F.angleACW(i,s)}if(this.sides===3)t>Math.PI*1.5&&this.reverseOrder();else if(this.sides===4)F.angleACW(this.getSideVector(1),this.getSideVector(0))>=Math.PI&&this.reverseOrder();else if(this.sides>4){let e=t-this.sides*Math.PI;e>0&&this.reverseOrder()}}reverseOrder(){this.points=this.points.reverse()}isPointInside(t){if(F.dist(t,this.centerPoint)>this.boundRadius)return!1;let e=this.centerPoint.copy;e.add(F.mult(new F(1.1,.6),this.boundRadius));let i=new qt(t,e),s=0;if([...Array(this.sides).keys()].map(n=>this.getSideSegment(n)).forEach(n=>{qt.intersect(n,i)&&s++}),s%2==0)return!1;if(s%2==1)return!0}get centerPoint(){let t=new F(0,0);return this.points.forEach(e=>{t.add(e)}),t.div(this.sides),t}get boundRadius(){let t=this.centerPoint;return Math.max(...this.points.map(e=>F.dist(e,t)))}get allSides(){return[...Array(this.sides).keys()].map(t=>this.getSideSegment(t))}static intersection(t,e){if(F.dist(t.centerPoint,e.centerPoint)>t.boundRadius+e.boundRadius)return;let i=[],s=t.allSides,n=e.allSides;if(s.forEach((f,y)=>{n.forEach((g,p)=>{let w=qt.intersect(f,g);w&&(w.isIntersectionPoint=!0,i.push({intersectionPoint:w,sideNumber1:y,sideNumber2:p}))})}),i.length===0){if(t.isPointInside(e.points[0]))return new lt(e.points.map(f=>f.copy));if(e.isPointInside(t.points[0]))return new lt(t.points.map(f=>f.copy))}let l=new lt(t.points.map(f=>f.copy));for(let f=l.points.length-1;f>=0;f--){let y=i.filter(g=>g.sideNumber1==f);y.length>1&&y.sort((g,p)=>F.dist(l.points[f],g.intersectionPoint)-F.dist(l.points[f],p.intersectionPoint)),y.length>0&&l.points.splice(f+1,0,...y.map(g=>g.intersectionPoint))}let o=new lt(e.points.map(f=>f.copy));for(let f=o.points.length-1;f>=0;f--){let y=i.filter(g=>g.sideNumber2==f);y.length>1&&y.sort((g,p)=>F.dist(o.points[f],g.intersectionPoint)-F.dist(o.points[f],p.intersectionPoint)),y.length>0&&o.points.splice(f+1,0,...y.map(g=>g.intersectionPoint))}let h={polyNum:1,pointNum:0};for(let f=0;f<l.points.length;f++)if(l.points[f].isIntersectionPoint){h.pointNum=f;break}else if(o.isPointInside(l.points[f])){h.pointNum=f;break}let a=!1,d=[];for(;!a;){let f=h.polyNum===1?l:o,y=h.polyNum===1?o:l;if(d.push(f.points[h.pointNum%f.points.length].copy),d.length>2&&d[0].x==d[d.length-1].x&&d[0].y==d[d.length-1].y){d.pop();break}if(d.length>l.points.length+o.points.length)break;f.points[h.pointNum%f.points.length].isIntersectionPoint?f.points[(h.pointNum+1)%f.points.length].isIntersectionPoint||y.isPointInside(f.points[(h.pointNum+1)%f.points.length])&&!f.points[(h.pointNum+1)%f.points.length].isIntersectionPoint?h.pointNum++:(h.pointNum=y.points.indexOf(f.points[h.pointNum%f.points.length])+1,h.polyNum=h.polyNum===1?2:1):h.pointNum++}return new lt(d)}static createCircle(t,e,i=25){let s=[...Array(i).keys()].map(n=>{let l=F.fromAngle(2*Math.PI*n/i);return l.setMag(t),l.add(e),l});return new lt(s)}static fracture(t,e=500){let i=t.map((s,n)=>{let l=[];for(let h=0;h<t.length;h++){if(n===h)continue;let a=t[h],d=F.div(F.add(s,a),2),f=F.sub(s,a);f.rotate(Math.PI/2),l.push(new Rt(d,F.add(f,d)))}l=l.filter((h,a)=>{let d=new qt(h.a,s);for(let f=0;f<l.length;f++){if(a===f)continue;let y=Rt.intersectWithLineSegment(l[f],d);if(y)return!1}return!0}),l=l.sort((h,a)=>F.sub(h.a,h.b).heading-F.sub(a.a,a.b).heading);let o=l.map((h,a)=>{let d=[];for(let y=0;y<l.length;y++){if(a===y)continue;let g=Rt.intersect(h,l[y]);g&&d.push(g)}let f=F.sub(h.a,h.b);return d=d.filter(y=>{let g=F.sub(y,s);f.setMag(1);let p=F.dot(g,f);return p>0}),d.length===0&&d.push(F.add(F.mult(f,e*1.2),h.a)),d=d.sort((y,g)=>F.dist(y,s)-F.dist(g,s)),d[0]});return o});return i.filter(s=>s.length>=3).map(s=>new lt(s))}};ve.exports=lt}),Pe=E(mt=>{mt.codeTable="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".split("");mt.arrayBuffertoBase64=c=>{let t="",e=new Uint8Array(c),i=[];e.forEach(s=>{let n=s.toString(2);n.length<8&&(n="0".repeat(8-n.length)+n),i.push(n)}),i=i.reduce((s,n)=>s+n);for(let s=0;s<i.length;s+=6){let n=i.slice(s,s+6);n.length<6?(n+="0".repeat(6-n.length),t+=mt.codeTable[Number.parseInt(n,2)],t+="=",t.length%4!=0&&(t+="=")):t+=mt.codeTable[Number.parseInt(n,2)]}return t};mt.base64ToArrayBuffer=c=>{let t="";for(let n=0;n<c.length/4;n++){let l=c.slice(n*4,(n+1)*4);for(let o=0;o<l.length;o++)if(l[o]!="="){let h=mt.codeTable.indexOf(l[o]).toString(2);h.length<6&&(h="0".repeat(6-h.length)+h),t=t+h}}t=t.slice(0,t.length-t.length%8);let e=t.match(/.{8}/g).map(n=>Number.parseInt(n,2)),i=new ArrayBuffer(e.length),s=new DataView(i);return e.forEach((n,l)=>{s.setUint8(l,n)}),i}}),Oe=E((bs,Se)=>{var ke=Pe();Se.exports=new function(){this.compress=c=>{let t=(" "+c).slice(1),e=[];t=t.replace(/:-?\d+\.?\d*/g,d=>(d=d.slice(1),e.push(Number.parseFloat(d)),":#\uFE0F\u20E3"));let i=new ArrayBuffer(e.length*8),s=new DataView(i);e.forEach((d,f)=>{s.setFloat64(f*8,d)});let n=ke.arrayBuffertoBase64(i),l=[/false/g,/true/g,/"[a-zA-Z0-9_.]*"/g],o=new Map;l.forEach(d=>{let f=t.match(d);f&&f.length>0&&f.forEach(y=>{o.has(y)?o.set(y,o.get(y)+y.length):o.set(y,y.length)})});let h=new Map([...o.entries()].sort((d,f)=>d[1]<f[1]?1:-1));delete o,t.replace(/(\r\n|\n|\r)/gm,"");let a=0;for(let d of h)h.set(d[0],"_"+a.toString(36)+"_"),t=t.replace(new RegExp(d[0],"g"),"_"+a.toString(36)+"_"),a++;return delete a,JSON.stringify([...h])+"endoftheentries"+t+"endoftheentries"+n},this.uncompress=c=>{let t=c.split("endoftheentries"),e=JSON.parse(t[0]),i=t[1],s=t[2],n=ke.base64ToArrayBuffer(s),l=new DataView(n),o=[];for(let h=0;h<n.byteLength;h+=8)o.push(l.getFloat64(h));return i=i.replace(/:#️⃣/g,h=>":"+o.shift().toString()),e.forEach(h=>{i=i.replace(new RegExp(h[1],"g"),h[0])}),i}}}),Ae=E((vs,Ie)=>{Ie.exports={name:"ballphysics",version:"1.6.0",description:"2D rigid body physics engine to-be",main:"./src/physics.js",scripts:{test:"jest --verbose ./tests",build:"esbuild editor/src/index.js --bundle --minify --sourcemap --target=chrome58,firefox57,safari11,edge16 --outfile=dest/main.js && cp editor/static/index.html dest/index.html"},repository:{type:"git",url:"git+https://github.com/AkosSeres/BallPhysics.git"},keywords:["physics","2d","rigid","balls"],author:"Akos Seres",license:"LGPL-2.1",bugs:{url:"https://github.com/AkosSeres/BallPhysics/issues"},homepage:"https://github.com/AkosSeres/BallPhysics#readme",devDependencies:{esbuild:"^0.8.26",eslint:"^6.0.1","eslint-config-google":"^0.9.1",jest:"^26.4.2"},dependencies:{}}}),ut=E((Ms,je)=>{var B=$(),_t=Ut(),Ct=ue(),xi=wt(),qe=Dt(),dt=Kt(),Jt=ye(),Bt=me(),bi=Qt(),vi=Me(),Ce=Oe(),R=class{constructor(){this.balls=[],this.bodies=[],this.fixedBalls=[],this.softBalls=[],this.walls=[],this.bounds=[],this.springs=[],this.airFriction=1,this.gravity=new B(0,0),this.debugData=[]}update(t,e){this.debugData=[];let i=e?this.copy:new R;e&&(i.bodies.reverse(),i.balls.reverse(),i.update(t,!1));for(let s=0;s<this.balls.length;s++)this.balls[s].lastPos=this.balls[s].pos.copy,this.balls[s].pos.add(B.mult(this.balls[s].vel,t)),this.balls[s].rotation+=this.balls[s].ang*t,this.balls[s].rotation%=Math.PI*2;for(let s=0;s<this.bodies.length;s++)this.bodies[s].lastPos=this.bodies[s].pos.copy,this.bodies[s].move(this.bodies[s].vel.x*t,this.bodies[s].vel.y*t),this.bodies[s].rotate(this.bodies[s].ang*t);for(let s=0;s<3;s++)for(let n of this.springs)n.update(t/3/2);for(let s=0;s<this.balls.length;s++){this.gravity&&this.balls[s].vel.add(new B(this.gravity.x*t,this.gravity.y*t));for(let n=s+1;n<this.balls.length;n++)(this.balls[s].layer!=this.balls[n].layer||!this.balls[s].layer&&!this.balls[n].layer)&&_t.collide(this.balls[s],this.balls[n]);for(let n of this.walls)n.collideWithBall(this.balls[s]);for(let n of this.fixedBalls){let l=this.balls[s],o,h=0,a=new B(n.x,n.y);a.x-=l.pos.x,a.y-=l.pos.y,a.mult(-1),a.length<=l.r+n.r&&(o=a.heading,h=a.length);t:if(o===0||o){let d=new B(l.pos.x,l.pos.y),f=new B(l.vel.x,l.vel.y);if(d.rotate(-o+Math.PI/2),f.rotate(-o+Math.PI/2),f.y>0)break t;f.y*=-l.k,d.y+=l.r+n.r-h;let y=f.y*(1+1/l.k),g=Math.sign(f.x-l.ang*l.r)*(y*l.fc)/(l.amc*l.r),p=(f.x-l.ang*l.r)/l.r;g/p>1&&(g=p),g*=l.amc/(l.amc+1),l.ang+=g;let w=g*l.r;f.x-=w,d.rotate(o-Math.PI/2),f.rotate(o-Math.PI/2),l.pos.x=d.x,l.pos.y=d.y,l.vel.x=f.x,l.vel.y=f.y}}for(let n of this.bounds)n.collideWithBall(this.balls[s])}for(let s=0;s<this.bodies.length;s++){for(let n of this.balls)(n.layer!=this.bodies[s].layer||!n.layer&&!this.bodies[s].layer)&&this.bodies[s].collideWithBall(n);for(let n=s+1;n<this.bodies.length;n++)(this.bodies[s].layer!=this.bodies[n].layer||!this.bodies[n].layer&&!this.bodies[s].layer)&&Bt.collide(this.bodies[s],this.bodies[n]);for(let n of this.bodies)for(let l of this.fixedBalls)n.collideWithFixedBall(l);for(let n of this.bodies)for(let l of this.walls){let o=n.collideWithWall(l);o&&this.debugData.push(...o)}for(let n of this.bodies)for(let l of this.bounds){let o=n.collideWithWall(l);o&&this.debugData.push(...o)}this.gravity&&this.bodies[s].vel.add(new B(this.gravity.x*t,this.gravity.y*t))}this.softBalls.forEach(s=>{Jt.updatePressureBasedForces(s,t)});for(let s=0;s<3;s++)for(let n of this.springs)n.update(t/3/2);this.balls.forEach(s=>{s.vel.mult(Math.pow(this.airFriction,t)),s.ang*=Math.pow(this.airFriction,t)}),this.bodies.forEach(s=>{s.vel.mult(Math.pow(this.airFriction,t)),s.ang*=Math.pow(this.airFriction,t)}),e&&(i.bodies.reverse(),i.balls.reverse(),this.balls.forEach((s,n)=>{s.move((i.balls[n].pos.x-s.pos.x)*.5,(i.balls[n].pos.y-s.pos.y)*.5),s.vel.add(new B((i.balls[n].vel.x-s.vel.x)*.5,(i.balls[n].vel.y-s.vel.y)*.5)),s.rotation=(s.rotation+i.balls[n].rotation)/2,s.ang=(s.ang+i.balls[n].ang)/2}),this.bodies.forEach((s,n)=>{let l=i.bodies[n];s.move((l.pos.x-s.pos.x)*.5,(l.pos.y-s.pos.y)*.5),s.vel.add(new B((l.vel.x-s.vel.x)*.5,(l.vel.y-s.vel.y)*.5)),s.rotate((l.rotation-s.rotation)/2),s.ang=(s.ang+l.ang)/2}))}get copy(){let t=new R;return t.balls=this.getCopyOfBalls(),t.bodies=this.getCopyOfBodies(),t.fixedBalls=this.fixedBalls,t.walls=this.walls,t.bounds=this.bounds,t.gravity=this.gravity,this.springs.forEach(e=>{let i=e.constructor==dt?dt:qe,s=new i(e.length,e.springConstant);s.rotationLocked=e.rotationLocked,s.pinned=e.pinned,e.objects.forEach(n=>{let l=this.balls.indexOf(n);l!=-1?s.attachObject(t.balls[l]):(l=this.bodies.indexOf(n),l!=-1&&s.attachObject(t.bodies[l]))}),t.springs.push(s)}),t}setAirFriction(t){if(!isFinite(t))return;this.airFriction=t,this.airFriction<0&&(this.airFriction=0),this.airFriction>1&&(this.airFriction=1)}setGravity(t){this.gravity=t.copy}addBall(t){if(typeof addBodyNotBall!="undefined"&&isFinite(addBodyNotBall)&&addBodyNotBall>2){let e=(i,s,n)=>{let l=[];for(let o=0;o<n;o++){let h=B.fromAngle(o/n*2*Math.PI);h.mult(s),h.add(i),l.push(h)}return l};this.bodies.push(new Bt(e(t.pos,t.r,addBodyNotBall),t.vel,t.k,t.ang,t.fc))}else this.balls.push(t)}addBody(t){this.bodies.push(t)}addSoftBall(t){this.balls.push(...t.points),this.springs.push(...t.sides),this.softBalls.push(t)}addSoftSquare(t,e,i,s){let n=new Jt(t,Math.sqrt(e*e/Math.PI),1,i,24);n.sides.forEach(h=>{h.length=.96*4*e/n.resolution}),n.points.forEach(h=>{h.vel=s.copy}),this.balls.push(...n.points),this.springs.push(...n.sides);let l=e*e*200,o=new dt(Math.sqrt(n.r*n.r*Math.PI),l/2);o.attachObject(n.points[0]),o.attachObject(n.points[n.resolution/2]),this.springs.push(o),o=new dt(Math.sqrt(n.r*n.r*Math.PI),l/2),o.attachObject(n.points[n.resolution/4]),o.attachObject(n.points[3*n.resolution/4]),this.springs.push(o),o=new dt(Math.sqrt(2*n.r*n.r*Math.PI),l),o.attachObject(n.points[n.resolution/8]),o.attachObject(n.points[5*n.resolution/8]),this.springs.push(o),o=new dt(Math.sqrt(2*n.r*n.r*Math.PI),l),o.attachObject(n.points[3*n.resolution/8]),o.attachObject(n.points[7*n.resolution/8]),this.springs.push(o)}addRectWall(t,e,i,s){let n=[];n.push(new B(t-i/2,e-s/2)),n.push(new B(t+i/2,e-s/2)),n.push(new B(t+i/2,e+s/2)),n.push(new B(t-i/2,e+s/2)),this.walls.push(new Ct(n))}addRectBody(t,e,i,s,n,l){let o=[];o.push(new B(t-i/2,e-s/2)),o.push(new B(t+i/2,e-s/2)),o.push(new B(t+i/2,e+s/2)),o.push(new B(t-i/2,e+s/2)),this.bodies.push(new Bt(o,new B(0,0),l,0,n))}addWall(t){this.walls.push(t)}addFixedBall(t,e,i){this.fixedBalls.push({x:t,y:e,r:i})}addSpring(t){this.springs.push(t)}setBounds(t,e,i,s){this.bounds=[];let n=(l,o,h,a)=>{let d=[];return d.push(new B(l-h/2,o-a/2)),d.push(new B(l+h/2,o-a/2)),d.push(new B(l+h/2,o+a/2)),d.push(new B(l-h/2,o+a/2)),new Ct(d)};this.bounds.push(n(t-i,e,2*i,4*s)),this.bounds.push(n(t+2*i,e,2*i,4*s)),this.bounds.push(n(t,e-s,4*i,s*2)),this.bounds.push(n(t,e+2*s,4*i,2*s))}getObjectAtCoordinates(t,e){let i,s=new B(t,e);return this.balls.forEach(n=>{n.containsPoint(s)&&(i=n)}),this.bodies.forEach(n=>{n.containsPoint(s)&&(i=n)}),this.walls.forEach(n=>{n.containsPoint(s)&&(i=n)}),this.fixedBalls.forEach(n=>{B.dist(new B(n.x,n.y),new B(t,e))<=n.r&&(i=n)}),this.softBalls.forEach(n=>{n.containsPoint(s)&&(i=n)}),i}getCopyOfBalls(){let t=[];return this.balls.forEach(e=>{t.push(e.copy)}),t}getCopyOfBodies(){let t=[];return this.bodies.forEach(e=>{t.push(e.copy)}),t}removeObjFromSystem(t){let e=this.balls.indexOf(t);if(e!=-1){let i=!1;if(this.softBalls.forEach(s=>{s.points.includes(this.balls[e])&&(this.removeObjFromSystem(s),i=!0)}),i)return;this.springs.forEach(s=>{s.objects.includes(this.balls[e])&&this.removeObjFromSystem(s)}),this.balls.splice(e,1);return}if(e=this.bodies.indexOf(t),e!=-1){this.bodies.splice(e,1);return}if(e=this.walls.indexOf(t),e!=-1){this.walls.splice(e,1);return}if(e=this.fixedBalls.indexOf(t),e!=-1){this.fixedBalls.splice(e,1);return}if(e=this.springs.indexOf(t),e!=-1){this.springs.splice(e,1);let i=!1;return this.softBalls.forEach(s=>{s.points.includes(this.springs[e])&&(this.removeObjFromSystem(s),i=!0)}),i,void 0}if(e=this.softBalls.indexOf(t),e!=-1){let i=this.softBalls[e];this.softBalls.splice(e,1),i.points.forEach(s=>{this.removeObjFromSystem(s)});return}}getItemDataFromId(){let t={},e=l=>l.id===id,i=this.balls.filter(e);if(i.length>=1)return t.type="ball",t.num=this.balls.indexOf(i[0]),t;let s=this.bodies.filter(e);if(s.length>=1)return t.type="body",t.num=this.bodies.indexOf(s[0]),t;let n=this.springs.filter(e);if(n.length>=1)return t.type="spring",t.num=this.springs.indexOf(n[0]),t}toJSObject(){let t={};return t.balls=this.balls.map(e=>e.toJSObject()),t.bounds=this.bounds.map(e=>e.toJSObject()),t.walls=this.walls.map(e=>e.toJSObject()),t.bodies=this.bodies.map(e=>e.toJSObject()),t.springs=this.springs.map(e=>e.toJSObject()),t.softBalls=this.softBalls.map(e=>e.toJSObject()),t.fixedBalls=this.fixedBalls,t.airFriction=this.airFriction,t.gravity=this.gravity.toJSObject(),t.version=Ae().version,t}static fromObject(t){let e=new R;return e.balls=t.balls.map(i=>_t.fromObject(i)),e.bounds=t.bounds.map(i=>Ct.fromObject(i)),e.walls=t.walls.map(i=>Ct.fromObject(i)),e.bodies=t.bodies.map(i=>Bt.fromObject(i)),e.springs=t.springs.map(i=>dt.fromObject(i,e.balls)),e.softBalls=t.softBalls.map(i=>Jt.fromObject(i,e.balls,e.springs)),e.fixedBalls=t.fixedBalls,e.airFriction=t.airFriction,e.gravity=B.fromObject(t.gravity),e}toJSON(){return JSON.stringify(this.toJSObject())}static fromJSON(t){return R.fromObject(JSON.parse(t))}toCompressed(){return Ce.compress(JSON.stringify(this.toJSObject()))}static fromCompressed(t){return R.fromObject(JSON.parse(Ce.uncompress(t)))}};R.Ball=_t;R.Body=Bt;R.Vec2=B;R.Wall=Ct;R.LineSegment=xi;R.Spring=dt;R.Stick=qe;R.SoftBall=Jt;R.Line=bi;R.Polygon=vi;je.exports=R}),Fe=E((Ps,Be)=>{var Mi=ut();Be.exports=function(c){this.startingState=c.getPhysics().toJSObject(),this.inStartingState=!0,document.getElementById("pause").onclick=()=>{c.getTimeMultiplier()!==0?c.setTimeMultiplier(0):(c.setTimeMultiplier(1),this.inStartingState==!0&&(this.startingState=c.getPhysics().toJSObject()),this.inStartingState=!1)},document.getElementById("revert").onclick=()=>{c.setTimeMultiplier(0),c.setPhysics(Mi.fromObject(this.startingState)),this.inStartingState=!0},document.getElementById("clear all").onclick=()=>{this.inStartingState=!0;let t=c.getPhysics();t.balls=[],t.walls=[],t.softBalls=[],t.springs=[],t.bodies=[]},document.getElementById("set start").onclick=()=>{this.startingState=c.getPhysics().toJSObject(),this.inStartingState=!0,c.setTimeMultiplier(0)}}}),tt=E((Ss,Ee)=>{var Te=class{constructor(t,e,i,s,n,l,o){this.name=t,this.description=e,this.drawFunc=i,this.startInteractionFunc=s,this.endInteractionFunc=n,this.keyGotUpFunc=l,this.keyGotDownFunc=o}};Ee.exports=Te}),Ve=E((ks,We)=>{var Pi=tt(),$t=ut(),Si=new Pi("Ball creator","",function(c,t,e,i,s,n,l,o,h,a){c.strokeStyle="black",c.beginPath(),c.arc(t,e,n,0,2*Math.PI),c.stroke(),i!=0&&s!=0&&(c.beginPath(),c.moveTo(t,e),c.lineTo(i,s),c.stroke())},function(c,t,e,i,s){},function(c,t,e,i,s,n,l){if(n!=0&&l!=0){let o=new $t.Ball(new $t.Vec2(n,l),new $t.Vec2(n-i,l-s),defaultSize,k,0,fc);isFinite(o.pos.x)&&isFinite(o.pos.y)&&isFinite(o.vel.x)&&isFinite(o.vel.y)||(o.vel.x=0,o.vel.y=0),c.addBall(o)}},function(){},function(){});We.exports=Si}),De=E((Os,Ne)=>{var ki=tt(),Oi=new ki("Rectangle wall","",function(c,t,e,i,s,n,l,o,h,a){i!=0&&s!=0&&(c.strokeStyle="black",c.strokeRect(t,e,i-t,s-e))},function(c,t,e,i,s){},function(c,t,e,i,s,n,l){n!=0&&l!=0&&c.addRectWall(n/2+i/2,l/2+s/2,2*Math.abs(n/2-i/2),2*Math.abs(l/2-s/2))},function(){},function(){});Ne.exports=Oi}),Re=E((Is,Le)=>{var Ii=tt(),Ai=new Ii("Wall drawer","",function(c,t,e,i,s,n,l,o,h,a,d){c.strokeStyle="black",c.beginPath(),c.arc(t,e,n,0,2*Math.PI),c.stroke(),i!=0&&s!=0&&o.addFixedBall(t/d.scaling-d.viewOffsetX/d.scaling,e/d.scaling-d.viewOffsetY/d.scaling,n)},function(c,t,e,i,s){},function(c,t,e,i,s,n,l){},function(){},function(){});Le.exports=Ai}),ze=E((As,Je)=>{var ji=tt(),qi=ut(),Ci=new ji("Stick creator","",function(c,t,e,i,s,n,l,o,h,a){i!=0&&s!=0&&(c.strokeStyle="black",c.beginPath(),c.moveTo(t,e),c.lineTo(i,s),c.stroke())},function(c,t,e,i,s,n){},function(c,t,e,i,s,n,l,o){if(n!=0&&l!=0){t:{let h=c.getObjectAtCoordinates(i,s),a,d=qi.Stick;if(h||(h={x:i,y:s,pinPoint:!0}),o==h||o==null&&h==null)break t;if(o.pinPoint&&h.pinPoint)break t;o.pinPoint?(a=new d(Math.sqrt(Math.pow(o.x-h.pos.x,2)+Math.pow(o.y-h.pos.y,2)),springConstant),a.attachObject(h),a.pinHere(o.x,o.y)):h.pinPoint?(a=new d(Math.sqrt(Math.pow(o.pos.x-h.x,2)+Math.pow(o.pos.y-h.y,2)),springConstant),a.attachObject(o),a.pinHere(h.x,h.y)):(a=new d(Math.sqrt(Math.pow(o.pos.x-h.pos.x,2)+Math.pow(o.pos.y-h.pos.y,2)),springConstant),a.attachObject(o),a.attachObject(h)),c.addSpring(a),lockRotation&&a.lockRotation()}}},function(){},function(){});Je.exports=Ci}),Ye=E((js,Xe)=>{var Bi=tt(),Fi=ut(),Ei=new Bi("Spring creator","",function(c,t,e,i,s,n,l,o,h,a){i!=0&&s!=0&&(c.strokeStyle="black",c.beginPath(),c.moveTo(t,e),c.lineTo(i,s),c.stroke())},function(c,t,e,i,s,n){},function(c,t,e,i,s,n,l,o){if(n!=0&&l!=0){t:{let h=c.getObjectAtCoordinates(i,s),a,d=Fi.Spring;if(h||(h={x:i,y:s,pinPoint:!0}),o==h||o==null&&h==null)break t;if(o.pinPoint&&h.pinPoint)break t;o.pinPoint?(a=new d(Math.sqrt(Math.pow(o.x-h.pos.x,2)+Math.pow(o.y-h.pos.y,2)),springConstant),a.attachObject(h),a.pinHere(o.x,o.y)):h.pinPoint?(a=new d(Math.sqrt(Math.pow(o.pos.x-h.x,2)+Math.pow(o.pos.y-h.y,2)),springConstant),a.attachObject(o),a.pinHere(h.x,h.y)):(a=new d(Math.sqrt(Math.pow(o.pos.x-h.pos.x,2)+Math.pow(o.pos.y-h.pos.y,2)),springConstant),a.attachObject(o),a.attachObject(h)),c.addSpring(a),lockRotation&&a.lockRotation()}}},function(){},function(){});Xe.exports=Ei}),Ke=E((qs,He)=>{var Ti=tt(),Ge=0,Ue=0,Ze=(c,t,e)=>({x:c/e.scaling-e.viewOffsetX/e.scaling,y:t/e.scaling-e.viewOffsetY/e.scaling}),Wi=new Ti("Move","",function(c,t,e,i,s,n,l,o,h,a,d){let f=Ze(t,e,d),y=Ze(Ge,Ue,d);h&&!h.pinPoint&&(h.move(f.x-h.pos.x,f.y-h.pos.y),a===0?(h.vel.x=0,h.vel.y=0):(h.vel.x=(f.x-y.x)/a,h.vel.y=(f.y-y.y)/a),h.ang=0),Ge=t,Ue=e},function(c,t,e,i,s){},function(c,t,e,i,s,n,l){},function(){},function(){});He.exports=Wi}),_e=E((Cs,Qe)=>{var Vi=tt(),zt=ut(),Ni=new Vi("Elastic ball creator","",function(c,t,e,i,s,n,l,o,h,a){c.strokeStyle="black",c.beginPath(),c.arc(t,e,n,0,2*Math.PI),c.stroke(),i!=0&&s!=0&&(c.beginPath(),c.moveTo(t,e),c.lineTo(i,s),c.stroke())},function(c,t,e,i,s){},function(c,t,e,i,s,n,l){if(n!=0&&l!=0){let o=new zt.Ball(new zt.Vec2(n,l),new zt.Vec2(n-i,l-s),defaultSize,k,0,fc);if(isFinite(o.pos.x)&&isFinite(o.pos.y)&&isFinite(o.vel.x)&&isFinite(o.vel.y)){let h=new zt.SoftBall(o.pos,defaultSize,1e6,fc,24);h.points.forEach(a=>{a.vel=o.vel.copy}),c.addSoftBall(h)}}},function(){},function(){});Qe.exports=Ni}),ti=E((Bs,$e)=>{var Di=tt(),te=ut(),Li=new Di("Soft square creator","",function(c,t,e,i,s,n,l,o,h,a){c.strokeStyle="black",c.beginPath(),c.moveTo(t-n,e-n),c.lineTo(t+n,e-n),c.lineTo(t+n,e+n),c.lineTo(t-n,e+n),c.lineTo(t-n,e-n),c.stroke(),i!=0&&s!=0&&(c.beginPath(),c.moveTo(t,e),c.lineTo(i,s),c.stroke())},function(c,t,e,i,s){},function(c,t,e,i,s,n,l){if(n!=0&&l!=0){let o=new te.Ball(new te.Vec2(n,l),new te.Vec2(n-i,l-s),defaultSize,k,0,fc);isFinite(o.pos.x)&&isFinite(o.pos.y)&&isFinite(o.vel.x)&&isFinite(o.vel.y)&&c.addSoftSquare(o.pos,defaultSize*2,fc,o.vel)}},function(){},function(){});$e.exports=Li}),ii=E((Fs,ei)=>{var Ri=tt(),Ji=new Ri("Delete","",function(c,t,e,i,s,n,l,o,h,a){},function(c,t,e,i,s,n){n&&c.removeObjFromSystem(n)},function(c,t,e,i,s,n,l){},function(){},function(){});ei.exports=Ji}),ni=E((Es,si)=>{var zi=tt(),Xi=new zi("Rectangle body (experimental)","",function(c,t,e,i,s,n,l,o,h,a){i!=0&&s!=0&&(c.strokeStyle="black",c.strokeRect(t,e,i-t,s-e))},function(c,t,e,i,s){},function(c,t,e,i,s,n,l,o,h,a){n!=0&&l!=0&&c.addRectBody(n/2+i/2,l/2+s/2,2*Math.abs(n/2-i/2),2*Math.abs(l/2-s/2),.18,.1)},function(){},function(){});si.exports=Xi}),Ft=ut(),li=Ft,oi=Ft.Ball,rt=Ft.Vec2,Yi=Ft.Spring,ri=Ft.Stick,Hi=Fe(),j,T,J=0,z=0,ee=0;window.defaultSize;window.k=.5;window.fc=2;window.springConstant=2e3;window.scaling=1;window.viewOffsetX=0;window.viewOffsetY=0;var Y=0,Pt=0,St=0,Xt=1,Yt;window.lockRotation=!1;window.time=!0;var xt=!1,ai=0;my=0;var Et=!1,ct=[Ve(),De(),Re(),ze(),Ye(),Ke(),_e(),ti(),ii(),ni()],ie=!1,se=!1;window.onload=()=>{T=document.getElementById("defaulCanvas0"),j=new li,j.setBounds(0,0,T.width,T.height),j.setGravity(new rt(0,1e3)),j.setAirFriction(.9),T.addEventListener("touchstart",Zi,!1),T.addEventListener("touchend",Ki,!1),T.addEventListener("touchmove",Qi,!1),T.addEventListener("mousedown",_i,!1),T.addEventListener("mouseup",$i,!1),T.addEventListener("mousemove",ts,!1),document.addEventListener("keydown",Gi,!1),document.addEventListener("keyup",Ui,!1),window.addEventListener("resize",hi,!1),T.addEventListener("mousedown",function(){ee=1},!1),T.addEventListener("mouseup",function(){ee=0},!1),hi(),window.defaultSize=(T.width+T.height)/80,Hi(new es),requestAnimationFrame(di)};function hi(){T.width=window.innerWidth,T.height=window.innerHeight,j.setBounds(0,0,T.width,T.height)}function di(){isFinite(Yt)||(Yt=performance.now());let c=performance.now()-Yt;isFinite(c)||(c=0),c/=1e3,J=isFinite(J)?J:ai,z=isFinite(z)?z:my,J&&isFinite(J)&&(ai=J),z&&isFinite(z)&&(my=z);let t=T.getContext("2d");if(t.fillStyle="rgb(51, 51, 51)",t.fillRect(0,0,T.width,T.height),t.strokeStyle="black",t.fillStyle="white",t.fillText("BallPhysics",10,10),t.fillText("Mode: "+ct[Y].name,10,25),t.fillText(Math.round(J).toString()+" "+Math.round(z).toString(),10,40),t.fillText(Math.round(Pt).toString()+" "+Math.round(St).toString(),10,55),ct[Y].drawFunc(t,J,z,Pt,St,defaultSize*window.scaling,ee,j,xt,c*Xt,{scaling:window.scaling,viewOffsetX:window.viewOffsetX,viewOffsetY:window.viewOffsetY}),t.strokeStyle="black",is(T),!time)return;j.balls[0]&&(se&&(j.balls[0].ang-=Math.PI*100*c),ie&&(j.balls[0].ang+=Math.PI*100*c)),c*=Xt,j.update(c/5,Et),j.update(c/5,Et),j.update(c/5,Et),j.update(c/5,Et),j.update(c/5,Et),pmouseX=J,pmouseY=z,Yt=performance.now(),requestAnimationFrame(di)}function ui(c,t){J=c,z=t,xt=j.getObjectAtCoordinates(J/window.scaling-window.viewOffsetX/window.scaling,z/window.scaling-window.viewOffsetY/window.scaling),xt||(xt={x:J/window.scaling-window.viewOffsetX/window.scaling,y:z/window.scaling-window.viewOffsetY/window.scaling,pinPoint:!0}),Pt=J,St=z,ct[Y].startInteractionFunc(j,c/window.scaling-window.viewOffsetX/window.scaling,t/window.scaling-window.viewOffsetY/window.scaling,J/window.scaling-window.viewOffsetX/window.scaling,z/window.scaling-window.viewOffsetY/window.scaling,xt)}function ci(c,t){if(J=c,z=t,ct[Y].endInteractionFunc(j,c/window.scaling-window.viewOffsetX/window.scaling,t/window.scaling-window.viewOffsetY/window.scaling,J/window.scaling-window.viewOffsetX/window.scaling,z/window.scaling-window.viewOffsetY/window.scaling,Pt/window.scaling-window.viewOffsetX/window.scaling,St/window.scaling-window.viewOffsetY/window.scaling,xt,fc,k),Pt===0&&St===0)return;Pt=0,St=0,xt=!1}function Gi(c){keyCode=c.key,keyCode==="ArrowUp"&&(Y+=1,Y%=ct.length),keyCode==="ArrowDown"&&(Y-=1,Y=Y===-1?ct.length-1:Y),keyCode==="s"&&ss(T.width/2,T.height/2,.5,j),keyCode==="a"&&(window.scaling+=.01),keyCode==="d"&&(window.scaling-=.01),keyCode==="j"&&(window.viewOffsetX-=10),keyCode==="l"&&(window.viewOffsetX+=10),keyCode==="k"&&(window.viewOffsetY-=10),keyCode==="i"&&(window.viewOffsetY+=10),keyCode==="ArrowRight"&&(se=!0),keyCode==="ArrowLeft"&&(ie=!0)}function Ui(c){keyCode=c.key,keyCode==="ArrowRight"&&(se=!1),keyCode==="ArrowLeft"&&(ie=!1)}function Zi(c){if(c.preventDefault(),T.width-c.changedTouches[0].clientX<T.width/100){Y+=1,Y%=ct.length;return}if(c.changedTouches[0].clientX<T.width/100){Y-=1,Y=Y===-1?ct.length-1:Y;return}return ui(c.changedTouches[0].clientX,c.changedTouches[0].clientY),!1}function Ki(c){return c.preventDefault(),ci(c.changedTouches[0].clientX,c.changedTouches[0].clientY),!1}function Qi(c){return c.preventDefault(),J=c.changedTouches[0].clientX,z=c.changedTouches[0].clientY,!1}function _i(c){return ui(c.clientX,c.clientY),!1}function $i(c){return ci(c.clientX,c.clientY),!1}function ts(c){J=c.clientX,z=c.clientY}var is=function(c){let t=c.getContext("2d");t.save(),t.translate(window.viewOffsetX,window.viewOffsetY),t.scale(window.scaling,window.scaling),t.fillStyle="green",t.strokeStyle="black";for(let i=0;i<j.balls.length;i++)t.beginPath(),t.arc(j.balls[i].pos.x,j.balls[i].pos.y,j.balls[i].r,0,2*Math.PI),t.stroke(),t.fill(),t.save(),t.translate(j.balls[i].pos.x,j.balls[i].pos.y),t.rotate(-Math.PI/2-j.balls[i].rotation),t.beginPath(),t.moveTo(0,0),t.lineTo(0,j.balls[i].r),t.stroke(),t.restore();j.bodies.forEach(i=>{t.beginPath(),t.moveTo(i.points[i.points.length-1].x,i.points[i.points.length-1].y),i.points.forEach(s=>{t.lineTo(s.x,s.y)}),t.stroke(),t.fill(),t.beginPath(),t.arc(i.pos.x,i.pos.y,1.5,0,Math.PI*2),t.stroke()});let e=i=>{t.beginPath(),t.moveTo(i.points[i.points.length-1].x,i.points[i.points.length-1].y),i.points.forEach(s=>{t.lineTo(s.x,s.y)}),t.fill()};t.fillStyle="white",j.walls.forEach(e),t.fillStyle="yellow",j.bounds.forEach(e),j.fixedBalls.forEach(i=>{t.beginPath(),t.arc(i.x,i.y,i.r,0,Math.PI*2),t.fill()}),t.save(),t.lineWidth=2,t.strokeStyle="#ADD8E6",t.fillStyle="#ADD8E6",j.springs.forEach(i=>{if(i instanceof Yi&&!(i instanceof ri)){let s,n,l,o;i.pinned?(s=i.pinned.x,n=i.pinned.y,l=i.objects[0].pos.x,o=i.objects[0].pos.y):(s=i.objects[0].pos.x,n=i.objects[0].pos.y,l=i.objects[1].pos.x,o=i.objects[1].pos.y);let h=new rt(l-s,o-n),a=h.copy;h.rotate(Math.PI/2),h.setMag(5);let d=new rt(s,n),f=Math.floor(i.length/10);for(let y=1;y<=f;y++)y===f&&(h=new rt(0,0)),t.beginPath(),t.moveTo(d.x,d.y),t.lineTo(s+y/f*a.x+h.x,n+y/f*a.y+h.y),t.stroke(),d=new rt(s+y/f*a.x+h.x,n+y/f*a.y+h.y),h.mult(-1)}else t.beginPath(),t.moveTo(i.objects[0].pos.x,i.objects[0].pos.y),t.lineTo(i.pinned?i.pinned.x:i.objects[1].pos.x,i.pinned?i.pinned.y:i.objects[1].pos.y),t.stroke();i.objects.forEach(s=>{t.beginPath(),t.arc(s.pos.x,s.pos.y,2.5,0,Math.PI*2),t.fill(),t.stroke()}),i.pinned&&(t.beginPath(),t.arc(i.pinned.x,i.pinned.y,3,0,Math.PI*2),t.fill(),t.stroke())}),t.restore();for(segment of j.debugData)t.strokeStyle="red",t.beginPath(),t.moveTo(segment.a.x,segment.a.y),t.lineTo(segment.b.x,segment.b.y),t.stroke();t.restore()};function ss(c,t,e,i){let s=[],n=25,l=250,o=8;s.push(new oi(new rt(c,t),new rt(0,0),e*n,1,0,0));let h=1;for(let a=0;a<o-1;a++)s.push(new oi(new rt(c+h*e*n*1.01*2,t),new rt(0,0),e*25,1,0,0)),h*=-1,h>0&&(h+=1),a===o-2&&(s[s.length-1].vel.x=-Math.sign(h)*e*n*8);s.forEach(a=>{i.addBall(a);let d=new ri(l);d.attachObject(a),d.pinHere(a.pos.x,a.pos.y-l),i.addSpring(d),d.lockRotation()})}function ns(c){isFinite(c)&&(Xt=c)}function ls(){return Xt}function os(c){c instanceof li&&(j=c)}function rs(){return j}var es=function(){this.setTimeMultiplier=ns,this.getTimeMultiplier=ls,this.getPhysics=rs,this.setPhysics=os};})();
//# sourceMappingURL=main.js.map

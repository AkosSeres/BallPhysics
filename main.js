(()=>{var R=(u,t)=>()=>(t||(t={exports:{}},u(t.exports,t)),t.exports),_=R((Qi,Kt)=>{var N=class{constructor(t,e){this.x=t,this.y=e}get copy(){return new N(this.x,this.y)}get length(){return Math.sqrt(this.x*this.x+this.y*this.y)}get sqlength(){return this.x*this.x+this.y*this.y}get heading(){if(this.x===0&&this.y===0)return 0;if(this.x===0)return this.y>0?Math.PI/2:1.5*Math.PI;if(this.y===0)return this.x>0?0:Math.PI;let t=N.normalized(this);return this.x>0&&this.y>0?Math.asin(t.y):this.x<0&&this.y>0?Math.asin(-t.x)+Math.PI/2:this.x<0&&this.y<0?Math.asin(-t.y)+Math.PI:this.x>0&&this.y<0?Math.asin(t.x)+1.5*Math.PI:0}add(t){this.x+=t.x,this.y+=t.y}sub(t){this.x-=t.x,this.y-=t.y}mult(t){this.x*=t,this.y*=t}div(t){this.x/=t,this.y/=t}lerp(t,e){this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e}dist(t){return new N(this.x-t.x,this.y-t.y).length}setMag(t){if(this.length===0)return;this.mult(t/this.length)}rotate(t){let e=this.heading,s=N.fromAngle(t+e);s.mult(this.length),this.x=s.x,this.y=s.y}static add(t,e){return new N(t.x+e.x,t.y+e.y)}static sub(t,e){return new N(t.x-e.x,t.y-e.y)}static mult(t,e){return new N(t.x*e,t.y*e)}static div(t,e){return new N(t.x/e,t.y/e)}static fromAngle(t){return new N(Math.cos(t),Math.sin(t))}static lerp(t,e,s){return N.add(t,N.mult(N.sub(e,t),s))}static dist(t,e){return N.sub(t,e).length}static dot(t,e){return t.x*e.x+t.y*e.y}static cross(t,e){return t.x*e.y-t.y*e.x}static crossScalarFirst(t,e){return new N(-e.y*t,e.x*t)}static crossScalarSecond(t,e){return new N(t.y*e,-t.x*e)}static angle(t,e){return Math.acos(Math.min(Math.max(N.dot(t,e)/Math.sqrt(t.sqlength*e.sqlength),1),-1))}static angleACW(t,e){let s=t.heading,i=e.heading,n=i-s;return n<0?2*Math.PI+n:n}static normalized(t){let e=t.length;return e===0?t:new N(t.x/e,t.y/e)}toJSObject(){let t={};return t.x=this.x,t.y=this.y,t}static fromObject(t){return new N(t.x,t.y)}};Kt.exports=N}),Ot=R((Zi,Qt)=>{var P=_(),yt=class{constructor(t,e,s,i,n,o){this.pos=t.copy,this.lastPos=this.pos.copy,this.r=s,this.fc=.4,this.amc=2/5,this.rotation=0,n?this.ang=n:this.ang=0,(o||o===0)&&(this.fc=o),i?this.k=i:this.k=.8,e!=null?this.vel=e.copy:this.vel=new P(0,0),this.id="_"+Math.random().toString(36).substr(2,9)}get m(){return this.r*this.r*Math.PI}get am(){return this.amc*this.r*this.r*this.m}getAmInPoint(t){let e=this.am;return e+=P.sub(this.pos,t).sqlength*this.m,e}get copy(){let t=new yt(this.pos.copy,this.vel.copy,this.r,this.k,this.ang,this.fc);return t.lastPos=this.lastPos.copy,t.rotation=this.rotation,t}move(t,e){this.pos.x+=t,this.pos.y+=e}rotate(t){this.rotation+=t}collided(t){return this.pos.dist(t.pos)<this.r+t.r}static collide(t,e){if(!t.collided(e))return;let s=P.dist(t.pos,e.pos),i=t.m,n=e.m,o=t.pos.copy,l=e.pos.copy,a=t.r+e.r-s,r=P.sub(t.pos,e.pos);if(r.setMag(1),r.mult(a*n/(i+n)),o.add(r),r.setMag(1),r.mult(-a*i/(i+n)),l.add(r),t.pos=o,e.pos=l,P.dot(r,P.sub(t.vel,e.vel))<0)return;r.setMag(1);let h=P.add(t.pos,P.mult(r,t.r)),d=t.vel.copy,g=e.vel.copy,f=t.ang,p=e.ang,y=P.sub(h,t.pos),x=P.sub(h,e.pos),M=t.am,S=e.am,w=(t.k+e.k)/2,m=(t.fc+e.fc)/2,O=r.copy,b=t.velInPlace(h),j=e.velInPlace(h),q=P.sub(j,b),T=1/i+1/n;T=-(1+w)*P.dot(q,O)/T;let B=P.sub(d,P.mult(O,T/i)),V=P.add(g,P.mult(O,T/n)),W=f-T*P.cross(y,O)/M,G=p,D=q.copy;D.sub(P.mult(O,P.dot(q,O))),D.setMag(1);let Q=1/i+1/n;Q+=P.dot(P.crossScalarFirst(P.cross(y,D)/M,y),D),Q+=P.dot(P.crossScalarFirst(P.cross(x,D)/S,x),D),Q=-.5*P.dot(q,D)/Q;let Z=T*m;Z>Q&&(Z=Q),B=P.sub(B,P.mult(D,Z/i)),V=P.add(V,P.mult(D,Z/n)),W=W-Z*P.cross(y,D)/M,G=G+Z*P.cross(x,D)/S,t.vel=B,e.vel=V,t.ang=W,e.ang=G}containsPoint(t){return P.dist(this.pos,t)<=this.r}velInPlace(t){let e=P.sub(t,this.pos);return e.rotate(Math.PI/2),e.mult(this.ang),e.add(this.vel),e}effectiveMass(t,e){let s=P.sub(t,this.pos);if(s.length===0)return this.m;let i=P.angle(e,s),n=Math.sin(i)**2*s.length**2/this.am;return isNaN(i)&&console.log(e,s,i),1/(n+1/this.m)}applyDeltaVelInPoint(t,e){let s=P.sub(e,this.pos);if(s.length===0){this.vel.add(t);return}let i=P.angle(s,t),n=P.mult(s,P.dot(t,s)/s.length**2);this.vel.add(n);let o=s.copy;o.rotate(Math.PI/2),o.setMag(1);let l=Math.sign(P.dot(t,o)),a=t.length*Math.cos(i),r=1/(1/this.m+s.length**2/this.am),h=a*r/this.m;this.vel.add(P.mult(o,h*l));let d=l*a*r*s.length/this.am;this.ang-=d}toJSObject(){let t={};return t.pos=this.pos.toJSObject(),t.lastPos=this.lastPos.toJSObject(),t.r=this.r,t.fc=this.fc,t.amc=this.amc,t.rotation=this.rotation,t.ang=this.ang,t.fc=this.fc,t.k=this.k,t.vel=this.vel.toJSObject(),t.id=this.id,this.layer!=null&&(t.layer=this.layer),t}static fromObject(t){let e=new yt(P.fromObject(t.pos),P.fromObject(t.vel),t.r,t.k,t.ang,t.fc);return e.lastPos=P.fromObject(t.lastPos),e.amc=t.amc,e.rotation=t.rotation,e.vel=P.fromObject(t.vel),e.id=t.id,t.layer!=null&&(e.layer=t.layer),e}};Qt.exports=yt}),ct=R(($i,Zt)=>{var K=_(),$t=class{constructor(t,e){this.a=t,this.b=e}get length(){return K.dist(this.a,this.b)}distFromPoint(t){let e=K.sub(this.a,this.b),s=K.sub(t,this.b),i=K.sub(t,this.a),n=s.length,o=i.length,l=e.length;if(l===0)return n;let a=K.angle(s,i),r=K.angle(s,e),h=Math.PI-a-r,d=Math.sin(h)*o*l/2,g=2*d/l;return h>Math.PI/2?o:r>Math.PI/2?n:g}static intersect(t,e){let s=K.sub(t.b,t.a),i=s.y/s.x,n=t.b.y-t.b.x*i,o=K.sub(e.b,e.a),l=o.y/o.x,a=e.b.y-e.b.x*l;if(s.x===0&&o.x!==0){if(t.a.x>=e.a.x&&t.a.x<=e.b.x||t.a.x<=e.a.x&&t.a.x>=e.b.x){let f=l*t.a.x+a;if(f>t.a.y&&f<t.b.y||f<t.a.y&&f>t.b.y)return new K(t.a.x,f)}return}if(o.x===0&&s.x!==0){if(e.a.x>=t.a.x&&e.a.x<=t.b.x||e.a.x<=t.a.x&&e.a.x>=t.b.x){let f=i*e.a.x+n;if(f>e.a.y&&f<e.b.y||f<e.a.y&&f>e.b.y)return new K(e.a.x,f)}return}if(s.x===0&&o.x===0){if(t.a.x===e.a.x){let f;t.a.y<t.b.y?f=[t.a.y,t.b.y]:f=[t.b.y,t.a.y];let p;e.a.y<e.b.y?p=[e.a.y,e.b.y]:p=[e.b.y,e.a.y];let y=[f[0]>p[0]?f[0]:p[0],f[1]<p[1]?f[1]:p[1]];if(y[0]<=y[1])return new K(t.a.x,(y[0]+y[1])/2)}return}let r;t.a.x<t.b.x?r=[t.a.x,t.b.x]:r=[t.b.x,t.a.x];let h;e.a.x<e.b.x?h=[e.a.x,e.b.x]:h=[e.b.x,e.a.x];let d=[r[0]>h[0]?r[0]:h[0],r[1]<h[1]?r[1]:h[1]];if(i===l&&n===a&&d[0]<=d[1])return new K((d[0]+d[1])/2,(d[0]+d[1])/2*i+n);let g=(a-n)/(i-l);return g>=d[0]&&g<=d[1]?new K(g,g*i+n):void 0}};Zt.exports=$t}),te=R((_i,_t)=>{var L=_(),Nt=ct(),jt=class{constructor(t){this.points=t;let e=this.points,s=0,i=0,n=L.angleACW(L.sub(e[1],e[0]),L.sub(e[e.length-1],e[0]));this.calculateCenterAndRadius(),s+=n,i+=Math.PI*2-n;for(let o=1;o<e.length-1;o++)n=L.angleACW(L.sub(e[(o+1)%e.length],e[o]),L.sub(e[o-1],e[o])),s+=n,i+=Math.PI*2-n;if(n=L.angleACW(L.sub(e[0],e[e.length-1]),L.sub(e[e.length-2],e[e.length-1])),s+=n,i+=Math.PI*2-n,i>s)return;{let o=[];for(let l=e.length-1;l>=0;l--)o.push(e[l]);this.points=o}}collideWithBall(t){let e,s;if(this.points.forEach((i,n)=>{let o=new L(i.x,i.y);o.x-=t.pos.x,o.y-=t.pos.y,o.mult(-1),o.length<=t.r&&(e=o.heading,s=o.length),o=new L(i.x,i.y);let l=new L(this.points[(n+1)%this.points.length].x,this.points[(n+1)%this.points.length].y),a=new L(t.pos.x,t.pos.y),r=new L(l.x-o.x,l.y-o.y),h=r.heading;o.rotate(-h+Math.PI),l.rotate(-h+Math.PI),a.rotate(-h+Math.PI);let d=a.y-(o.y+l.y)/2;d>=-t.r&&d<=t.r&&a.x>=l.x&&a.x<=o.x&&(e=h-Math.PI/2,s=d)}),isFinite(e)){let i=new L(t.pos.x,t.pos.y),n=new L(t.vel.x,t.vel.y);if(i.rotate(-e+Math.PI/2),n.rotate(-e+Math.PI/2),n.y>0)return;n.y*=-t.k,i.y+=t.r-s;let o=n.y*(1+t.k),l=Math.sign(n.x+t.ang*t.r)*(o*t.fc)/(t.amc*t.r),a=(n.x+t.ang*t.r)/t.r;l/a>1&&(l=a),t.ang-=l;let r=l*t.am/t.r/t.m;n.x-=r,i.rotate(e-Math.PI/2),n.rotate(e-Math.PI/2),t.pos.x=i.x,t.pos.y=i.y,t.vel.x=n.x,t.vel.y=n.y}}containsPoint(t){let e=this.sides,s=Math.max(...this.points.map(l=>L.dist(l,t)))+1,i=L.fromAngle(0);i.setMag(s);let n=new Nt(t,L.add(i,t)),o=e.filter(l=>Nt.intersect(l,n)!=null);return o.length%2==1}calculateCenterAndRadius(){this.center=this.points.reduce((t,e)=>L.add(t,e)),this.center.div(this.points.length),this.boundRadius=Math.max(this.points.map(t=>L.dist(t,this.center)))}get sides(){return this.points.map((t,e)=>new Nt(t,this.points[(e+1)%this.points.length]))}toJSObject(){let t={};return t.points=this.points.map(e=>({x:e.x,y:e.y})),t}static fromObject(t){let e=new jt(t.points.map(s=>new L(v.x,v.y)));return e}};_t.exports=jt}),Jt=R((ts,ee)=>{var et=_(),wt=class{constructor(t,e){this.length=t,this.springConstant=e,this.pinned=!1,this.objects=[],this.rotationLocked=!1,this.id="_"+Math.random().toString(36).substr(2,9)}pinHere(t,e){this.pinned={x:t,y:e}}unpin(){this.pinned=!1}attachObject(t){let e=this.objects;e.push(t),e.length===2&&(this.pinned=!1),e.length>=3&&(e=[e[e.length-2],e[e.length-1]])}lockRotation(){this.rotationLocked=!0}unlockRotation(){this.rotationLocked=!1}update(t){let e,s;if(this.pinned&&this.objects[0]){s=this.pinned,e=this.objects[0];let i=new et(s.x-e.pos.x,s.y-e.pos.y),n=i.length-this.length;i.setMag(1),i.mult(n*this.springConstant*t/e.m),e.vel.x+=i.x,e.vel.y+=i.y;let o=e.vel;if(o.rotate(-i.heading),this.rotationLocked){let l=new et(s.x,s.y),a=et.sub(e.pos,l),r=a.length*a.length*e.m+e.am,h=(e.am*e.ang-a.length*e.m*o.y)/r;o.y=-h*a.length,e.ang=h}o.rotate(i.heading)}else if(this.objects[0]&&this.objects[1]){e=this.objects[0],s=this.objects[1];let i=et.sub(e.pos,s.pos),n=i.length-this.length;i.setMag(1),i.mult(n*this.springConstant*t),s.vel.add(et.div(i,s.m)),e.vel.add(et.div(i,-e.m)),i=et.sub(e.pos,s.pos);let o=e.vel,l=s.vel;if(o.rotate(-i.heading),l.rotate(-i.heading),this.rotationLocked){let a=new et(e.pos.x*e.m+s.pos.x*s.m,e.pos.y*e.m+s.pos.y*s.m);a.div(e.m+s.m);let r=et.sub(e.pos,a),h=et.sub(s.pos,a),d=r.length*r.length*e.m+e.am+h.length*h.length*s.m+s.am,g=(o.y-l.y)*h.length/(r.length+h.length)+l.y,f=(e.am*e.ang+s.am*s.ang-r.length*e.m*(o.y-g)+h.length*s.m*(l.y-g))/d;o.y=-f*r.length+g,l.y=+f*h.length+g,e.ang=f,s.ang=f}o.rotate(i.heading),l.rotate(i.heading)}}toJSObject(){let t={};return t.length=this.length,t.springConstant=this.springConstant,t.pinned=this.pinned,t.rotationLocked=this.rotationLocked,t.id=this.id,t.objects=this.objects.map(e=>e.id),t.type=this.__proto__==wt.prototype?"spring":"stick",t}static fromObject(t,e){let s=new ei,i=s.createStickOrSpring(t.type,t.length,t.springConstant);return i.pinned=t.pinned,i.rotationLocked=t.rotationLocked,i.id=t.id,i.objects=t.objects.map(n=>{let o=e.filter(l=>n==l.id);return o[0]}),i}};function ei(){this.createStickOrSpring=function(u,t,e){let s;if(u=="spring")s=new wt(t,e);else if(u=="stick"){let i=qt();s=new i(t)}return s}}ee.exports=wt}),qt=R((es,ie)=>{var ot=_(),ii=Jt(),se=class extends ii{constructor(t){super(t,0);this.springConstant=0}update(t){let e,s;if(this.pinned&&this.objects[0]){s=this.pinned,e=this.objects[0];let i=new ot(s.x-e.pos.x,s.y-e.pos.y);i.setMag(1),i.mult(-this.length),e.move(-e.pos.x+s.x+i.x,-e.pos.y+s.y+i.y);let n=e.vel;if(n.rotate(-i.heading),n.x=0,this.rotationLocked){let o=new ot(s.x,s.y),l=ot.sub(e.pos,o),a=l.length*l.length*e.m+e.am,r=(e.am*e.ang-l.length*e.m*n.y)/a;n.y=-r*l.length,e.ang=r}n.rotate(i.heading)}else if(this.objects[0]&&this.objects[1]){e=this.objects[0],s=this.objects[1];let i=ot.sub(e.pos,s.pos),n=this.length-i.length;i.setMag(1);let o=ot.mult(i,n*s.m/(e.m+s.m)),l=ot.mult(i,-n*e.m/(e.m+s.m));e.move(o.x,o.y),s.move(l.x,l.y);let a=e.vel,r=s.vel;if(a.rotate(-i.heading),r.rotate(-i.heading),a.x=r.x=(e.m*a.x+s.m*r.x)/(e.m+s.m),this.rotationLocked){let h=new ot(e.pos.x*e.m+s.pos.x*s.m,e.pos.y*e.m+s.pos.y*s.m);h.div(e.m+s.m);let d=ot.sub(e.pos,h),g=ot.sub(s.pos,h),f=d.length*d.length*e.m+e.am+g.length*g.length*s.m+s.am,p=(a.y-r.y)*g.length/(d.length+g.length)+r.y,y=(e.am*e.ang+s.am*s.ang-d.length*e.m*(a.y-p)+g.length*s.m*(r.y-p))/f;a.y=-y*d.length+p,r.y=+y*g.length+p,e.ang=y,s.ang=y}a.rotate(i.heading),r.rotate(i.heading)}}};ie.exports=se}),oe=R((is,ne)=>{var I=_(),si=Ot(),ni=qt(),it=ct(),Ct=class{constructor(t,e,s,i,n){this.points=[],i||i===0?this.fc=i:this.fc=.4,this.pressure=s,n?this.resolution=n:this.resolution=30,e=Math.abs(e),this.r=e;let o=Math.random()*1e6;for(let l=0;l<this.resolution;l++){let a=new I(t.x,t.y);a.add(I.mult(I.fromAngle(l/this.resolution*Math.PI*2),e)),this.points.push(new si(a,new I(0,0),e*Math.sin(Math.PI/this.resolution),0,0,this.fc)),this.points[this.points.length-1].layer=o}this.sides=[];for(let l=0;l<this.resolution;l++){let a=new ni(2*e*Math.sin(Math.PI/this.resolution));a.attachObject(this.points[l]),a.attachObject(this.points[(l+1)%this.resolution]),l%2===0&&a.lockRotation(),this.sides.push(a)}}static updatePressureBasedForces(t,e){let s=[];if(s.push([]),t.points.forEach(o=>{s[0].push(new I(o.pos.x,o.pos.y))}),function(o){let l=I.angleACW(I.sub(o[1],o[0]),I.sub(o[o.length-1],o[0]));if(l>Math.PI)return!0;for(let a=1;a<o.length-1;a++)if(l=I.angleACW(I.sub(o[(a+1)%o.length],o[a]),I.sub(o[a-1],o[a])),l>Math.PI)return!0;return l=I.angleACW(I.sub(o[0],o[o.length-1]),I.sub(o[o.length-2],o[o.length-1])),l>Math.PI}(s[0])){let o=(r,h)=>{for(let d=0;d<r.length;d++)if(r[d]===h)return!0;return!1},l=function(r,h,d){for(let g=0;g<h.length;g++)if(!o(d,g)){let f=new it(new I(h[g].x,h[g].y),new I(h[(g+1)%h.length].x,h[(g+1)%h.length].y));if(it.intersect(r,f))return!0}return!1},a=!0;t:for(;a;){a=!1;for(let r=0;r<s.length;r++){let h=s[r],d=I.sub(h[1],h[0]),g=I.sub(h[h.length-1],h[0]),f=I.angleACW(d,g);if(f>Math.PI){a=!0;let p=0,y=p+2,x=new it(new I(h[p].x,h[p].y),new I(h[y%h.length].x,h[y%h.length].y)),M=new I(x.b.x-x.a.x,x.b.y-x.a.y).heading;for(;!(d.heading>g.heading?M>d.heading&&M<2*Math.PI||M>0&&M<g.heading:M>d.heading&&M<g.heading)||l(new it(new I(h[p%h.length].x,h[p%h.length].y),new I(h[y%h.length].x,h[y%h.length].y)),h,[(h.length-1)%h.length,p%h.length,(y-1)%h.length,y%h.length]);)y++,x=new it(new I(h[p].x,h[p].y),new I(h[y%h.length].x,h[y%h.length].y)),M=new I(x.b.x-x.a.x,x.b.y-x.a.y).heading;let S=[],w=[];for(let m=p;m<=y;m++)S.push(h[m%h.length]);for(let m=y;m<=p+h.length;m++)w.push(h[m%h.length]);s[r]=S,s.push(w);continue t}for(let p=1;p<h.length;p++){let y=I.sub(h[(p+1)%h.length],h[p]),x=I.sub(h[p-1],h[p]),M=I.angleACW(y,x);if(M>Math.PI){a=!0;let S=p+2,w=new it(new I(h[p].x,h[p].y),new I(h[S%h.length].x,h[S%h.length].y)),m=new I(w.b.x-w.a.x,w.b.y-w.a.y).heading;for(;!(y.heading>x.heading?m>y.heading&&m<2*Math.PI||m>0&&m<x.heading:m>y.heading&&m<x.heading)||l(w,h,[(p-1)%h.length,p%h.length,(S-1)%h.length,S%h.length]);)S++,w=new it(new I(h[p].x,h[p].y),new I(h[S%h.length].x,h[S%h.length].y)),m=new I(w.b.x-w.a.x,w.b.y-w.a.y).heading;let O=[],b=[];for(let j=p;j<=S;j++)O.push(h[j%h.length]);for(let j=S;j<=p+h.length;j++)b.push(h[j%h.length]);s[r]=O,s.push(b);continue t}}}}}for(let o=s.length-1;o>=0;o--){let l=s[o];for(;l.length>3;)s.push([l[0],l[1],l[2]]),l.splice(1,1)}let i=0;s.forEach(o=>{let l=Math.sqrt(Math.pow(o[0].x-o[1].x,2)+Math.pow(o[0].y-o[1].y,2)),a=Math.sqrt(Math.pow(o[1].x-o[2].x,2)+Math.pow(o[1].y-o[2].y,2)),r=Math.sqrt(Math.pow(o[2].x-o[0].x,2)+Math.pow(o[2].y-o[0].y,2)),h=(l+a+r)/2,d=Math.sqrt(h*(h-l)*(h-a)*(h-r));i+=d});let n=t.pressure*(t.r*t.r*Math.PI/i)-t.pressure;t.sides.forEach(o=>{let l=I.sub(o.objects[0].pos,o.objects[1].pos);l.mult(n),l.rotate(Math.PI/2),l.mult(e),o.objects[0].vel.add(I.div(l,o.objects[0].m)),o.objects[1].vel.add(I.div(l,o.objects[1].m))})}get sideSegments(){return this.points.map((t,e)=>new it(t.pos,this.points[(e+1)%this.points.length].pos))}containsPoint(t){let e=this.sideSegments,s=Math.max(...this.points.map(l=>I.dist(l.pos,t)))+1,i=I.fromAngle(0);i.setMag(s);let n=new it(t,I.add(i,t)),o=e.filter(l=>it.intersect(l,n)!=null);return o.length%2==1}toJSObject(){let t={};return t.pressure=this.pressure,t.fc=this.fc,t.r=this.r,t.resolution=this.resolution,t.points=this.points.map(e=>e.id),t.sides=this.sides.map(e=>e.id),t}static fromObject(t,e,s){let i=Object.create(Ct.prototype);return console.log(i),i.pressure=t.pressure,i.fc=t.fc,i.resolution=t.resolution,i.r=t.r,i.points=t.points.map(n=>{let o=e.filter(l=>n==l.id);return o[0]}),i.sides=t.sides.map(n=>{let o=s.filter(l=>n==l.id);return o[0]}),i}};ne.exports=Ct}),le=R((ns,re)=>{var c=_(),J=ct(),ss=Ot(),mt=class{constructor(t,e,s,i,n){this.points=t;let o=this.points,l=0,a=0,r=c.angleACW(c.sub(o[1],o[0]),c.sub(o[o.length-1],o[0]));l+=r,a+=Math.PI*2-r;for(let h=1;h<o.length-1;h++)r=c.angleACW(c.sub(o[(h+1)%o.length],o[h]),c.sub(o[h-1],o[h])),l+=r,a+=Math.PI*2-r;if(r=c.angleACW(c.sub(o[0],o[o.length-1]),c.sub(o[o.length-2],o[o.length-1])),l+=r,a+=Math.PI*2-r,a<l){let h=[];for(let d=o.length-1;d>=0;d--)h.push(o[d]);this.points=h}this.calculatePosAndMass(),this.lastPos=this.pos.copy,this.fc=.4,this.rotation=0,i?this.ang=i:this.ang=0,(n||n===0)&&(this.fc=n),s?this.k=s:this.k=.8,e!=null?this.vel=e.copy:this.vel=new c(0,0),this.id="_"+Math.random().toString(36).substr(2,9)}getAmInPoint(t){let e=this.am;return e+=c.sub(this.pos,t).sqlength*this.m,e}get copy(){let t=[];for(let s=0;s<this.points.length;s++)t.push(new c(this.points[s].x,this.points[s].y));let e=new mt(t,this.vel.copy,this.k,this.ang,this.fc);return e.rotation=this.rotation,e.lastPos=this.lastPos.copy,e.pos=this.pos.copy,e}move(t,e){this.pos.x+=t,this.pos.y+=e,this.points.forEach(s=>{s.x+=t,s.y+=e})}collideWithBall(t){let e,s,i;if(c.dist(t.pos,this.pos)>t.r+this.boundRadius)return;if(this.points.forEach((n,o)=>{let l=new c(n.x,n.y);if(l.x-=t.pos.x,l.y-=t.pos.y,l.length<=t.r){e=l.heading+Math.PI,s=l.length;let f=c.fromAngle(e);f.mult(t.r-s),this.move(f.x*-1*t.m/(this.m+t.m),f.y*-1*t.m/(this.m+t.m)),t.move(f.x*1*this.m/(this.m+t.m),f.y*1*this.m/(this.m+t.m)),i=new c(n.x,n.y);let p=c.fromAngle(e);p.mult(-30)}l=new c(n.x,n.y);let a=new c(this.points[(o+1)%this.points.length].x,this.points[(o+1)%this.points.length].y),r=new c(t.pos.x,t.pos.y),h=new c(a.x-l.x,a.y-l.y),d=h.heading;l.rotate(-d+Math.PI),a.rotate(-d+Math.PI),r.rotate(-d+Math.PI);let g=r.y-(l.y+a.y)/2;if(g>=-t.r&&g<=t.r&&r.x>=a.x&&r.x<=l.x){e=d-Math.PI/2,s=g;let f=c.fromAngle(e);f.mult(t.r-s),this.move(f.x*-1*t.m/(this.m+t.m),f.y*-1*t.m/(this.m+t.m)),t.move(f.x*1*this.m/(this.m+t.m),f.y*1*this.m/(this.m+t.m)),i=t.pos.copy,i.add(c.mult(c.fromAngle(e+Math.PI),g));let p=c.fromAngle(e);p.mult(-30)}}),e===0||e){let n=this.vel.copy,o=t.vel.copy,l=this.ang,a=t.ang,r=c.sub(i,this.pos),h=c.sub(i,t.pos),d=this.am,g=t.am,f=this.m,p=t.m,y=(this.k+t.k)/2,x=(this.fc+t.fc)/2,M=h.copy;M.setMag(-1);let S=this.velInPlace(i),w=t.velInPlace(i),m=c.sub(w,S),O=1/f+1/p;O+=c.dot(c.crossScalarFirst(c.cross(r,M)/d,r),M),O=-(1+y)*c.dot(m,M)/O;let b=c.sub(n,c.mult(M,O/f)),j=c.add(o,c.mult(M,O/p)),q=l-O*c.cross(r,M)/d,T=a,B=m.copy;B.sub(c.mult(M,c.dot(m,M))),B.setMag(1);let V=1/f+1/p;V+=c.dot(c.crossScalarFirst(c.cross(r,B)/d,r),B),V+=c.dot(c.crossScalarFirst(c.cross(h,B)/g,h),B),V=-c.dot(m,B)/V;let W=O*x;W>V&&(W=V),b=c.sub(b,c.mult(B,W/f)),j=c.add(j,c.mult(B,W/p)),q=q-W*c.cross(r,B)/d,T=T+W*c.cross(h,B)/g,this.vel=b,t.vel=j,this.ang=q,t.ang=T}}calculatePosAndMass(){let t=[];if(t.push([]),this.points.forEach(n=>{t[0].push(new c(n.x,n.y))}),this.isConcave){let n=(a,r)=>{for(let h=0;h<a.length;h++)if(a[h]===r)return!0;return!1},o=function(a,r,h){for(let d=0;d<r.length;d++)if(!n(h,d)){let g=new J(new c(r[d].x,r[d].y),new c(r[(d+1)%r.length].x,r[(d+1)%r.length].y));if(J.intersect(a,g))return!0}return!1},l=!0;t:for(;l;){l=!1;for(let a=0;a<t.length;a++){let r=t[a],h=c.sub(r[1],r[0]),d=c.sub(r[r.length-1],r[0]),g=c.angleACW(h,d);if(g>Math.PI){l=!0;let f=0,p=f+2,y=new J(new c(r[f].x,r[f].y),new c(r[p%r.length].x,r[p%r.length].y)),x=new c(y.b.x-y.a.x,y.b.y-y.a.y).heading;for(;!(h.heading>d.heading?x>h.heading&&x<2*Math.PI||x>0&&x<d.heading:x>h.heading&&x<d.heading)||o(new J(new c(r[f%r.length].x,r[f%r.length].y),new c(r[p%r.length].x,r[p%r.length].y)),r,[(r.length-1)%r.length,f%r.length,(p-1)%r.length,p%r.length]);)p++,y=new J(new c(r[f].x,r[f].y),new c(r[p%r.length].x,r[p%r.length].y)),x=new c(y.b.x-y.a.x,y.b.y-y.a.y).heading;let M=[],S=[];for(let w=f;w<=p;w++)M.push(r[w%r.length]);for(let w=p;w<=f+r.length;w++)S.push(r[w%r.length]);t[a]=M,t.push(S);continue t}for(let f=1;f<r.length;f++){let p=c.sub(r[(f+1)%r.length],r[f]),y=c.sub(r[f-1],r[f]),x=c.angleACW(p,y);if(x>Math.PI){l=!0;let M=f+2,S=new J(new c(r[f].x,r[f].y),new c(r[M%r.length].x,r[M%r.length].y)),w=new c(S.b.x-S.a.x,S.b.y-S.a.y).heading;for(;!(p.heading>y.heading?w>p.heading&&w<2*Math.PI||w>0&&w<y.heading:w>p.heading&&w<y.heading)||o(S,r,[(f-1)%r.length,f%r.length,(M-1)%r.length,M%r.length]);)M++,S=new J(new c(r[f].x,r[f].y),new c(r[M%r.length].x,r[M%r.length].y)),w=new c(S.b.x-S.a.x,S.b.y-S.a.y).heading;let m=[],O=[];for(let b=f;b<=M;b++)m.push(r[b%r.length]);for(let b=M;b<=f+r.length;b++)O.push(r[b%r.length]);t[a]=m,t.push(O);continue t}}}}}for(let n=t.length-1;n>=0;n--){let o=t[n];for(;o.length>3;)t.push([o[0],o[1],o[2]]),o.splice(1,1)}let e=0,s=0,i=new c(0,0);t.forEach(n=>{let o=Math.sqrt(Math.pow(n[0].x-n[1].x,2)+Math.pow(n[0].y-n[1].y,2)),l=Math.sqrt(Math.pow(n[1].x-n[2].x,2)+Math.pow(n[1].y-n[2].y,2)),a=Math.sqrt(Math.pow(n[2].x-n[0].x,2)+Math.pow(n[2].y-n[0].y,2)),r=(o+l+a)/2,h=Math.sqrt(r*(r-o)*(r-l)*(r-a));e+=h,i.x+=h*(n[0].x+n[1].x+n[2].x)/3,i.y+=h*(n[0].y+n[1].y+n[2].y)/3}),i.div(e),this.pos=i,this.m=e;for(let n of t){let o=Math.sqrt(Math.pow(n[0].x-n[1].x,2)+Math.pow(n[0].y-n[1].y,2)),l=Math.sqrt(Math.pow(n[1].x-n[2].x,2)+Math.pow(n[1].y-n[2].y,2)),a=Math.sqrt(Math.pow(n[2].x-n[0].x,2)+Math.pow(n[2].y-n[0].y,2)),r=Math.max(o,l,a),h=(o+l+a)/2,d=Math.sqrt(h*(h-o)*(h-l)*(h-a)),g=2*d/r,f=Math.sqrt(Math.min(o,a,l)**2-g*g),p=g*r*(g*g+r*r)/24,y=Math.sqrt(g*g/36+(Math.abs(f-r/2)/3)**2);p-=y*y*d,p+=new c((n[0].x+n[1].x+n[2].x)/3,(n[0].y+n[1].y+n[2].y)/3).dist(this.pos)**2*d,s+=p}this.am=s,this.boundRadius=Math.max(...this.points.map(n=>c.dist(n,this.pos)))}rotate(t){this.points.forEach(e=>{let s=new c(e.x,e.y);s.sub(this.pos),s.rotate(t),s.add(this.pos),e.x=s.x,e.y=s.y}),this.rotation+=t}get isConcave(){let t=this.points,e=c.angleACW(c.sub(t[1],t[0]),c.sub(t[t.length-1],t[0]));if(e>Math.PI)return!0;for(let s=1;s<t.length-1;s++)if(e=c.angleACW(c.sub(t[(s+1)%t.length],t[s]),c.sub(t[s-1],t[s])),e>Math.PI)return!0;return e=c.angleACW(c.sub(t[0],t[t.length-1]),c.sub(t[t.length-2],t[t.length-1])),e>Math.PI}static collide(t,e){let s=0,i=0,n=new c(0,0),o=[],l=!1;if(t.points.forEach((b,j)=>{let q=new J(new c(b.x,b.y),new c(t.points[(j+1)%t.points.length].x,t.points[(j+1)%t.points.length].y));e.points.forEach((T,B)=>{let V=new J(new c(T.x,T.y),new c(e.points[(B+1)%e.points.length].x,e.points[(B+1)%e.points.length].y)),W=J.intersect(q,V);W&&(s++,n.add(W),o.push(W),l=!0)})}),!l)return;n.div(s);for(let b=0;b<Math.floor(s/2);b++)i+=c.sub(o[2*b+1],o[2*b]).heading;i/=s/2,i+=Math.PI/2;let a=c.fromAngle(i),r=t.ang,h=t.vel.copy,d=e.ang,g=e.vel.copy,f=0,p=0,y=0,x=0;for(let b of t.points)f=Math.min(c.dot(a,c.sub(new c(b.x,b.y),n)),f),p=Math.max(c.dot(a,c.sub(new c(b.x,b.y),n)),p);for(let b of e.points)y=Math.min(c.dot(a,c.sub(new c(b.x,b.y),n)),y),x=Math.max(c.dot(a,c.sub(new c(b.x,b.y),n)),x);Math.abs(f-x)<Math.abs(y-p)?(t.move(-a.x*f,-a.y*f),e.move(-a.x*x,-a.y*x)):(t.move(-a.x*p,-a.y*p),e.move(-a.x*y,-a.y*y));let M=o,S=[],w=[],m=[],O=[];for(let b of M){let j=c.fromAngle(i),q=b,T=t.vel.copy,B=e.vel.copy,V=t.ang,W=e.ang,G=c.sub(q,t.pos),D=c.sub(q,e.pos),Q=t.am,Z=e.am,St=t.m,kt=e.m,Ze=(t.k+e.k)/2,$e=(t.fc+e.fc)/2,_e=t.velInPlace(q),ti=e.velInPlace(q),It=c.sub(ti,_e),nt=1/St+1/kt;nt+=c.dot(c.crossScalarFirst(c.cross(G,j)/Q,G),j),nt+=c.dot(c.crossScalarFirst(c.cross(D,j)/Z,D),j),nt=-(1+Ze)*c.dot(It,j)/nt;let Wt=c.sub(T,c.mult(j,nt/St)),Rt=c.add(B,c.mult(j,nt/kt)),Dt=V-nt*c.cross(G,j)/Q,Lt=W+nt*c.cross(D,j)/Z,$=It.copy;$.sub(c.mult(j,c.dot(It,j))),$.setMag(1);let dt=1/St+1/kt;dt+=c.dot(c.crossScalarFirst(c.cross(G,$)/Q,G),$),dt+=c.dot(c.crossScalarFirst(c.cross(D,$)/Z,D),$),dt=-c.dot(It,$)/dt;let ft=nt*$e;ft>dt&&(ft=dt),Wt=c.sub(Wt,c.mult($,ft/St)),Rt=c.add(Rt,c.mult($,ft/kt)),Dt=Dt-ft*c.cross(G,$)/Q,Lt=Lt+ft*c.cross(D,$)/Z,t.vel=Wt,e.vel=Rt,t.ang=Dt,e.ang=Lt,S.push(t.ang),m.push(t.vel),w.push(e.ang),O.push(e.vel),t.ang=r,t.vel=h,e.ang=d,e.vel=g}if(S.length!=m.length)return;if(S.length==0)return;if(m.length==0)return;if(w.length!=O.length)return;if(w.length==0)return;if(O.length==0)return;t.vel=m.reduce((b,j)=>c.add(b,j)),t.vel.div(m.length),t.ang=S.reduce((b,j)=>b+j),t.ang/=S.length,e.vel=O.reduce((b,j)=>c.add(b,j)),e.vel.div(O.length),e.ang=w.reduce((b,j)=>b+j),e.ang/=w.length}collideWithFixedBall(t){let e=new c(t.x,t.y),s;if(c.dist(e,this.pos)>this.boundRadius+t.r)return;for(let m of this.sides){let O,b;if(O=c.angle(c.sub(m.a,m.b),c.sub(e,m.b)),b=c.angle(c.sub(m.b,m.a),c.sub(e,m.a)),O<Math.PI/2&&b<Math.PI/2){let j=m.distFromPoint(e);if(j<=t.r){let q=c.sub(m.a,m.b);q.rotate(Math.PI/2),q.setMag(t.r*2);let T=c.mult(q,-1),B=new J(c.add(q,e),c.add(T,e));s=J.intersect(B,m),s!=null&&(q=c.sub(s,e),q.setMag(t.r-q.length),this.move(q.x,q.y))}}}if(!s||s==null){t:for(let m of this.points)if(c.dist(m,e)<t.r){let O=c.sub(m,e);O.setMag(t.r-O.length),this.move(O.x,O.y),O.setMag(t.r),s=c.add(e,O);break t}}if(!s||s==null)return;let i=c.sub(s,e);i.setMag(1);let n=s,o=this.vel.copy,l=this.ang,a=c.sub(n,this.pos),r=this.am,h=this.m,d=this.k,g=this.fc,f=c.mult(this.velInPlace(n),-1),p=1/h;p+=c.dot(c.crossScalarFirst(c.cross(a,i)/r,a),i),p=-(1+d)*c.dot(f,i)/p;let y=c.sub(o,c.mult(i,p/h)),x=l-p*c.cross(a,i)/r,M=f.copy;M.sub(c.mult(i,c.dot(f,i))),M.setMag(1);let S=1/h;S+=c.dot(c.crossScalarFirst(c.cross(a,M)/r,a),M),S=-c.dot(f,M)/S;let w=p*g;w>S&&(w=S),y=c.sub(y,c.mult(M,w/h)),x=x-w*c.cross(a,M)/r,this.vel=y,this.ang=x}collideWithWall(t){if(this.boundRadius+t.boundRadius<c.dist(this.pos,t.center))return;let e=this.sides,s=[],i=[];for(let p of e)for(let y of t.sides){let x=J.intersect(p,y);x!=null&&i.push(x)}if(i.length<2)return;let n=this.vel.copy,o=this.ang,l=[],a=[],r=c.sub(...i);r.rotate(Math.PI/2);let h=c.sub(i[0],this.pos);c.dot(r,h)>0&&r.mult(-1),r.setMag(1),c.dot(r,c.sub(this.pos,t.center))<0&&r.mult(-1),s.push(new J(...i)),s.push(new J(i[0],c.add(i[0],c.mult(r,20)))),s.push(new J(i[1],c.add(i[1],c.mult(r,20))));let d=[],g=i[0];for(let p of t.points){let y=c.sub(p,g),x=c.dot(y,r);x>0&&d.push(x)}if(d.length>0){let p=r.copy;p.mult(Math.max(...d)),this.move(p.x,p.y)}d=[];let f=c.add(...i);if(f.div(2),this.containsPoint(f))for(let p of e)d.push(p.distFromPoint(f));if(d.length>0){let p=r.copy;p.mult(Math.min(...d)),p.length<this.boundRadius/2&&this.move(p.x,p.y)}for(let p of i){let y=r;y.setMag(1);let x=p,M=this.vel.copy,S=this.ang,w=c.sub(x,this.pos),m=this.am,O=this.m,b=this.k,j=this.fc,q=c.mult(this.velInPlace(x),-1),T=1/O;T+=c.dot(c.crossScalarFirst(c.cross(w,y)/m,w),y),T=-(1+b)*c.dot(q,y)/T;let B=c.sub(M,c.mult(y,T/O)),V=S-T*c.cross(w,y)/m,W=q.copy;W.sub(c.mult(y,c.dot(q,y))),W.setMag(1);let G=1/O;G+=c.dot(c.crossScalarFirst(c.cross(w,W)/m,w),W),G=-c.dot(q,W)/G;let D=T*j;D>G&&(D=G),B=c.sub(B,c.mult(W,D/O)),V=V-D*c.cross(w,W)/m,this.vel=B,this.ang=V,l.push(this.vel),this.vel=n.copy,a.push(this.ang),this.ang=o}return a.length!=l.length||(a.length==0||l.length==0)?void 0:(this.vel=l.reduce((p,y)=>c.add(p,y)),this.vel.div(l.length),this.ang=a.reduce((p,y)=>p+y),this.ang/=a.length,(!isFinite(this.vel.x)||!isFinite(this.vel.y)||!isFinite(this.ang))&&(this.vel=n,this.ang=o),s)}containsPoint(t){let e=this.sides,s=Math.max(...this.points.map(l=>c.dist(l,t)))+1,i=c.fromAngle(0);i.setMag(s);let n=new J(t,c.add(i,t)),o=e.filter(l=>J.intersect(l,n)!=null);return o.length%2==1}get sides(){return this.points.map((t,e)=>new J(t,this.points[(e+1)%this.points.length]))}velInPlace(t){let e=c.sub(t,this.pos);return e.rotate(Math.PI/2),e.mult(this.ang),e.add(this.vel),e}effectiveMass(t,e){let s=c.sub(t,this.pos),i=c.angle(e,s),n=Math.sin(i)**2*s.length**2/this.am;return 1/(n+1/this.m)}applyDeltaVelInPoint(t,e){let s=c.sub(e,this.pos);if(s.length==0){this.vel.add(t);return}let i=c.angle(s,t),n=c.mult(s,c.dot(t,s)/s.length**2);this.vel.add(n);let o=s.copy;o.rotate(Math.PI/2),o.setMag(1);let l=Math.sign(c.dot(t,o)),a=t.length*Math.cos(i),r=1/(1/this.m+s.length**2/this.am),h=a*r/this.m;this.vel.add(c.mult(o,h*l));let d=l*a*r*s.length/this.am;console.log(i),this.ang-=d}toJSObject(){let t={};return t.points=this.points.map(e=>({x:e.x,y:e.y})),t.vel=this.vel.toJSObject(),t.k=this.k,t.ang=this.ang,t.fc=this.fc,t.pos=this.pos.toJSObject(),t.lastPos=this.lastPos.toJSObject(),t.rotation=this.rotation,t.id=this.id,t}static fromObject(t){let e=new mt(t.points.map(s=>({x:s.x,y:s.y})),c.fromObject(t.vel),t.k,t.ang,t.fc);return e.id=t.id,e.pos=c.fromObject(t.pos),e.lastPos=c.fromObject(t.lastPos),e.rotation=t.rotation,e}};re.exports=mt}),Vt=R((os,ae)=>{var U=_(),oi=ct(),he=class extends oi{constructor(t,e){super(t,e)}get length(){return Number.POSITIVE_INFINITY}distFromPoint(t){let e=U.sub(this.a,this.b);e.setMag(1),e.rotate(Math.PI/2);let s=U.sub(t,this.a),i=Math.abs(U.dot(s,e));return i}static intersect(t,e){let s=U.sub(t.b,t.a),i=s.y/s.x,n=t.b.y-t.b.x*i,o=U.sub(e.b,e.a),l=o.y/o.x,a=e.b.y-e.b.x*l;if(i===l)return t.distFromPoint(e.a)==0?new U((t.a.x+t.b.x+e.a.x+e.b.x)/4,(t.a.y+t.b.y+e.a.y+e.b.y)/4):void 0;{let r=(a-n)/(i-l);return new U(r,i*r+n)}}static intersectWithLineSegment(t,e){let s=U.sub(t.b,t.a),i=s.y/s.x,n=t.b.y-t.b.x*i,o=U.sub(e.b,e.a),l=o.y/o.x,a=e.b.y-e.b.x*l;if(s.x===0){if(o.x===0)return t.a.x==e.a.x?new U((e.a.x+e.b.x)/2,(e.a.y+e.b.y)/2):void 0;let r=t.a.x,h=l*r+a;return Math.min(e.a.x,e.b.x)<r&&r<Math.max(e.a.x,e.b.x)&&Math.min(e.a.y,e.b.y)<h&&Math.max(e.a.y,e.b.y)>h?new U(r,h):void 0}if(o.x===0){let r=e.a.x,h=i*r+n;return Math.min(e.a.x,e.b.x)<r&&r<Math.max(e.a.x,e.b.x)&&Math.min(e.a.y,e.b.y)<h&&Math.max(e.a.y,e.b.y)>h?new U(r,h):void 0}if(i===l)return t.distFromPoint(e.a)===0?new U((e.a.x+e.b.x)/2,(e.a.y+e.b.y)/2):void 0;{let r=(a-n)/(i-l),h=i*r+n;return Math.min(e.a.x,e.b.x)<r&&r<Math.max(e.a.x,e.b.x)&&Math.min(e.a.y,e.b.y)<h&&Math.max(e.a.y,e.b.y)>h?new U(r,h):void 0}}};ae.exports=he}),ue=R((rs,ce)=>{var A=_(),xt=ct(),At=Vt(),st=class{constructor(t){if(t.length<3)throw new Error("Not enough points in polygon (minimum required: 3)");this.points=t,this.makeAntiClockwise()}getSideVector(t){return t<0&&(t+=Math.abs(Math.floor(t))*this.points.length),A.sub(this.points[(t+1)%this.points.length],this.points[t%this.points.length])}getSideSegment(t){return t<0&&(t+=Math.abs(Math.floor(t))*this.points.length),new xt(this.points[(t+1)%this.points.length],this.points[t%this.points.length])}getSideLine(t){return t<0&&(t+=Math.abs(Math.floor(t))*this.points.length),new At(this.points[(t+1)%this.points.length],this.points[t%this.points.length])}get sides(){return this.points.length}makeAntiClockwise(){let t=0;for(let e=1;e<=this.sides;e++){let s=this.getSideVector(e),i=this.getSideVector(e-1);i.mult(-1),t+=A.angleACW(s,i)}if(this.sides===3)t>Math.PI*1.5&&this.reverseOrder();else if(this.sides===4)A.angleACW(this.getSideVector(1),this.getSideVector(0))>=Math.PI&&this.reverseOrder();else if(this.sides>4){let e=t-this.sides*Math.PI;e>0&&this.reverseOrder()}}reverseOrder(){this.points=this.points.reverse()}isPointInside(t){if(A.dist(t,this.centerPoint)>this.boundRadius)return!1;let e=this.centerPoint.copy;e.add(A.mult(new A(1.1,.6),this.boundRadius));let s=new xt(t,e),i=0;if([...Array(this.sides).keys()].map(n=>this.getSideSegment(n)).forEach(n=>{xt.intersect(n,s)&&i++}),i%2==0)return!1;if(i%2==1)return!0}get centerPoint(){let t=new A(0,0);return this.points.forEach(e=>{t.add(e)}),t.div(this.sides),t}get boundRadius(){let t=this.centerPoint;return Math.max(...this.points.map(e=>A.dist(e,t)))}get allSides(){return[...Array(this.sides).keys()].map(t=>this.getSideSegment(t))}static intersection(t,e){if(A.dist(t.centerPoint,e.centerPoint)>t.boundRadius+e.boundRadius)return;let s=[],i=t.allSides,n=e.allSides;if(i.forEach((d,g)=>{n.forEach((f,p)=>{let y=xt.intersect(d,f);y&&(y.isIntersectionPoint=!0,s.push({intersectionPoint:y,sideNumber1:g,sideNumber2:p}))})}),s.length===0){if(t.isPointInside(e.points[0]))return new st(e.points.map(d=>d.copy));if(e.isPointInside(t.points[0]))return new st(t.points.map(d=>d.copy))}let o=new st(t.points.map(d=>d.copy));for(let d=o.points.length-1;d>=0;d--){let g=s.filter(f=>f.sideNumber1==d);g.length>1&&g.sort((f,p)=>A.dist(o.points[d],f.intersectionPoint)-A.dist(o.points[d],p.intersectionPoint)),g.length>0&&o.points.splice(d+1,0,...g.map(f=>f.intersectionPoint))}let l=new st(e.points.map(d=>d.copy));for(let d=l.points.length-1;d>=0;d--){let g=s.filter(f=>f.sideNumber2==d);g.length>1&&g.sort((f,p)=>A.dist(l.points[d],f.intersectionPoint)-A.dist(l.points[d],p.intersectionPoint)),g.length>0&&l.points.splice(d+1,0,...g.map(f=>f.intersectionPoint))}let a={polyNum:1,pointNum:0};for(let d=0;d<o.points.length;d++)if(o.points[d].isIntersectionPoint){a.pointNum=d;break}else if(l.isPointInside(o.points[d])){a.pointNum=d;break}let r=!1,h=[];for(;!r;){let d=a.polyNum===1?o:l,g=a.polyNum===1?l:o;if(h.push(d.points[a.pointNum%d.points.length].copy),h.length>2&&h[0].x==h[h.length-1].x&&h[0].y==h[h.length-1].y){h.pop();break}if(h.length>o.points.length+l.points.length)break;d.points[a.pointNum%d.points.length].isIntersectionPoint?d.points[(a.pointNum+1)%d.points.length].isIntersectionPoint||g.isPointInside(d.points[(a.pointNum+1)%d.points.length])&&!d.points[(a.pointNum+1)%d.points.length].isIntersectionPoint?a.pointNum++:(a.pointNum=g.points.indexOf(d.points[a.pointNum%d.points.length])+1,a.polyNum=a.polyNum===1?2:1):a.pointNum++}return new st(h)}static createCircle(t,e,s=25){let i=[...Array(s).keys()].map(n=>{let o=A.fromAngle(2*Math.PI*n/s);return o.setMag(t),o.add(e),o});return new st(i)}static fracture(t,e=500){let s=t.map((i,n)=>{let o=[];for(let a=0;a<t.length;a++){if(n===a)continue;let r=t[a],h=A.div(A.add(i,r),2),d=A.sub(i,r);d.rotate(Math.PI/2),o.push(new At(h,A.add(d,h)))}o=o.filter((a,r)=>{let h=new xt(a.a,i);for(let d=0;d<o.length;d++){if(r===d)continue;let g=At.intersectWithLineSegment(o[d],h);if(g)return!1}return!0}),o=o.sort((a,r)=>A.sub(a.a,a.b).heading-A.sub(r.a,r.b).heading);let l=o.map((a,r)=>{let h=[];for(let g=0;g<o.length;g++){if(r===g)continue;let f=At.intersect(a,o[g]);f&&h.push(f)}let d=A.sub(a.a,a.b);return h=h.filter(g=>{let f=A.sub(g,i);d.setMag(1);let p=A.dot(f,d);return p>0}),h.length===0&&h.push(A.add(A.mult(d,e*1.2),a.a)),h=h.sort((g,f)=>A.dist(g,i)-A.dist(f,i)),h[0]});return l});return s.filter(i=>i.length>=3).map(i=>new st(i))}};ce.exports=st}),fe=R((ls,de)=>{de.exports={name:"ballphysics",version:"1.6.0",description:"2D rigid body physics engine to-be",main:"./src/physics.js",scripts:{test:"jest --verbose ./tests",build:"esbuild editor/src/index.js --bundle --minify --sourcemap --target=chrome58,firefox57,safari11,edge16 --outfile=dest/main.js && cp editor/static/index.html dest/index.html"},repository:{type:"git",url:"git+https://github.com/AkosSeres/BallPhysics.git"},keywords:["physics","2d","rigid","balls"],author:"Akos Seres",license:"LGPL-2.1",bugs:{url:"https://github.com/AkosSeres/BallPhysics/issues"},homepage:"https://github.com/AkosSeres/BallPhysics#readme",devDependencies:{esbuild:"^0.8.26",eslint:"^6.0.1","eslint-config-google":"^0.9.1",jest:"^26.4.2"},dependencies:{}}}),at=R((as,pe)=>{var F=_(),Xt=Ot(),bt=te(),ri=ct(),ge=qt(),lt=Jt(),Ft=oe(),vt=le(),li=Vt(),ai=ue(),H=class{constructor(){this.balls=[],this.bodies=[],this.fixedBalls=[],this.softBalls=[],this.walls=[],this.bounds=[],this.springs=[],this.airFriction=1,this.gravity=new F(0,0),this.debugData=[]}update(t,e){this.debugData=[];let s=e?this.copy:new H;e&&(s.bodies.reverse(),s.balls.reverse(),s.update(t,!1));for(let i=0;i<this.balls.length;i++)this.balls[i].lastPos=this.balls[i].pos.copy,this.balls[i].pos.add(F.mult(this.balls[i].vel,t)),this.balls[i].rotation+=this.balls[i].ang*t,this.balls[i].rotation%=Math.PI*2;for(let i=0;i<this.bodies.length;i++)this.bodies[i].lastPos=this.bodies[i].pos.copy,this.bodies[i].move(this.bodies[i].vel.x*t,this.bodies[i].vel.y*t),this.bodies[i].rotate(this.bodies[i].ang*t);for(let i=0;i<3;i++)for(let n of this.springs)n.update(t/3/2);for(let i=0;i<this.balls.length;i++){this.gravity&&this.balls[i].vel.add(new F(this.gravity.x*t,this.gravity.y*t));for(let n=i+1;n<this.balls.length;n++)(this.balls[i].layer!=this.balls[n].layer||!this.balls[i].layer&&!this.balls[n].layer)&&Xt.collide(this.balls[i],this.balls[n]);for(let n of this.walls)n.collideWithBall(this.balls[i]);for(let n of this.fixedBalls){let o=this.balls[i],l,a=0,r=new F(n.x,n.y);r.x-=o.pos.x,r.y-=o.pos.y,r.mult(-1),r.length<=o.r+n.r&&(l=r.heading,a=r.length);t:if(isFinite(l)){let h=o.pos.copy,d=o.vel.copy;if(h.rotate(-l+Math.PI/2),d.rotate(-l+Math.PI/2),d.y>0)break t;d.y*=-o.k,h.y+=o.r+n.r-a;let g=d.y*(1+o.k),f=Math.sign(d.x+o.ang*o.r)*(g*o.fc)/(o.amc*o.r),p=(d.x+o.ang*o.r)/o.r;f/p>1&&(f=p),o.ang-=f;let y=f*o.am/o.r/o.m;d.x-=y,h.rotate(l-Math.PI/2),d.rotate(l-Math.PI/2),o.pos.x=h.x,o.pos.y=h.y,o.vel.x=d.x,o.vel.y=d.y}}for(let n of this.bounds)n.collideWithBall(this.balls[i])}for(let i=0;i<this.bodies.length;i++){for(let n of this.balls)(n.layer!=this.bodies[i].layer||!n.layer&&!this.bodies[i].layer)&&this.bodies[i].collideWithBall(n);for(let n=i+1;n<this.bodies.length;n++)(this.bodies[i].layer!=this.bodies[n].layer||!this.bodies[n].layer&&!this.bodies[i].layer)&&vt.collide(this.bodies[i],this.bodies[n]);for(let n of this.bodies)for(let o of this.fixedBalls)n.collideWithFixedBall(o);for(let n of this.bodies)for(let o of this.walls){let l=n.collideWithWall(o);l&&this.debugData.push(...l)}for(let n of this.bodies)for(let o of this.bounds){let l=n.collideWithWall(o);l&&this.debugData.push(...l)}this.gravity&&this.bodies[i].vel.add(new F(this.gravity.x*t,this.gravity.y*t))}this.softBalls.forEach(i=>{Ft.updatePressureBasedForces(i,t)});for(let i=0;i<3;i++)for(let n of this.springs)n.update(t/3/2);this.balls.forEach(i=>{i.vel.mult(Math.pow(this.airFriction,t)),i.ang*=Math.pow(this.airFriction,t)}),this.bodies.forEach(i=>{i.vel.mult(Math.pow(this.airFriction,t)),i.ang*=Math.pow(this.airFriction,t)}),e&&(s.bodies.reverse(),s.balls.reverse(),this.balls.forEach((i,n)=>{i.move((s.balls[n].pos.x-i.pos.x)*.5,(s.balls[n].pos.y-i.pos.y)*.5),i.vel.add(new F((s.balls[n].vel.x-i.vel.x)*.5,(s.balls[n].vel.y-i.vel.y)*.5)),i.rotation=(i.rotation+s.balls[n].rotation)/2,i.ang=(i.ang+s.balls[n].ang)/2}),this.bodies.forEach((i,n)=>{let o=s.bodies[n];i.move((o.pos.x-i.pos.x)*.5,(o.pos.y-i.pos.y)*.5),i.vel.add(new F((o.vel.x-i.vel.x)*.5,(o.vel.y-i.vel.y)*.5)),i.rotate((o.rotation-i.rotation)/2),i.ang=(i.ang+o.ang)/2}))}get copy(){let t=new H;return t.balls=this.getCopyOfBalls(),t.bodies=this.getCopyOfBodies(),t.fixedBalls=this.fixedBalls,t.walls=this.walls,t.bounds=this.bounds,t.gravity=this.gravity,this.springs.forEach(e=>{let s=e.constructor==lt?lt:ge,i=new s(e.length,e.springConstant);i.rotationLocked=e.rotationLocked,i.pinned=e.pinned,e.objects.forEach(n=>{let o=this.balls.indexOf(n);o!=-1?i.attachObject(t.balls[o]):(o=this.bodies.indexOf(n),o!=-1&&i.attachObject(t.bodies[o]))}),t.springs.push(i)}),t}setAirFriction(t){if(!isFinite(t))return;this.airFriction=t,this.airFriction<0&&(this.airFriction=0),this.airFriction>1&&(this.airFriction=1)}setGravity(t){this.gravity=t.copy}addBall(t){if(typeof addBodyNotBall!="undefined"&&isFinite(addBodyNotBall)&&addBodyNotBall>2){let e=(s,i,n)=>{let o=[];for(let l=0;l<n;l++){let a=F.fromAngle(l/n*2*Math.PI);a.mult(i),a.add(s),o.push(a)}return o};this.bodies.push(new vt(e(t.pos,t.r,addBodyNotBall),t.vel,t.k,t.ang,t.fc))}else this.balls.push(t)}addBody(t){this.bodies.push(t)}addSoftBall(t){this.balls.push(...t.points),this.springs.push(...t.sides),this.softBalls.push(t)}addSoftSquare(t,e,s,i){let n=new Ft(t,Math.sqrt(e*e/Math.PI),1,s,24);n.sides.forEach(a=>{a.length=.96*4*e/n.resolution}),n.points.forEach(a=>{a.vel=i.copy}),this.balls.push(...n.points),this.springs.push(...n.sides);let o=e*e*200,l=new lt(Math.sqrt(n.r*n.r*Math.PI),o/2);l.attachObject(n.points[0]),l.attachObject(n.points[n.resolution/2]),this.springs.push(l),l=new lt(Math.sqrt(n.r*n.r*Math.PI),o/2),l.attachObject(n.points[n.resolution/4]),l.attachObject(n.points[3*n.resolution/4]),this.springs.push(l),l=new lt(Math.sqrt(2*n.r*n.r*Math.PI),o),l.attachObject(n.points[n.resolution/8]),l.attachObject(n.points[5*n.resolution/8]),this.springs.push(l),l=new lt(Math.sqrt(2*n.r*n.r*Math.PI),o),l.attachObject(n.points[3*n.resolution/8]),l.attachObject(n.points[7*n.resolution/8]),this.springs.push(l)}addRectWall(t,e,s,i){let n=[];n.push(new F(t-s/2,e-i/2)),n.push(new F(t+s/2,e-i/2)),n.push(new F(t+s/2,e+i/2)),n.push(new F(t-s/2,e+i/2)),this.walls.push(new bt(n))}addRectBody(t,e,s,i,n,o){let l=[];l.push(new F(t-s/2,e-i/2)),l.push(new F(t+s/2,e-i/2)),l.push(new F(t+s/2,e+i/2)),l.push(new F(t-s/2,e+i/2)),this.bodies.push(new vt(l,new F(0,0),o,0,n))}addWall(t){this.walls.push(t)}addFixedBall(t,e,s){this.fixedBalls.push({x:t,y:e,r:s})}addSpring(t){this.springs.push(t)}setBounds(t,e,s,i){this.bounds=[];let n=(o,l,a,r)=>{let h=[];return h.push(new F(o-a/2,l-r/2)),h.push(new F(o+a/2,l-r/2)),h.push(new F(o+a/2,l+r/2)),h.push(new F(o-a/2,l+r/2)),new bt(h)};this.bounds.push(n(t-s,e,2*s,4*i)),this.bounds.push(n(t+2*s,e,2*s,4*i)),this.bounds.push(n(t,e-i,4*s,i*2)),this.bounds.push(n(t,e+2*i,4*s,2*i))}getObjectAtCoordinates(t,e){let s,i=new F(t,e);return this.balls.forEach(n=>{n.containsPoint(i)&&(s=n)}),this.bodies.forEach(n=>{n.containsPoint(i)&&(s=n)}),this.walls.forEach(n=>{n.containsPoint(i)&&(s=n)}),this.fixedBalls.forEach(n=>{F.dist(new F(n.x,n.y),new F(t,e))<=n.r&&(s=n)}),this.softBalls.forEach(n=>{n.containsPoint(i)&&(s=n)}),s}getCopyOfBalls(){let t=[];return this.balls.forEach(e=>{t.push(e.copy)}),t}getCopyOfBodies(){let t=[];return this.bodies.forEach(e=>{t.push(e.copy)}),t}removeObjFromSystem(t){let e=this.balls.indexOf(t);if(e!=-1){let s=!1;if(this.softBalls.forEach(i=>{i.points.includes(this.balls[e])&&(this.removeObjFromSystem(i),s=!0)}),s)return;this.springs.forEach(i=>{i.objects.includes(this.balls[e])&&this.removeObjFromSystem(i)}),this.balls.splice(e,1);return}if(e=this.bodies.indexOf(t),e!=-1){this.bodies.splice(e,1);return}if(e=this.walls.indexOf(t),e!=-1){this.walls.splice(e,1);return}if(e=this.fixedBalls.indexOf(t),e!=-1){this.fixedBalls.splice(e,1);return}if(e=this.springs.indexOf(t),e!=-1){this.springs.splice(e,1);let s=!1;return this.softBalls.forEach(i=>{i.points.includes(this.springs[e])&&(this.removeObjFromSystem(i),s=!0)}),s,void 0}if(e=this.softBalls.indexOf(t),e!=-1){let s=this.softBalls[e];this.softBalls.splice(e,1),s.points.forEach(i=>{this.removeObjFromSystem(i)});return}}getItemDataFromId(){let t={},e=o=>o.id===id,s=this.balls.filter(e);if(s.length>=1)return t.type="ball",t.num=this.balls.indexOf(s[0]),t;let i=this.bodies.filter(e);if(i.length>=1)return t.type="body",t.num=this.bodies.indexOf(i[0]),t;let n=this.springs.filter(e);if(n.length>=1)return t.type="spring",t.num=this.springs.indexOf(n[0]),t}toJSObject(){let t={};return t.balls=this.balls.map(e=>e.toJSObject()),t.bounds=this.bounds.map(e=>e.toJSObject()),t.walls=this.walls.map(e=>e.toJSObject()),t.bodies=this.bodies.map(e=>e.toJSObject()),t.springs=this.springs.map(e=>e.toJSObject()),t.softBalls=this.softBalls.map(e=>e.toJSObject()),t.fixedBalls=this.fixedBalls,t.airFriction=this.airFriction,t.gravity=this.gravity.toJSObject(),t.version=fe().version,t}static fromObject(t){let e=new H;return e.balls=t.balls.map(s=>Xt.fromObject(s)),e.bounds=t.bounds.map(s=>bt.fromObject(s)),e.walls=t.walls.map(s=>bt.fromObject(s)),e.bodies=t.bodies.map(s=>vt.fromObject(s)),e.springs=t.springs.map(s=>lt.fromObject(s,e.balls)),e.softBalls=t.softBalls.map(s=>Ft.fromObject(s,e.balls,e.springs)),e.fixedBalls=t.fixedBalls,e.airFriction=t.airFriction,e.gravity=F.fromObject(t.gravity),e}toJSON(){return JSON.stringify(this.toJSObject())}static fromJSON(t){return H.fromObject(JSON.parse(t))}};H.Ball=Xt;H.Body=vt;H.Vec2=F;H.Wall=bt;H.LineSegment=ri;H.Spring=lt;H.Stick=ge;H.SoftBall=Ft;H.Line=li;H.Polygon=ai;pe.exports=H}),we=R((hs,ye)=>{var hi=at();ye.exports=function(u){this.startingState=u.getPhysics().toJSObject(),this.inStartingState=!0,document.getElementById("pause").onclick=()=>{u.getTimeMultiplier()!==0?u.setTimeMultiplier(0):(u.setTimeMultiplier(1),this.inStartingState==!0&&(this.startingState=u.getPhysics().toJSObject()),this.inStartingState=!1)},document.getElementById("revert").onclick=()=>{u.setTimeMultiplier(0),u.setPhysics(hi.fromObject(this.startingState)),this.inStartingState=!0},document.getElementById("clear all").onclick=()=>{this.inStartingState=!0;let t=u.getPhysics();t.balls=[],t.walls=[],t.softBalls=[],t.springs=[],t.bodies=[]},document.getElementById("set start").onclick=()=>{this.startingState=u.getPhysics().toJSObject(),this.inStartingState=!0,u.setTimeMultiplier(0)}}}),tt=R((cs,me)=>{var xe=class{constructor(t,e,s,i,n,o,l){this.name=t,this.description=e,this.drawFunc=s,this.startInteractionFunc=i,this.endInteractionFunc=n,this.keyGotUpFunc=o,this.keyGotDownFunc=l}};me.exports=xe}),ve=R((us,be)=>{var ci=tt(),Yt=at(),ui=new ci("Ball creator","",function(u,t,e,s,i,n,o,l,a,r){u.strokeStyle="black",u.beginPath(),u.arc(t,e,n,0,2*Math.PI),u.stroke(),s!=0&&i!=0&&(u.beginPath(),u.moveTo(t,e),u.lineTo(s,i),u.stroke())},function(u,t,e,s,i){},function(u,t,e,s,i,n,o){if(n!=0&&o!=0){let l=new Yt.Ball(new Yt.Vec2(n,o),new Yt.Vec2(n-s,o-i),defaultSize,k,0,fc);isFinite(l.pos.x)&&isFinite(l.pos.y)&&isFinite(l.vel.x)&&isFinite(l.vel.y)||(l.vel.x=0,l.vel.y=0),u.addBall(l)}},function(){},function(){});be.exports=ui}),Pe=R((ds,Me)=>{var di=tt(),fi=new di("Rectangle wall","",function(u,t,e,s,i,n,o,l,a,r){s!=0&&i!=0&&(u.strokeStyle="black",u.strokeRect(t,e,s-t,i-e))},function(u,t,e,s,i){},function(u,t,e,s,i,n,o){n!=0&&o!=0&&u.addRectWall(n/2+s/2,o/2+i/2,2*Math.abs(n/2-s/2),2*Math.abs(o/2-i/2))},function(){},function(){});Me.exports=fi}),ke=R((fs,Se)=>{var pi=tt(),gi=new pi("Wall drawer","",function(u,t,e,s,i,n,o,l,a,r,h){u.strokeStyle="black",u.beginPath(),u.arc(t,e,n,0,2*Math.PI),u.stroke(),s!=0&&i!=0&&l.addFixedBall(t/h.scaling-h.viewOffsetX/h.scaling,e/h.scaling-h.viewOffsetY/h.scaling,n)},function(u,t,e,s,i){},function(u,t,e,s,i,n,o){},function(){},function(){});Se.exports=gi}),Oe=R((ps,Ie)=>{var yi=tt(),wi=at(),mi=new yi("Stick creator","",function(u,t,e,s,i,n,o,l,a,r){s!=0&&i!=0&&(u.strokeStyle="black",u.beginPath(),u.moveTo(t,e),u.lineTo(s,i),u.stroke())},function(u,t,e,s,i,n){},function(u,t,e,s,i,n,o,l){if(n!=0&&o!=0){t:{let a=u.getObjectAtCoordinates(s,i),r,h=wi.Stick;if(a||(a={x:s,y:i,pinPoint:!0}),l==a||l==null&&a==null)break t;if(l.pinPoint&&a.pinPoint)break t;l.pinPoint?(r=new h(Math.sqrt(Math.pow(l.x-a.pos.x,2)+Math.pow(l.y-a.pos.y,2)),springConstant),r.attachObject(a),r.pinHere(l.x,l.y)):a.pinPoint?(r=new h(Math.sqrt(Math.pow(l.pos.x-a.x,2)+Math.pow(l.pos.y-a.y,2)),springConstant),r.attachObject(l),r.pinHere(a.x,a.y)):(r=new h(Math.sqrt(Math.pow(l.pos.x-a.pos.x,2)+Math.pow(l.pos.y-a.pos.y,2)),springConstant),r.attachObject(l),r.attachObject(a)),u.addSpring(r),lockRotation&&r.lockRotation()}}},function(){},function(){});Ie.exports=mi}),qe=R((gs,je)=>{var xi=tt(),bi=at(),vi=new xi("Spring creator","",function(u,t,e,s,i,n,o,l,a,r){s!=0&&i!=0&&(u.strokeStyle="black",u.beginPath(),u.moveTo(t,e),u.lineTo(s,i),u.stroke())},function(u,t,e,s,i,n){},function(u,t,e,s,i,n,o,l){if(n!=0&&o!=0){t:{let a=u.getObjectAtCoordinates(s,i),r,h=bi.Spring;if(a||(a={x:s,y:i,pinPoint:!0}),l==a||l==null&&a==null)break t;if(l.pinPoint&&a.pinPoint)break t;l.pinPoint?(r=new h(Math.sqrt(Math.pow(l.x-a.pos.x,2)+Math.pow(l.y-a.pos.y,2)),springConstant),r.attachObject(a),r.pinHere(l.x,l.y)):a.pinPoint?(r=new h(Math.sqrt(Math.pow(l.pos.x-a.x,2)+Math.pow(l.pos.y-a.y,2)),springConstant),r.attachObject(l),r.pinHere(a.x,a.y)):(r=new h(Math.sqrt(Math.pow(l.pos.x-a.pos.x,2)+Math.pow(l.pos.y-a.pos.y,2)),springConstant),r.attachObject(l),r.attachObject(a)),u.addSpring(r),lockRotation&&r.lockRotation()}}},function(){},function(){});je.exports=vi}),Ee=R((ys,Ce)=>{var Mi=tt(),Ae=0,Fe=0,Be=(u,t,e)=>({x:u/e.scaling-e.viewOffsetX/e.scaling,y:t/e.scaling-e.viewOffsetY/e.scaling}),Pi=new Mi("Move","",function(u,t,e,s,i,n,o,l,a,r,h){let d=Be(t,e,h),g=Be(Ae,Fe,h);a&&!a.pinPoint&&(a.move(d.x-a.pos.x,d.y-a.pos.y),r===0?(a.vel.x=0,a.vel.y=0):(a.vel.x=(d.x-g.x)/r,a.vel.y=(d.y-g.y)/r),a.ang=0),Ae=t,Fe=e},function(u,t,e,s,i){},function(u,t,e,s,i,n,o){},function(){},function(){});Ce.exports=Pi}),We=R((ws,Te)=>{var Si=tt(),Bt=at(),ki=new Si("Elastic ball creator","",function(u,t,e,s,i,n,o,l,a,r){u.strokeStyle="black",u.beginPath(),u.arc(t,e,n,0,2*Math.PI),u.stroke(),s!=0&&i!=0&&(u.beginPath(),u.moveTo(t,e),u.lineTo(s,i),u.stroke())},function(u,t,e,s,i){},function(u,t,e,s,i,n,o){if(n!=0&&o!=0){let l=new Bt.Ball(new Bt.Vec2(n,o),new Bt.Vec2(n-s,o-i),defaultSize,k,0,fc);if(isFinite(l.pos.x)&&isFinite(l.pos.y)&&isFinite(l.vel.x)&&isFinite(l.vel.y)){let a=new Bt.SoftBall(l.pos,defaultSize,1e6,fc,24);a.points.forEach(r=>{r.vel=l.vel.copy}),u.addSoftBall(a)}}},function(){},function(){});Te.exports=ki}),De=R((ms,Re)=>{var Ii=tt(),Ht=at(),Oi=new Ii("Soft square creator","",function(u,t,e,s,i,n,o,l,a,r){u.strokeStyle="black",u.beginPath(),u.moveTo(t-n,e-n),u.lineTo(t+n,e-n),u.lineTo(t+n,e+n),u.lineTo(t-n,e+n),u.lineTo(t-n,e-n),u.stroke(),s!=0&&i!=0&&(u.beginPath(),u.moveTo(t,e),u.lineTo(s,i),u.stroke())},function(u,t,e,s,i){},function(u,t,e,s,i,n,o){if(n!=0&&o!=0){let l=new Ht.Ball(new Ht.Vec2(n,o),new Ht.Vec2(n-s,o-i),defaultSize,k,0,fc);isFinite(l.pos.x)&&isFinite(l.pos.y)&&isFinite(l.vel.x)&&isFinite(l.vel.y)&&u.addSoftSquare(l.pos,defaultSize*2,fc,l.vel)}},function(){},function(){});Re.exports=Oi}),Ne=R((xs,Le)=>{var ji=tt(),qi=new ji("Delete","",function(u,t,e,s,i,n,o,l,a,r){},function(u,t,e,s,i,n){n&&u.removeObjFromSystem(n)},function(u,t,e,s,i,n,o){},function(){},function(){});Le.exports=qi}),Ve=R((bs,Je)=>{var Ci=tt(),Ai=new Ci("Rectangle body (experimental)","",function(u,t,e,s,i,n,o,l,a,r){s!=0&&i!=0&&(u.strokeStyle="black",u.strokeRect(t,e,s-t,i-e))},function(u,t,e,s,i){},function(u,t,e,s,i,n,o,l,a,r){n!=0&&o!=0&&u.addRectBody(n/2+s/2,o/2+i/2,2*Math.abs(n/2-s/2),2*Math.abs(o/2-i/2),.18,.1)},function(){},function(){});Je.exports=Ai}),Mt=at(),Xe=Mt,Ye=Mt.Ball,rt=Mt.Vec2,Fi=Mt.Spring,He=Mt.Stick,Bi=we(),C,E,X=0,Y=0,Gt=0;window.defaultSize;window.k=.5;window.fc=2;window.springConstant=2e3;window.scaling=1;window.viewOffsetX=0;window.viewOffsetY=0;var z=0,pt=0,gt=0,Et=1,Tt;window.lockRotation=!1;window.time=!0;var ut=!1,Ge=0;my=0;var Pt=!1,ht=[ve(),Pe(),ke(),Oe(),qe(),Ee(),We(),De(),Ne(),Ve()],zt=!1,Ut=!1;window.onload=()=>{E=document.getElementById("defaulCanvas0"),C=new Xe,C.setBounds(0,0,E.width,E.height),C.setGravity(new rt(0,1e3)),C.setAirFriction(.9),E.addEventListener("touchstart",Wi,!1),E.addEventListener("touchend",Ri,!1),E.addEventListener("touchmove",Di,!1),E.addEventListener("mousedown",Li,!1),E.addEventListener("mouseup",Ni,!1),E.addEventListener("mousemove",Ji,!1),document.addEventListener("keydown",Ei,!1),document.addEventListener("keyup",Ti,!1),window.addEventListener("resize",ze,!1),E.addEventListener("mousedown",function(){Gt=1},!1),E.addEventListener("mouseup",function(){Gt=0},!1),ze(),window.defaultSize=(E.width+E.height)/80,Bi(new Vi),requestAnimationFrame(Ue)};function ze(){E.width=window.innerWidth,E.height=window.innerHeight,C.setBounds(0,0,E.width,E.height)}function Ue(){isFinite(Tt)||(Tt=performance.now());let u=performance.now()-Tt;isFinite(u)||(u=0),u/=1e3,X=isFinite(X)?X:Ge,Y=isFinite(Y)?Y:my,X&&isFinite(X)&&(Ge=X),Y&&isFinite(Y)&&(my=Y);let t=E.getContext("2d");if(t.fillStyle="rgb(51, 51, 51)",t.fillRect(0,0,E.width,E.height),t.strokeStyle="black",t.fillStyle="white",t.fillText("BallPhysics",10,10),t.fillText("Mode: "+ht[z].name,10,25),t.fillText(Math.round(X).toString()+" "+Math.round(Y).toString(),10,40),t.fillText(Math.round(pt).toString()+" "+Math.round(gt).toString(),10,55),ht[z].drawFunc(t,X,Y,pt,gt,defaultSize*window.scaling,Gt,C,ut,u*Et,{scaling:window.scaling,viewOffsetX:window.viewOffsetX,viewOffsetY:window.viewOffsetY}),t.strokeStyle="black",Xi(E),!time)return;C.balls[0]&&(Ut&&(C.balls[0].ang-=Math.PI*100*u),zt&&(C.balls[0].ang+=Math.PI*100*u)),u*=Et,C.update(u/5,Pt),C.update(u/5,Pt),C.update(u/5,Pt),C.update(u/5,Pt),C.update(u/5,Pt),pmouseX=X,pmouseY=Y,Tt=performance.now(),requestAnimationFrame(Ue)}function Ke(u,t){X=u,Y=t,ut=C.getObjectAtCoordinates(X/window.scaling-window.viewOffsetX/window.scaling,Y/window.scaling-window.viewOffsetY/window.scaling),ut||(ut={x:X/window.scaling-window.viewOffsetX/window.scaling,y:Y/window.scaling-window.viewOffsetY/window.scaling,pinPoint:!0}),pt=X,gt=Y,ht[z].startInteractionFunc(C,u/window.scaling-window.viewOffsetX/window.scaling,t/window.scaling-window.viewOffsetY/window.scaling,X/window.scaling-window.viewOffsetX/window.scaling,Y/window.scaling-window.viewOffsetY/window.scaling,ut)}function Qe(u,t){if(X=u,Y=t,ht[z].endInteractionFunc(C,u/window.scaling-window.viewOffsetX/window.scaling,t/window.scaling-window.viewOffsetY/window.scaling,X/window.scaling-window.viewOffsetX/window.scaling,Y/window.scaling-window.viewOffsetY/window.scaling,pt/window.scaling-window.viewOffsetX/window.scaling,gt/window.scaling-window.viewOffsetY/window.scaling,ut,fc,k),pt===0&&gt===0)return;pt=0,gt=0,ut=!1}function Ei(u){keyCode=u.key,keyCode==="ArrowUp"&&(z+=1,z%=ht.length),keyCode==="ArrowDown"&&(z-=1,z=z===-1?ht.length-1:z),keyCode==="s"&&Yi(E.width/2,E.height/2,.5,C),keyCode==="a"&&(window.scaling+=.01),keyCode==="d"&&(window.scaling-=.01),keyCode==="j"&&(window.viewOffsetX-=10),keyCode==="l"&&(window.viewOffsetX+=10),keyCode==="k"&&(window.viewOffsetY-=10),keyCode==="i"&&(window.viewOffsetY+=10),keyCode==="ArrowRight"&&(Ut=!0),keyCode==="ArrowLeft"&&(zt=!0)}function Ti(u){keyCode=u.key,keyCode==="ArrowRight"&&(Ut=!1),keyCode==="ArrowLeft"&&(zt=!1)}function Wi(u){if(u.preventDefault(),E.width-u.changedTouches[0].clientX<E.width/100){z+=1,z%=ht.length;return}if(u.changedTouches[0].clientX<E.width/100){z-=1,z=z===-1?ht.length-1:z;return}return Ke(u.changedTouches[0].clientX,u.changedTouches[0].clientY),!1}function Ri(u){return u.preventDefault(),Qe(u.changedTouches[0].clientX,u.changedTouches[0].clientY),!1}function Di(u){return u.preventDefault(),X=u.changedTouches[0].clientX,Y=u.changedTouches[0].clientY,!1}function Li(u){return Ke(u.clientX,u.clientY),!1}function Ni(u){return Qe(u.clientX,u.clientY),!1}function Ji(u){X=u.clientX,Y=u.clientY}var Xi=function(u){let t=u.getContext("2d");t.save(),t.translate(window.viewOffsetX,window.viewOffsetY),t.scale(window.scaling,window.scaling),t.fillStyle="green",t.strokeStyle="black";for(let s=0;s<C.balls.length;s++){let i=C.balls[s];t.beginPath(),t.arc(i.pos.x,i.pos.y,i.r,0,2*Math.PI),t.stroke(),t.fill(),t.beginPath(),t.moveTo(i.pos.x,i.pos.y),t.lineTo(i.pos.x+i.r*Math.cos(i.rotation),i.pos.y+i.r*Math.sin(i.rotation)),t.stroke()}C.bodies.forEach(s=>{t.beginPath(),t.moveTo(s.points[s.points.length-1].x,s.points[s.points.length-1].y),s.points.forEach(i=>{t.lineTo(i.x,i.y)}),t.stroke(),t.fill(),t.beginPath(),t.arc(s.pos.x,s.pos.y,1.5,0,Math.PI*2),t.stroke()});let e=s=>{t.beginPath(),t.moveTo(s.points[s.points.length-1].x,s.points[s.points.length-1].y),s.points.forEach(i=>{t.lineTo(i.x,i.y)}),t.fill()};t.fillStyle="white",C.walls.forEach(e),t.fillStyle="yellow",C.bounds.forEach(e),C.fixedBalls.forEach(s=>{t.beginPath(),t.arc(s.x,s.y,s.r,0,Math.PI*2),t.fill()}),t.save(),t.lineWidth=2,t.strokeStyle="#ADD8E6",t.fillStyle="#ADD8E6",C.springs.forEach(s=>{if(s instanceof Fi&&!(s instanceof He)){let i,n,o,l;s.pinned?(i=s.pinned.x,n=s.pinned.y,o=s.objects[0].pos.x,l=s.objects[0].pos.y):(i=s.objects[0].pos.x,n=s.objects[0].pos.y,o=s.objects[1].pos.x,l=s.objects[1].pos.y);let a=new rt(o-i,l-n),r=a.copy;a.rotate(Math.PI/2),a.setMag(5);let h=new rt(i,n),d=Math.floor(s.length/10);for(let g=1;g<=d;g++)g===d&&(a=new rt(0,0)),t.beginPath(),t.moveTo(h.x,h.y),t.lineTo(i+g/d*r.x+a.x,n+g/d*r.y+a.y),t.stroke(),h=new rt(i+g/d*r.x+a.x,n+g/d*r.y+a.y),a.mult(-1)}else t.beginPath(),t.moveTo(s.objects[0].pos.x,s.objects[0].pos.y),t.lineTo(s.pinned?s.pinned.x:s.objects[1].pos.x,s.pinned?s.pinned.y:s.objects[1].pos.y),t.stroke();s.objects.forEach(i=>{t.beginPath(),t.arc(i.pos.x,i.pos.y,2.5,0,Math.PI*2),t.fill(),t.stroke()}),s.pinned&&(t.beginPath(),t.arc(s.pinned.x,s.pinned.y,3,0,Math.PI*2),t.fill(),t.stroke())}),t.restore();for(segment of C.debugData)t.strokeStyle="red",t.beginPath(),t.moveTo(segment.a.x,segment.a.y),t.lineTo(segment.b.x,segment.b.y),t.stroke();t.restore()};function Yi(u,t,e,s){let i=[],n=25,o=250,l=8;i.push(new Ye(new rt(u,t),new rt(0,0),e*n,1,0,0));let a=1;for(let r=0;r<l-1;r++)i.push(new Ye(new rt(u+a*e*n*1.01*2,t),new rt(0,0),e*25,1,0,0)),a*=-1,a>0&&(a+=1),r===l-2&&(i[i.length-1].vel.x=-Math.sign(a)*e*n*8);i.forEach(r=>{s.addBall(r);let h=new He(o);h.attachObject(r),h.pinHere(r.pos.x,r.pos.y-o),s.addSpring(h),h.lockRotation()})}function Hi(u){isFinite(u)&&(Et=u)}function Gi(){return Et}function zi(u){u instanceof Xe&&(C=u)}function Ui(){return C}var Vi=function(){this.setTimeMultiplier=Hi,this.getTimeMultiplier=Gi,this.getPhysics=Ui,this.setPhysics=zi};})();
//# sourceMappingURL=main.js.map

(()=>{var O=class{constructor(t,e){this.x=t,this.y=e}get copy(){return new O(this.x,this.y)}get length(){return Math.sqrt(this.x*this.x+this.y*this.y)}get sqlength(){return this.x*this.x+this.y*this.y}get heading(){if(this.x===0&&this.y===0)return 0;if(this.x===0)return this.y>0?Math.PI/2:1.5*Math.PI;if(this.y===0)return this.x>0?0:Math.PI;let t=O.normalized(this);return this.x>0&&this.y>0?Math.asin(t.y):this.x<0&&this.y>0?Math.asin(-t.x)+Math.PI/2:this.x<0&&this.y<0?Math.asin(-t.y)+Math.PI:this.x>0&&this.y<0?Math.asin(t.x)+1.5*Math.PI:0}add(t){this.x+=t.x,this.y+=t.y}sub(t){this.x-=t.x,this.y-=t.y}mult(t){this.x*=t,this.y*=t}div(t){this.x/=t,this.y/=t}lerp(t,e){this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e}dist(t){return new O(this.x-t.x,this.y-t.y).length}setMag(t){if(this.length===0)return;this.mult(t/this.length)}rotate(t){let e=this.heading,n=O.fromAngle(t+e);n.mult(this.length),this.x=n.x,this.y=n.y}static add(t,e){return new O(t.x+e.x,t.y+e.y)}static sub(t,e){return new O(t.x-e.x,t.y-e.y)}static mult(t,e){return new O(t.x*e,t.y*e)}static div(t,e){return new O(t.x/e,t.y/e)}static fromAngle(t){return new O(Math.cos(t),Math.sin(t))}static lerp(t,e,n){return O.add(t,O.mult(O.sub(e,t),n))}static dist(t,e){return O.sub(t,e).length}static dot(t,e){return t.x*e.x+t.y*e.y}static cross(t,e){return t.x*e.y-t.y*e.x}static crossScalarFirst(t,e){return new O(-e.y*t,e.x*t)}static crossScalarSecond(t,e){return new O(t.y*e,-t.x*e)}static angle(t,e){return Math.acos(Math.min(Math.max(O.dot(t,e)/Math.sqrt(t.sqlength*e.sqlength),1),-1))}static angleACW(t,e){let n=t.heading,i=e.heading,r=i-n;return r<0?2*Math.PI+r:r}static normalized(t){let e=t.length;return e===0?t:new O(t.x/e,t.y/e)}toJSObject(){return{x:this.x,y:this.y}}static fromObject(t){return new O(t.x,t.y)}},s=O,et=class{constructor(t,e,n,i,r,c){this.pos=t.copy,this.lastPos=this.pos.copy,this.r=n,this.fc=.4,this.amc=2/5,this.rotation=0,r?this.ang=r:this.ang=0,(c||c===0)&&(this.fc=c),i?this.k=i:this.k=.8,e!==void 0?this.vel=e.copy:this.vel=new s(0,0),this.id=`_${Math.random().toString(36).substr(2,9)}`,this.layer=void 0}get m(){return this.r*this.r*Math.PI}get am(){return this.amc*this.r*this.r*this.m}getAmInPoint(t){let e=this.am;return e+=s.sub(this.pos,t).sqlength*this.m,e}get copy(){let t=new et(this.pos.copy,this.vel.copy,this.r,this.k,this.ang,this.fc);return t.lastPos=this.lastPos.copy,t.rotation=this.rotation,t}move(t,e){this.pos.x+=t,this.pos.y+=e}rotate(t){this.rotation+=t}collided(t){return this.pos.dist(t.pos)<this.r+t.r}static collide(t,e){if(!t.collided(e))return;let n=s.dist(t.pos,e.pos),i=t.m,r=e.m,c=t.pos.copy,h=e.pos.copy,u=t,l=e,a=t.r+e.r-n,d=s.sub(t.pos,e.pos);if(d.setMag(1),d.mult(a*r/(i+r)),c.add(d),d.setMag(1),d.mult(-a*i/(i+r)),h.add(d),u.pos=c,l.pos=h,s.dot(d,s.sub(t.vel,e.vel))<0)return;d.setMag(1);let m=s.add(t.pos,s.mult(d,t.r)),p=t.vel.copy,f=e.vel.copy,g=t.ang,x=e.ang,y=s.sub(m,t.pos),M=s.sub(m,e.pos),S=t.am,b=e.am,k=(t.k+e.k)/2,Y=(t.fc+e.fc)/2,C=d.copy,v=t.velInPlace(m),P=e.velInPlace(m),I=s.sub(P,v),E=1/i+1/r;E=-(1+k)*s.dot(I,C)/E;let T=s.sub(p,s.mult(C,E/i)),J=s.add(f,s.mult(C,E/r)),H=g-E*s.cross(y,C)/S,G=x,B=I.copy;B.sub(s.mult(C,s.dot(I,C))),B.setMag(1);let W=1/i+1/r;W+=s.dot(s.crossScalarFirst(s.cross(y,B)/S,y),B),W+=s.dot(s.crossScalarFirst(s.cross(M,B)/b,M),B),W=-(.5*s.dot(I,B))/W;let D=E*Y;D>W&&(D=W),T=s.sub(T,s.mult(B,D/i)),J=s.add(J,s.mult(B,D/r)),H-=D*s.cross(y,B)/S,G+=D*s.cross(M,B)/b,u.vel=T,l.vel=J,u.ang=H,l.ang=G}containsPoint(t){return s.dist(this.pos,t)<=this.r}velInPlace(t){let e=s.sub(t,this.pos);return e.rotate(Math.PI/2),e.mult(this.ang),e.add(this.vel),e}effectiveMass(t,e){let n=s.sub(t,this.pos);if(n.length===0)return this.m;let i=s.angle(e,n),r=Math.sin(i)**2*n.length**2/this.am;return 1/(r+1/this.m)}applyDeltaVelInPoint(t,e){let n=s.sub(e,this.pos);if(n.length===0){this.vel.add(t);return}let i=s.angle(n,t),r=s.mult(n,s.dot(t,n)/n.length**2);this.vel.add(r);let c=n.copy;c.rotate(Math.PI/2),c.setMag(1);let h=Math.sign(s.dot(t,c)),u=t.length*Math.cos(i),l=1/(1/this.m+n.length**2/this.am),a=u*l/this.m;this.vel.add(s.mult(c,a*h));let d=h*u*l*n.length/this.am;this.ang-=d}toJSObject(){let t={};return t.pos=this.pos.toJSObject(),t.lastPos=this.lastPos.toJSObject(),t.r=this.r,t.fc=this.fc,t.amc=this.amc,t.rotation=this.rotation,t.ang=this.ang,t.fc=this.fc,t.k=this.k,t.vel=this.vel.toJSObject(),t.id=this.id,typeof this.layer!="undefined"&&(t.layer=this.layer),t}static fromObject(t){let e=new et(s.fromObject(t.pos),s.fromObject(t.vel),t.r,t.k,t.ang,t.fc);return e.lastPos=s.fromObject(t.lastPos),e.amc=t.amc,e.rotation=t.rotation,e.vel=s.fromObject(t.vel),e.id=t.id,typeof t.layer!="undefined"&&(e.layer=t.layer),e}},L=et,qt=class{constructor(t,e){this.a=t,this.b=e}get length(){return s.dist(this.a,this.b)}distFromPoint(t){let e=s.sub(this.a,this.b),n=s.sub(t,this.b),i=s.sub(t,this.a),r=n.length,c=i.length,h=e.length;if(h===0)return r;let u=s.angle(n,i),l=s.angle(n,e),a=Math.PI-u-l,d=Math.sin(a)*c*h/2,m=2*d/h;return a>Math.PI/2?c:l>Math.PI/2?r:m}static intersect(t,e){let n=s.sub(t.b,t.a),i=n.y/n.x,r=t.b.y-t.b.x*i,c=s.sub(e.b,e.a),h=c.y/c.x,u=e.b.y-e.b.x*h;if(n.x===0&&c.x!==0){if(t.a.x>=e.a.x&&t.a.x<=e.b.x||t.a.x<=e.a.x&&t.a.x>=e.b.x){let p=h*t.a.x+u;if(p>t.a.y&&p<t.b.y||p<t.a.y&&p>t.b.y)return new s(t.a.x,p)}return!1}if(c.x===0&&n.x!==0){if(e.a.x>=t.a.x&&e.a.x<=t.b.x||e.a.x<=t.a.x&&e.a.x>=t.b.x){let p=i*e.a.x+r;if(p>e.a.y&&p<e.b.y||p<e.a.y&&p>e.b.y)return new s(e.a.x,p)}return!1}if(n.x===0&&c.x===0){if(t.a.x===e.a.x){let p;t.a.y<t.b.y?p=[t.a.y,t.b.y]:p=[t.b.y,t.a.y];let f;e.a.y<e.b.y?f=[e.a.y,e.b.y]:f=[e.b.y,e.a.y];let g=[p[0]>f[0]?p[0]:f[0],p[1]<f[1]?p[1]:f[1]];if(g[0]<=g[1])return new s(t.a.x,(g[0]+g[1])/2)}return!1}let l;t.a.x<t.b.x?l=[t.a.x,t.b.x]:l=[t.b.x,t.a.x];let a;e.a.x<e.b.x?a=[e.a.x,e.b.x]:a=[e.b.x,e.a.x];let d=[l[0]>a[0]?l[0]:a[0],l[1]<a[1]?l[1]:a[1]];if(i===h&&r===u&&d[0]<=d[1])return new s((d[0]+d[1])/2,(d[0]+d[1])/2*i+r);let m=(u-r)/(i-h);return m>=d[0]&&m<=d[1]?new s(m,m*i+r):!1}},w=qt,ct=class{constructor(t){this.points=t;let e=this.points,n=0,i=0,r=s.angleACW(s.sub(e[1],e[0]),s.sub(e[e.length-1],e[0]));this.points.length>0?[this.center]=[this.points[0]]:this.center=new s(0,0),this.boundRadius=1,this.calculateCenterAndRadius(),n+=r,i+=Math.PI*2-r;for(let h=1;h<e.length-1;h+=1)r=s.angleACW(s.sub(e[(h+1)%e.length],e[h]),s.sub(e[h-1],e[h])),n+=r,i+=Math.PI*2-r;if(r=s.angleACW(s.sub(e[0],e[e.length-1]),s.sub(e[e.length-2],e[e.length-1])),n+=r,i+=Math.PI*2-r,i>n)return;let c=[];for(let h=e.length-1;h>=0;h-=1)c.push(e[h]);this.points=c}collideWithBall(t){let e,n;if(this.points.forEach((i,r)=>{let c=new s(i.x,i.y);c.x-=t.pos.x,c.y-=t.pos.y,c.mult(-1),c.length<=t.r&&(e=c.heading,n=c.length),c=new s(i.x,i.y);let h=new s(this.points[(r+1)%this.points.length].x,this.points[(r+1)%this.points.length].y),u=new s(t.pos.x,t.pos.y),l=new s(h.x-c.x,h.y-c.y),a=l.heading;c.rotate(-a+Math.PI),h.rotate(-a+Math.PI),u.rotate(-a+Math.PI);let d=u.y-(c.y+h.y)/2;d>=-t.r&&d<=t.r&&u.x>=h.x&&u.x<=c.x&&(e=a-Math.PI/2,n=d)}),typeof e!="undefined"&&typeof n!="undefined"){let i=new s(t.pos.x,t.pos.y),r=new s(t.vel.x,t.vel.y);if(i.rotate(-e+Math.PI/2),r.rotate(-e+Math.PI/2),r.y>0)return;r.y*=-t.k,i.y+=t.r-n;let c=r.y*(1+t.k),h=Math.sign(r.x+t.ang*t.r)*(c*t.fc)/(t.amc*t.r),u=(r.x+t.ang*t.r)/t.r;h/u>1&&(h=u);let l=t;l.ang-=h;let a=h*t.am/t.r/t.m;r.x-=a,i.rotate(e-Math.PI/2),r.rotate(e-Math.PI/2),l.pos.x=i.x,l.pos.y=i.y,l.vel.x=r.x,l.vel.y=r.y}}containsPoint(t){let{sides:e}=this,n=Math.max(...this.points.map(h=>s.dist(h,t)))+1,i=s.fromAngle(0);i.setMag(n);let r=new w(t,s.add(i,t)),c=e.filter(h=>w.intersect(h,r)!==void 0);return c.length%2===1}calculateCenterAndRadius(){this.center=this.points.reduce((t,e)=>s.add(t,e)),this.center.div(this.points.length),this.boundRadius=Math.max(...this.points.map(t=>s.dist(t,this.center)))}get sides(){return this.points.map((t,e)=>new w(t,this.points[(e+1)%this.points.length]))}toJSObject(){let t={};return t.points=this.points.map(e=>({x:e.x,y:e.y})),t}static fromObject(t){let e=new ct(t.points.map(n=>new s(n.x,n.y)));return e}},_=ct,st=class{constructor(t,e,n,i,r){this.points=t,this.pos=new s(t[0].x,t[0].y);let c=this.points,h=0,u=0,l=s.angleACW(s.sub(c[1],c[0]),s.sub(c[c.length-1],c[0]));h+=l,u+=Math.PI*2-l;for(let a=1;a<c.length-1;a+=1)l=s.angleACW(s.sub(c[(a+1)%c.length],c[a]),s.sub(c[a-1],c[a])),h+=l,u+=Math.PI*2-l;if(l=s.angleACW(s.sub(c[0],c[c.length-1]),s.sub(c[c.length-2],c[c.length-1])),h+=l,u+=Math.PI*2-l,u<h){let a=[];for(let d=c.length-1;d>=0;d-=1)a.push(c[d]);this.points=a}this.m=1,this.am=1,this.boundRadius=1,this.calculatePosAndMass(),this.lastPos=this.pos.copy,this.fc=.4,this.rotation=0,i?this.ang=i:this.ang=0,(r||r===0)&&(this.fc=r),n?this.k=n:this.k=.8,e!==void 0?this.vel=e.copy:this.vel=new s(0,0),this.id=`_${Math.random().toString(36).substr(2,9)}`}getAmInPoint(t){let e=this.am;return e+=s.sub(this.pos,t).sqlength*this.m,e}get copy(){let t=this.points.map(n=>new s(n.x,n.y)),e=new st(t,this.vel.copy,this.k,this.ang,this.fc);return e.rotation=this.rotation,e.lastPos=this.lastPos.copy,e.pos=this.pos.copy,e}move(t,e){this.pos.x+=t,this.pos.y+=e,this.points.forEach(n=>{let i=n;i.x+=t,i.y+=e})}collideWithBall(t){let e,n,i;if(s.dist(t.pos,this.pos)>t.r+this.boundRadius)return;if(this.points.forEach((r,c)=>{let h=new s(r.x,r.y);if(h.x-=t.pos.x,h.y-=t.pos.y,h.length<=t.r){e=h.heading+Math.PI,n=h.length;let p=s.fromAngle(e);p.mult(t.r-n),this.move(p.x*-1*t.m/(this.m+t.m),p.y*-1*t.m/(this.m+t.m)),t.move(p.x*1*this.m/(this.m+t.m),p.y*1*this.m/(this.m+t.m)),i=new s(r.x,r.y);let f=s.fromAngle(e);f.mult(-30)}h=new s(r.x,r.y);let u=new s(this.points[(c+1)%this.points.length].x,this.points[(c+1)%this.points.length].y),l=new s(t.pos.x,t.pos.y),a=new s(u.x-h.x,u.y-h.y),d=a.heading;h.rotate(-d+Math.PI),u.rotate(-d+Math.PI),l.rotate(-d+Math.PI);let m=l.y-(h.y+u.y)/2;if(m>=-t.r&&m<=t.r&&l.x>=u.x&&l.x<=h.x){e=d-Math.PI/2,n=m;let p=s.fromAngle(e);p.mult(t.r-n),this.move(p.x*-1*t.m/(this.m+t.m),p.y*-1*t.m/(this.m+t.m)),t.move(p.x*1*this.m/(this.m+t.m),p.y*1*this.m/(this.m+t.m)),i=t.pos.copy,i.add(s.mult(s.fromAngle(e+Math.PI),m));let f=s.fromAngle(e);f.mult(-30)}}),Number.isFinite(e)&&i){let r=this.vel.copy,c=t.vel.copy,h=this.ang,u=t.ang,l=s.sub(i,this.pos),a=s.sub(i,t.pos),d=this.am,m=t.am,p=this.m,f=t.m,g=(this.k+t.k)/2,x=(this.fc+t.fc)/2,y=a.copy;y.setMag(-1);let M=this.velInPlace(i),S=t.velInPlace(i),b=s.sub(S,M),k=1/p+1/f;k+=s.dot(s.crossScalarFirst(s.cross(l,y)/d,l),y),k=-((1+g)*s.dot(b,y))/k;let Y=s.sub(r,s.mult(y,k/p)),C=s.add(c,s.mult(y,k/f)),v=h-k*s.cross(l,y)/d,P=u,I=b.copy;I.sub(s.mult(y,s.dot(b,y))),I.setMag(1);let E=1/p+1/f;E+=s.dot(s.crossScalarFirst(s.cross(l,I)/d,l),I),E+=s.dot(s.crossScalarFirst(s.cross(a,I)/m,a),I),E=-s.dot(b,I)/E;let T=k*x;T>E&&(T=E),Y=s.sub(Y,s.mult(I,T/p)),C=s.add(C,s.mult(I,T/f)),v-=T*s.cross(l,I)/d,P+=T*s.cross(a,I)/m;let J=t;this.vel=Y,J.vel=C,this.ang=v,J.ang=P}}calculatePosAndMass(){let t=[];if(t.push([]),this.points.forEach(r=>{t[0].push(new s(r.x,r.y))}),this.isConcave){let r=(l,a)=>{for(let d=0;d<l.length;d+=1)if(l[d]===a)return!0;return!1},c=(l,a,d)=>{for(let m=0;m<a.length;m+=1)if(!r(d,m)){let p=new w(new s(a[m].x,a[m].y),new s(a[(m+1)%a.length].x,a[(m+1)%a.length].y));if(w.intersect(l,p))return!0}return!1},h=!0,u=()=>{h=!1;for(let l=0;l<t.length;l+=1){let a=t[l],d=s.sub(a[1],a[0]),m=s.sub(a[a.length-1],a[0]),p=s.angleACW(d,m);if(p>Math.PI){h=!0;let f=0,g=f+2,x=new w(new s(a[f].x,a[f].y),new s(a[g%a.length].x,a[g%a.length].y)),y=new s(x.b.x-x.a.x,x.b.y-x.a.y).heading;for(;!(d.heading>m.heading?y>d.heading&&y<2*Math.PI||y>0&&y<m.heading:y>d.heading&&y<m.heading)||c(new w(new s(a[f%a.length].x,a[f%a.length].y),new s(a[g%a.length].x,a[g%a.length].y)),a,[(a.length-1)%a.length,f%a.length,(g-1)%a.length,g%a.length]);)g+=1,x=new w(new s(a[f].x,a[f].y),new s(a[g%a.length].x,a[g%a.length].y)),y=new s(x.b.x-x.a.x,x.b.y-x.a.y).heading;let M=[],S=[];for(let b=f;b<=g;b+=1)M.push(a[b%a.length]);for(let b=g;b<=f+a.length;b+=1)S.push(a[b%a.length]);t[l]=M,t.push(S);return}for(let f=1;f<a.length;f+=1)if(d=s.sub(a[(f+1)%a.length],a[f]),m=s.sub(a[f-1],a[f]),p=s.angleACW(d,m),p>Math.PI){h=!0;let g=f+2,x=new w(new s(a[f].x,a[f].y),new s(a[g%a.length].x,a[g%a.length].y)),y=new s(x.b.x-x.a.x,x.b.y-x.a.y).heading;for(;!(d.heading>m.heading?y>d.heading&&y<2*Math.PI||y>0&&y<m.heading:y>d.heading&&y<m.heading)||c(x,a,[(f-1)%a.length,f%a.length,(g-1)%a.length,g%a.length]);)g+=1,x=new w(new s(a[f].x,a[f].y),new s(a[g%a.length].x,a[g%a.length].y)),y=new s(x.b.x-x.a.x,x.b.y-x.a.y).heading;let M=[],S=[];for(let b=f;b<=g;b+=1)M.push(a[b%a.length]);for(let b=g;b<=f+a.length;b+=1)S.push(a[b%a.length]);t[l]=M,t.push(S);return}}};for(;h;)u()}for(let r=t.length-1;r>=0;r-=1){let c=t[r];for(;c.length>3;)t.push([c[0],c[1],c[2]]),c.splice(1,1)}let e=0,n=0,i=new s(0,0);t.forEach(r=>{let c=Math.sqrt((r[0].x-r[1].x)**2+(r[0].y-r[1].y)**2),h=Math.sqrt((r[1].x-r[2].x)**2+(r[1].y-r[2].y)**2),u=Math.sqrt((r[2].x-r[0].x)**2+(r[2].y-r[0].y)**2),l=(c+h+u)/2,a=Math.sqrt(l*(l-c)*(l-h)*(l-u));e+=a,i.x+=a*(r[0].x+r[1].x+r[2].x)/3,i.y+=a*(r[0].y+r[1].y+r[2].y)/3}),i.div(e),this.pos=i,this.m=e,t.forEach(r=>{let c=Math.sqrt((r[0].x-r[1].x)**2+(r[0].y-r[1].y)**2),h=Math.sqrt((r[1].x-r[2].x)**2+(r[1].y-r[2].y)**2),u=Math.sqrt((r[2].x-r[0].x)**2+(r[2].y-r[0].y)**2),l=Math.max(c,h,u),a=(c+h+u)/2,d=Math.sqrt(a*(a-c)*(a-h)*(a-u)),m=2*d/l,p=Math.sqrt(Math.min(c,u,h)**2-m*m),f=m*l*(m*m+l*l)/24,g=Math.sqrt(m*m/36+(Math.abs(p-l/2)/3)**2);f-=g*g*d,f+=new s((r[0].x+r[1].x+r[2].x)/3,(r[0].y+r[1].y+r[2].y)/3).dist(this.pos)**2*d,n+=f}),this.am=n,this.boundRadius=Math.max(...this.points.map(r=>s.dist(r,this.pos)))}rotate(t){this.points.forEach(e=>{let n=e;n.sub(this.pos),n.rotate(t),n.add(this.pos)}),this.rotation+=t}get isConcave(){let t=this.points,e=s.angleACW(s.sub(t[1],t[0]),s.sub(t[t.length-1],t[0]));if(e>Math.PI)return!0;for(let n=1;n<t.length-1;n+=1)if(e=s.angleACW(s.sub(t[(n+1)%t.length],t[n]),s.sub(t[n-1],t[n])),e>Math.PI)return!0;return e=s.angleACW(s.sub(t[0],t[t.length-1]),s.sub(t[t.length-2],t[t.length-1])),e>Math.PI}static collide(t,e){let n=0,i=0,r=new s(0,0),c=[],h=!1,u=t,l=e;if(t.points.forEach((v,P)=>{let I=new w(new s(v.x,v.y),new s(t.points[(P+1)%t.points.length].x,t.points[(P+1)%t.points.length].y));e.points.forEach((E,T)=>{let J=new w(new s(E.x,E.y),new s(e.points[(T+1)%e.points.length].x,e.points[(T+1)%e.points.length].y)),H=w.intersect(I,J);H instanceof s&&(n+=1,r.add(H),c.push(H),h=!0)})}),!h)return;r.div(n);for(let v=0;v<Math.floor(n/2);v+=1)i+=s.sub(c[2*v+1],c[2*v]).heading;i/=n/2,i+=Math.PI/2;let a=s.fromAngle(i),d=t.ang,m=t.vel.copy,p=e.ang,f=e.vel.copy,g=0,x=0,y=0,M=0;t.points.forEach(v=>{g=Math.min(s.dot(a,s.sub(v,r)),g),x=Math.max(s.dot(a,s.sub(v,r)),x)}),e.points.forEach(v=>{y=Math.min(s.dot(a,s.sub(v,r)),y),M=Math.max(s.dot(a,s.sub(v,r)),M)}),Math.abs(g-M)<Math.abs(y-x)?(t.move(-a.x*g,-a.y*g),e.move(-a.x*M,-a.y*M)):(t.move(-a.x*x,-a.y*x),e.move(-a.x*y,-a.y*y));let S=c,b=[],k=[],Y=[],C=[];if(S.forEach(v=>{let P=s.fromAngle(i);r=v;let I=t.vel.copy,E=e.vel.copy,T=t.ang,J=e.ang,H=s.sub(r,t.pos),G=s.sub(r,e.pos),B=t.am,W=e.am,D=t.m,at=e.m,be=(t.k+e.k)/2,xe=(t.fc+e.fc)/2,ve=t.velInPlace(r),we=e.velInPlace(r),rt=s.sub(we,ve),V=1/D+1/at;V+=s.dot(s.crossScalarFirst(s.cross(H,P)/B,H),P),V+=s.dot(s.crossScalarFirst(s.cross(G,P)/W,G),P),V=-((1+be)*s.dot(rt,P))/V;let yt=s.sub(I,s.mult(P,V/D)),bt=s.add(E,s.mult(P,V/at)),Wt=T-V*s.cross(H,P)/B,Dt=J+V*s.cross(G,P)/W,q=rt.copy;q.sub(s.mult(P,s.dot(rt,P))),q.setMag(1);let Q=1/D+1/at;Q+=s.dot(s.crossScalarFirst(s.cross(H,q)/B,H),q),Q+=s.dot(s.crossScalarFirst(s.cross(G,q)/W,G),q),Q=-s.dot(rt,q)/Q;let Z=V*xe;Z>Q&&(Z=Q),yt=s.sub(yt,s.mult(q,Z/D)),bt=s.add(bt,s.mult(q,Z/at)),Wt-=Z*s.cross(H,q)/B,Dt+=Z*s.cross(G,q)/W,u.vel=yt,l.vel=bt,u.ang=Wt,l.ang=Dt,b.push(t.ang),Y.push(t.vel),k.push(e.ang),C.push(e.vel),u.ang=d,u.vel=m,l.ang=p,l.vel=f}),b.length!==Y.length)return;if(b.length===0)return;if(Y.length===0)return;if(k.length!==C.length)return;if(k.length===0)return;if(C.length===0)return;u.vel=Y.reduce((v,P)=>s.add(v,P)),u.vel.div(Y.length),u.ang=b.reduce((v,P)=>v+P),u.ang/=b.length,l.vel=C.reduce((v,P)=>s.add(v,P)),l.vel.div(C.length),l.ang=k.reduce((v,P)=>v+P),l.ang/=k.length}collideWithFixedBall(t){let e=new s(t.x,t.y),n;if(s.dist(e,this.pos)>this.boundRadius+t.r)return;if(this.sides.forEach(b=>{let k=s.angle(s.sub(b.a,b.b),s.sub(e,b.b)),Y=s.angle(s.sub(b.b,b.a),s.sub(e,b.a));if(k<Math.PI/2&&Y<Math.PI/2){let C=b.distFromPoint(e);if(C<=t.r){let v=s.sub(b.a,b.b);v.rotate(Math.PI/2),v.setMag(t.r*2);let P=s.mult(v,-1),I=new w(s.add(v,e),s.add(P,e));n=w.intersect(I,b),n instanceof s&&(v=s.sub(n,e),v.setMag(t.r-v.length),this.move(v.x,v.y))}}}),(!n||n===void 0)&&this.points.forEach(b=>{if(s.dist(b,e)<t.r){let k=s.sub(b,e);k.setMag(t.r-k.length),this.move(k.x,k.y),k.setMag(t.r),n=s.add(e,k)}}),!n||n===void 0)return;let i=s.sub(n,e);i.setMag(1);let r=n,c=this.vel.copy,{ang:h}=this,u=s.sub(r,this.pos),{am:l}=this,{m:a}=this,{k:d}=this,{fc:m}=this,p=s.mult(this.velInPlace(r),-1),f=1/a;f+=s.dot(s.crossScalarFirst(s.cross(u,i)/l,u),i),f=-((1+d)*s.dot(p,i))/f;let g=s.sub(c,s.mult(i,f/a)),x=h-f*s.cross(u,i)/l,y=p.copy;y.sub(s.mult(i,s.dot(p,i))),y.setMag(1);let M=1/a;M+=s.dot(s.crossScalarFirst(s.cross(u,y)/l,u),y),M=-s.dot(p,y)/M;let S=f*m;S>M&&(S=M),g=s.sub(g,s.mult(y,S/a)),x-=S*s.cross(u,y)/l,this.vel=g,this.ang=x}collideWithWall(t){if(this.boundRadius+t.boundRadius<s.dist(this.pos,t.center))return;let{sides:e}=this,n=[],i=[];e.forEach(l=>{t.sides.forEach(a=>{let d=w.intersect(l,a);d instanceof s&&i.push(d)})});let r=this.vel.copy,c=this.ang,h=[],u=[];if(i.length>=2){let l=s.sub(i[0],i[1]);l.rotate(Math.PI/2);let a=s.sub(i[0],this.pos);s.dot(l,a)>0&&l.mult(-1),l.setMag(1),s.dot(l,s.sub(this.pos,t.center))<0&&l.mult(-1),n.push(new w(i[0],i[1])),n.push(new w(i[0],s.add(i[0],s.mult(l,20)))),n.push(new w(i[1],s.add(i[1],s.mult(l,20))));let d=[],m=i[0];if(t.points.forEach(f=>{let g=s.sub(f,m),x=s.dot(g,l);x>0&&d.push(x)}),d.length>0){let f=l.copy;f.mult(Math.max(...d)),this.move(f.x,f.y)}d=[];let p=s.add(i[0],i[1]);if(p.div(2),this.containsPoint(p)&&e.forEach(f=>{d.push(f.distFromPoint(p))}),d.length>0){let f=l.copy;f.mult(Math.min(...d)),f.length<this.boundRadius/2&&this.move(f.x,f.y)}if(i.forEach(f=>{let g=l;g.setMag(1),m=f;let x=this.vel.copy,{ang:y}=this;a=s.sub(m,this.pos);let{am:M}=this,{m:S}=this,{k:b}=this,{fc:k}=this,Y=s.mult(this.velInPlace(m),-1),C=1/S;C+=s.dot(s.crossScalarFirst(s.cross(a,g)/M,a),g),C=-((1+b)*s.dot(Y,g))/C;let v=s.sub(x,s.mult(g,C/S)),P=y-C*s.cross(a,g)/M,I=Y.copy;I.sub(s.mult(g,s.dot(Y,g))),I.setMag(1);let E=1/S;E+=s.dot(s.crossScalarFirst(s.cross(a,I)/M,a),I),E=-s.dot(Y,I)/E;let T=C*k;T>E&&(T=E),v=s.sub(v,s.mult(I,T/S)),P-=T*s.cross(a,I)/M,this.vel=v,this.ang=P,h.push(this.vel),this.vel=r.copy,u.push(this.ang),this.ang=c}),u.length!==h.length)return;if(u.length===0)return;if(h.length===0)return;this.vel=h.reduce((f,g)=>s.add(f,g)),this.vel.div(h.length),this.ang=u.reduce((f,g)=>f+g),this.ang/=u.length,(!Number.isFinite(this.vel.x)||!Number.isFinite(this.vel.y)||!Number.isFinite(this.ang))&&(this.vel=r,this.ang=c)}}containsPoint(t){let{sides:e}=this,n=Math.max(...this.points.map(h=>s.dist(h,t)))+1,i=s.fromAngle(0);i.setMag(n);let r=new w(t,s.add(i,t)),c=e.filter(h=>w.intersect(h,r)!==void 0);return c.length%2===1}get sides(){return this.points.map((t,e)=>new w(t,this.points[(e+1)%this.points.length]))}velInPlace(t){let e=s.sub(t,this.pos);return e.rotate(Math.PI/2),e.mult(this.ang),e.add(this.vel),e}effectiveMass(t,e){let n=s.sub(t,this.pos),i=s.angle(e,n),r=Math.sin(i)**2*n.length**2/this.am;return 1/(r+1/this.m)}applyDeltaVelInPoint(t,e){let n=s.sub(e,this.pos);if(n.length===0){this.vel.add(t);return}let i=s.angle(n,t),r=s.mult(n,s.dot(t,n)/n.length**2);this.vel.add(r);let c=n.copy;c.rotate(Math.PI/2),c.setMag(1);let h=Math.sign(s.dot(t,c)),u=t.length*Math.cos(i),l=1/(1/this.m+n.length**2/this.am),a=u*l/this.m;this.vel.add(s.mult(c,a*h));let d=h*u*l*n.length/this.am;this.ang-=d}toJSObject(){let t={};return t.points=this.points.map(e=>({x:e.x,y:e.y})),t.vel=this.vel.toJSObject(),t.k=this.k,t.ang=this.ang,t.fc=this.fc,t.pos=this.pos.toJSObject(),t.lastPos=this.lastPos.toJSObject(),t.rotation=this.rotation,t.id=this.id,t}static fromObject(t){let e=new st(t.points.map(n=>new s(n.x,n.y)),s.fromObject(t.vel),t.k,t.ang,t.fc);return e.id=t.id,e.pos=s.fromObject(t.pos),e.lastPos=s.fromObject(t.lastPos),e.rotation=t.rotation,e}},U=st,Jt=class{constructor(t,e){this.length=t,this.springConstant=e,this.pinned=!1,this.objects=[],this.rotationLocked=!1,this.id=`_${Math.random().toString(36).substr(2,9)}`}pinHere(t,e){this.pinned={x:t,y:e}}unpin(){this.pinned=!1}attachObject(t){let e=this.objects;e.push(t),e.length===2&&(this.pinned=!1),e.length>=3&&(e=[e[e.length-2],e[e.length-1]])}lockRotation(){this.rotationLocked=!0}unlockRotation(){this.rotationLocked=!1}update(t){let e,n;if(this.pinned instanceof Object&&this.objects[0]){[n,e]=[this.pinned,this.objects[0]];let i=new s(n.x-e.pos.x,n.y-e.pos.y),r=i.length-this.length;i.setMag(1),i.mult(r*this.springConstant*t/e.m),e.vel.x+=i.x,e.vel.y+=i.y;let c=e.vel;if(c.rotate(-i.heading),this.rotationLocked){let h=new s(n.x,n.y),u=s.sub(e.pos,h),l=u.length*u.length*e.m+e.am,a=(e.am*e.ang-u.length*e.m*c.y)/l;c.y=-a*u.length,e.ang=a}c.rotate(i.heading)}else if(this.objects[0]&&this.objects[1]){[e,n]=[this.objects[0],this.objects[1]];let i=s.sub(e.pos,n.pos),r=i.length-this.length;i.setMag(1),i.mult(r*this.springConstant*t),n.vel.add(s.div(i,n.m)),e.vel.add(s.div(i,-e.m)),i=s.sub(e.pos,n.pos);let c=e.vel,h=n.vel;if(c.rotate(-i.heading),h.rotate(-i.heading),this.rotationLocked){let u=new s(e.pos.x*e.m+n.pos.x*n.m,e.pos.y*e.m+n.pos.y*n.m);u.div(e.m+n.m);let l=s.sub(e.pos,u),a=s.sub(n.pos,u),d=l.length*l.length*e.m+e.am+a.length*a.length*n.m+n.am,m=(c.y-h.y)*a.length/(l.length+a.length)+h.y,p=(e.am*e.ang+n.am*n.ang+l.length*e.m*(c.y-m)-a.length*n.m*(h.y-m))/d;c.y=p*l.length+m,h.y=-p*a.length+m,e.ang=p,n.ang=p}c.rotate(i.heading),h.rotate(i.heading)}}},j=Jt,Gt=class extends j{constructor(t){super(t,0);this.springConstant=0}update(){let t,e;if(this.pinned instanceof Object&&"x"in this.pinned&&this.objects[0]){[e,t]=[this.pinned,this.objects[0]];let n=new s(e.x-t.pos.x,e.y-t.pos.y);n.setMag(1),n.mult(-this.length),t.move(-t.pos.x+e.x+n.x,-t.pos.y+e.y+n.y);let i=t.vel;if(i.rotate(-n.heading),i.x=0,this.rotationLocked){let r=new s(e.x,e.y),c=s.sub(t.pos,r),h=c.length*c.length*t.m+t.am,u=(t.am*t.ang+c.length*t.m*i.y)/h;i.y=u*c.length,t.ang=u}i.rotate(n.heading)}else if(this.objects[0]&&this.objects[1]){[t,e]=[this.objects[0],this.objects[1]];let n=s.sub(t.pos,e.pos),i=this.length-n.length;n.setMag(1);let r=s.mult(n,i*e.m/(t.m+e.m)),c=s.mult(n,-i*t.m/(t.m+e.m));t.move(r.x,r.y),e.move(c.x,c.y);let h=t.vel,u=e.vel;if(h.rotate(-n.heading),u.rotate(-n.heading),h.x=(t.m*h.x+e.m*u.x)/(t.m+e.m),u.x=h.x,this.rotationLocked){let l=new s(t.pos.x*t.m+e.pos.x*e.m,t.pos.y*t.m+e.pos.y*e.m);l.div(t.m+e.m);let a=s.sub(t.pos,l),d=s.sub(e.pos,l),m=a.length*a.length*t.m+t.am+d.length*d.length*e.m+e.am,p=(h.y-u.y)*d.length/(a.length+d.length)+u.y,f=(t.am*t.ang+e.am*e.ang+a.length*t.m*(h.y-p)-d.length*e.m*(u.y-p))/m;h.y=f*a.length+p,u.y=-f*d.length+p,t.ang=f,e.ang=f}h.rotate(n.heading),u.rotate(n.heading)}}},N=Gt,ht=class{constructor(t,e,n,i,r){this.points=[],i||i===0?this.fc=i:this.fc=.4,this.pressure=n,r?this.resolution=r:this.resolution=30,this.r=Math.abs(e);let c=Math.random()*1e6;for(let h=0;h<this.resolution;h+=1){let u=new s(t.x,t.y);u.add(s.mult(s.fromAngle(h/this.resolution*Math.PI*2),this.r)),this.points.push(new L(u,new s(0,0),this.r*Math.sin(Math.PI/this.resolution),0,0,this.fc)),this.points[this.points.length-1].layer=c}this.sides=[];for(let h=0;h<this.resolution;h+=1){let u=new N(2*this.r*Math.sin(Math.PI/this.resolution));u.attachObject(this.points[h]),u.attachObject(this.points[(h+1)%this.resolution]),h%2===0&&u.lockRotation(),this.sides.push(u)}}static updatePressureBasedForces(t,e){let n=[];if(n.push([]),t.points.forEach(c=>{n[0].push(new s(c.pos.x,c.pos.y))}),(c=>{let h=s.angleACW(s.sub(c[1],c[0]),s.sub(c[c.length-1],c[0]));if(h>Math.PI)return!0;for(let u=1;u<c.length-1;u+=1)if(h=s.angleACW(s.sub(c[(u+1)%c.length],c[u]),s.sub(c[u-1],c[u])),h>Math.PI)return!0;return h=s.angleACW(s.sub(c[0],c[c.length-1]),s.sub(c[c.length-2],c[c.length-1])),h>Math.PI})(n[0])){let c=(l,a)=>{for(let d=0;d<l.length;d+=1)if(l[d]===a)return!0;return!1},h=(l,a,d)=>{for(let m=0;m<a.length;m+=1)if(!c(d,m)){let p=new w(new s(a[m].x,a[m].y),new s(a[(m+1)%a.length].x,a[(m+1)%a.length].y));if(w.intersect(l,p))return!0}return!1},u=!0;t:for(;u;){u=!1;for(let l=0;l<n.length;l+=1){let a=n[l],d=s.sub(a[1],a[0]),m=s.sub(a[a.length-1],a[0]),p=s.angleACW(d,m);if(p>Math.PI){u=!0;let f=0,g=f+2,x=new w(new s(a[f].x,a[f].y),new s(a[g%a.length].x,a[g%a.length].y)),y=new s(x.b.x-x.a.x,x.b.y-x.a.y).heading;for(;!(d.heading>m.heading?y>d.heading&&y<2*Math.PI||y>0&&y<m.heading:y>d.heading&&y<m.heading)||h(new w(new s(a[f%a.length].x,a[f%a.length].y),new s(a[g%a.length].x,a[g%a.length].y)),a,[(a.length-1)%a.length,f%a.length,(g-1)%a.length,g%a.length]);)g+=1,x=new w(new s(a[f].x,a[f].y),new s(a[g%a.length].x,a[g%a.length].y)),y=new s(x.b.x-x.a.x,x.b.y-x.a.y).heading;let M=[],S=[];for(let b=f;b<=g;b+=1)M.push(a[b%a.length]);for(let b=g;b<=f+a.length;b+=1)S.push(a[b%a.length]);n[l]=M,n.push(S);continue t}for(let f=1;f<a.length;f+=1)if(d=s.sub(a[(f+1)%a.length],a[f]),m=s.sub(a[f-1],a[f]),p=s.angleACW(d,m),p>Math.PI){u=!0;let g=f+2,x=new w(new s(a[f].x,a[f].y),new s(a[g%a.length].x,a[g%a.length].y)),y=new s(x.b.x-x.a.x,x.b.y-x.a.y).heading;for(;!(d.heading>m.heading?y>d.heading&&y<2*Math.PI||y>0&&y<m.heading:y>d.heading&&y<m.heading)||h(x,a,[(f-1)%a.length,f%a.length,(g-1)%a.length,g%a.length]);)g+=1,x=new w(new s(a[f].x,a[f].y),new s(a[g%a.length].x,a[g%a.length].y)),y=new s(x.b.x-x.a.x,x.b.y-x.a.y).heading;let M=[],S=[];for(let b=f;b<=g;b+=1)M.push(a[b%a.length]);for(let b=g;b<=f+a.length;b+=1)S.push(a[b%a.length]);n[l]=M,n.push(S);continue t}}}}for(let c=n.length-1;c>=0;c-=1){let h=n[c];for(;h.length>3;)n.push([h[0],h[1],h[2]]),h.splice(1,1)}let i=0;n.forEach(c=>{let h=Math.sqrt((c[0].x-c[1].x)**2+(c[0].y-c[1].y)**2),u=Math.sqrt((c[1].x-c[2].x)**2+(c[1].y-c[2].y)**2),l=Math.sqrt((c[2].x-c[0].x)**2+(c[2].y-c[0].y)**2),a=(h+u+l)/2,d=Math.sqrt(a*(a-h)*(a-u)*(a-l));i+=d});let r=t.pressure*(t.r*t.r*Math.PI/i)-t.pressure;t.sides.forEach(c=>{let h=s.sub(c.objects[0].pos,c.objects[1].pos);h.mult(r),h.rotate(Math.PI/2),h.mult(e),c.objects[0].vel.add(s.div(h,c.objects[0].m)),c.objects[1].vel.add(s.div(h,c.objects[1].m))})}get sideSegments(){return this.points.map((t,e)=>new w(t.pos,this.points[(e+1)%this.points.length].pos))}containsPoint(t){let e=this.sideSegments,n=Math.max(...this.points.map(h=>s.dist(h.pos,t)))+1,i=s.fromAngle(0);i.setMag(n);let r=new w(t,s.add(i,t)),c=e.filter(h=>w.intersect(h,r)!==void 0);return c.length%2===1}toJSObject(){let t={};return t.pressure=this.pressure,t.fc=this.fc,t.r=this.r,t.resolution=this.resolution,t.points=this.points.map(e=>e.id),t.sides=this.sides.map(e=>e.id),t}static fromObject(t,e,n){let i=Object.create(ht.prototype);return i.pressure=t.pressure,i.fc=t.fc,i.resolution=t.resolution,i.r=t.r,i.points=t.points.map(r=>{let c=e.filter(h=>r===h.id);return c[0]}),i.sides=t.sides.map(r=>{let c=n.filter(h=>r===h.id);return c[0]}),i}},$=ht;function Pe(o,t,e){return o==="spring"?new j(t,e):o==="stick"?new N(t):new j(0,0)}function Vt(o,t){let e=Pe(o.type,o.length,o.springConstant);return e.pinned=o.pinned,e.rotationLocked=o.rotationLocked,e.id=o.id,e.objects=o.objects.map(n=>{let i=t.filter(r=>n===r.id);return i[0]}),e}function zt(o){let t={};return t.length=o.length,t.springConstant=o.springConstant,t.pinned=o.pinned,t.rotationLocked=o.rotationLocked,t.id=o.id,t.objects=o.objects.map(e=>e.id),o instanceof j&&(t.type="spring"),o instanceof N&&(t.type="stick"),t}var K=class{constructor(){this.balls=[],this.bodies=[],this.fixedBalls=[],this.softBalls=[],this.walls=[],this.bounds=[],this.springs=[],this.airFriction=1,this.gravity=new s(0,0),this.addBodyNotBall=!1}update(t,e){let n=e?this.copy:new K;e&&(n.bodies.reverse(),n.balls.reverse(),n.update(t,!1));for(let i=0;i<this.balls.length;i+=1)this.balls[i].lastPos=this.balls[i].pos.copy,this.balls[i].pos.add(s.mult(this.balls[i].vel,t)),this.balls[i].rotation+=this.balls[i].ang*t,this.balls[i].rotation%=Math.PI*2;for(let i=0;i<this.bodies.length;i+=1)this.bodies[i].lastPos=this.bodies[i].pos.copy,this.bodies[i].move(this.bodies[i].vel.x*t,this.bodies[i].vel.y*t),this.bodies[i].rotate(this.bodies[i].ang*t);for(let i=0;i<3;i+=1)this.springs.forEach(r=>{r.update(t/3/2)});for(let i=0;i<this.balls.length;i+=1){this.gravity&&this.balls[i].vel.add(new s(this.gravity.x*t,this.gravity.y*t));for(let r=i+1;r<this.balls.length;r+=1)(this.balls[i].layer!==this.balls[r].layer||!this.balls[i].layer&&!this.balls[r].layer)&&L.collide(this.balls[i],this.balls[r]);this.walls.forEach(r=>{r.collideWithBall(this.balls[i])}),this.fixedBalls.forEach(r=>{let c=this.balls[i],h,u=0,l=new s(r.x,r.y);if(l.x-=c.pos.x,l.y-=c.pos.y,l.mult(-1),l.length<=c.r+r.r&&(h=l.heading,u=l.length),Number.isFinite(h)&&typeof h!="undefined"){let a=c.pos.copy,d=c.vel.copy;if(a.rotate(-h+Math.PI/2),d.rotate(-h+Math.PI/2),d.y<=0){d.y*=-c.k,a.y+=c.r+r.r-u;let m=d.y*(1+c.k),p=Math.sign(d.x+c.ang*c.r)*(m*c.fc)/(c.amc*c.r),f=(d.x+c.ang*c.r)/c.r;p/f>1&&(p=f),c.ang-=p;let g=p*c.am/c.r/c.m;d.x-=g,a.rotate(h-Math.PI/2),d.rotate(h-Math.PI/2),c.pos.x=a.x,c.pos.y=a.y,c.vel.x=d.x,c.vel.y=d.y}}}),this.bounds.forEach(r=>{r.collideWithBall(this.balls[i])})}for(let i=0;i<this.bodies.length;i+=1){this.balls.forEach(r=>{this.bodies[i].collideWithBall(r)});for(let r=i+1;r<this.bodies.length;r+=1)U.collide(this.bodies[i],this.bodies[r]);this.bodies.forEach(r=>{this.fixedBalls.forEach(c=>{r.collideWithFixedBall(c)})}),this.bodies.forEach(r=>{this.walls.forEach(c=>{r.collideWithWall(c)})}),this.bodies.forEach(r=>{this.bounds.forEach(c=>{r.collideWithWall(c)})}),this.gravity&&this.bodies[i].vel.add(new s(this.gravity.x*t,this.gravity.y*t))}this.softBalls.forEach(i=>{$.updatePressureBasedForces(i,t)});for(let i=0;i<3;i+=1)this.springs.forEach(r=>{r.update(t/3/2)});this.balls.forEach(i=>{let r=i;r.vel.mult(this.airFriction**t),r.ang*=this.airFriction**t}),this.bodies.forEach(i=>{let r=i;r.vel.mult(this.airFriction**t),r.ang*=this.airFriction**t}),e&&(n.bodies.reverse(),n.balls.reverse(),this.balls.forEach((i,r)=>{i.move((n.balls[r].pos.x-i.pos.x)*.5,(n.balls[r].pos.y-i.pos.y)*.5),i.vel.add(new s((n.balls[r].vel.x-i.vel.x)*.5,(n.balls[r].vel.y-i.vel.y)*.5));let c=i;c.rotation=(i.rotation+n.balls[r].rotation)/2,c.ang=(i.ang+n.balls[r].ang)/2}),this.bodies.forEach((i,r)=>{let c=n.bodies[r];i.move((c.pos.x-i.pos.x)*.5,(c.pos.y-i.pos.y)*.5),i.vel.add(new s((c.vel.x-i.vel.x)*.5,(c.vel.y-i.vel.y)*.5)),i.rotate((c.rotation-i.rotation)/2);let h=i;h.ang=(i.ang+c.ang)/2}))}get copy(){let t=new K;return t.balls=this.getCopyOfBalls(),t.bodies=this.getCopyOfBodies(),t.fixedBalls=this.fixedBalls,t.walls=this.walls,t.bounds=this.bounds,t.gravity=this.gravity,this.springs.forEach(e=>{let n=e instanceof j?j:N,i=new n(e.length,e.springConstant);i.rotationLocked=e.rotationLocked,i.pinned=e.pinned,e.objects.forEach(r=>{let c=-1;r instanceof L&&(c=this.balls.indexOf(r)),c!==-1?i.attachObject(t.balls[c]):(c=-1,r instanceof U&&(c=this.bodies.indexOf(r)),c!==-1&&i.attachObject(t.bodies[c]))}),t.springs.push(i)}),t}setAirFriction(t){if(!Number.isFinite(t))return;this.airFriction=t,this.airFriction<0&&(this.airFriction=0),this.airFriction>1&&(this.airFriction=1)}setGravity(t){this.gravity=t.copy}addBall(t){if(this.addBodyNotBall){let e=(n,i,r)=>{let c=[];for(let h=0;h<r;h+=1){let u=s.fromAngle(h/r*2*Math.PI);u.mult(i),u.add(n),c.push(u)}return c};this.bodies.push(new U(e(t.pos,t.r,24),t.vel,t.k,t.ang,t.fc))}else this.balls.push(t)}addBody(t){this.bodies.push(t)}addSoftBall(t){this.balls.push(...t.points),this.springs.push(...t.sides),this.softBalls.push(t)}addSoftSquare(t,e,n,i,r=24,c=1){let h=new $(t,Math.sqrt(e*e/Math.PI),c,n,r);h.sides.forEach(a=>{let d=a;d.length=.96*4*e/h.resolution}),h.points.forEach(a=>{let d=a;d.vel=i.copy}),this.balls.push(...h.points),this.springs.push(...h.sides);let u=e*e*200*c,l=new j(Math.sqrt(h.r*h.r*Math.PI),u/2);l.attachObject(h.points[0]),l.attachObject(h.points[h.resolution/2]),this.springs.push(l),l=new j(Math.sqrt(h.r*h.r*Math.PI),u/2),l.attachObject(h.points[h.resolution/4]),l.attachObject(h.points[3*h.resolution/4]),this.springs.push(l),l=new j(Math.sqrt(2*h.r*h.r*Math.PI),u),l.attachObject(h.points[h.resolution/8]),l.attachObject(h.points[5*h.resolution/8]),this.springs.push(l),l=new j(Math.sqrt(2*h.r*h.r*Math.PI),u),l.attachObject(h.points[3*h.resolution/8]),l.attachObject(h.points[7*h.resolution/8]),this.springs.push(l)}addRectWall(t,e,n,i){let r=[];r.push(new s(t-n/2,e-i/2)),r.push(new s(t+n/2,e-i/2)),r.push(new s(t+n/2,e+i/2)),r.push(new s(t-n/2,e+i/2)),this.walls.push(new _(r))}addRectBody(t,e,n,i,r,c){let h=[];h.push(new s(t-n/2,e-i/2)),h.push(new s(t+n/2,e-i/2)),h.push(new s(t+n/2,e+i/2)),h.push(new s(t-n/2,e+i/2)),this.bodies.push(new U(h,new s(0,0),c,0,r))}addWall(t){this.walls.push(t)}addFixedBall(t,e,n){this.fixedBalls.push({x:t,y:e,r:n})}addSpring(t){this.springs.push(t)}setBounds(t,e,n,i){this.bounds=[];let r=(c,h,u,l)=>{let a=[];return a.push(new s(c-u/2,h-l/2)),a.push(new s(c+u/2,h-l/2)),a.push(new s(c+u/2,h+l/2)),a.push(new s(c-u/2,h+l/2)),new _(a)};this.bounds.push(r(t-n,e,2*n,4*i)),this.bounds.push(r(t+2*n,e,2*n,4*i)),this.bounds.push(r(t,e-i,4*n,i*2)),this.bounds.push(r(t,e+2*i,4*n,2*i))}getObjectAtCoordinates(t,e){let n={x:t,y:e,pinPoint:!0},i=new s(t,e);return this.balls.forEach(r=>{r.containsPoint(i)&&(n=r)}),this.bodies.forEach(r=>{r.containsPoint(i)&&(n=r)}),this.walls.forEach(r=>{r.containsPoint(i)&&(n=r)}),this.fixedBalls.forEach(r=>{s.dist(new s(r.x,r.y),new s(t,e))<=r.r&&(n=r)}),this.softBalls.forEach(r=>{r.containsPoint(i)&&(n=r)}),n}getCopyOfBalls(){return this.balls.map(t=>t.copy)}getCopyOfBodies(){return this.bodies.map(t=>t.copy)}removeObjFromSystem(t){let e=-1;if(t instanceof L&&(e=this.balls.indexOf(t)),e!==-1){let n=!1;if(this.softBalls.forEach(i=>{i.points.includes(this.balls[e])&&(this.removeObjFromSystem(i),n=!0)}),n)return;this.springs.forEach(i=>{i.objects.includes(this.balls[e])&&this.removeObjFromSystem(i)}),this.balls.splice(e,1);return}if(t instanceof U&&(e=this.bodies.indexOf(t)),e!==-1){this.bodies.splice(e,1);return}if(t instanceof _&&(e=this.walls.indexOf(t)),e!==-1){this.walls.splice(e,1);return}if(t instanceof Object&&"r"in t&&"x"in t&&(e=this.fixedBalls.indexOf(t)),e!==-1){this.fixedBalls.splice(e,1);return}if((t instanceof N||t instanceof j)&&(e=this.springs.indexOf(t)),e!==-1){this.springs.splice(e,1);let n=this.springs[e];this.softBalls.forEach(i=>{n instanceof N&&i.sides.includes(n)&&this.removeObjFromSystem(i)});return}if(t instanceof $&&(e=this.softBalls.indexOf(t)),e!==-1){let n=this.softBalls[e];this.softBalls.splice(e,1),n.points.forEach(i=>{this.removeObjFromSystem(i)})}}getItemDataFromId(t){let e=c=>c.id===t,n=this.balls.filter(e);if(n.length>=1)return{type:"ball",num:this.balls.indexOf(n[0])};let i=this.bodies.filter(e);if(i.length>=1)return{type:"body",num:this.bodies.indexOf(i[0])};let r=this.springs.filter(e);return r.length>=1?{type:"spring",num:this.springs.indexOf(r[0])}:{type:"",num:-1}}toJSObject(){let t={};return t.balls=this.balls.map(e=>e.toJSObject()),t.bounds=this.bounds.map(e=>e.toJSObject()),t.walls=this.walls.map(e=>e.toJSObject()),t.bodies=this.bodies.map(e=>e.toJSObject()),t.springs=this.springs.map(e=>zt(e)),t.softBalls=this.softBalls.map(e=>e.toJSObject()),t.fixedBalls=this.fixedBalls,t.airFriction=this.airFriction,t.gravity=this.gravity.toJSObject(),t}static fromObject(t){let e=new K;return e.balls=t.balls.map(n=>L.fromObject(n)),e.bounds=t.bounds.map(n=>_.fromObject(n)),e.walls=t.walls.map(n=>_.fromObject(n)),e.bodies=t.bodies.map(n=>U.fromObject(n)),e.springs=t.springs.map(n=>Vt(n,e.balls)),e.softBalls=t.softBalls.map(n=>$.fromObject(n,e.balls,e.springs)),e.fixedBalls=t.fixedBalls,e.airFriction=t.airFriction,e.gravity=s.fromObject(t.gravity),e}toJSON(){return JSON.stringify(this.toJSObject())}static fromJSON(t){return K.fromObject(JSON.parse(t))}},nt=K,lt,A;function xt(o){lt=o.getPhysics().toJSObject(),A=!0;let t=document.getElementById("pause");t&&(t.onclick=()=>{o.getTimeMultiplier()!==0?o.setTimeMultiplier(0):(o.setTimeMultiplier(1),A===!0&&(lt=o.getPhysics().toJSObject()),A=!1)});let e=document.getElementById("revert");e&&(e.onclick=()=>{o.setTimeMultiplier(0),o.setPhysics(nt.fromObject(lt)),A=!0});let n=document.getElementById("clear all");n&&(n.onclick=()=>{A=!0;let r=o.getPhysics();r.balls=[],r.walls=[],r.softBalls=[],r.springs=[],r.bodies=[]});let i=document.getElementById("set start");i&&(i.onclick=()=>{lt=o.getPhysics().toJSObject(),A=!0,o.setTimeMultiplier(0)})}function X(o){let t=document.createElement("div"),e=document.createElement("h3");return e.innerText=o,e.classList.add("modetitlemargin"),t.appendChild(e),t.classList.add("mode-title"),t.classList.add("bg-blue"),t}function F(o,t,e,n,i,r=1){let c=document.createElement("p");c.innerText=o;let h=document.createElement("input");h.type="range",h.min=t.toString(),h.max=e.toString(),h.step=r.toString(),h.value=n.toString(),h.classList.add("slider"),h.classList.add("fix-width"),h.onchange=i;let u=document.createElement("div");return u.appendChild(c),u.appendChild(h),u}function ut(o,t,e){let n=o+Math.random().toString(),i=document.createElement("label");i.innerText=o,i.htmlFor=n,i.classList.add("checkbox-label");let r=document.createElement("input");r.type="checkbox",r.name=n,r.value=t.toString(),r.classList.add("ch-box"),r.onchange=e;let c=document.createElement("div");return c.appendChild(r),c.appendChild(i),c}var dt=35,vt=.5,wt=1.5,Mt=document.createElement("div"),Ut={name:"Ball creator",description:"",element:Mt,drawFunc(o,t){let e=o.cnv.getContext("2d");e.strokeStyle="black",e.beginPath(),e.arc(o.mouseX,o.mouseY,dt,0,2*Math.PI),e.stroke(),o.lastX!==0&&o.lastY!==0&&(e.beginPath(),e.moveTo(o.mouseX,o.mouseY),e.lineTo(o.lastX,o.lastY),e.stroke())},startInteractionFunc(o){},endInteractionFunc(o){if(o.lastX!==0&&o.lastY!==0){let t=new L(new s(o.lastX,o.lastY),new s(o.lastX-o.mouseX,o.lastY-o.mouseY),dt,vt,0,wt);Number.isFinite(t.pos.x)&&Number.isFinite(t.pos.y)&&Number.isFinite(t.vel.x)&&Number.isFinite(t.vel.y)||(t.vel.x=0,t.vel.y=0),o.physics.addBall(t)}},keyGotUpFunc(o){},keyGotDownFunc(o){}};[X(Ut.name),F("Size",5,120,dt,o=>{dt=o.target.valueAsNumber}),F("Bounciness",0,1,vt,o=>{vt=o.target.valueAsNumber},.02),F("Coefficient of friction",0,2,wt,o=>{wt=o.target.valueAsNumber},.1)].forEach(Mt.appendChild.bind(Mt));var $t=Ut,Pt=document.createElement("div"),Kt={name:"Delete",description:"",element:Pt,drawFunc(o,t){},startInteractionFunc(o){o.choosed&&o.physics.removeObjFromSystem(o.choosed)},endInteractionFunc(o){},keyGotUpFunc(o){},keyGotDownFunc(o){}};[X(Kt.name)].forEach(Pt.appendChild.bind(Pt));var Qt=Kt,it=35,Ie=.5,ft=1.5,It=24,St=1e6,kt=document.createElement("div"),Zt={name:"Elastic ball creator",description:"",element:kt,drawFunc(o,t){let e=o.cnv.getContext("2d");e.strokeStyle="black",e.beginPath(),e.arc(o.mouseX,o.mouseY,it,0,2*Math.PI),e.stroke(),o.lastX!==0&&o.lastY!==0&&(e.beginPath(),e.moveTo(o.mouseX,o.mouseY),e.lineTo(o.lastX,o.lastY),e.stroke())},startInteractionFunc(o){},endInteractionFunc(o){if(o.lastX!==0&&o.lastY!==0){let t=new L(new s(o.lastX,o.lastY),new s(o.lastX-o.mouseX,o.lastY-o.mouseY),it,Ie,0,ft);if(Number.isFinite(t.pos.x)&&Number.isFinite(t.pos.y)&&Number.isFinite(t.vel.x)&&Number.isFinite(t.vel.y)){let e=new $(t.pos,it,St,ft,It);e.points.forEach(n=>{let i=n;i.vel=t.vel.copy}),o.physics.addSoftBall(e)}}},keyGotUpFunc(o){},keyGotDownFunc(o){}};[X(Zt.name),F("Size",5,60,it,o=>{it=o.target.valueAsNumber}),F("Pressure",5e5,3e6,St,o=>{St=o.target.valueAsNumber},4e3),F("Coefficient of friction",0,2,ft,o=>{ft=o.target.valueAsNumber},.1),F("Resolution",6,24,It,o=>{It=o.target.valueAsNumber},1)].forEach(kt.appendChild.bind(kt));var _t=Zt,At=0,te=0,Ct=document.createElement("div"),ee={name:"Move",description:"",element:Ct,drawFunc(o,t){let{choosed:e}=o;e instanceof Object&&"move"in e&&(e.move(o.mouseX-e.pos.x,o.mouseY-e.pos.y),t===0?(e.vel.x=0,e.vel.y=0):(e.vel.x=(o.mouseX-At)/t,e.vel.y=(o.mouseY-te)/t),e.ang=0),At=o.mouseX,te=o.mouseY},startInteractionFunc(o){},endInteractionFunc(o){},keyGotUpFunc(o){},keyGotDownFunc(o){}};[X(ee.name)].forEach(Ct.appendChild.bind(Ct));var se=ee,Et=document.createElement("div"),ne={name:"Rectangle wall",description:"",element:Et,drawFunc(o,t){if(o.lastX!==0&&o.lastY!==0){let e=o.cnv.getContext("2d");e.strokeStyle="black",e.strokeRect(o.mouseX,o.mouseY,o.lastX-o.mouseX,o.lastY-o.mouseY)}},startInteractionFunc(o){},endInteractionFunc(o){o.lastX!==0&&o.lastY!==0&&o.physics.addRectWall(o.lastX/2+o.mouseX/2,o.lastY/2+o.mouseY/2,2*Math.abs(o.lastX/2-o.mouseX/2),2*Math.abs(o.lastY/2-o.mouseY/2))},keyGotUpFunc(o){},keyGotDownFunc(o){}};[X(ne.name)].forEach(Et.appendChild.bind(Et));var ie=ne,Ot=.2,Ft=.5,Tt=document.createElement("div"),oe={name:"Rectangle body (experimental)",description:"",element:Tt,drawFunc(o,t){let e=o.cnv.getContext("2d");o.lastX!==0&&o.lastY!==0&&(e.strokeStyle="black",e.strokeRect(o.mouseX,o.mouseY,o.lastX-o.mouseX,o.lastY-o.mouseY))},startInteractionFunc(o){},endInteractionFunc(o){o.lastX!==0&&o.lastY!==0&&o.physics.addRectBody(o.lastX/2+o.mouseX/2,o.lastY/2+o.mouseY/2,2*Math.abs(o.lastX/2-o.mouseX/2),2*Math.abs(o.lastY/2-o.mouseY/2),Ft,Ot)},keyGotUpFunc(o){},keyGotDownFunc(o){}};[X(oe.name),F("Bounciness",.07,.3,Ot,o=>{Ot=o.target.valueAsNumber},.02),F("Coefficient of friction",0,.6,Ft,o=>{Ft=o.target.valueAsNumber},.1)].forEach(Tt.appendChild.bind(Tt));var ae=oe,R=35,Se=.5,mt=1.5,Xt=24,Yt=1,jt=document.createElement("div"),re={name:"Soft square creator",description:"",element:jt,drawFunc(o,t){let e=o.cnv.getContext("2d");e.strokeStyle="black",e.beginPath(),e.moveTo(o.mouseX-R,o.mouseY-R),e.lineTo(o.mouseX+R,o.mouseY-R),e.lineTo(o.mouseX+R,o.mouseY+R),e.lineTo(o.mouseX-R,o.mouseY+R),e.lineTo(o.mouseX-R,o.mouseY-R),e.stroke(),o.lastX!==0&&o.lastY!==0&&(e.beginPath(),e.moveTo(o.mouseX,o.mouseY),e.lineTo(o.lastX,o.lastY),e.stroke())},startInteractionFunc(o){},endInteractionFunc(o){if(o.lastX!==0&&o.lastY!==0){let t=new L(new s(o.lastX,o.lastY),new s(o.lastX-o.mouseX,o.lastY-o.mouseY),R,Se,0,mt);Number.isFinite(t.pos.x)&&Number.isFinite(t.pos.y)&&Number.isFinite(t.vel.x)&&Number.isFinite(t.vel.y)&&o.physics.addSoftSquare(t.pos,R*2,mt,t.vel,Xt,Yt)}},keyGotUpFunc(o){},keyGotDownFunc(o){}};[X(re.name),F("Size",5,100,R,o=>{R=o.target.valueAsNumber}),F("Pressure",.4,7,Yt,o=>{Yt=o.target.valueAsNumber},.1),F("Coefficient of friction",0,2,mt,o=>{mt=o.target.valueAsNumber},.1),F("Resolution",16,48,Xt,o=>{Xt=o.target.valueAsNumber},8)].forEach(jt.appendChild.bind(jt));var ce=re,Bt=!1,ot=1e4,Lt=document.createElement("div"),he={name:"Spring creator",description:"",element:Lt,drawFunc(o,t){let e=o.cnv.getContext("2d");o.lastX!==0&&o.lastY!==0&&(e.strokeStyle="black",e.beginPath(),e.moveTo(o.mouseX,o.mouseY),e.lineTo(o.lastX,o.lastY),e.stroke())},startInteractionFunc(o){},endInteractionFunc(o){if(o.lastX!==0&&o.lastY!==0){let t=o.physics.getObjectAtCoordinates(o.mouseX,o.mouseY),e,n=j;if(t||(t={x:o.mouseX,y:o.mouseY,pinPoint:!0}),o.choosed===t||o.choosed===void 0&&t===void 0)return;if(o.choosed instanceof Object&&t instanceof Object&&"pinPoint"in o.choosed&&"pinPoint"in t)return;if(o.choosed instanceof Object&&t instanceof Object&&"pinPoint"in o.choosed&&"pos"in t?(e=new n(Math.sqrt((o.choosed.x-t.pos.x)**2+(o.choosed.y-t.pos.y)**2),ot),e.attachObject(t),e.pinHere(o.choosed.x,o.choosed.y)):t instanceof Object&&o.choosed instanceof Object&&"pos"in o.choosed&&"pinPoint"in t?(e=new n(Math.sqrt((o.choosed.pos.x-t.x)**2+(o.choosed.pos.y-t.y)**2),ot),e.attachObject(o.choosed),e.pinHere(t.x,t.y)):o.choosed instanceof Object&&t instanceof Object&&"pos"in o.choosed&&"pos"in t&&(e=new n(Math.sqrt((o.choosed.pos.x-t.pos.x)**2+(o.choosed.pos.y-t.pos.y)**2),ot),e.attachObject(o.choosed),e.attachObject(t)),typeof e=="undefined")return;o.physics.addSpring(e),Bt&&e.lockRotation()}},keyGotUpFunc(o){},keyGotDownFunc(o){}};[X(he.name),ut("Rotation locked",Bt,o=>{Bt=o.target.checked}),F("Spring stiffness",2e3,1e5,ot,o=>{ot=o.target.valueAsNumber},50)].forEach(Lt.appendChild.bind(Lt));var le=he,Nt=!1,Rt=document.createElement("div"),ue={name:"Stick creator",description:"",element:Rt,drawFunc(o,t){let e=o.cnv.getContext("2d");o.lastX!==0&&o.lastY!==0&&(e.strokeStyle="black",e.beginPath(),e.moveTo(o.mouseX,o.mouseY),e.lineTo(o.lastX,o.lastY),e.stroke())},startInteractionFunc(o){},endInteractionFunc(o){if(o.lastX!==0&&o.lastY!==0){let t=o.physics.getObjectAtCoordinates(o.mouseX,o.mouseY),e,n=N;if(t||(t={x:o.mouseX,y:o.mouseY,pinPoint:!0}),o.choosed===t||o.choosed===void 0&&t===void 0)return;if("pinPoint"in o.choosed&&"pinPoint"in t)return;if("pinPoint"in o.choosed&&"pos"in t?(e=new n(Math.sqrt((o.choosed.x-t.pos.x)**2+(o.choosed.y-t.pos.y)**2)),e.attachObject(t),e.pinHere(o.choosed.x,o.choosed.y)):"pinPoint"in t&&"pos"in o.choosed?(e=new n(Math.sqrt((o.choosed.pos.x-t.x)**2+(o.choosed.pos.y-t.y)**2)),e.attachObject(o.choosed),e.pinHere(t.x,t.y)):"pos"in o.choosed&&"pos"in t&&(e=new n(Math.sqrt((o.choosed.pos.x-t.pos.x)**2+(o.choosed.pos.y-t.pos.y)**2)),e.attachObject(o.choosed),e.attachObject(t)),typeof e=="undefined")return;o.physics.addSpring(e),Nt&&e.lockRotation()}},keyGotUpFunc(o){},keyGotDownFunc(o){}};[X(ue.name),ut("Rotation locked",Nt,o=>{Nt=o.target.checked})].forEach(Rt.appendChild.bind(Rt));var de=ue,gt=20,Ht=document.createElement("div"),fe={name:"Wall drawer",description:"",element:Ht,drawFunc(o,t){let e=o.cnv.getContext("2d");e.strokeStyle="black",e.beginPath(),e.arc(o.mouseX,o.mouseY,gt,0,2*Math.PI),e.stroke(),o.lastX!==0&&o.lastY!==0&&o.physics.addFixedBall(o.mouseX,o.mouseY,gt)},startInteractionFunc(o){},endInteractionFunc(o){},keyGotUpFunc(o){},keyGotDownFunc(o){}};[X(fe.name),F("Size",5,70,gt,o=>{gt=o.target.valueAsNumber})].forEach(Ht.appendChild.bind(Ht));var me=fe,ge=[$t,ie,me,de,le,se,_t,ce,Qt,ae];var tt=ge,pt=tt.map(o=>o.name),z={white:"#faf3dd",green:"#02c39a",pink:"#e58c8a",blue:"#77b6ea",black:"#363732"},pe=class{constructor(){this.resizeCanvas=()=>{let t=this.canvasHolder.getBoundingClientRect();this.cnv.width=t.width,this.cnv.height=window.innerHeight-t.top;let e=window.devicePixelRatio||1,n=t;this.cnv.width=n.width*e,this.cnv.height=n.height*e,this.cnv.style.width=`${n.width}px`,this.cnv.style.height=`${n.height}px`,this.scaling=1/e,this.physics.setBounds(0,0,this.cnv.width,this.cnv.height);let i=this.cnv.getContext("2d");i&&(i.scale(e,e),i.lineWidth=e),this.defaultSize=(this.cnv.width+this.cnv.height)/80};this.drawFunction=()=>{var n,i;Number.isFinite(this.lastFrameTime)||(this.lastFrameTime=performance.now());let t=performance.now()-this.lastFrameTime;Number.isFinite(t)||(t=0),t/=1e3;let e=this.cnv.getContext("2d");e.fillStyle=z.black,e.fillRect(0,0,this.cnv.width,this.cnv.height),e.save(),e.translate(this.viewOffsetX,this.viewOffsetY),e.scale(this.scaling,this.scaling),(i=(n=tt[this.mode]).drawFunc)==null||i.call(n,this,t*this.timeMultiplier),this.physicsDraw(),e.restore(),this.physics.balls[0]&&(this.right&&(this.physics.balls[0].ang-=Math.PI*100*t),this.left&&(this.physics.balls[0].ang+=Math.PI*100*t)),t*=this.timeMultiplier,this.physics.update(t/5,!1),this.physics.update(t/5,!1),this.physics.update(t/5,!1),this.physics.update(t/5,!1),this.physics.update(t/5,!1),this.lastFrameTime=performance.now(),requestAnimationFrame(this.drawFunction)};this.startInteraction=(t,e)=>{var n,i;this.mouseX=t/this.scaling-this.viewOffsetX/this.scaling,this.mouseY=e/this.scaling-this.viewOffsetY/this.scaling,this.choosed=this.physics.getObjectAtCoordinates(this.mouseX,this.mouseY),this.choosed||(this.choosed={x:this.mouseX,y:this.mouseY,pinPoint:!0}),this.lastX=this.mouseX,this.lastY=this.mouseY,(i=(n=tt[this.mode]).startInteractionFunc)==null||i.call(n,this)};this.endInteraction=(t,e)=>{var n,i;if(this.mouseX=t/this.scaling-this.viewOffsetX/this.scaling,this.mouseY=e/this.scaling-this.viewOffsetY/this.scaling,(i=(n=tt[this.mode]).endInteractionFunc)==null||i.call(n,this),this.lastX===0&&this.lastY===0)return;this.lastX=0,this.lastY=0,this.choosed=!1};this.keyGotDown=t=>{let e=t.key;e==="s"&&this.spawnNewtonsCradle(this.cnv.width/2,this.cnv.height/2,.5,this.physics),e==="a"&&(this.scaling+=.01),e==="d"&&(this.scaling-=.01),e==="j"&&(this.viewOffsetX-=10),e==="l"&&(this.viewOffsetX+=10),e==="k"&&(this.viewOffsetY-=10),e==="i"&&(this.viewOffsetY+=10),e==="ArrowRight"&&(this.right=!0),e==="ArrowLeft"&&(this.left=!0)};this.keyGotUp=t=>{let e=t.key;e==="ArrowRight"&&(this.right=!1),e==="ArrowLeft"&&(this.left=!1)};this.startTouch=t=>{t.preventDefault();let e=this.canvasHolder.getBoundingClientRect();return this.startInteraction(t.changedTouches[0].clientX-e.left,t.changedTouches[0].clientY-e.top),!1};this.endTouch=t=>{t.preventDefault();let e=this.canvasHolder.getBoundingClientRect();return this.endInteraction(t.changedTouches[0].clientX-e.left,t.changedTouches[0].clientY-e.top),!1};this.moveTouch=t=>{t.preventDefault();let e=this.canvasHolder.getBoundingClientRect();return this.mouseX=t.changedTouches[0].clientX-e.left,this.mouseY=t.changedTouches[0].clientY-e.top,this.mouseX=this.mouseX/this.scaling-this.viewOffsetX/this.scaling,this.mouseY=this.mouseY/this.scaling-this.viewOffsetY/this.scaling,!1};this.startMouse=t=>(this.startInteraction(t.offsetX,t.offsetY),!1);this.endMouse=t=>(this.endInteraction(t.offsetX,t.offsetY),!1);this.handleMouseMovement=t=>{this.mouseX=t.offsetX,this.mouseY=t.offsetY,this.mouseX=this.mouseX/this.scaling-this.viewOffsetX/this.scaling,this.mouseY=this.mouseY/this.scaling-this.viewOffsetY/this.scaling};this.physicsDraw=()=>{let t=this.cnv.getContext("2d");if(t){t.fillStyle=z.green,t.strokeStyle="black";for(let n=0;n<this.physics.balls.length;n+=1){let i=this.physics.balls[n];t.beginPath(),t.arc(i.pos.x,i.pos.y,i.r,0,2*Math.PI),t.stroke(),t.fill(),t.beginPath(),t.moveTo(i.pos.x,i.pos.y),t.lineTo(i.pos.x+i.r*Math.cos(i.rotation),i.pos.y+i.r*Math.sin(i.rotation)),t.stroke()}this.physics.bodies.forEach(n=>{t.beginPath(),t.moveTo(n.points[n.points.length-1].x,n.points[n.points.length-1].y),n.points.forEach(i=>{t.lineTo(i.x,i.y)}),t.stroke(),t.fill(),t.beginPath(),t.arc(n.pos.x,n.pos.y,1.5,0,Math.PI*2),t.stroke()});let e=n=>{t.beginPath(),t.moveTo(n.points[n.points.length-1].x,n.points[n.points.length-1].y),n.points.forEach(i=>{t.lineTo(i.x,i.y)}),t.fill()};t.fillStyle="white",this.physics.walls.forEach(e),this.physics.bounds.forEach(e),this.physics.fixedBalls.forEach(n=>{t.beginPath(),t.arc(n.x,n.y,n.r,0,Math.PI*2),t.fill()}),t.save(),t.lineWidth=2,this.physics.springs.forEach(n=>{if(n instanceof j&&!(n instanceof N)){let i,r,c,h;n.pinned&&typeof n.pinned=="object"?(i=n.pinned.x,r=n.pinned.y,c=n.objects[0].pos.x,h=n.objects[0].pos.y):(i=n.objects[0].pos.x,r=n.objects[0].pos.y,c=n.objects[1].pos.x,h=n.objects[1].pos.y);let u=new s(c-i,h-r),l=u.copy;u.rotate(Math.PI/2),u.setMag(5);let a=new s(i,r),d=Math.floor(n.length/10);for(let m=1;m<=d;m+=1)t.strokeStyle=z.blue,t.fillStyle=z.blue,m===d&&(u=new s(0,0)),t.beginPath(),t.moveTo(a.x,a.y),t.lineTo(i+m/d*l.x+u.x,r+m/d*l.y+u.y),t.stroke(),a=new s(i+m/d*l.x+u.x,r+m/d*l.y+u.y),u.mult(-1)}else t.strokeStyle=z.blue,t.fillStyle=z.blue,t.beginPath(),t.moveTo(n.objects[0].pos.x,n.objects[0].pos.y),t.lineTo(typeof n.pinned=="object"?n.pinned.x:n.objects[1].pos.x,typeof n.pinned=="object"?n.pinned.y:n.objects[1].pos.y),t.stroke();n.objects.forEach(i=>{t.strokeStyle="black",t.fillStyle=z.blue,t.beginPath(),t.arc(i.pos.x,i.pos.y,2.5,0,Math.PI*2),t.fill(),t.stroke()}),typeof n.pinned=="object"&&(t.strokeStyle="black",t.fillStyle=z.blue,t.beginPath(),t.arc(n.pinned.x,n.pinned.y,3,0,Math.PI*2),t.fill(),t.stroke())}),t.restore()}};this.spawnNewtonsCradle=(t,e,n,i)=>{let r=[],c=25,h=250,u=8;r.push(new L(new s(t,e),new s(0,0),n*c,1,0,0));let l=1;for(let a=0;a<u-1;a+=1)r.push(new L(new s(t+l*n*c*1.01*2,e),new s(0,0),n*25,1,0,0)),l*=-1,l>0&&(l+=1),a===u-2&&(r[r.length-1].vel.x=-Math.sign(l)*n*c*8);r.forEach(a=>{i.addBall(a);let d=new N(h);d.attachObject(a),d.pinHere(a.pos.x,a.pos.y-h),i.addSpring(d),d.lockRotation()})};this.modeButtonClicked=t=>{let e=t.target.id.replace("-btn",""),n=pt.indexOf(e);this.switchToMode(n)};this.switchToMode=t=>{let e=document.getElementById(`${pt[this.mode]}-btn`);e&&e.classList.remove("bg-pink-darker"),this.sidebar.innerHTML="";let n=document.getElementById(`${pt[t]}-btn`);n&&n.classList.add("bg-pink-darker"),this.mode=t,this.sidebar.appendChild(tt[this.mode].element)};this.setupModes=()=>{let t=document.getElementById("button-holder");pt.forEach((e,n)=>{let i=document.createElement("div");i.classList.add("big-button"),i.classList.add("fix-width"),i.id=`${e}-btn`,i.textContent=tt[n].name,i.onclick=this.modeButtonClicked,t&&t.appendChild(i)}),this.switchToMode(this.mode)};this.setTimeMultiplier=t=>{Number.isFinite(t)&&(this.timeMultiplier=t)};this.getTimeMultiplier=()=>this.timeMultiplier;this.setPhysics=t=>{t instanceof nt&&(this.physics=t)};this.getPhysics=()=>this.physics;this.physics=new nt,this.mouseX=0,this.mouseY=0,this.mouseDown=!1,this.defaultSize=30,this.k=.5,this.fc=2,this.springConstant=2e3,this.scaling=1,this.viewOffsetX=0,this.viewOffsetY=0,this.mode=0,this.lastX=0,this.lastY=0,this.timeMultiplier=1,this.lastFrameTime=performance.now(),this.choosed=!1,this.left=!1,this.right=!1,this.cnv=document.getElementById("defaulCanvas0"),this.canvasHolder=document.getElementById("canvas-holder"),this.sidebar=document.getElementById("sidebar"),this.physics.setBounds(0,0,this.cnv.width,this.cnv.height),this.physics.setGravity(new s(0,1e3)),this.physics.setAirFriction(.9),this.cnv.addEventListener("touchstart",this.startTouch,!1),this.cnv.addEventListener("touchend",this.endTouch,!1),this.cnv.addEventListener("touchmove",this.moveTouch,!1),this.cnv.addEventListener("mousedown",this.startMouse,!1),this.cnv.addEventListener("mouseup",this.endMouse,!1),this.cnv.addEventListener("mousemove",this.handleMouseMovement,!1),document.addEventListener("keydown",this.keyGotDown,!1),document.addEventListener("keyup",this.keyGotUp,!1),window.addEventListener("resize",this.resizeCanvas,!1),this.cnv.addEventListener("mousedown",()=>{this.mouseDown=!0},!1),this.cnv.addEventListener("mouseup",()=>{this.mouseDown=!1},!1),this.resizeCanvas(),this.setupModes(),xt(this),requestAnimationFrame(this.drawFunction)}},ye=pe;window.onload=()=>{window.editorApp=new ye};})();
//# sourceMappingURL=main.js.map

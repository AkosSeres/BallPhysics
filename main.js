(()=>{var M=class{constructor(t,e){this.x=t,this.y=e}get copy(){return new M(this.x,this.y)}get length(){return Math.sqrt(this.x*this.x+this.y*this.y)}get sqlength(){return this.x*this.x+this.y*this.y}get heading(){if(this.x===0&&this.y===0)return 0;if(this.x===0)return this.y>0?Math.PI/2:1.5*Math.PI;if(this.y===0)return this.x>0?0:Math.PI;let t=M.normalized(this);return this.x>0&&this.y>0?Math.asin(t.y):this.x<0&&this.y>0?Math.asin(-t.x)+Math.PI/2:this.x<0&&this.y<0?Math.asin(-t.y)+Math.PI:this.x>0&&this.y<0?Math.asin(t.x)+1.5*Math.PI:0}add(t){this.x+=t.x,this.y+=t.y}sub(t){this.x-=t.x,this.y-=t.y}mult(t){this.x*=t,this.y*=t}div(t){this.x/=t,this.y/=t}lerp(t,e){this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e}dist(t){return new M(this.x-t.x,this.y-t.y).length}setMag(t){if(this.length===0)return;this.mult(t/this.length)}rotate(t){let e=this.heading,n=M.fromAngle(t+e);n.mult(this.length),this.x=n.x,this.y=n.y}rotate90(){let{x:t}=this;this.x=-this.y,this.y=t}rotate270(){let{x:t}=this;this.x=this.y,this.y=-t}static add(t,e){return new M(t.x+e.x,t.y+e.y)}static sub(t,e){return new M(t.x-e.x,t.y-e.y)}static mult(t,e){return new M(t.x*e,t.y*e)}static div(t,e){return new M(t.x/e,t.y/e)}static fromAngle(t){return new M(Math.cos(t),Math.sin(t))}static lerp(t,e,n){return M.add(t,M.mult(M.sub(e,t),n))}static dist(t,e){return M.sub(t,e).length}static dot(t,e){return t.x*e.x+t.y*e.y}static cross(t,e){return t.x*e.y-t.y*e.x}static crossScalarFirst(t,e){return new M(-e.y*t,e.x*t)}static crossScalarSecond(t,e){return new M(t.y*e,-t.x*e)}static angle(t,e){return Math.acos(Math.min(Math.max(M.dot(t,e)/Math.sqrt(t.sqlength*e.sqlength),1),-1))}static angleACW(t,e){let n=t.heading,i=e.heading,a=i-n;return a<0?2*Math.PI+a:a}static normalized(t){let e=t.length;return e===0?t:new M(t.x/e,t.y/e)}toJSObject(){return{x:this.x,y:this.y}}static fromObject(t){return new M(t.x,t.y)}},s=M;function U(o,t,e,n){let i=n,a=e,c=o,h=t,l=c.vel,u=h.vel,r=c.ang,d=h.ang,f=s.sub(a,c.pos),g=s.sub(a,h.pos),m=c.am,p=h.am,y=c.m,b=h.m,I=(c.k+h.k)/2,E=(c.fc+h.fc)/2,x=c.velInPlace(a),R=h.velInPlace(a),j=s.sub(R,x),O=1/y+1/b;O+=s.dot(s.crossScalarFirst(s.cross(f,i)/m,f),i),O+=s.dot(s.crossScalarFirst(s.cross(g,i)/p,g),i),O=-((1+I)*s.dot(j,i))/O;let w=s.sub(l,s.mult(i,O/y)),F=s.add(u,s.mult(i,O/b)),A=r-O*s.cross(f,i)/m,z=d+O*s.cross(g,i)/p,T=j.copy;T.sub(s.mult(i,s.dot(j,i))),T.setMag(1);let L=1/y+1/b;L+=s.dot(s.crossScalarFirst(s.cross(f,T)/m,f),T),L+=s.dot(s.crossScalarFirst(s.cross(g,T)/p,g),T),L=-s.dot(j,T)/L;let B=O*E;B>L&&(B=L),w=s.sub(w,s.mult(T,B/y)),F=s.add(F,s.mult(T,B/b)),A-=B*s.cross(f,T)/m,z+=B*s.cross(g,T)/p,c.vel=w,h.vel=F,c.ang=A,h.ang=z}function W(o,t,e){let n=t,i=e,a=o,c=s.sub(n,a.pos),{am:h,m:l}=a,u=s.mult(a.velInPlace(n),-1),r=1/l;r+=s.dot(s.crossScalarFirst(s.cross(c,i)/h,c),i),r=-((1+a.k)*s.dot(u,i))/r;let d=s.sub(a.vel,s.mult(i,r/l)),f=a.ang-r*s.cross(c,i)/h,g=u.copy;g.sub(s.mult(i,s.dot(u,i))),g.setMag(1);let m=1/l;m+=s.dot(s.crossScalarFirst(s.cross(c,g)/h,c),g),m=-s.dot(u,g)/m;let p=r*a.fc;p>m&&(p=m),d=s.sub(d,s.mult(g,p/l)),f-=p*s.cross(c,g)/h,a.vel=d,a.ang=f}var $=class{constructor(t,e,n,i,a,c){this.pos=t.copy,this.lastPos=this.pos.copy,this.r=n,this.fc=.4,this.amc=2/5,this.density=1,this.rotation=0,a?this.ang=a:this.ang=0,(c||c===0)&&(this.fc=c),i?this.k=i:this.k=.8,e!==void 0?this.vel=e.copy:this.vel=new s(0,0),this.id=`_${Math.random().toString(36).substr(2,9)}`,this.layer=void 0}get m(){return this.density*this.r*this.r*Math.PI}get am(){return this.amc*this.r*this.r*this.m}getAmInPoint(t){let e=this.am;return e+=s.sub(this.pos,t).sqlength*this.m,e}get copy(){let t=new $(this.pos.copy,this.vel.copy,this.r,this.k,this.ang,this.fc);return t.lastPos=this.lastPos.copy,t.rotation=this.rotation,t}move(t,e){this.pos.x+=t,this.pos.y+=e}rotate(t){this.rotation+=t}collided(t){return this.pos.dist(t.pos)<this.r+t.r}static collide(t,e){if(!t.collided(e))return;let n=s.dist(t.pos,e.pos),i=t.m,a=e.m,c=t.pos.copy,h=e.pos.copy,l=t,u=e,r=t.r+e.r-n,d=s.sub(t.pos,e.pos);if(d.setMag(1),d.mult(r*a/(i+a)),c.add(d),d.setMag(1),d.mult(-r*i/(i+a)),h.add(d),l.pos=c,u.pos=h,s.dot(d,s.sub(t.vel,e.vel))<0)return;d.setMag(1);let f=s.add(t.pos,s.mult(d,t.r));U(t,e,f,d)}containsPoint(t){return s.dist(this.pos,t)<=this.r}velInPlace(t){let e=s.sub(t,this.pos);return e.rotate(Math.PI/2),e.mult(this.ang),e.add(this.vel),e}effectiveMass(t,e){let n=s.sub(t,this.pos);if(n.length===0)return this.m;let i=s.angle(e,n),a=Math.sin(i)**2*n.length**2/this.am;return 1/(a+1/this.m)}applyDeltaVelInPoint(t,e){let n=s.sub(e,this.pos);if(n.length===0){this.vel.add(t);return}let i=s.angle(n,t),a=s.mult(n,s.dot(t,n)/n.length**2);this.vel.add(a);let c=n.copy;c.rotate(Math.PI/2),c.setMag(1);let h=Math.sign(s.dot(t,c)),l=t.length*Math.cos(i),u=1/(1/this.m+n.length**2/this.am),r=l*u/this.m;this.vel.add(s.mult(c,r*h));let d=h*l*u*n.length/this.am;this.ang-=d}toJSObject(){let t={};return t.pos=this.pos.toJSObject(),t.lastPos=this.lastPos.toJSObject(),t.r=this.r,t.fc=this.fc,t.amc=this.amc,t.rotation=this.rotation,t.ang=this.ang,t.fc=this.fc,t.k=this.k,t.vel=this.vel.toJSObject(),t.id=this.id,typeof this.layer!="undefined"&&(t.layer=this.layer),t}static fromObject(t){let e=new $(s.fromObject(t.pos),s.fromObject(t.vel),t.r,t.k,t.ang,t.fc);return e.lastPos=s.fromObject(t.lastPos),e.amc=t.amc,e.rotation=t.rotation,e.vel=s.fromObject(t.vel),e.id=t.id,typeof t.layer!="undefined"&&(e.layer=t.layer),e}},k=$,Ft=class{constructor(t,e){this.a=t,this.b=e}get length(){return s.dist(this.a,this.b)}distFromPoint(t){let e=s.sub(this.a,this.b),n=s.sub(t,this.b),i=s.sub(t,this.a),a=n.length,c=i.length,h=e.length;if(h===0)return a;let l=s.angle(n,i),u=s.angle(n,e),r=Math.PI-l-u,d=Math.sin(r)*c*h/2,f=2*d/h;return r>Math.PI/2?c:u>Math.PI/2?a:f}static intersect(t,e){let n=s.sub(t.b,t.a),i=n.y/n.x,a=t.b.y-t.b.x*i,c=s.sub(e.b,e.a),h=c.y/c.x,l=e.b.y-e.b.x*h;if(n.x===0&&c.x!==0){if(t.a.x>=e.a.x&&t.a.x<=e.b.x||t.a.x<=e.a.x&&t.a.x>=e.b.x){let g=h*t.a.x+l;if(g>t.a.y&&g<t.b.y||g<t.a.y&&g>t.b.y)return new s(t.a.x,g)}return!1}if(c.x===0&&n.x!==0){if(e.a.x>=t.a.x&&e.a.x<=t.b.x||e.a.x<=t.a.x&&e.a.x>=t.b.x){let g=i*e.a.x+a;if(g>e.a.y&&g<e.b.y||g<e.a.y&&g>e.b.y)return new s(e.a.x,g)}return!1}if(n.x===0&&c.x===0){if(t.a.x===e.a.x){let g;t.a.y<t.b.y?g=[t.a.y,t.b.y]:g=[t.b.y,t.a.y];let m;e.a.y<e.b.y?m=[e.a.y,e.b.y]:m=[e.b.y,e.a.y];let p=[g[0]>m[0]?g[0]:m[0],g[1]<m[1]?g[1]:m[1]];if(p[0]<=p[1])return new s(t.a.x,(p[0]+p[1])/2)}return!1}let u;t.a.x<t.b.x?u=[t.a.x,t.b.x]:u=[t.b.x,t.a.x];let r;e.a.x<e.b.x?r=[e.a.x,e.b.x]:r=[e.b.x,e.a.x];let d=[u[0]>r[0]?u[0]:r[0],u[1]<r[1]?u[1]:r[1]];if(i===h&&a===l&&d[0]<=d[1])return new s((d[0]+d[1])/2,(d[0]+d[1])/2*i+a);let f=(l-a)/(i-h);return f>=d[0]&&f<=d[1]?new s(f,f*i+a):!1}},v=Ft,tt=class{constructor(t){this.points=t;let e=this.points,n=0,i=0,a=s.angleACW(s.sub(e[1],e[0]),s.sub(e[e.length-1],e[0]));this.points.length>0?[this.center]=[this.points[0]]:this.center=new s(0,0),this.boundRadius=1,this.calculateCenterAndRadius(),n+=a,i+=Math.PI*2-a;for(let h=1;h<e.length-1;h+=1)a=s.angleACW(s.sub(e[(h+1)%e.length],e[h]),s.sub(e[h-1],e[h])),n+=a,i+=Math.PI*2-a;if(a=s.angleACW(s.sub(e[0],e[e.length-1]),s.sub(e[e.length-2],e[e.length-1])),n+=a,i+=Math.PI*2-a,i>n)return;let c=[];for(let h=e.length-1;h>=0;h-=1)c.push(e[h]);this.points=c}collideWithBall(t){let e,n,i=t,a=this.points.some((c,h)=>{let l=s.sub(i.pos,c);l.sqlength<=t.r*t.r&&(e=c,n=l);let u=this.points[(h+1)%this.points.length].copy,r=new s(u.x-c.x,u.y-c.y),d=r.sqlength;r.setMag(1);let f=r.copy;f.rotate270();let g=s.dot(l,r),m=s.dot(l,f);return m>=-t.r&&m<t.r&&g>=0&&g*g<=d?(e=s.add(c,s.mult(r,g)),n=f,!0):!1});typeof n!="undefined"&&(a||n.setMag(1),typeof e!="undefined"&&(n.mult(-1),i.pos=s.add(e,s.mult(n,-t.r)),W(i,e,n)))}containsPoint(t){let{sides:e}=this,n=Math.max(...this.points.map(h=>s.dist(h,t)))+1,i=s.fromAngle(0);i.setMag(n);let a=new v(t,s.add(i,t)),c=e.filter(h=>v.intersect(h,a)!==void 0);return c.length%2===1}calculateCenterAndRadius(){this.center=this.points.reduce((t,e)=>s.add(t,e)),this.center.div(this.points.length),this.boundRadius=Math.max(...this.points.map(t=>s.dist(t,this.center)))}get sides(){return this.points.map((t,e)=>new v(t,this.points[(e+1)%this.points.length]))}toJSObject(){let t={};return t.points=this.points.map(e=>({x:e.x,y:e.y})),t}static fromObject(t){let e=new tt(t.points.map(n=>new s(n.x,n.y)));return e}},J=tt,K=class{constructor(t,e,n,i,a){this.points=t,this.pos=new s(t[0].x,t[0].y);let c=this.points,h=0,l=0,u=s.angleACW(s.sub(c[1],c[0]),s.sub(c[c.length-1],c[0]));h+=u,l+=Math.PI*2-u;for(let r=1;r<c.length-1;r+=1)u=s.angleACW(s.sub(c[(r+1)%c.length],c[r]),s.sub(c[r-1],c[r])),h+=u,l+=Math.PI*2-u;if(u=s.angleACW(s.sub(c[0],c[c.length-1]),s.sub(c[c.length-2],c[c.length-1])),h+=u,l+=Math.PI*2-u,l<h){let r=[];for(let d=c.length-1;d>=0;d-=1)r.push(c[d]);this.points=r}this.m=1,this.am=1,this.boundRadius=1,this.calculatePosAndMass(),this.lastPos=this.pos.copy,this.fc=.4,this.rotation=0,i?this.ang=i:this.ang=0,(a||a===0)&&(this.fc=a),n?this.k=n:this.k=.8,e!==void 0?this.vel=e.copy:this.vel=new s(0,0),this.id=`_${Math.random().toString(36).substr(2,9)}`}getAmInPoint(t){let e=this.am;return e+=s.sub(this.pos,t).sqlength*this.m,e}get copy(){let t=this.points.map(n=>new s(n.x,n.y)),e=new K(t,this.vel.copy,this.k,this.ang,this.fc);return e.rotation=this.rotation,e.lastPos=this.lastPos.copy,e.pos=this.pos.copy,e}move(t,e){this.pos.x+=t,this.pos.y+=e,this.points.forEach(n=>{let i=n;i.x+=t,i.y+=e})}collideWithBall(t){let e,n,i;if(s.dist(t.pos,this.pos)>t.r+this.boundRadius)return;if(this.points.forEach((a,c)=>{let h=new s(a.x,a.y);if(h.x-=t.pos.x,h.y-=t.pos.y,h.length<=t.r){e=h.heading+Math.PI,n=h.length;let g=s.fromAngle(e);g.mult(t.r-n),this.move(g.x*-1*t.m/(this.m+t.m),g.y*-1*t.m/(this.m+t.m)),t.move(g.x*1*this.m/(this.m+t.m),g.y*1*this.m/(this.m+t.m)),i=new s(a.x,a.y);let m=s.fromAngle(e);m.mult(-30)}h=new s(a.x,a.y);let l=new s(this.points[(c+1)%this.points.length].x,this.points[(c+1)%this.points.length].y),u=new s(t.pos.x,t.pos.y),r=new s(l.x-h.x,l.y-h.y),d=r.heading;h.rotate(-d+Math.PI),l.rotate(-d+Math.PI),u.rotate(-d+Math.PI);let f=u.y-(h.y+l.y)/2;if(f>=-t.r&&f<=t.r&&u.x>=l.x&&u.x<=h.x){e=d-Math.PI/2,n=f;let g=s.fromAngle(e);g.mult(t.r-n),this.move(g.x*-1*t.m/(this.m+t.m),g.y*-1*t.m/(this.m+t.m)),t.move(g.x*1*this.m/(this.m+t.m),g.y*1*this.m/(this.m+t.m)),i=t.pos.copy,i.add(s.mult(s.fromAngle(e+Math.PI),f));let m=s.fromAngle(e);m.mult(-30)}}),Number.isFinite(e)&&i){let a=s.sub(i,t.pos);a.setMag(-1),U(this,t,i,a)}}calculatePosAndMass(){let t=[];if(t.push([]),this.points.forEach(a=>{t[0].push(new s(a.x,a.y))}),this.isConcave){let a=(u,r)=>{for(let d=0;d<u.length;d+=1)if(u[d]===r)return!0;return!1},c=(u,r,d)=>{for(let f=0;f<r.length;f+=1)if(!a(d,f)){let g=new v(new s(r[f].x,r[f].y),new s(r[(f+1)%r.length].x,r[(f+1)%r.length].y));if(v.intersect(u,g))return!0}return!1},h=!0,l=()=>{h=!1;for(let u=0;u<t.length;u+=1){let r=t[u],d=s.sub(r[1],r[0]),f=s.sub(r[r.length-1],r[0]),g=s.angleACW(d,f);if(g>Math.PI){h=!0;let m=0,p=m+2,y=new v(new s(r[m].x,r[m].y),new s(r[p%r.length].x,r[p%r.length].y)),b=new s(y.b.x-y.a.x,y.b.y-y.a.y).heading;for(;!(d.heading>f.heading?b>d.heading&&b<2*Math.PI||b>0&&b<f.heading:b>d.heading&&b<f.heading)||c(new v(new s(r[m%r.length].x,r[m%r.length].y),new s(r[p%r.length].x,r[p%r.length].y)),r,[(r.length-1)%r.length,m%r.length,(p-1)%r.length,p%r.length]);)p+=1,y=new v(new s(r[m].x,r[m].y),new s(r[p%r.length].x,r[p%r.length].y)),b=new s(y.b.x-y.a.x,y.b.y-y.a.y).heading;let I=[],E=[];for(let x=m;x<=p;x+=1)I.push(r[x%r.length]);for(let x=p;x<=m+r.length;x+=1)E.push(r[x%r.length]);t[u]=I,t.push(E);return}for(let m=1;m<r.length;m+=1)if(d=s.sub(r[(m+1)%r.length],r[m]),f=s.sub(r[m-1],r[m]),g=s.angleACW(d,f),g>Math.PI){h=!0;let p=m+2,y=new v(new s(r[m].x,r[m].y),new s(r[p%r.length].x,r[p%r.length].y)),b=new s(y.b.x-y.a.x,y.b.y-y.a.y).heading;for(;!(d.heading>f.heading?b>d.heading&&b<2*Math.PI||b>0&&b<f.heading:b>d.heading&&b<f.heading)||c(y,r,[(m-1)%r.length,m%r.length,(p-1)%r.length,p%r.length]);)p+=1,y=new v(new s(r[m].x,r[m].y),new s(r[p%r.length].x,r[p%r.length].y)),b=new s(y.b.x-y.a.x,y.b.y-y.a.y).heading;let I=[],E=[];for(let x=m;x<=p;x+=1)I.push(r[x%r.length]);for(let x=p;x<=m+r.length;x+=1)E.push(r[x%r.length]);t[u]=I,t.push(E);return}}};for(;h;)l()}for(let a=t.length-1;a>=0;a-=1){let c=t[a];for(;c.length>3;)t.push([c[0],c[1],c[2]]),c.splice(1,1)}let e=0,n=0,i=new s(0,0);t.forEach(a=>{let c=Math.sqrt((a[0].x-a[1].x)**2+(a[0].y-a[1].y)**2),h=Math.sqrt((a[1].x-a[2].x)**2+(a[1].y-a[2].y)**2),l=Math.sqrt((a[2].x-a[0].x)**2+(a[2].y-a[0].y)**2),u=(c+h+l)/2,r=Math.sqrt(u*(u-c)*(u-h)*(u-l));e+=r,i.x+=r*(a[0].x+a[1].x+a[2].x)/3,i.y+=r*(a[0].y+a[1].y+a[2].y)/3}),i.div(e),this.pos=i,this.m=e,t.forEach(a=>{let c=Math.sqrt((a[0].x-a[1].x)**2+(a[0].y-a[1].y)**2),h=Math.sqrt((a[1].x-a[2].x)**2+(a[1].y-a[2].y)**2),l=Math.sqrt((a[2].x-a[0].x)**2+(a[2].y-a[0].y)**2),u=Math.max(c,h,l),r=(c+h+l)/2,d=Math.sqrt(r*(r-c)*(r-h)*(r-l)),f=2*d/u,g=Math.sqrt(Math.min(c,l,h)**2-f*f),m=f*u*(f*f+u*u)/24,p=Math.sqrt(f*f/36+(Math.abs(g-u/2)/3)**2);m-=p*p*d,m+=new s((a[0].x+a[1].x+a[2].x)/3,(a[0].y+a[1].y+a[2].y)/3).dist(this.pos)**2*d,n+=m}),this.am=n,this.boundRadius=Math.max(...this.points.map(a=>s.dist(a,this.pos)))}rotate(t){this.points.forEach(e=>{let n=e;n.sub(this.pos),n.rotate(t),n.add(this.pos)}),this.rotation+=t}get isConcave(){let t=this.points,e=s.angleACW(s.sub(t[1],t[0]),s.sub(t[t.length-1],t[0]));if(e>Math.PI)return!0;for(let n=1;n<t.length-1;n+=1)if(e=s.angleACW(s.sub(t[(n+1)%t.length],t[n]),s.sub(t[n-1],t[n])),e>Math.PI)return!0;return e=s.angleACW(s.sub(t[0],t[t.length-1]),s.sub(t[t.length-2],t[t.length-1])),e>Math.PI}static collide(t,e){let n=0,i=0,a=new s(0,0),c=[],h=!1,l=t,u=e;if(t.points.forEach((w,F)=>{let A=new v(new s(w.x,w.y),new s(t.points[(F+1)%t.points.length].x,t.points[(F+1)%t.points.length].y));e.points.forEach((z,T)=>{let L=new v(new s(z.x,z.y),new s(e.points[(T+1)%e.points.length].x,e.points[(T+1)%e.points.length].y)),B=v.intersect(A,L);B instanceof s&&(n+=1,a.add(B),c.push(B),h=!0)})}),!h)return;a.div(n);for(let w=0;w<Math.floor(n/2);w+=1)i+=s.sub(c[2*w+1],c[2*w]).heading;i/=n/2,i+=Math.PI/2;let r=s.fromAngle(i),d=t.ang,f=t.vel.copy,g=e.ang,m=e.vel.copy,p=0,y=0,b=0,I=0;t.points.forEach(w=>{p=Math.min(s.dot(r,s.sub(w,a)),p),y=Math.max(s.dot(r,s.sub(w,a)),y)}),e.points.forEach(w=>{b=Math.min(s.dot(r,s.sub(w,a)),b),I=Math.max(s.dot(r,s.sub(w,a)),I)}),Math.abs(p-I)<Math.abs(b-y)?(t.move(-r.x*p,-r.y*p),e.move(-r.x*I,-r.y*I)):(t.move(-r.x*y,-r.y*y),e.move(-r.x*b,-r.y*b));let E=c,x=[],R=[],j=[],O=[];if(E.forEach(w=>{U(t,e,w,s.fromAngle(i)),x.push(t.ang),j.push(t.vel),R.push(e.ang),O.push(e.vel),l.ang=d,l.vel=f,u.ang=g,u.vel=m}),x.length!==j.length)return;if(x.length===0)return;if(j.length===0)return;if(R.length!==O.length)return;if(R.length===0)return;if(O.length===0)return;l.vel=j.reduce((w,F)=>s.add(w,F)),l.vel.div(j.length),l.ang=x.reduce((w,F)=>w+F),l.ang/=x.length,u.vel=O.reduce((w,F)=>s.add(w,F)),u.vel.div(O.length),u.ang=R.reduce((w,F)=>w+F),u.ang/=R.length}collideWithFixedBall(t){let e=new s(t.x,t.y),n;if(s.dist(e,this.pos)>this.boundRadius+t.r)return;if(this.sides.forEach(a=>{let c=s.angle(s.sub(a.a,a.b),s.sub(e,a.b)),h=s.angle(s.sub(a.b,a.a),s.sub(e,a.a));if(c<Math.PI/2&&h<Math.PI/2){let l=a.distFromPoint(e);if(l<=t.r){let u=s.sub(a.a,a.b);u.rotate(Math.PI/2),u.setMag(t.r*2);let r=s.mult(u,-1),d=new v(s.add(u,e),s.add(r,e));n=v.intersect(d,a),n instanceof s&&(u=s.sub(n,e),u.setMag(t.r-u.length),this.move(u.x,u.y))}}}),(!n||n===void 0)&&this.points.forEach(a=>{if(s.dist(a,e)<t.r){let c=s.sub(a,e);c.setMag(t.r-c.length),this.move(c.x,c.y),c.setMag(t.r),n=s.add(e,c)}}),!n||n===void 0)return;let i=s.sub(n,e);i.setMag(1),W(this,n,i)}collideWithWall(t){if(this.boundRadius+t.boundRadius<s.dist(this.pos,t.center))return;let{sides:e}=this,n=[];e.forEach(l=>{t.sides.forEach(u=>{let r=v.intersect(l,u);r instanceof s&&n.push(r)})});let i=this.vel.copy,a=this.ang,c=[],h=[];if(n.length>=2){let l=s.sub(n[0],n[1]);l.rotate(Math.PI/2);let u=s.sub(n[0],this.pos);s.dot(l,u)>0&&l.mult(-1),l.setMag(1),s.dot(l,s.sub(this.pos,t.center))<0&&l.mult(-1);let r=[],d=n[0];if(t.points.forEach(g=>{let m=s.sub(g,d),p=s.dot(m,l);p>0&&r.push(p)}),r.length>0){let g=l.copy;g.mult(Math.max(...r)),this.move(g.x,g.y)}r=[];let f=s.add(n[0],n[1]);if(f.div(2),this.containsPoint(f)&&e.forEach(g=>{r.push(g.distFromPoint(f))}),r.length>0){let g=l.copy;g.mult(Math.min(...r)),g.length<this.boundRadius/2&&this.move(g.x,g.y)}if(n.forEach(g=>{W(this,g,l),c.push(this.vel),this.vel=i.copy,h.push(this.ang),this.ang=a}),h.length!==c.length)return;if(h.length===0)return;if(c.length===0)return;this.vel=c.reduce((g,m)=>s.add(g,m)),this.vel.div(c.length),this.ang=h.reduce((g,m)=>g+m),this.ang/=h.length,(!Number.isFinite(this.vel.x)||!Number.isFinite(this.vel.y)||!Number.isFinite(this.ang))&&(this.vel=i,this.ang=a)}}containsPoint(t){let{sides:e}=this,n=Math.max(...this.points.map(h=>s.dist(h,t)))+1,i=s.fromAngle(0);i.setMag(n);let a=new v(t,s.add(i,t)),c=e.filter(h=>v.intersect(h,a)!==void 0);return c.length%2===1}get sides(){return this.points.map((t,e)=>new v(t,this.points[(e+1)%this.points.length]))}velInPlace(t){let e=s.sub(t,this.pos);return e.rotate(Math.PI/2),e.mult(this.ang),e.add(this.vel),e}effectiveMass(t,e){let n=s.sub(t,this.pos),i=s.angle(e,n),a=Math.sin(i)**2*n.length**2/this.am;return 1/(a+1/this.m)}applyDeltaVelInPoint(t,e){let n=s.sub(e,this.pos);if(n.length===0){this.vel.add(t);return}let i=s.angle(n,t),a=s.mult(n,s.dot(t,n)/n.length**2);this.vel.add(a);let c=n.copy;c.rotate(Math.PI/2),c.setMag(1);let h=Math.sign(s.dot(t,c)),l=t.length*Math.cos(i),u=1/(1/this.m+n.length**2/this.am),r=l*u/this.m;this.vel.add(s.mult(c,r*h));let d=h*l*u*n.length/this.am;this.ang-=d}toJSObject(){let t={};return t.points=this.points.map(e=>({x:e.x,y:e.y})),t.vel=this.vel.toJSObject(),t.k=this.k,t.ang=this.ang,t.fc=this.fc,t.pos=this.pos.toJSObject(),t.lastPos=this.lastPos.toJSObject(),t.rotation=this.rotation,t.id=this.id,t}static fromObject(t){let e=new K(t.points.map(n=>new s(n.x,n.y)),s.fromObject(t.vel),t.k,t.ang,t.fc);return e.id=t.id,e.pos=s.fromObject(t.pos),e.lastPos=s.fromObject(t.lastPos),e.rotation=t.rotation,e}},H=K,Tt=class{constructor(t,e){this.length=t,this.springConstant=e,this.pinned=!1,this.objects=[],this.rotationLocked=!1,this.id=`_${Math.random().toString(36).substr(2,9)}`}pinHere(t,e){this.pinned={x:t,y:e}}unpin(){this.pinned=!1}attachObject(t){let e=this.objects;e.push(t),e.length===2&&(this.pinned=!1),e.length>=3&&(e=[e[e.length-2],e[e.length-1]])}lockRotation(){this.rotationLocked=!0}unlockRotation(){this.rotationLocked=!1}update(t){let e,n;if(this.pinned instanceof Object&&this.objects[0]){[n,e]=[this.pinned,this.objects[0]];let i=new s(n.x-e.pos.x,n.y-e.pos.y),a=i.length-this.length;i.setMag(1),i.mult(a*this.springConstant*t/e.m),e.vel.x+=i.x,e.vel.y+=i.y;let c=e.vel;if(c.rotate(-i.heading),this.rotationLocked){let h=new s(n.x,n.y),l=s.sub(e.pos,h),u=l.length,r=u*u*e.m+e.am,d=(e.am*e.ang-u*e.m*c.y)/r;c.y=-d*u,e.ang=d}c.rotate(i.heading)}else if(this.objects[0]&&this.objects[1]){[e,n]=[this.objects[0],this.objects[1]];let i=s.sub(e.pos,n.pos),a=i.length-this.length;i.setMag(1),i.mult(a*this.springConstant*t),n.vel.add(s.div(i,n.m)),e.vel.add(s.div(i,-e.m)),i=s.sub(e.pos,n.pos);let c=e.vel,h=n.vel;if(c.rotate(-i.heading),h.rotate(-i.heading),this.rotationLocked){let l=new s(e.pos.x*e.m+n.pos.x*n.m,e.pos.y*e.m+n.pos.y*n.m);l.div(e.m+n.m);let u=s.sub(e.pos,l),r=s.sub(n.pos,l),d=u.length,f=r.length,g=d*d*e.m+e.am+f*f*n.m+n.am,m=(c.y-h.y)*f/(d+f)+h.y,p=(e.am*e.ang+n.am*n.ang+d*e.m*(c.y-m)-f*n.m*(h.y-m))/g;c.y=p*d+m,h.y=-p*f+m,e.ang=p,n.ang=p}c.rotate(i.heading),h.rotate(i.heading)}}},C=Tt,Xt=class extends C{constructor(t){super(t,0);this.springConstant=0}update(){let t,e;if(this.pinned instanceof Object&&"x"in this.pinned&&this.objects[0]){[e,t]=[this.pinned,this.objects[0]];let n=new s(e.x-t.pos.x,e.y-t.pos.y);n.setMag(1),n.mult(-this.length),t.move(-t.pos.x+e.x+n.x,-t.pos.y+e.y+n.y);let i=t.vel;if(i.rotate(-n.heading),i.x=0,this.rotationLocked){let a=new s(e.x,e.y),c=s.sub(t.pos,a),h=c.length,l=h*h*t.m+t.am,u=(t.am*t.ang+h*t.m*i.y)/l;i.y=u*h,t.ang=u}i.rotate(n.heading)}else if(this.objects[0]&&this.objects[1]){[t,e]=[this.objects[0],this.objects[1]];let n=s.sub(t.pos,e.pos),i=this.length-n.length;n.setMag(1);let a=s.mult(n,i*e.m/(t.m+e.m)),c=s.mult(n,-i*t.m/(t.m+e.m));t.move(a.x,a.y),e.move(c.x,c.y);let h=t.vel,l=e.vel;if(h.rotate(-n.heading),l.rotate(-n.heading),h.x=(t.m*h.x+e.m*l.x)/(t.m+e.m),l.x=h.x,this.rotationLocked){let u=new s(t.pos.x*t.m+e.pos.x*e.m,t.pos.y*t.m+e.pos.y*e.m);u.div(t.m+e.m);let r=s.sub(t.pos,u),d=s.sub(e.pos,u),f=r.length,g=d.length,m=f*f*t.m+t.am+g*g*e.m+e.am,p=(h.y-l.y)*g/(f+g)+l.y,y=(t.am*t.ang+e.am*e.ang+f*t.m*(h.y-p)-g*e.m*(l.y-p))/m;h.y=y*f+p,l.y=-y*g+p,t.ang=y,e.ang=y}h.rotate(n.heading),l.rotate(n.heading)}}},X=Xt,et=class{constructor(t,e,n,i,a){this.points=[],i||i===0?this.fc=i:this.fc=.4,this.pressure=n,a?this.resolution=a:this.resolution=30,this.r=Math.abs(e);let c=Math.random()*1e6;for(let h=0;h<this.resolution;h+=1){let l=new s(t.x,t.y);l.add(s.mult(s.fromAngle(h/this.resolution*Math.PI*2),this.r)),this.points.push(new k(l,new s(0,0),this.r*Math.sin(Math.PI/this.resolution),0,0,this.fc)),this.points[this.points.length-1].layer=c}this.sides=[];for(let h=0;h<this.resolution;h+=1){let l=new X(2*this.r*Math.sin(Math.PI/this.resolution));l.attachObject(this.points[h]),l.attachObject(this.points[(h+1)%this.resolution]),h%2===0&&l.lockRotation(),this.sides.push(l)}}static updatePressureBasedForces(t,e){let n=[];if(n.push([]),t.points.forEach(c=>{n[0].push(new s(c.pos.x,c.pos.y))}),(c=>{let h=s.angleACW(s.sub(c[1],c[0]),s.sub(c[c.length-1],c[0]));if(h>Math.PI)return!0;for(let l=1;l<c.length-1;l+=1)if(h=s.angleACW(s.sub(c[(l+1)%c.length],c[l]),s.sub(c[l-1],c[l])),h>Math.PI)return!0;return h=s.angleACW(s.sub(c[0],c[c.length-1]),s.sub(c[c.length-2],c[c.length-1])),h>Math.PI})(n[0])){let c=(u,r)=>{for(let d=0;d<u.length;d+=1)if(u[d]===r)return!0;return!1},h=(u,r,d)=>{for(let f=0;f<r.length;f+=1)if(!c(d,f)){let g=new v(new s(r[f].x,r[f].y),new s(r[(f+1)%r.length].x,r[(f+1)%r.length].y));if(v.intersect(u,g))return!0}return!1},l=!0;t:for(;l;){l=!1;for(let u=0;u<n.length;u+=1){let r=n[u],d=s.sub(r[1],r[0]),f=s.sub(r[r.length-1],r[0]),g=s.angleACW(d,f);if(g>Math.PI){l=!0;let m=0,p=m+2,y=new v(new s(r[m].x,r[m].y),new s(r[p%r.length].x,r[p%r.length].y)),b=new s(y.b.x-y.a.x,y.b.y-y.a.y).heading;for(;!(d.heading>f.heading?b>d.heading&&b<2*Math.PI||b>0&&b<f.heading:b>d.heading&&b<f.heading)||h(new v(new s(r[m%r.length].x,r[m%r.length].y),new s(r[p%r.length].x,r[p%r.length].y)),r,[(r.length-1)%r.length,m%r.length,(p-1)%r.length,p%r.length]);)p+=1,y=new v(new s(r[m].x,r[m].y),new s(r[p%r.length].x,r[p%r.length].y)),b=new s(y.b.x-y.a.x,y.b.y-y.a.y).heading;let I=[],E=[];for(let x=m;x<=p;x+=1)I.push(r[x%r.length]);for(let x=p;x<=m+r.length;x+=1)E.push(r[x%r.length]);n[u]=I,n.push(E);continue t}for(let m=1;m<r.length;m+=1)if(d=s.sub(r[(m+1)%r.length],r[m]),f=s.sub(r[m-1],r[m]),g=s.angleACW(d,f),g>Math.PI){l=!0;let p=m+2,y=new v(new s(r[m].x,r[m].y),new s(r[p%r.length].x,r[p%r.length].y)),b=new s(y.b.x-y.a.x,y.b.y-y.a.y).heading;for(;!(d.heading>f.heading?b>d.heading&&b<2*Math.PI||b>0&&b<f.heading:b>d.heading&&b<f.heading)||h(y,r,[(m-1)%r.length,m%r.length,(p-1)%r.length,p%r.length]);)p+=1,y=new v(new s(r[m].x,r[m].y),new s(r[p%r.length].x,r[p%r.length].y)),b=new s(y.b.x-y.a.x,y.b.y-y.a.y).heading;let I=[],E=[];for(let x=m;x<=p;x+=1)I.push(r[x%r.length]);for(let x=p;x<=m+r.length;x+=1)E.push(r[x%r.length]);n[u]=I,n.push(E);continue t}}}}for(let c=n.length-1;c>=0;c-=1){let h=n[c];for(;h.length>3;)n.push([h[0],h[1],h[2]]),h.splice(1,1)}let i=0;n.forEach(c=>{let h=Math.sqrt((c[0].x-c[1].x)**2+(c[0].y-c[1].y)**2),l=Math.sqrt((c[1].x-c[2].x)**2+(c[1].y-c[2].y)**2),u=Math.sqrt((c[2].x-c[0].x)**2+(c[2].y-c[0].y)**2),r=(h+l+u)/2,d=Math.sqrt(r*(r-h)*(r-l)*(r-u));i+=d});let a=t.pressure*(t.r*t.r*Math.PI/i)-t.pressure;t.sides.forEach(c=>{let h=s.sub(c.objects[0].pos,c.objects[1].pos);h.mult(a),h.rotate(Math.PI/2),h.mult(e),c.objects[0].vel.add(s.div(h,c.objects[0].m)),c.objects[1].vel.add(s.div(h,c.objects[1].m))})}get sideSegments(){return this.points.map((t,e)=>new v(t.pos,this.points[(e+1)%this.points.length].pos))}containsPoint(t){let e=this.sideSegments,n=Math.max(...this.points.map(h=>s.dist(h.pos,t)))+1,i=s.fromAngle(0);i.setMag(n);let a=new v(t,s.add(i,t)),c=e.filter(h=>v.intersect(h,a)!==void 0);return c.length%2===1}toJSObject(){let t={};return t.pressure=this.pressure,t.fc=this.fc,t.r=this.r,t.resolution=this.resolution,t.points=this.points.map(e=>e.id),t.sides=this.sides.map(e=>e.id),t}static fromObject(t,e,n){let i=Object.create(et.prototype);return i.pressure=t.pressure,i.fc=t.fc,i.resolution=t.resolution,i.r=t.r,i.points=t.points.map(a=>{let c=e.filter(h=>a===h.id);return c[0]}),i.sides=t.sides.map(a=>{let c=n.filter(h=>a===h.id);return c[0]}),i}},q=et;function re(o,t,e){return o==="spring"?new C(t,e):o==="stick"?new X(t):new C(0,0)}function Yt(o,t){let e=re(o.type,o.length,o.springConstant);return e.pinned=o.pinned,e.rotationLocked=o.rotationLocked,e.id=o.id,e.objects=o.objects.map(n=>{let i=t.filter(a=>n===a.id);return i[0]}),e}function jt(o){let t={};return t.length=o.length,t.springConstant=o.springConstant,t.pinned=o.pinned,t.rotationLocked=o.rotationLocked,t.id=o.id,t.objects=o.objects.map(e=>e.id),o instanceof C&&(t.type="spring"),o instanceof X&&(t.type="stick"),t}var D=class{constructor(){this.balls=[],this.bodies=[],this.fixedBalls=[],this.softBalls=[],this.walls=[],this.bounds=[],this.springs=[],this.airFriction=1,this.gravity=new s(0,0),this.addBodyNotBall=!1}update(t,e){let n=e?this.copy:new D;e&&(n.bodies.reverse(),n.balls.reverse(),n.update(t,!1));for(let i=0;i<this.balls.length;i+=1)this.balls[i].lastPos=this.balls[i].pos.copy,this.balls[i].pos.add(s.mult(this.balls[i].vel,t)),this.balls[i].rotation+=this.balls[i].ang*t,this.balls[i].rotation%=Math.PI*2;for(let i=0;i<this.bodies.length;i+=1)this.bodies[i].lastPos=this.bodies[i].pos.copy,this.bodies[i].move(this.bodies[i].vel.x*t,this.bodies[i].vel.y*t),this.bodies[i].rotate(this.bodies[i].ang*t);for(let i=0;i<3;i+=1)this.springs.forEach(a=>{a.update(t/3/2)});for(let i=0;i<this.balls.length;i+=1){this.gravity&&this.balls[i].vel.add(new s(this.gravity.x*t,this.gravity.y*t));for(let a=i+1;a<this.balls.length;a+=1)(this.balls[i].layer!==this.balls[a].layer||!this.balls[i].layer&&!this.balls[a].layer)&&k.collide(this.balls[i],this.balls[a]);this.walls.forEach(a=>{a.collideWithBall(this.balls[i])}),this.fixedBalls.forEach(a=>{let c=this.balls[i],h=s.sub(c.pos,a);if(h.sqlength<=(c.r+a.r)**2){let l=h;l.setMag(1),c.pos=s.add(a,s.mult(l,c.r+a.r)),l.mult(-1),W(c,a,l)}}),this.bounds.forEach(a=>{a.collideWithBall(this.balls[i])})}for(let i=0;i<this.bodies.length;i+=1){this.balls.forEach(a=>{this.bodies[i].collideWithBall(a)});for(let a=i+1;a<this.bodies.length;a+=1)H.collide(this.bodies[i],this.bodies[a]);this.bodies.forEach(a=>{this.fixedBalls.forEach(c=>{a.collideWithFixedBall(c)})}),this.bodies.forEach(a=>{this.walls.forEach(c=>{a.collideWithWall(c)})}),this.bodies.forEach(a=>{this.bounds.forEach(c=>{a.collideWithWall(c)})}),this.gravity&&this.bodies[i].vel.add(new s(this.gravity.x*t,this.gravity.y*t))}this.softBalls.forEach(i=>{q.updatePressureBasedForces(i,t)});for(let i=0;i<3;i+=1)this.springs.forEach(a=>{a.update(t/3/2)});this.balls.forEach(i=>{let a=i;a.vel.mult(this.airFriction**t),a.ang*=this.airFriction**t}),this.bodies.forEach(i=>{let a=i;a.vel.mult(this.airFriction**t),a.ang*=this.airFriction**t}),e&&(n.bodies.reverse(),n.balls.reverse(),this.balls.forEach((i,a)=>{i.move((n.balls[a].pos.x-i.pos.x)*.5,(n.balls[a].pos.y-i.pos.y)*.5),i.vel.add(new s((n.balls[a].vel.x-i.vel.x)*.5,(n.balls[a].vel.y-i.vel.y)*.5));let c=i;c.rotation=(i.rotation+n.balls[a].rotation)/2,c.ang=(i.ang+n.balls[a].ang)/2}),this.bodies.forEach((i,a)=>{let c=n.bodies[a];i.move((c.pos.x-i.pos.x)*.5,(c.pos.y-i.pos.y)*.5),i.vel.add(new s((c.vel.x-i.vel.x)*.5,(c.vel.y-i.vel.y)*.5)),i.rotate((c.rotation-i.rotation)/2);let h=i;h.ang=(i.ang+c.ang)/2}))}get copy(){let t=new D;return t.balls=this.getCopyOfBalls(),t.bodies=this.getCopyOfBodies(),t.fixedBalls=this.fixedBalls,t.walls=this.walls,t.bounds=this.bounds,t.gravity=this.gravity,this.springs.forEach(e=>{let n=e instanceof C?C:X,i=new n(e.length,e.springConstant);i.rotationLocked=e.rotationLocked,i.pinned=e.pinned,e.objects.forEach(a=>{let c=-1;a instanceof k&&(c=this.balls.indexOf(a)),c!==-1?i.attachObject(t.balls[c]):(c=-1,a instanceof H&&(c=this.bodies.indexOf(a)),c!==-1&&i.attachObject(t.bodies[c]))}),t.springs.push(i)}),t}setAirFriction(t){if(!Number.isFinite(t))return;this.airFriction=t,this.airFriction<0&&(this.airFriction=0),this.airFriction>1&&(this.airFriction=1)}setGravity(t){this.gravity=t.copy}addBall(t){if(this.addBodyNotBall){let e=(n,i,a)=>{let c=[];for(let h=0;h<a;h+=1){let l=s.fromAngle(h/a*2*Math.PI);l.mult(i),l.add(n),c.push(l)}return c};this.bodies.push(new H(e(t.pos,t.r,24),t.vel,t.k,t.ang,t.fc))}else this.balls.push(t)}addBody(t){this.bodies.push(t)}addSoftBall(t){this.balls.push(...t.points),this.springs.push(...t.sides),this.softBalls.push(t)}addSoftSquare(t,e,n,i,a=24,c=1){let h=new q(t,Math.sqrt(e*e/Math.PI),c,n,a);h.sides.forEach(r=>{let d=r;d.length=.96*4*e/h.resolution}),h.points.forEach(r=>{let d=r;d.vel=i.copy}),this.balls.push(...h.points),this.springs.push(...h.sides);let l=e*e*200*c,u=new C(Math.sqrt(h.r*h.r*Math.PI),l/2);u.attachObject(h.points[0]),u.attachObject(h.points[h.resolution/2]),this.springs.push(u),u=new C(Math.sqrt(h.r*h.r*Math.PI),l/2),u.attachObject(h.points[h.resolution/4]),u.attachObject(h.points[3*h.resolution/4]),this.springs.push(u),u=new C(Math.sqrt(2*h.r*h.r*Math.PI),l),u.attachObject(h.points[h.resolution/8]),u.attachObject(h.points[5*h.resolution/8]),this.springs.push(u),u=new C(Math.sqrt(2*h.r*h.r*Math.PI),l),u.attachObject(h.points[3*h.resolution/8]),u.attachObject(h.points[7*h.resolution/8]),this.springs.push(u)}addRectWall(t,e,n,i){let a=[];a.push(new s(t-n/2,e-i/2)),a.push(new s(t+n/2,e-i/2)),a.push(new s(t+n/2,e+i/2)),a.push(new s(t-n/2,e+i/2)),this.walls.push(new J(a))}addRectBody(t,e,n,i,a,c){let h=[];h.push(new s(t-n/2,e-i/2)),h.push(new s(t+n/2,e-i/2)),h.push(new s(t+n/2,e+i/2)),h.push(new s(t-n/2,e+i/2)),this.bodies.push(new H(h,new s(0,0),c,0,a))}addWall(t){this.walls.push(t)}addFixedBall(t,e,n){this.fixedBalls.push({x:t,y:e,r:n})}addSpring(t){this.springs.push(t)}setBounds(t,e,n,i){this.bounds=[];let a=(c,h,l,u)=>{let r=[];return r.push(new s(c-l/2,h-u/2)),r.push(new s(c+l/2,h-u/2)),r.push(new s(c+l/2,h+u/2)),r.push(new s(c-l/2,h+u/2)),new J(r)};this.bounds.push(a(t-n,e,2*n,4*i)),this.bounds.push(a(t+2*n,e,2*n,4*i)),this.bounds.push(a(t,e-i,4*n,i*2)),this.bounds.push(a(t,e+2*i,4*n,2*i))}getObjectAtCoordinates(t,e){let n={x:t,y:e,pinPoint:!0},i=new s(t,e);return this.balls.forEach(a=>{a.containsPoint(i)&&(n=a)}),this.bodies.forEach(a=>{a.containsPoint(i)&&(n=a)}),this.walls.forEach(a=>{a.containsPoint(i)&&(n=a)}),this.fixedBalls.forEach(a=>{s.dist(new s(a.x,a.y),new s(t,e))<=a.r&&(n=a)}),this.softBalls.forEach(a=>{a.containsPoint(i)&&(n=a)}),n}getCopyOfBalls(){return this.balls.map(t=>t.copy)}getCopyOfBodies(){return this.bodies.map(t=>t.copy)}removeObjFromSystem(t){let e=-1;if(t instanceof k&&(e=this.balls.indexOf(t)),e!==-1){let n=!1;if(this.softBalls.forEach(i=>{i.points.includes(this.balls[e])&&(this.removeObjFromSystem(i),n=!0)}),n)return;this.springs.forEach(i=>{i.objects.includes(this.balls[e])&&this.removeObjFromSystem(i)}),this.balls.splice(e,1);return}if(t instanceof H&&(e=this.bodies.indexOf(t)),e!==-1){this.bodies.splice(e,1);return}if(t instanceof J&&(e=this.walls.indexOf(t)),e!==-1){this.walls.splice(e,1);return}if(t instanceof Object&&"r"in t&&"x"in t&&(e=this.fixedBalls.indexOf(t)),e!==-1){this.fixedBalls.splice(e,1);return}if((t instanceof X||t instanceof C)&&(e=this.springs.indexOf(t)),e!==-1){this.springs.splice(e,1);let n=this.springs[e];this.softBalls.forEach(i=>{n instanceof X&&i.sides.includes(n)&&this.removeObjFromSystem(i)});return}if(t instanceof q&&(e=this.softBalls.indexOf(t)),e!==-1){let n=this.softBalls[e];this.softBalls.splice(e,1),n.points.forEach(i=>{this.removeObjFromSystem(i)})}}getItemDataFromId(t){let e=c=>c.id===t,n=this.balls.filter(e);if(n.length>=1)return{type:"ball",num:this.balls.indexOf(n[0])};let i=this.bodies.filter(e);if(i.length>=1)return{type:"body",num:this.bodies.indexOf(i[0])};let a=this.springs.filter(e);return a.length>=1?{type:"spring",num:this.springs.indexOf(a[0])}:{type:"",num:-1}}toJSObject(){let t={};return t.balls=this.balls.map(e=>e.toJSObject()),t.bounds=this.bounds.map(e=>e.toJSObject()),t.walls=this.walls.map(e=>e.toJSObject()),t.bodies=this.bodies.map(e=>e.toJSObject()),t.springs=this.springs.map(e=>jt(e)),t.softBalls=this.softBalls.map(e=>e.toJSObject()),t.fixedBalls=this.fixedBalls,t.airFriction=this.airFriction,t.gravity=this.gravity.toJSObject(),t}static fromObject(t){let e=new D;return e.balls=t.balls.map(n=>k.fromObject(n)),e.bounds=t.bounds.map(n=>J.fromObject(n)),e.walls=t.walls.map(n=>J.fromObject(n)),e.bodies=t.bodies.map(n=>H.fromObject(n)),e.springs=t.springs.map(n=>Yt(n,e.balls)),e.softBalls=t.softBalls.map(n=>q.fromObject(n,e.balls,e.springs)),e.fixedBalls=t.fixedBalls,e.airFriction=t.airFriction,e.gravity=s.fromObject(t.gravity),e}toJSON(){return JSON.stringify(this.toJSObject())}static fromJSON(t){return D.fromObject(JSON.parse(t))}},Q=D,st,G;function ht(o){st=o.getPhysics().toJSObject(),G=!0;let t=document.getElementById("pause");t&&(t.onclick=()=>{o.getTimeMultiplier()!==0?o.setTimeMultiplier(0):(o.setTimeMultiplier(1),G===!0&&(st=o.getPhysics().toJSObject()),G=!1)});let e=document.getElementById("revert");e&&(e.onclick=()=>{o.setTimeMultiplier(0),o.setPhysics(Q.fromObject(st)),G=!0});let n=document.getElementById("clear all");n&&(n.onclick=()=>{G=!0;let a=o.getPhysics();a.balls=[],a.walls=[],a.softBalls=[],a.springs=[],a.bodies=[]});let i=document.getElementById("set start");i&&(i.onclick=()=>{st=o.getPhysics().toJSObject(),G=!0,o.setTimeMultiplier(0)})}function S(o){let t=document.createElement("div"),e=document.createElement("h3");return e.innerText=o,e.classList.add("modetitlemargin"),t.appendChild(e),t.classList.add("mode-title"),t.classList.add("bg-blue"),t}function P(o,t,e,n,i,a=1){let c=document.createElement("p");c.innerText=o;let h=document.createElement("input");h.type="range",h.min=t.toString(),h.max=e.toString(),h.step=a.toString(),h.value=n.toString(),h.classList.add("slider"),h.classList.add("fix-width"),h.onchange=i;let l=document.createElement("div");return l.appendChild(c),l.appendChild(h),l}function nt(o,t,e){let n=o+Math.random().toString(),i=document.createElement("label");i.innerText=o,i.htmlFor=n,i.classList.add("checkbox-label");let a=document.createElement("input");a.type="checkbox",a.name=n,a.value=t.toString(),a.classList.add("ch-box"),a.onchange=e;let c=document.createElement("div");return c.appendChild(a),c.appendChild(i),c}var it=35,lt=.5,ut=1.5,dt=document.createElement("div"),Bt={name:"Ball creator",description:"",element:dt,drawFunc(o,t){let e=o.cnv.getContext("2d");e.strokeStyle="black",e.beginPath(),e.arc(o.mouseX,o.mouseY,it,0,2*Math.PI),e.stroke(),o.lastX!==0&&o.lastY!==0&&(e.beginPath(),e.moveTo(o.mouseX,o.mouseY),e.lineTo(o.lastX,o.lastY),e.stroke())},startInteractionFunc(o){},endInteractionFunc(o){if(o.lastX!==0&&o.lastY!==0){let t=new k(new s(o.lastX,o.lastY),new s(o.lastX-o.mouseX,o.lastY-o.mouseY),it,lt,0,ut);Number.isFinite(t.pos.x)&&Number.isFinite(t.pos.y)&&Number.isFinite(t.vel.x)&&Number.isFinite(t.vel.y)||(t.vel.x=0,t.vel.y=0),o.physics.addBall(t)}},keyGotUpFunc(o){},keyGotDownFunc(o){}};[S(Bt.name),P("Size",5,120,it,o=>{it=o.target.valueAsNumber}),P("Bounciness",0,1,lt,o=>{lt=o.target.valueAsNumber},.02),P("Coefficient of friction",0,2,ut,o=>{ut=o.target.valueAsNumber},.1)].forEach(dt.appendChild.bind(dt));var Lt=Bt,ft=document.createElement("div"),Nt={name:"Delete",description:"",element:ft,drawFunc(o,t){},startInteractionFunc(o){o.choosed&&o.physics.removeObjFromSystem(o.choosed)},endInteractionFunc(o){},keyGotUpFunc(o){},keyGotDownFunc(o){}};[S(Nt.name)].forEach(ft.appendChild.bind(ft));var Rt=Nt,Z=35,ce=.5,ot=1.5,mt=24,gt=1e6,pt=document.createElement("div"),Wt={name:"Elastic ball creator",description:"",element:pt,drawFunc(o,t){let e=o.cnv.getContext("2d");e.strokeStyle="black",e.beginPath(),e.arc(o.mouseX,o.mouseY,Z,0,2*Math.PI),e.stroke(),o.lastX!==0&&o.lastY!==0&&(e.beginPath(),e.moveTo(o.mouseX,o.mouseY),e.lineTo(o.lastX,o.lastY),e.stroke())},startInteractionFunc(o){},endInteractionFunc(o){if(o.lastX!==0&&o.lastY!==0){let t=new k(new s(o.lastX,o.lastY),new s(o.lastX-o.mouseX,o.lastY-o.mouseY),Z,ce,0,ot);if(Number.isFinite(t.pos.x)&&Number.isFinite(t.pos.y)&&Number.isFinite(t.vel.x)&&Number.isFinite(t.vel.y)){let e=new q(t.pos,Z,gt,ot,mt);e.points.forEach(n=>{let i=n;i.vel=t.vel.copy}),o.physics.addSoftBall(e)}}},keyGotUpFunc(o){},keyGotDownFunc(o){}};[S(Wt.name),P("Size",5,60,Z,o=>{Z=o.target.valueAsNumber}),P("Pressure",5e5,3e6,gt,o=>{gt=o.target.valueAsNumber},4e3),P("Coefficient of friction",0,2,ot,o=>{ot=o.target.valueAsNumber},.1),P("Resolution",6,24,mt,o=>{mt=o.target.valueAsNumber},1)].forEach(pt.appendChild.bind(pt));var Ht=Wt,qt=0,Dt=0,yt=document.createElement("div"),Jt={name:"Move",description:"",element:yt,drawFunc(o,t){let{choosed:e}=o;e instanceof Object&&"move"in e&&(e.move(o.mouseX-e.pos.x,o.mouseY-e.pos.y),t===0?(e.vel.x=0,e.vel.y=0):(e.vel.x=(o.mouseX-qt)/t,e.vel.y=(o.mouseY-Dt)/t),e.ang=0),qt=o.mouseX,Dt=o.mouseY},startInteractionFunc(o){},endInteractionFunc(o){},keyGotUpFunc(o){},keyGotDownFunc(o){}};[S(Jt.name)].forEach(yt.appendChild.bind(yt));var Gt=Jt,bt=document.createElement("div"),Vt={name:"Rectangle wall",description:"",element:bt,drawFunc(o,t){if(o.lastX!==0&&o.lastY!==0){let e=o.cnv.getContext("2d");e.strokeStyle="black",e.strokeRect(o.mouseX,o.mouseY,o.lastX-o.mouseX,o.lastY-o.mouseY)}},startInteractionFunc(o){},endInteractionFunc(o){o.lastX!==0&&o.lastY!==0&&o.physics.addRectWall(o.lastX/2+o.mouseX/2,o.lastY/2+o.mouseY/2,2*Math.abs(o.lastX/2-o.mouseX/2),2*Math.abs(o.lastY/2-o.mouseY/2))},keyGotUpFunc(o){},keyGotDownFunc(o){}};[S(Vt.name)].forEach(bt.appendChild.bind(bt));var zt=Vt,xt=.2,vt=.5,wt=document.createElement("div"),Ut={name:"Rectangle body (experimental)",description:"",element:wt,drawFunc(o,t){let e=o.cnv.getContext("2d");o.lastX!==0&&o.lastY!==0&&(e.strokeStyle="black",e.strokeRect(o.mouseX,o.mouseY,o.lastX-o.mouseX,o.lastY-o.mouseY))},startInteractionFunc(o){},endInteractionFunc(o){o.lastX!==0&&o.lastY!==0&&o.physics.addRectBody(o.lastX/2+o.mouseX/2,o.lastY/2+o.mouseY/2,2*Math.abs(o.lastX/2-o.mouseX/2),2*Math.abs(o.lastY/2-o.mouseY/2),vt,xt)},keyGotUpFunc(o){},keyGotDownFunc(o){}};[S(Ut.name),P("Bounciness",.07,.3,xt,o=>{xt=o.target.valueAsNumber},.02),P("Coefficient of friction",0,.6,vt,o=>{vt=o.target.valueAsNumber},.1)].forEach(wt.appendChild.bind(wt));var $t=Ut,Y=35,he=.5,at=1.5,Mt=24,Pt=1,St=document.createElement("div"),Kt={name:"Soft square creator",description:"",element:St,drawFunc(o,t){let e=o.cnv.getContext("2d");e.strokeStyle="black",e.beginPath(),e.moveTo(o.mouseX-Y,o.mouseY-Y),e.lineTo(o.mouseX+Y,o.mouseY-Y),e.lineTo(o.mouseX+Y,o.mouseY+Y),e.lineTo(o.mouseX-Y,o.mouseY+Y),e.lineTo(o.mouseX-Y,o.mouseY-Y),e.stroke(),o.lastX!==0&&o.lastY!==0&&(e.beginPath(),e.moveTo(o.mouseX,o.mouseY),e.lineTo(o.lastX,o.lastY),e.stroke())},startInteractionFunc(o){},endInteractionFunc(o){if(o.lastX!==0&&o.lastY!==0){let t=new k(new s(o.lastX,o.lastY),new s(o.lastX-o.mouseX,o.lastY-o.mouseY),Y,he,0,at);Number.isFinite(t.pos.x)&&Number.isFinite(t.pos.y)&&Number.isFinite(t.vel.x)&&Number.isFinite(t.vel.y)&&o.physics.addSoftSquare(t.pos,Y*2,at,t.vel,Mt,Pt)}},keyGotUpFunc(o){},keyGotDownFunc(o){}};[S(Kt.name),P("Size",5,100,Y,o=>{Y=o.target.valueAsNumber}),P("Pressure",.4,7,Pt,o=>{Pt=o.target.valueAsNumber},.1),P("Coefficient of friction",0,2,at,o=>{at=o.target.valueAsNumber},.1),P("Resolution",16,48,Mt,o=>{Mt=o.target.valueAsNumber},8)].forEach(St.appendChild.bind(St));var Qt=Kt,It=!1,_=1e4,Ct=document.createElement("div"),Zt={name:"Spring creator",description:"",element:Ct,drawFunc(o,t){let e=o.cnv.getContext("2d");o.lastX!==0&&o.lastY!==0&&(e.strokeStyle="black",e.beginPath(),e.moveTo(o.mouseX,o.mouseY),e.lineTo(o.lastX,o.lastY),e.stroke())},startInteractionFunc(o){},endInteractionFunc(o){if(o.lastX!==0&&o.lastY!==0){let t=o.physics.getObjectAtCoordinates(o.mouseX,o.mouseY),e,n=C;if(t||(t={x:o.mouseX,y:o.mouseY,pinPoint:!0}),o.choosed===t||o.choosed===void 0&&t===void 0)return;if(o.choosed instanceof Object&&t instanceof Object&&"pinPoint"in o.choosed&&"pinPoint"in t)return;if(o.choosed instanceof Object&&t instanceof Object&&"pinPoint"in o.choosed&&"pos"in t?(e=new n(Math.sqrt((o.choosed.x-t.pos.x)**2+(o.choosed.y-t.pos.y)**2),_),e.attachObject(t),e.pinHere(o.choosed.x,o.choosed.y)):t instanceof Object&&o.choosed instanceof Object&&"pos"in o.choosed&&"pinPoint"in t?(e=new n(Math.sqrt((o.choosed.pos.x-t.x)**2+(o.choosed.pos.y-t.y)**2),_),e.attachObject(o.choosed),e.pinHere(t.x,t.y)):o.choosed instanceof Object&&t instanceof Object&&"pos"in o.choosed&&"pos"in t&&(e=new n(Math.sqrt((o.choosed.pos.x-t.pos.x)**2+(o.choosed.pos.y-t.pos.y)**2),_),e.attachObject(o.choosed),e.attachObject(t)),typeof e=="undefined")return;o.physics.addSpring(e),It&&e.lockRotation()}},keyGotUpFunc(o){},keyGotDownFunc(o){}};[S(Zt.name),nt("Rotation locked",It,o=>{It=o.target.checked}),P("Spring stiffness",2e3,1e5,_,o=>{_=o.target.valueAsNumber},50)].forEach(Ct.appendChild.bind(Ct));var _t=Zt,kt=!1,Et=document.createElement("div"),At={name:"Stick creator",description:"",element:Et,drawFunc(o,t){let e=o.cnv.getContext("2d");o.lastX!==0&&o.lastY!==0&&(e.strokeStyle="black",e.beginPath(),e.moveTo(o.mouseX,o.mouseY),e.lineTo(o.lastX,o.lastY),e.stroke())},startInteractionFunc(o){},endInteractionFunc(o){if(o.lastX!==0&&o.lastY!==0){let t=o.physics.getObjectAtCoordinates(o.mouseX,o.mouseY),e,n=X;if(t||(t={x:o.mouseX,y:o.mouseY,pinPoint:!0}),o.choosed===t||o.choosed===void 0&&t===void 0)return;if("pinPoint"in o.choosed&&"pinPoint"in t)return;if("pinPoint"in o.choosed&&"pos"in t?(e=new n(Math.sqrt((o.choosed.x-t.pos.x)**2+(o.choosed.y-t.pos.y)**2)),e.attachObject(t),e.pinHere(o.choosed.x,o.choosed.y)):"pinPoint"in t&&"pos"in o.choosed?(e=new n(Math.sqrt((o.choosed.pos.x-t.x)**2+(o.choosed.pos.y-t.y)**2)),e.attachObject(o.choosed),e.pinHere(t.x,t.y)):"pos"in o.choosed&&"pos"in t&&(e=new n(Math.sqrt((o.choosed.pos.x-t.pos.x)**2+(o.choosed.pos.y-t.pos.y)**2)),e.attachObject(o.choosed),e.attachObject(t)),typeof e=="undefined")return;o.physics.addSpring(e),kt&&e.lockRotation()}},keyGotUpFunc(o){},keyGotDownFunc(o){}};[S(At.name),nt("Rotation locked",kt,o=>{kt=o.target.checked})].forEach(Et.appendChild.bind(Et));var te=At,rt=20,Ot=document.createElement("div"),ee={name:"Wall drawer",description:"",element:Ot,drawFunc(o,t){let e=o.cnv.getContext("2d");e.strokeStyle="black",e.beginPath(),e.arc(o.mouseX,o.mouseY,rt,0,2*Math.PI),e.stroke(),o.lastX!==0&&o.lastY!==0&&o.physics.addFixedBall(o.mouseX,o.mouseY,rt)},startInteractionFunc(o){},endInteractionFunc(o){},keyGotUpFunc(o){},keyGotDownFunc(o){}};[S(ee.name),P("Size",5,70,rt,o=>{rt=o.target.valueAsNumber})].forEach(Ot.appendChild.bind(Ot));var se=ee,ne=[Lt,zt,se,te,_t,Gt,Ht,Qt,Rt,$t];var V=ne,ct=V.map(o=>o.name),N={white:"#faf3dd",green:"#02c39a",pink:"#e58c8a",blue:"#77b6ea",black:"#363732"},ie=class{constructor(){this.resizeCanvas=()=>{let t=this.canvasHolder.getBoundingClientRect();this.cnv.width=t.width,this.cnv.height=window.innerHeight-t.top;let e=window.devicePixelRatio||1,n=t;this.cnv.width=n.width*e,this.cnv.height=n.height*e,this.cnv.style.width=`${n.width}px`,this.cnv.style.height=`${n.height}px`,this.scaling=1/e,this.physics.setBounds(0,0,this.cnv.width,this.cnv.height);let i=this.cnv.getContext("2d");i&&(i.scale(e,e),i.lineWidth=e),this.defaultSize=(this.cnv.width+this.cnv.height)/80};this.drawFunction=()=>{var n,i;Number.isFinite(this.lastFrameTime)||(this.lastFrameTime=performance.now());let t=performance.now()-this.lastFrameTime;Number.isFinite(t)||(t=0),t/=1e3;let e=this.cnv.getContext("2d");e.fillStyle=N.black,e.fillRect(0,0,this.cnv.width,this.cnv.height),e.save(),e.translate(this.viewOffsetX,this.viewOffsetY),e.scale(this.scaling,this.scaling),(i=(n=V[this.mode]).drawFunc)==null||i.call(n,this,t*this.timeMultiplier),this.physicsDraw(),e.restore(),this.physics.balls[0]&&(this.right&&(this.physics.balls[0].ang-=Math.PI*100*t),this.left&&(this.physics.balls[0].ang+=Math.PI*100*t)),t*=this.timeMultiplier,this.physics.update(t/5,!1),this.physics.update(t/5,!1),this.physics.update(t/5,!1),this.physics.update(t/5,!1),this.physics.update(t/5,!1),this.lastFrameTime=performance.now(),requestAnimationFrame(this.drawFunction)};this.startInteraction=(t,e)=>{var n,i;this.mouseX=t/this.scaling-this.viewOffsetX/this.scaling,this.mouseY=e/this.scaling-this.viewOffsetY/this.scaling,this.choosed=this.physics.getObjectAtCoordinates(this.mouseX,this.mouseY),this.choosed||(this.choosed={x:this.mouseX,y:this.mouseY,pinPoint:!0}),this.lastX=this.mouseX,this.lastY=this.mouseY,(i=(n=V[this.mode]).startInteractionFunc)==null||i.call(n,this)};this.endInteraction=(t,e)=>{var n,i;if(this.mouseX=t/this.scaling-this.viewOffsetX/this.scaling,this.mouseY=e/this.scaling-this.viewOffsetY/this.scaling,(i=(n=V[this.mode]).endInteractionFunc)==null||i.call(n,this),this.lastX===0&&this.lastY===0)return;this.lastX=0,this.lastY=0,this.choosed=!1};this.keyGotDown=t=>{let e=t.key;e==="s"&&this.spawnNewtonsCradle(this.cnv.width/2,this.cnv.height/2,.5,this.physics),e==="a"&&(this.scaling+=.01),e==="d"&&(this.scaling-=.01),e==="j"&&(this.viewOffsetX-=10),e==="l"&&(this.viewOffsetX+=10),e==="k"&&(this.viewOffsetY-=10),e==="i"&&(this.viewOffsetY+=10),e==="ArrowRight"&&(this.right=!0),e==="ArrowLeft"&&(this.left=!0)};this.keyGotUp=t=>{let e=t.key;e==="ArrowRight"&&(this.right=!1),e==="ArrowLeft"&&(this.left=!1)};this.startTouch=t=>{t.preventDefault();let e=this.canvasHolder.getBoundingClientRect();return this.startInteraction(t.changedTouches[0].clientX-e.left,t.changedTouches[0].clientY-e.top),!1};this.endTouch=t=>{t.preventDefault();let e=this.canvasHolder.getBoundingClientRect();return this.endInteraction(t.changedTouches[0].clientX-e.left,t.changedTouches[0].clientY-e.top),!1};this.moveTouch=t=>{t.preventDefault();let e=this.canvasHolder.getBoundingClientRect();return this.mouseX=t.changedTouches[0].clientX-e.left,this.mouseY=t.changedTouches[0].clientY-e.top,this.mouseX=this.mouseX/this.scaling-this.viewOffsetX/this.scaling,this.mouseY=this.mouseY/this.scaling-this.viewOffsetY/this.scaling,!1};this.startMouse=t=>(this.startInteraction(t.offsetX,t.offsetY),!1);this.endMouse=t=>(this.endInteraction(t.offsetX,t.offsetY),!1);this.handleMouseMovement=t=>{this.mouseX=t.offsetX,this.mouseY=t.offsetY,this.mouseX=this.mouseX/this.scaling-this.viewOffsetX/this.scaling,this.mouseY=this.mouseY/this.scaling-this.viewOffsetY/this.scaling};this.physicsDraw=()=>{let t=this.cnv.getContext("2d");if(t){t.fillStyle=N.green,t.strokeStyle="black";for(let n=0;n<this.physics.balls.length;n+=1){let i=this.physics.balls[n];t.beginPath(),t.arc(i.pos.x,i.pos.y,i.r,0,2*Math.PI),t.stroke(),t.fill(),t.beginPath(),t.moveTo(i.pos.x,i.pos.y),t.lineTo(i.pos.x+i.r*Math.cos(i.rotation),i.pos.y+i.r*Math.sin(i.rotation)),t.stroke()}this.physics.bodies.forEach(n=>{t.beginPath(),t.moveTo(n.points[n.points.length-1].x,n.points[n.points.length-1].y),n.points.forEach(i=>{t.lineTo(i.x,i.y)}),t.stroke(),t.fill(),t.beginPath(),t.arc(n.pos.x,n.pos.y,1.5,0,Math.PI*2),t.stroke()});let e=n=>{t.beginPath(),t.moveTo(n.points[n.points.length-1].x,n.points[n.points.length-1].y),n.points.forEach(i=>{t.lineTo(i.x,i.y)}),t.fill()};t.fillStyle="white",this.physics.walls.forEach(e),this.physics.bounds.forEach(e),this.physics.fixedBalls.forEach(n=>{t.beginPath(),t.arc(n.x,n.y,n.r,0,Math.PI*2),t.fill()}),t.save(),t.lineWidth=2,this.physics.springs.forEach(n=>{if(n instanceof C&&!(n instanceof X)){let i,a,c,h;n.pinned&&typeof n.pinned=="object"?(i=n.pinned.x,a=n.pinned.y,c=n.objects[0].pos.x,h=n.objects[0].pos.y):(i=n.objects[0].pos.x,a=n.objects[0].pos.y,c=n.objects[1].pos.x,h=n.objects[1].pos.y);let l=new s(c-i,h-a),u=l.copy;l.rotate(Math.PI/2),l.setMag(5);let r=new s(i,a),d=Math.floor(n.length/10);for(let f=1;f<=d;f+=1)t.strokeStyle=N.blue,t.fillStyle=N.blue,f===d&&(l=new s(0,0)),t.beginPath(),t.moveTo(r.x,r.y),t.lineTo(i+f/d*u.x+l.x,a+f/d*u.y+l.y),t.stroke(),r=new s(i+f/d*u.x+l.x,a+f/d*u.y+l.y),l.mult(-1)}else t.strokeStyle=N.blue,t.fillStyle=N.blue,t.beginPath(),t.moveTo(n.objects[0].pos.x,n.objects[0].pos.y),t.lineTo(typeof n.pinned=="object"?n.pinned.x:n.objects[1].pos.x,typeof n.pinned=="object"?n.pinned.y:n.objects[1].pos.y),t.stroke();n.objects.forEach(i=>{t.strokeStyle="black",t.fillStyle=N.blue,t.beginPath(),t.arc(i.pos.x,i.pos.y,2.5,0,Math.PI*2),t.fill(),t.stroke()}),typeof n.pinned=="object"&&(t.strokeStyle="black",t.fillStyle=N.blue,t.beginPath(),t.arc(n.pinned.x,n.pinned.y,3,0,Math.PI*2),t.fill(),t.stroke())}),t.restore()}};this.spawnNewtonsCradle=(t,e,n,i)=>{let a=[],c=25,h=250,l=8;a.push(new k(new s(t,e),new s(0,0),n*c,1,0,0));let u=1;for(let r=0;r<l-1;r+=1)a.push(new k(new s(t+u*n*c*1.01*2,e),new s(0,0),n*25,1,0,0)),u*=-1,u>0&&(u+=1),r===l-2&&(a[a.length-1].vel.x=-Math.sign(u)*n*c*8);a.forEach(r=>{i.addBall(r);let d=new X(h);d.attachObject(r),d.pinHere(r.pos.x,r.pos.y-h),i.addSpring(d),d.lockRotation()})};this.modeButtonClicked=t=>{let e=t.target.id.replace("-btn",""),n=ct.indexOf(e);this.switchToMode(n)};this.switchToMode=t=>{let e=document.getElementById(`${ct[this.mode]}-btn`);e&&e.classList.remove("bg-pink-darker"),this.sidebar.innerHTML="";let n=document.getElementById(`${ct[t]}-btn`);n&&n.classList.add("bg-pink-darker"),this.mode=t,this.sidebar.appendChild(V[this.mode].element)};this.setupModes=()=>{let t=document.getElementById("button-holder");ct.forEach((e,n)=>{let i=document.createElement("div");i.classList.add("big-button"),i.classList.add("fix-width"),i.id=`${e}-btn`,i.textContent=V[n].name,i.onclick=this.modeButtonClicked,t&&t.appendChild(i)}),this.switchToMode(this.mode)};this.setTimeMultiplier=t=>{Number.isFinite(t)&&(this.timeMultiplier=t)};this.getTimeMultiplier=()=>this.timeMultiplier;this.setPhysics=t=>{t instanceof Q&&(this.physics=t)};this.getPhysics=()=>this.physics;this.physics=new Q,this.mouseX=0,this.mouseY=0,this.mouseDown=!1,this.defaultSize=30,this.k=.5,this.fc=2,this.springConstant=2e3,this.scaling=1,this.viewOffsetX=0,this.viewOffsetY=0,this.mode=0,this.lastX=0,this.lastY=0,this.timeMultiplier=1,this.lastFrameTime=performance.now(),this.choosed=!1,this.left=!1,this.right=!1,this.cnv=document.getElementById("defaulCanvas0"),this.canvasHolder=document.getElementById("canvas-holder"),this.sidebar=document.getElementById("sidebar"),this.physics.setBounds(0,0,this.cnv.width,this.cnv.height),this.physics.setGravity(new s(0,1e3)),this.physics.setAirFriction(.9),this.cnv.addEventListener("touchstart",this.startTouch,!1),this.cnv.addEventListener("touchend",this.endTouch,!1),this.cnv.addEventListener("touchmove",this.moveTouch,!1),this.cnv.addEventListener("mousedown",this.startMouse,!1),this.cnv.addEventListener("mouseup",this.endMouse,!1),this.cnv.addEventListener("mousemove",this.handleMouseMovement,!1),document.addEventListener("keydown",this.keyGotDown,!1),document.addEventListener("keyup",this.keyGotUp,!1),window.addEventListener("resize",this.resizeCanvas,!1),this.cnv.addEventListener("mousedown",()=>{this.mouseDown=!0},!1),this.cnv.addEventListener("mouseup",()=>{this.mouseDown=!1},!1),this.resizeCanvas(),this.setupModes(),ht(this),requestAnimationFrame(this.drawFunction)}},oe=ie;window.onload=()=>{window.editorApp=new oe};})();
//# sourceMappingURL=main.js.map
